/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/* global gridjs */

var alterTableData = {};
var updateDataInfo = {};
var bodyTop = 20;
var bodySourceTop = 20;
var sourceFirst = true;
var operatorI = 0;
var sourceOperatorI = 0;
var linkedDataObj = {};
var savedDBData = {};
var sourceTables = [];
var windowHeight;
var pageHeight;
var pageOperations;
var gridHeight;
var gridHeightInner;
var tabHeightInner;
var buttonGroups = "";
var $pageBodycontainer;
var pageBodycontinerPadding;
var TabExcelStatus;
var pageOperations1;
var gridMainHeight;
var selectConnObj;
var selectColumnsObj;
var selectedDataBase;
var globalTreeObj;
var cubePreviousOperatorId;
var currentTabId;
var processLogInterval = null;
var processScheduledJobLogInterval = null;
var trfmRulesChanged = false;
var previousOperatorId;
var treeIconClickEvent;
var operatorDoublClick = false;
var prevTargetOperatorId = null;
var globalFileTreeItem = {};
var selectedItems = [];
var imagepath;
var HtmlEntities = {
    " ": "&nbsp;"
};

var flowChartWorkSpaceId = 'flowchartworkSourcesspace';

$(document).dblclick(function (evt) {

    if ($(evt.target).closest('#etlIconGroup').length > 0) {
        return;
    } else {
        $("#etlIconGroup").hide();
    }
});

$(document).on('keydown', function (e) {
    // if key is Delete/Back Space
    if (e.which == 46 || e.which == 8) {
        // remove the same div you clicked on
        var selectedTypeVal = e.currentTarget.activeElement.type;
        if (selectedTypeVal != null
                && (selectedTypeVal == 'input'
                        || selectedTypeVal == 'textarea'
                        || selectedTypeVal == 'text'
                        || selectedTypeVal == 'checkbox'
                        || selectedTypeVal == 'password'
                        || selectedTypeVal == 'hidden'
                        || selectedTypeVal == 'date'
                        || selectedTypeVal == 'number'
                        || selectedTypeVal == 'select')) {
            // console.log('selectedClassVal::::'+selectedClassVal);
        } else {
            // remove the same div you clicked on
            deleteSelectedOporLink();
        }

    } else if (e.which == 17 && e.which == 13) {
        var activeElement = e.currentTarget.activeElement;
        var currentEditorId = activeElement.id;
        if (currentEditorId != null && currentEditorId.indexOf("_editor_") > -1) {
            executeEditorScripts("editorViewDiv");
        }
    }
});
$(function () {
    var theme = $("#ssUserThemeName").val();
    if (theme == '-Light' || theme == '-Dark') {
        imagepath = 'images/Multi_Theme_Images';
    } else {
        imagepath = 'images';
    }

    if (!String.prototype.endsWith) {
        String.prototype.endsWith = function (suffix) {
            return this.indexOf(suffix, this.length - suffix.length) !== -1;
        };
    }
//visionTdETLIcons
    $("#treeSearchInputDiv").hide();

    $("#etlIconGroup div, #cubeRelatedICONS div").draggable({
        cursor: "move",
        opacity: 0.7,
        helper: 'clone',
        containment: "#jqxWidget",
//                                appendTo: 'body',
        zIndex: 1000,
        helper: function (event, ui) {
            var $this = $(this);
            var innerText = $this.text();
            var descripttion = $this.attr("title");
            var operatorData = {
                top: event.screenX,
                left: event.screenY,

                properties: {
                    body: '<div title="' + descripttion + '" class="visionOpLabelDiv">' + innerText + '</div>',
                    inputs: {
                        input_1: {
                            label: '',
                            multipleLinks: true
                        }
                    },
                    outputs: {
                        output_1: {
                            label: '',
                            multipleLinks: true

                        }
                    }
                }
            };
//            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
            var contentSplitterStyle = $("#contentSplitter").css("display");

            var contentSplitter1Style = $("#contentSplitter1").css("display");

            var $flowchart;

            if (contentSplitterStyle == "block") {
                $flowchart = $('#' + flowChartWorkSpaceId);

            } else if (contentSplitter1Style == "block") {
                $flowchart = $('#dataModellerFlowchartworkSourcesspace');

            }
            return  $flowchart.flowchart('getOperatorElement', operatorData);
//            return  $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
        },
        stop: function (e, ui) {
            $(".flowchart-operator-connector-label").hide();
            var contentSplitterStyle = $("#contentSplitter").css("display");

            var contentSplitter1Style = $("#contentSplitter1").css("display");

            var $flowchart;
            var $container;
            if (contentSplitterStyle == "block") {
                $flowchart = $('#' + flowChartWorkSpaceId);
                $container = $('#' + flowChartWorkSpaceId);
            } else if (contentSplitter1Style == "block") {
                $flowchart = $('#dataModellerFlowchartworkSourcesspace');
                $container = $('#dataModellerFlowchartworkSourcesspace');
            }

//            var $flowchart = $('#'+flowChartWorkSpaceId);
//            var $container = $('#'+flowChartWorkSpaceId);
            var $this = $(this);
            var innerText = $this.html();
            var title = $(this).attr("data-optitle");
            if (!(title != null && title != '')) {
                title = $(this).attr("title");
            }
            var imgsrc = $(this).attr("data-imgsrc");
            var iconType = $(this).attr("data-type");
            var component = $(this).attr("component"); // ravi component
            var functionName = $(this).attr("data-functionname");
            if (!(functionName != null && functionName != '')) {
//                functionName = "showTranformationRules(this)";
            }
            var jobId;
            var jobName;
            if (previousOperatorId != null) {
                var previousMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
                jobId = previousMapOperatorData['jobId'];
                jobName = previousMapOperatorData['jobName'];
            }
            trfmRulesChanged = true;
//            var title = "Click here to add transformation rules";

            var elOffset = ui.offset;
            var containerOffset = $container.offset();
            if (elOffset.left > containerOffset.left &&
                    elOffset.top > containerOffset.top &&
                    elOffset.left < containerOffset.left + $container.width() &&
                    elOffset.top < containerOffset.top + $container.height()) {
                var flowchartOffset = $flowchart.offset();
                var relativeLeft = elOffset.left - flowchartOffset.left;
                var relativeTop = elOffset.top - flowchartOffset.top;
                var positionRatio = $flowchart.flowchart('getPositionRatio');
                relativeLeft /= positionRatio;
                relativeTop /= positionRatio;
                elOffset.left = relativeLeft;
                elOffset.top = relativeTop;
            }
//            var divId = "mapDivId_" + 0;
//            if ($("#" + divId).length == 0) {
//                //it doesn't exist
//            }else{
//                
//            }
            //mapDivId:'',
            var data = {
                top: elOffset.top,
                left: elOffset.left,
                iconType: iconType,
                component: component,
                jobName: jobName,
                jobId: jobName,
                timeStamp: new Date().getTime(),
//                statusLebel: innerText,
                properties: {

//                                title: innerText,
                    body: '<div  title="' + title + '" ondblclick=' + functionName
                            + ' class="visionMapOperator"><img src="' + imgsrc + '" class="visionETLIcons" '
                            + 'style="width:20px;height: 20px;"/></div>',
                    inputs: {
                        input_1: {
                            label: 'I-' + iconType,
                            multipleLinks: true
                        }
                    },
                    outputs: {
                        output_1: {
                            label: 'O-' + iconType,
                            multipleLinks: true

                        }
                    }
                }
            };
            var operatorId = $flowchart.flowchart('addOperator', data);
            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();
            console.log("operatorId:::" + operatorId);
//            console.error("operatorId:::" + operatorId);
            var component = $(this).attr("component");
            if (component != "Y") {
                inputOutPutPopUp(operatorId);
            }
        }
    });
    $("#treeSearchValue").keyup(function (event) {
        if (event.keyCode === 13) {
            // Cancel the default action, if needed
//            event.preventDefault();
            $("#treeNodeSearchIconId").click();
        }
    });

    showEtlList('savedSources', 'newConnections');

});
$(document).ready(function () {


    showSavedJobs();
// $('#designViewTab').jqxTabs({width: "100%", height: "100%", position: 'bottom', theme: 'ui-redmond', reorder: true});

    $("#savedConnections").on('mousedown', function (event) {


        var target = $(event.target).parents('li:first')[0];
        var rightClick = isRightClick(event);
        if (rightClick && target != null) {
            $("#savedConnections").jqxTree('selectItem', target);

            var selectedItem = $('#savedConnections').jqxTree('getSelectedItem');
            if (selectedItem.level == 5 || selectedItem.level == 4) {
                var menuItems = "";
                var menuHeight;
                var columnObj = globalTreeObj['treeColumnObj'][selectedItem.level];
                var initParams = columnObj.TREE_INIT_PARAMS;
                if (initParams != null) {
                    var rightClickFunc = initParams.uuu_RightClickFunc;
                    if (rightClickFunc != null) {
                        var options = rightClickFunc.split(";");
                        menuHeight = options.length;
                        $.each(options, function (index) {
                            var menuItem = options[index].split(":")[0];
                            var funcName = options[index].split(":")[1];
                            menuItems += "<li onclick='" + funcName + "'>" + menuItem + "</li>"
                        });
                    }
                }
                $("#jqxMenu").remove();
                $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
                $("#jqxMenu ul").html(menuItems);
                var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 30 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start




            } else if (selectedItem.level == 3) {// ravi start
                var height = 1;
                var parentListItem = selectedItem.parentElement.parentElement.parentElement;
                if (parentListItem != null) {
                    var selectedParentItem = $('#savedConnections').jqxTree('getItem', parentListItem);
                }


                //   PKH View file data START--->  


                var item = $("#savedConnections").jqxTree('getSelectedItem');
                var fileType = "";
                var title = item.label;
                var fileExtensions = [".xlsx", ".xls", ".XLS", ".XLSX", ".txt", ".csv", ".xml", ".TXT", ".CSV", ".XML", ".JSON", ".json"];
                if (item != null && !item.hasItems && title != null && title != '') {
                    for (var i = 0; i < fileExtensions.length; i++) {
                        if (title.endsWith(fileExtensions[i]) > -1) {
                            fileType = fileExtensions[i];
                            break;
                        }
                    }
                }
                var fileType = "." + title.substr((title.lastIndexOf('.') + 1));
                var fileObj = {};
                var filePath = item['value'];
                if (filePath != null && filePath.lastIndexOf("\\") > -1) {
                    filePath = filePath.substring(filePath.lastIndexOf("\\") + 1);
                }
                fileObj['filePath'] = filePath;
                fileObj['fileType'] = fileType;

                for (var entitykey in HtmlEntities) {
                    var entity = HtmlEntities[entitykey];
                    var regex = new RegExp(entitykey, 'g');
                    title = title.replace(regex, entity);
                }
                fileObj['fileName'] = title;



                //   PKH View file data end ----->  

                if (selectedParentItem != null && selectedParentItem.label == "Files") {
                    height = 2;
                    var menuItems = "<li onclick='deleteFile()'>Delete</li>";
                    menuItems += "<li onclick=viewFileData('" + JSON.stringify(fileObj) + "')>View File Data</li>";
                    $("#jqxMenu").remove();
                    $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
                    $("#jqxMenu ul").html(menuItems);
                    var contextMenu = $("#jqxMenu").jqxMenu({width: '140px', height: height * 30 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start

                } else {
                    var menuItems = "";
                    height = 1;
                    if (selectedItem.value != "Current_V10") {
                        menuItems += "<li onclick='viewConnection()'>View</li>";
                        menuItems += "<li onclick='deleteConnection()'>Delete</li>";
                        height = 3;
                    }
                    menuItems += "<li onclick=viewSQLEditor('" + selectedItem.value + "')>SQL</li>";
                    $("#jqxMenu").remove();
                    $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
                    $("#jqxMenu ul").html(menuItems);
                    var contextMenu = $("#jqxMenu").jqxMenu({width: '140px', height: height * 30 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start
                }
            } else { // ravi end
                return false;
            }


            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();

            contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
            return false;
        }
    });

// ravi start
    $("#schemaObjectsDiv").on('mousedown', function (event) {

        var target;
        if ($(event.target).hasClass('visionObjectNameDiv')) {
            target = $(event.target);


        } else {
            target = $(event.target).parents('div.visionObjectNameDiv')[0];
        }



        var rightClick = isRightClick(event);
        if (rightClick && target != null) {

            $(".visionObjectNameDiv").removeClass("visionSelectedObject");
            $(target).addClass("visionSelectedObject");
            $(".visionObjectNameDiv").find('span').removeClass("visionHighlightTables");
            $(target).find('span').addClass("visionHighlightTables");
            var menuItems = "";
            var menuHeight;
            var columnObj = globalTreeObj['treeColumnObj'][5];
            var initParams = columnObj.TREE_INIT_PARAMS;
            if (initParams != null) {
                var rightClickFunc = initParams.uuu_RightClickFunc;
                if (rightClickFunc != null) {
                    var options = rightClickFunc.split(";");
                    menuHeight = options.length;
                    $.each(options, function (index) {
                        var menuItem = this.split(":")[0];
                        var funcName = this.split(":")[1];
                        menuItems += "<li onclick='" + funcName + "'>" + menuItem + "</li>"
                    });
                }
            }

            $("#jqxMenu").remove();
            $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
            $("#jqxMenu ul").html(menuItems);
            var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 30 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start

            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();

            contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
            return false;
        }
    });
    $("#availableJobsId").on('mousedown', function (event) {


        var target = $(event.target).parents('li:first')[0];
        var treeItem = $(event.target).closest('.visionETLAvailableJobs');
        var rightClick = isRightClick(event);
        if (rightClick && target != null && treeItem.length > 0) {
            $("#avaialableJobsTree").jqxTree('selectItem', target);

            var selectedItem = $('#avaialableJobsTree').jqxTree('getSelectedItem');
            var jobId = $(target).find("div.visionETLAvailableJobs").attr("id");
            var menuItems = "<li onclick=\"rightClickProcessJob('" + jobId + "')\">Execute</li>";
            menuItems += "<li onclick=\"deleteJob('" + jobId + "')\">Delete</li>";
            menuItems += "<li onclick=\"copyJob('" + jobId + "')\">Copy</li>"; // -----------------ravi copy job
            menuItems += "<li onclick=\"scheduleJob('" + jobId + "')\">Schedule</li>";
            var menuHeight = 4;

            $("#jqxMenu").remove();
            $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
            $("#jqxMenu ul").html(menuItems);
            var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 27.5 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start


            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();

            contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
            return false;
        }
        if (rightClick && target != null && treeItem.length == 0) { // // -----------------ravi new job
            $("#avaialableJobsTree").jqxTree('selectItem', target);

            var selectedItem = $('#avaialableJobsTree').jqxTree('getSelectedItem');

            var menuItems = "<li onclick=\"createNewJob()\">New Job</li>"
                    + "<li onclick=\"createNewSaveJobFolder()\">New Folder</li>"
                    + "<li onclick=\"deleteFolder()\">Delete Folder</li>"

            var menuHeight = 3;


            $("#jqxMenu").remove();
            $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
            $("#jqxMenu ul").html(menuItems);
            var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 30 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start

            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();

            contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
            return false;
        }
    });

// disable the default browser's context menu.
    $(document).on('contextmenu', function (e) {
        if ($(e.target).parents('.jqx-tree').length > 0) {
            return false;
        }
        if ($(event.target).parents('div.visionObjectNameDiv').length > 0 || $(event.target).hasClass('visionObjectNameDiv')) {
            return false;
        }

        return true;
    });

    function isRightClick(event) {
        var rightclick;
        if (!event)
            var event = window.event;
        if (event.which)
            rightclick = (event.which == 3);
        else if (event.button)
            rightclick = (event.button == 2);
        return rightclick;
    }

// showSavedJobs();
    $('#editorViewDiv').jqxTabs({width: "100%",
        height: "100%",
        position: 'top',
        theme: 'energyblue',
        reorder: true,
        showCloseButtons: true
    });
    // sql Editor
    $("#Current_V10_editor_1").attr("data-connction-name", "Current_V10");
    var sqlMainEditor = ace.edit("Current_V10_editor_1", {
        mode: "ace/mode/sql",
//        enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
//        showPrintMargin: true, // hides the vertical limiting strip
        fontSize: "100%", // ensures that the editor fits in the environment
        minLines: 5,
        maxLines: 20,
        wrap: true,
        autoScrollEditorIntoView: true
    });
//    sqlMainEditor.getSession().setMode("ace/mode/sql");
    //Current_V10_editor_1_icons_execute
    $("#scriptsExecute").click(function () {
        executeEditorScripts("editorViewDiv");
    });
    $('#Current_V10_editor_1_splitter').jqxSplitter({width: '100%', height: '100%',
        orientation: 'horizontal',
        panels: [{size: "50%", min: 50}, {min: 50, size: "50%"}]});
    $('#jobSchedulingViewSplitter').jqxSplitter({width: '100%', height: '100%',
        orientation: 'vertical',
        panels: [{size: "20%", min: 50}, {min: 50, size: "80%"}]});
    //Current_V10_editor_1_splitter
    // $(".flowchart-example-container").css('height', 10000);

    var formHiddenValue = $('#formJobFlag').val();
    if (formHiddenValue != null && formHiddenValue == 'Y') {
        onSubmitChildJob();
    }


});

$(window).resize(function ()
{
    screenHeight = screen.height;
    windowHeight = $(window).height();
    pageHeight = $(".visionHeader").height() + $(".visionFooterMain").height() + $(".visionBreadcrumMain").height();
    pageOperations = $(".visionGenericTabSubmit").outerHeight(true) > 0 ? $(".visionGenericTabSubmit").outerHeight(true) : "0";
    pageOperations1 = $(".visionGenericTabExport").outerHeight(true) > 0 ? $(".visionGenericTabExport").outerHeight(true) : "0";
    pageOperations = pageOperations >= pageOperations1 ? pageOperations : pageOperations1;
    $pageBodycontainer = $('.visionBodyContent');
    pageBodycontinerPadding = parseInt($pageBodycontainer.css('padding-top')) + parseInt($pageBodycontainer.css('padding-bottom'));
    gridHeight = windowHeight - pageHeight - pageOperations - pageBodycontinerPadding - 5;
//                        if (parseInt(screenHeight) >= 769) {
//                            gridHeight = windowHeight - pageHeight - pageOperations - pageBodycontinerPadding - 200;
//                            console.log("screen height is::::864:::" + screenHeight);
//                        } else {
//                            gridHeight = windowHeight - pageHeight - pageOperations - pageBodycontinerPadding - 150;
//                            console.log("screen height is::::768:::" + screenHeight);
//                        }
    gridHeightInner = gridHeight - $(".visionGenericTabGrid .jqx-tabs-headerWrapper").outerHeight(true);
    gridMainHeight = gridHeightInner - $(".visionGenericTabGrid .jqx-tabs-headerWrapper").outerHeight(true);

}).resize();

// function to adjust splitters height and width in ETL page
function splitterAdjustment(treeObj)
{
    // uttezz tabs
//    flowChartWorkSpaceId = 'flowchartworkSourcesspace';
    var jobId = genHexString(32);
    flowChartWorkSpaceId = "workSpace_" + jobId;
    $("#currentJobId").val(jobId);
    $("#" + flowChartWorkSpaceId).remove();
    $("#feedHeader").append('<div id="flowChartTabs"  class="flowChartTabs flowChartHeaderTabs" style="width: 100%;height: 9%;"><ul class=flowChartTabList><li></li></ul><div></div></div>');
    $('#flowChartTabs').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
    $('#flowChartTabs').jqxTabs('showAllCloseButtons');
    $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
    $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
    $('#flowChartTabs').jqxTabs('removeAt', 0);
    $('#flowChartTabs').jqxTabs('addFirst', "New Tab", '<div  id="' + flowChartWorkSpaceId + '" jobid= "' + jobId + '"class="flowchart-example-container"></div>');
    $("#currentJobId").val(jobId);
    $("#" + flowChartWorkSpaceId).flowchart({
        linkWidth: 2,
        defaultSelectedLinkColor: '#000055',
        grid: 10,
        distanceFromArrow: 0,
        multipleLinksOnInput: true,
        multipleLinksOnOutput: true,
        defaultSelectedLinkColor: 'red',
        onOpeartorContextMenu: function (operatorId) {
            console.log("operatorId:::" + operatorId);
            openOpeartorContextMenu(operatorId);
            return true;
        },
    });
    $("#" + flowChartWorkSpaceId).flowchart({

        onLinkCreate: function (linkId, linkData) {

            var fromOperatorId = linkData['fromOperator'];
            var toOperatorId = linkData['toOperator'];
            var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
            var connectedTo = fromOperatorData['connectedTo'];
            connectedTo = (connectedTo != null) ? connectedTo : [];
            if (connectedTo.indexOf(toOperatorId) == -1) {
                connectedTo.push(toOperatorId)
            }

            fromOperatorData['connectedTo'] = connectedTo;
            $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
            var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
            var connectedFrom = toOperatorData['connectedFrom'];
            connectedFrom = (connectedFrom != null) ? connectedFrom : [];
            if (connectedFrom.indexOf(fromOperatorId) == -1) {
                connectedFrom.push(fromOperatorId)
            }

            toOperatorData['connectedFrom'] = connectedFrom;
            if (toOperatorData['component'] == 'Y') {
                toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                if (toOperatorData['connObj'] == null) {
                    toOperatorData['connObj'] = savedDBData["Current_V10"];
                }
            }
            var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
            var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
            if (originalSources.indexOf(fromTable) == -1) {
                originalSources.push(fromTable);
            }
            toOperatorData['originalSources'] = originalSources;

            var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
            if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                originalSourceOp.push(fromOperatorId);
            }
            toOperatorData['originalSourceOp'] = originalSourceOp;
            $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
            //            setToOpDblCLickFuncName(fromOperator, toOperator);
            return true;
        },
        onAfterChange: function (changeType) {

            if (!operatorDoublClick) {
                trfmRulesChanged = true;
                console.error("trfmRulesChanged : " + trfmRulesChanged);
                return true;
            }
        },
        onOperatorSelect: function (changeType) {
            $(document).find("input").blur();
            return true;

        },
        onLinkSelect: function (changeType) {
            $(document).find("input").blur();
            return true;
        }
    });

    $('#flowChartTabs').on('selected', function (event)
    {
        $("#feedContentArea").html("");

        var clickedItem = event.args.item;
        var jobName = $('#flowChartTabs').jqxTabs('getTitleAt', clickedItem);

        var content = $('#flowChartTabs').jqxTabs('getContentAt', clickedItem);
        var workSpaceId = $(content).attr("id");
        if (workSpaceId != null) {
            flowChartWorkSpaceId = workSpaceId;
        }
        if (workSpaceId == null) {
            workSpaceId = $(content).children('div:nth-child(1)').attr("id");
            var childDiv = $(content).children();
            var childDivID = childDiv[0];
            flowChartWorkSpaceId = childDivID['id'];
        }
        if (workSpaceId == null) {
            workSpaceId = $(content).children('div:nth-child(1)').attr("id");
            var childDiv = $(content).children();
            var childDivID = childDiv[1];
            if (childDivID != null) {
                flowChartWorkSpaceId = childDivID['id'];
            }
            if (childDivID == null) {
                var lastChildId = $(content).children().last();
                var getIdDiv = lastChildId[0];
                var childId = getIdDiv['lastChild'];
                flowChartWorkSpaceId = childId['id'];
            }
        }
        var jobId = flowChartWorkSpaceId.substring(10, 100);
        var jobName = $('#flowChartTabs').jqxTabs('getTitleAt', clickedItem);
        $('#currentJobName').val(jobName);
        $("#currentJobId").val(jobId);
        var divHiddenFileds = $('#' + flowChartWorkSpaceId).find('input[type="hidden"]')
        var id = divHiddenFileds[0].id;
        var name = divHiddenFileds[1].id;
        var folderId = $("#" + id).val();
        var folderName = $("#" + name).val();
        $("#folderIdHidden").val(folderId);
        $("#folderNameHidden").val(folderName);

    });

    // uttezz tabs end

    globalTreeObj = treeObj;
    var levelTabIdHeight = $("#levelTabId").height();
    var visionClusterSpliterMainHeight = $("#visionClusterSpliterMain").height();
    var levelTabIdHeight = $("#levelTabId").height();
    var visionClusterSpliterMainHeight = $("#visionClusterSpliterMain").height();
    var pageHeight = $(".visionHeader").height() + $(".visionFooterMain").height() + $(".visionBreadcrumMain").height();
    var pageHeight1 = $(".visionHeader").height() + $(".visionFooterMain").height();
    var splitterHeight = (parseInt($(window).height()) - parseInt(pageHeight1)) - 10;
    hideBreadcrumb();
    var rss = (function ($) {
        var createWidgets = function () {
            $('#mainSplitter').jqxSplitter({width: '99.3%',
                height: parseInt(splitterHeight),
                panels: [{size: "20%"}, {min: '60%', size: "79.3%"}]});
            $('#contentSplitter').jqxSplitter({width: '100%', height: '100%',
                orientation: 'horizontal',
                panels: [{size: "70%", min: 200}, {min: 30, size: "30%"}]});

            $("#availableJobsDiv").jqxSplitter({width: '99%', height: parseInt(splitterHeight), orientation: 'horizontal'});

            $('#contentSplitter1').jqxSplitter({width: '100%', height: '100%',
                orientation: 'horizontal',
                panels: [{size: "70%", min: 200}, {min: 30, size: "30%"}]});

            $('#childJobContentSplitter').jqxSplitter({width: '100%', height: '100%',
                orientation: 'horizontal',
                panels: [{size: "70%", min: 200}, {min: 30, size: "30%"}]});

            var contentSplitterHeight = $("#feedListExpander").height();
            console.log("contentSplitterHeight:::" + contentSplitterHeight);
            $(".flowchart-example-container").css('height', parseInt(contentSplitterHeight) - 22);
//            $('#connectionsTabs').jqxRibbon({width:5, height: "100%", position: 'left',selectionMode: 'click',mode: 'popup'});
//            $('#connectionsTabs')jqxTabs.({width: "100%", height: "100%", position: 'top', theme: 'energyblue', reorder: true});
//            $('#designViewTab').jqxTabs({width: "100%", height: "100%",position: 'bottom',theme:'energyblue',reorder: true});
            treeSourcesMenus('ETL_DM_TREE_SOURCES', 'savedSources');
//            showUploadedFiles('MM_TREE_UPLOADED_FILES', 'uploadSourceFiles');
            treeSavedConnections(treeObj, 'savedConnections');
            $('#contentSplitter').on('resize', function (event) {
                var feedContentAreaHeight = $('#feedContentArea').height();
                $('table#sourceDestColsTableId tbody').css('height', parseInt(feedContentAreaHeight) - 70);
                $('table#sourceDestColsTableId tbody').css('overflow-y', 'scroll');
                var contentSplitterHeight = $("#feedListExpander").height();
                console.log("contentSplitterHeight:::" + contentSplitterHeight);
                $(".flowchart-example-container").css('height', parseInt(contentSplitterHeight) - 22);
                if (event.args != null) {
                    var panels = event.args.panels;
                    if (panels != null) {
                        // get first panel.
                        var panel1 = panels[0].size;
                        // get second panel.
                        var panel2 = panels[1].size;
                        try {
                            // commented by Ashwini for scroll bar issue
//                            console.log("Tabs Height:Before:" + $("#dataMigrationTabs").jqxTabs("height"));
//                            $("#dataMigrationTabs").jqxTabs({height: ((parseInt(panel2) - 35) + "px")});
//                            console.log("Tabs Height:After:" + $("#dataMigrationTabs").jqxTabs("height"));
//                            $("#dataMigrationTabs .jqx-tabs-content").attr('style', 'height: ' + $("#dataMigrationTabs").jqxTabs("height") + 'px !important');

                        } catch (e) {
                        }
                    }

                }

                // for scrol bar issue
                var feedContentAreaHeight = $("#feedContentArea").height();
                if ($('#dataMigrationTabs').length) {
                    $("#dataMigrationTabs").jqxTabs({height: feedContentAreaHeight});
                }

                var tbodyHeight = feedContentAreaHeight - 90;
                $(".visionColMappScrollDiv1").css("max-height", tbodyHeight);
                $(".visionEtlJoinClauseTablesDiv").css("max-height", tbodyHeight);
//                $(".visionEtlMappingTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                $(".visionSqlViewQuery1").css("max-height", parseInt(feedContentAreaHeight) - 67)
                $(".visionEtlJoinrClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                $(".visionEtlwhereClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 69);
                var joinTablesHeight = $(".visionEtlJoinrClauseTablesDiv").height();
                $(".viewJoinQueryOuterDivClass").css("max-height", parseInt(feedContentAreaHeight) - (parseInt(joinTablesHeight) + 82));

                var flowchartworkSourcesspaceHeight = $("#feedListExpander").height();
                $("#feedHeader").css("height", parseInt(flowchartworkSourcesspaceHeight));
                $("#feedHeader").css("overflow-y", "auto");
                $("#" + flowChartWorkSpaceId).css("height", "");
                // for scrol bar issue

//                console.log("Tabs Height:Before:" + $("#dataMigrationTabs").jqxTabs("height"));
//                $("#dataMigrationTabs").jqxTabs({height: ((parseInt(panel2) - 35) + "px")});
//                console.log("Tabs Height:After:" + $("#dataMigrationTabs").jqxTabs("height"));
//                $("#dataMigrationTabs .jqx-tabs-content").attr('style', 'height: ' + $("#dataMigrationTabs").jqxTabs("height") + 'px !important');
                $(".flowchart-example-container").css('height', 10000);
            });
            $('#mainSplitter').on('resize', function (event) {
                var height = $("#connectionsDiv").height();
                var width = $("#connectionsDiv").width();
                $("#schemaObjectsDiv").css("height", height);
                $("#schemaObjectsDiv").css("width", width);

                var contentSplitterWidth = $("#contentSplitter").width();
                if (contentSplitterWidth > 1121) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80% !important');
                    $(".visionColMappingInput").attr('style', 'width:84% !important');

                } else if (contentSplitterWidth > 1100 && contentSplitterWidth < 1120) {
                    $(".visionColJoinMappingInput").attr('style', 'width:81% !important');
                    $(".visionColMappingInput").attr('style', 'width:84% !important');
                    $(".visionColFuncInput").attr('style', 'width:68% !important');


                } else if (contentSplitterWidth > 1000 && contentSplitterWidth < 1100) {
                    $(".visionColJoinMappingInput").attr('style', 'width:81% !important');
                    $(".visionColMappingInput").attr('style', 'width:84% !important');
                    $(".visionColFuncInput").attr('style', 'width:68% !important');


                } else if (contentSplitterWidth > 900 && contentSplitterWidth < 1000) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80% !important');
                    $(".visionColMappingInput").attr('style', 'width:83% !important');

                } else if (contentSplitterWidth > 800 && contentSplitterWidth < 900) {
                    $(".visionColJoinMappingInput").attr('style', 'width:78% !important');
                    $(".visionColMappingInput").attr('style', 'width:80% !important');

                } else if (contentSplitterWidth > 700 && contentSplitterWidth < 800) {
                    $(".visionColJoinMappingInput").attr('style', 'width:75% !important');
                    $(".visionColMappingInput").attr('style', 'width:78% !important');

                }
                $(".inputvalue").attr('style', 'display: none');
            });

            $('#childJobContentSplitter').on('resize', function (event) {
                var flowchartworkSourcesspaceHeight = $("#childJobFeedListExpander").height();
                $("#childFeedHeader").css("height", parseInt(flowchartworkSourcesspaceHeight));
                $("#childFeedHeader").css("overflow-y", "auto");
                $("#childFlowChartWorkSpace").css("height", "");
                $(".child-flowchart-example-container").css('height', 10000);
            });

            $('#' + flowChartWorkSpaceId + ', #dataModellerFlowchartworkSourcesspace').flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
//                defaultOperatorClass:'VisionWorkFlowTest',
//                multipleLinksOnInput: true,
//                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });



            $('#' + flowChartWorkSpaceId + ', #dataModellerFlowchartworkSourcesspace').flowchart({
//                onOperatorSelect: function (operatorId) {
//                    openOpeartorContextMenu(operatorId);
//                    return true;
//                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });

        };
        return {
            init: function () {
                createWidgets();
            }
        }
    }(jQuery));
    rss.init();
//    setTimeout(function(event){
//        window.dispatchEvent(new Event('resize'));
//    }, 200);
}

// function to create operator icon on dragging source tables to flowchat area in ETL
function createImageSourcesFlowchart(item, title, type)
{
//    var itemId = item.id;
//    var items = $("#" + itemId);
//    var childDiv = items[0].children[1];
//    var divId = childDiv.id;
    var levelType;
    var divTitle;
    var connectionObj;
    var fileType = "";
    var fileExtensions = [".xls", ".xlsx", ".XLS", ".XLSX", ".txt", ".csv", ".xml", ".TXT", ".CSV", ".XML", ".JSON", ".json"];
    if (item != null && !item.hasItems && title != null && title != '') {
        for (var i = 0; i < fileExtensions.length; i++) {
            if (title.endsWith(fileExtensions[i]) > -1) {
                type = 'File';
                fileType = fileExtensions[i];
                break;
            }
        }
    }
    var fileType = "." + title.substr((title.lastIndexOf('.') + 1));
    if (type == 'File' || type == 'FileData')
    {
        levelType = 3;
    } else if (type == 'Table')
    {
        sourceTables.push(title);
        var parentElement = item.parentElement;
        var parent = $(parentElement)[0].parentElement;
        var childObj = parent.parentElement.children[1];
        var valueObj = childObj.treeItem['value'];
        divTitle = valueObj;
        levelType = 5;
    }
    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        var connObj = savedDBData[divTitle];
        if (connObj != null && !jQuery.isEmptyObject(connObj)) {
            connectionObj = connObj;
        }
    }
    if (item.level == levelType) {
        $("#savedConnections").off('dragEnd').on('dragEnd', function (event) {
            $(".flowchart-operator-connector-label").hide();
            var contentSplitterStyle = $("#contentSplitter").css("display");

            var contentSplitter1Style = $("#contentSplitter1").css("display");

            var $flowchart;
            var $container;
            if (contentSplitterStyle == "block") {
                $flowchart = $('#' + flowChartWorkSpaceId);
                $container = $('#' + flowChartWorkSpaceId);
            } else if (contentSplitter1Style == "block") {
                $flowchart = $('#dataModellerFlowchartworkSourcesspace');
                $container = $('#dataModellerFlowchartworkSourcesspace');
            }
//            var $flowchart = $('#'+flowChartWorkSpaceId);
//            var $container = $('#'+flowChartWorkSpaceId);
            var $this = $(this);
            var ui = event.args.originalEvent;
            var elOffset = ui.position;
            var containerOffset = $container.offset();
            if (elOffset.left > containerOffset.left &&
                    elOffset.top > containerOffset.top &&
                    elOffset.left < containerOffset.left + $container.width() &&
                    elOffset.top < containerOffset.top + $container.height()) {
                var flowchartOffset = $flowchart.offset();
                var relativeLeft = elOffset.left - flowchartOffset.left;
                var relativeTop = elOffset.top - flowchartOffset.top;
                var positionRatio = $flowchart.flowchart('getPositionRatio');
                relativeLeft /= positionRatio;
                relativeTop /= positionRatio;
                elOffset.left = relativeLeft;
                elOffset.top = relativeTop;
            }
            var data = {
                top: elOffset.top,
                left: elOffset.left,

                dragType: type

            };

            if (connectionObj != null) {
                var items = [];
                var itemcount = 0;
                var top = elOffset.top;
                items[0] = item;
                var checkedItems = $('#savedConnections').jqxTree('getCheckedItems');
                if (checkedItems != null && checkedItems.length != null && checkedItems.length > 0) {
                    for (var i = 0; i < checkedItems.length; i++) {
                        var itemLevel = checkedItems[i].level;
                        if (itemLevel == 5 &&
                                !(checkedItems[i].label == "VIEWS" ||
                                        checkedItems[i].label == "SYNONYMS" ||
                                        checkedItems[i].label == "TABLES")) {
                            items[itemcount] = checkedItems[i];
                            itemcount++;
                        }
                    }
                }
                for (var i = 0; i < items.length; i++) {
                    var dragedItem = items[i];
                    if (!(dragedItem.label == "VIEWS" || dragedItem.label == "SYNONYMS" || dragedItem.label == "TABLES")) {
                        var itemTreeLevel = dragedItem.level;
                        var title = dragedItem.label;
                        if (itemTreeLevel == 5) {

                            var data = {
                                top: top,
                                left: elOffset.left,
                                dragType: type
                            };

                            data['CONNECTION_NAME'] = connectionObj['CONNECTION_NAME']; //CONNECTION_NAME
                            data['CONN_DB_NAME'] = connectionObj['CONN_DB_NAME']; //CONN_DB_NAME
                            data['CONN_CUST_COL1'] = connectionObj['CONN_CUST_COL1']; //CONN_CUST_COL1
                            data['connObj'] = connectionObj;
                            data['statusLebel'] = title;
                            data['tableName'] = (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + title) : title
//                            data['tableName'] = connectionObj['CONN_USER_NAME'] + '.' + title;
                            data['properties'] = {
                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + '.' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px; padding-top: 6px;padding-top: 6px;"/></div>'

                                        + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: '',
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: '',
                                    }
                                }
                            }
                            $flowchart.flowchart('addOperator', data);
                            $(".flowchart-operator-connector-label").hide();
                            $(".flowchart-operator-title").hide();
                            trfmRulesChanged = true;
                            top = top + 70;
                        }
                    }
                }


            } else {
                var items = [];
                var top = elOffset.top;
                items[0] = item;
                var itemcount = 0;
                var checkedItems = $('#savedConnections').jqxTree('getCheckedItems');
                if (checkedItems != null && checkedItems.length != null && checkedItems.length > 0) {
                    for (var i = 0; i < checkedItems.length; i++) {
                        var itemLevel = checkedItems[i].level;
                        if (itemLevel == 3 && !(item.label == "xml" || item.label == "csv" || item.label == "xlsx" || item.label == "xls" || item.label == "json")) {
                            items[itemcount] = checkedItems[i];
                            itemcount++;
                        }

                    }
                }
                for (var i = 0; i < items.length; i++) {
                    item = items[i];
                    if (!(item.label == "xml" || item.label == "csv" || item.label == "xlsx" || item.label == "xls" || item.label == "json")) {
                        var itemTreeLevel = item.level;
                        if (itemTreeLevel == 3) {
                            var data = {
                                top: top,
                                left: elOffset.left,
                                dragType: type
                            };
                            var title = item.label;

                            connectionObj = {};
                            connectionObj['filePath'] = item['value'];
                            connectionObj['fileType'] = fileType;
                            connectionObj['fileName'] = title;
                            var fileObj = {};
                            var filePath = item['value'];
                            if (filePath != null && filePath.lastIndexOf("\\") > -1) {
                                filePath = filePath.substring(filePath.lastIndexOf("\\") + 1);
                            }
                            fileObj['filePath'] = filePath;
                            fileObj['fileType'] = fileType;

                            for (var entitykey in HtmlEntities) {
                                var entity = HtmlEntities[entitykey];
                                var regex = new RegExp(entitykey, 'g');
                                title = title.replace(regex, entity);
                            }
                            fileObj['fileName'] = title;
                            var imageIcon = "images/Notepad.png";
                            if (fileType == '.xls'
                                    || fileType == '.xlsx'
                                    || fileType == '.XLS'
                                    || fileType == '.XLSX'
                                    ) {
                                imageIcon = "images/xlsx Icon-01.svg"
                            } else if (fileType == '.xml'
                                    || fileType == '.XML') {
                                imageIcon = "images/XML Icon-01.svg";

                            } else if (fileType == '.CSV'
                                    || fileType == '.csv') {
                                imageIcon = "images/CSV ICON-01.svg";
                            } else if (fileType == '.JSON'
                                    || fileType == '.json') {
                                imageIcon = "images/JSON_Isons-02.svg";
                            }
                            connectionObj['imageIcon'] = imageIcon;
                            data['connObj'] = connectionObj;
                            data['filePath'] = item['value'];
                            data['properties'] = {

                                body: '<div  title="' + title + '" class=""><div><img src="' + imageIcon + '"'
                                        + 'class="visionOpIcons" title="Double click here to view the data" ondblclick=viewFileData(\'' + JSON.stringify(fileObj) + '\')  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: '',
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: '',
                                    }
                                }
                            }

                            $flowchart.flowchart('addOperator', data);
                            $(".flowchart-operator-connector-label").hide();
                            $(".flowchart-operator-title").hide();
                            trfmRulesChanged = true;
                            top = top + 70;
                        }
                    }
                }


            }
//            $flowchart.flowchart('addOperator', data);
//            $(".flowchart-operator-connector-label").hide();
//            $(".flowchart-operator-title").hide();
//            trfmRulesChanged = true;
        });
    }

}



// function to create operator icon on dragging destination tables to flowchat area in ETL
function createImageDestinationFlowchart(item, title, type)
{
    var levelType;
    var divTitle;
    var connectionObj;
    if (type == 'File' || type == 'FileData')
    {
        levelType = 1;
    } else if (type == 'Table')
    {
        levelType = 3;
        var parentElement = item.parentElement;
        var parent = $(parentElement)[0].parentElement;
        var div = parent.parentElement.children[1];
        divTitle = div.title;
    }
    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        for (var i = 0; i < savedDBData.length; i++)
        {
            var connObj = savedDBData[i];
            if (connObj.hasOwnProperty(divTitle)) {
                connectionObj = connObj[divTitle];
            }
        }

    }
    if (item.level == levelType) {

        var operatorId = 'Dest_operator_' + sourceOperatorI;
        if (true)
        {
            var defaultFlowchartData = {
                operators: {
                    op2: {
                        top: 20,
                        left: 400,
                        statusLebel: title,
                        tableName: title,
                        dragType: type,
                        connObj: connectionObj,
                        properties: {
                            body: '<div  title="' + title + '" class="visionOpLabelDiv">' + title + '</div>',
                            inputs: {
                                input_1: {
                                    label: 'I-' + title,
                                    multipleLinks: true
                                }
                            },
                            outputs: {
                                output_1: {
                                    label: 'O-' + title,
                                    multipleLinks: true
                                }
                            }
                        }
                    }
                },
            };
            $('#' + flowChartWorkSpaceId).flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $('#' + flowChartWorkSpaceId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });
            $('#' + flowChartWorkSpaceId).flowchart('setData', defaultFlowchartData);
            sourceFirst = false;
        } else
        {
            var operatorId = 'destination_operator_' + operatorI;
            var operatorData = {
                top: bodyTop,
                left: 400,
                statusLebel: title,
                tableName: title,
                dragType: type,
                connObj: connectionObj,
                properties: {
                    body: '<div  title="' + title + '" class="visionOpLabelDiv">' + title + '</div>',
                    inputs: {
                        input_1: {
                            label: '',
                        }
                    },
                    outputs: {
                        output_1: {
                            label: '',
                        }
                    }
                }
            };
            bodyTop = bodyTop + 80;
            $('#' + flowChartWorkSpaceId).flowchart('createOperator', operatorId, operatorData);
        }

        operatorI++;
        $(".flowchart-operator-connector-label").hide();
        $(".flowchart-operator-title").hide();
    }
}


function createImageSourcesDataModellerFlowchart(item, title, type)
{
//    var itemId = item.id;
//    var items = $("#" + itemId);
//    var childDiv = items[0].children[1];
//    var divId = childDiv.id;
    var levelType;
    var divTitle;
    var connectionObj;
    var fileType = "";
    var fileExtensions = [".xls", ".xlsx", ".XLS", ".XLSX", ".txt", ".csv", ".xml", ".TXT", ".CSV", ".XML", ".JSON", ".json"];
    if (item != null && !item.hasItems && title != null && title != '') {
        for (var i = 0; i < fileExtensions.length; i++) {

            if (title.endsWith(fileExtensions[i]) > -1) {
                type = 'File';
                fileType = fileExtensions[i];
                break;
            }
        }

    }
    var fileType = "." + title.substr((title.lastIndexOf('.') + 1));
    if (type == 'File' || type == 'FileData')
    {
        levelType = 3;
    } else if (type == 'Table')
    {
        sourceTables.push(title);
        var parentElement = item.parentElement;
        var parent = $(parentElement)[0].parentElement;
        var childObj = parent.parentElement.children[1];
        var valueObj = childObj.treeItem['value'];
        divTitle = valueObj;
        levelType = 5;
    }
    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        var connObj = savedDBData[divTitle];
        if (connObj != null && !jQuery.isEmptyObject(connObj)) {
            connectionObj = connObj;
        }
    }
    if (item.level == levelType) {
        $("#savedConnections").off('dragEnd').on('dragEnd', function (event) {
            $(".flowchart-operator-connector-label").hide();
            var $flowchart = $('#dataModellerFlowchartworkSourcesspace');
            var $container = $('#dataModellerFlowchartworkSourcesspace');
            var $this = $(this);
            var ui = event.args.originalEvent;
            var elOffset = ui.position;
            var containerOffset = $container.offset();
            if (elOffset.left > containerOffset.left &&
                    elOffset.top > containerOffset.top &&
                    elOffset.left < containerOffset.left + $container.width() &&
                    elOffset.top < containerOffset.top + $container.height()) {
                var flowchartOffset = $flowchart.offset();
                var relativeLeft = elOffset.left - flowchartOffset.left;
                var relativeTop = elOffset.top - flowchartOffset.top;
                var positionRatio = $flowchart.flowchart('getPositionRatio');
                relativeLeft /= positionRatio;
                relativeTop /= positionRatio;
                elOffset.left = relativeLeft;
                elOffset.top = relativeTop;
            }
            var data = {
                top: elOffset.top,
                left: elOffset.left,

                dragType: type

            };

            if (connectionObj != null) {
                var items = [];
                var itemcount = 0;
                var top = elOffset.top;
                items[0] = item;
                var checkedItems = $('#savedConnections').jqxTree('getCheckedItems');
                if (checkedItems != null && checkedItems.length != null && checkedItems.length > 0) {
                    for (var i = 0; i < checkedItems.length; i++) {
                        var itemLevel = checkedItems[i].level;
                        if (itemLevel == 5 &&
                                !(checkedItems[i].label == "VIEWS" ||
                                        checkedItems[i].label == "SYNONYMS" ||
                                        checkedItems[i].label == "TABLES")) {
                            items[itemcount] = checkedItems[i];
                            itemcount++;
                        }
                    }
                }
                for (var i = 0; i < items.length; i++) {
                    var dragedItem = items[i];
                    if (!(dragedItem.label == "VIEWS" || dragedItem.label == "SYNONYMS" || dragedItem.label == "TABLES")) {
                        var itemTreeLevel = dragedItem.level;
                        var title = dragedItem.label;
                        if (itemTreeLevel == 5) {

                            var data = {
                                top: top,
                                left: elOffset.left,
                                dragType: type
                            };

                            data['CONNECTION_NAME'] = connectionObj['CONNECTION_NAME']; //CONNECTION_NAME
                            data['CONN_DB_NAME'] = connectionObj['CONN_DB_NAME']; //CONN_DB_NAME
                            data['CONN_CUST_COL1'] = connectionObj['CONN_CUST_COL1']; //CONN_CUST_COL1
                            data['connObj'] = connectionObj;
                            data['statusLebel'] = title;
                            data['tableName'] = (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + title) : title
//                            data['tableName'] = connectionObj['CONN_USER_NAME'] + '.' + title;
                            data['properties'] = {
                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + '.' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;padding-top: 6px;"/></div>'

                                        + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: '',
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: '',
                                    }
                                }
                            }
                            $flowchart.flowchart('addOperator', data);
                            $(".flowchart-operator-connector-label").hide();
                            $(".flowchart-operator-title").hide();
                            trfmRulesChanged = true;
                            top = top + 70;
                        }
                    }
                }


            } else {
                var items = [];
                var top = elOffset.top;
                items[0] = item;
                var itemcount = 0;
                var checkedItems = $('#savedConnections').jqxTree('getCheckedItems');
                if (checkedItems != null && checkedItems.length != null && checkedItems.length > 0) {
                    for (var i = 0; i < checkedItems.length; i++) {
                        var itemLevel = checkedItems[i].level;
                        if (itemLevel == 3 && !(item.label == "xml" || item.label == "csv" || item.label == "xlsx" || item.label == "xls" || item.label == "json")) {
                            items[itemcount] = checkedItems[i];
                            itemcount++;
                        }

                    }
                }
                for (var i = 0; i < items.length; i++) {
                    item = items[i];
                    if (!(item.label == "xml" || item.label == "csv" || item.label == "xlsx" || item.label == "xls" || item.label == "json")) {
                        var itemTreeLevel = item.level;
                        if (itemTreeLevel == 3) {
                            var data = {
                                top: top,
                                left: elOffset.left,
                                dragType: type
                            };
                            var title = item.label;

                            connectionObj = {};
                            connectionObj['filePath'] = item['value'];
                            connectionObj['fileType'] = fileType;
                            connectionObj['fileName'] = title;
                            var fileObj = {};
                            var filePath = item['value'];
                            if (filePath != null && filePath.lastIndexOf("\\") > -1) {
                                filePath = filePath.substring(filePath.lastIndexOf("\\") + 1);
                            }
                            fileObj['filePath'] = filePath;
                            fileObj['fileType'] = fileType;

                            for (var entitykey in HtmlEntities) {
                                var entity = HtmlEntities[entitykey];
                                var regex = new RegExp(entitykey, 'g');
                                title = title.replace(regex, entity);
                            }
                            fileObj['fileName'] = title;
                            var imageIcon = "images/Notepad.png";
                            if (fileType == '.xls'
                                    || fileType == '.xlsx'
                                    || fileType == '.XLS'
                                    || fileType == '.XLSX'
                                    ) {
                                imageIcon = "images/xlsx Icon-01.svg"
                            } else if (fileType == '.xml'
                                    || fileType == '.XML') {
                                imageIcon = "images/XML Icon-01.svg";

                            } else if (fileType == '.CSV'
                                    || fileType == '.csv') {
                                imageIcon = "images/CSV ICON-01.svg";
                            } else if (fileType == '.JSON'
                                    || fileType == '.json') {
                                imageIcon = "images/JSON_Isons-02.svg";
                            }
                            connectionObj['imageIcon'] = imageIcon;
                            data['connObj'] = connectionObj;
                            data['filePath'] = item['value'];
                            data['properties'] = {

                                body: '<div  title="' + title + '" class=""><div><img src="' + imageIcon + '"'
                                        + 'class="visionOpIcons" title="Double click here to view the data" ondblclick=viewFileData(\'' + JSON.stringify(fileObj) + '\')  style="width:18px;height: 18px;"/></div></div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: '',
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: '',
                                    }
                                }
                            }

                            $flowchart.flowchart('addOperator', data);
                            $(".flowchart-operator-connector-label").hide();
                            $(".flowchart-operator-title").hide();
                            trfmRulesChanged = true;
                            top = top + 70;
                        }
                    }
                }


            }
//            $flowchart.flowchart('addOperator', data);
//            $(".flowchart-operator-connector-label").hide();
//            $(".flowchart-operator-title").hide();
//            trfmRulesChanged = true;
        });
    }

}




function createImageDestinationDataModellerFlowchart(item, title, type)
{
    var levelType;
    var divTitle;
    var connectionObj;
    if (type == 'File' || type == 'FileData')
    {
        levelType = 1;
    } else if (type == 'Table')
    {
        levelType = 3;
        var parentElement = item.parentElement;
        var parent = $(parentElement)[0].parentElement;
        var div = parent.parentElement.children[1];
        divTitle = div.title;
    }
    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        for (var i = 0; i < savedDBData.length; i++)
        {
            var connObj = savedDBData[i];
            if (connObj.hasOwnProperty(divTitle)) {
                connectionObj = connObj[divTitle];
            }
        }

    }
    if (item.level == levelType) {

        var operatorId = 'Dest_operator_' + sourceOperatorI;
        if (true)
        {
            var defaultFlowchartData = {
                operators: {
                    op2: {
                        top: 20,
                        left: 400,
                        statusLebel: title,
                        tableName: title,
                        dragType: type,
                        connObj: connectionObj,
                        properties: {
                            body: '<div  title="' + title + '" class="visionOpLabelDiv">' + title + '</div>',
                            inputs: {
                                input_1: {
                                    label: 'I-' + title,
                                    multipleLinks: true
                                }
                            },
                            outputs: {
                                output_1: {
                                    label: 'O-' + title,
                                    multipleLinks: true
                                }
                            }
                        }
                    }
                },
            };
            $('#dataModellerFlowchartworkSourcesspace').flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $('#dataModellerFlowchartworkSourcesspace').flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });
            $('#dataModellerFlowchartworkSourcesspace').flowchart('setData', defaultFlowchartData);
            sourceFirst = false;
        } else
        {
            var operatorId = 'destination_operator_' + operatorI;
            var operatorData = {
                top: bodyTop,
                left: 400,
                statusLebel: title,
                tableName: title,
                dragType: type,
                connObj: connectionObj,
                properties: {
                    body: '<div  title="' + title + '" class="visionOpLabelDiv">' + title + '</div>',
                    inputs: {
                        input_1: {
                            label: '',
                        }
                    },
                    outputs: {
                        output_1: {
                            label: '',
                        }
                    }
                }
            };
            bodyTop = bodyTop + 80;
            $('#dataModellerFlowchartworkSourcesspace').flowchart('createOperator', operatorId, operatorData);
        }

        operatorI++;
        $(".flowchart-operator-connector-label").hide();
        $(".flowchart-operator-title").hide();
    }
}


function addJoinTableRow(connObj, tableId, rowId)
{
    console.log("rowId :::" + rowId);
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'getJoinTableRows',
        async: true,
        data: {
            sourceTables: JSON.stringify(sourceTables),
            rowId: rowId,
            connObj: connObj
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var responseObj = JSON.parse(response);
                if (responseObj != null) {
                    $('#selectedJoinTables tr:last').after(responseObj.rowData);
                    $("#showSourceJoinIcon").html(responseObj.rowId);
                }


            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}
function getTreeDMTableTabs(fromTable, toTable, fromConnObj, toConnObj)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    if ((fromConnObj != null && !jQuery.isEmptyObject(fromConnObj)) && (toConnObj != null && !jQuery.isEmptyObject(toConnObj))) {
        $.ajax({
            type: 'post',
            traditional: true,
            dataType: 'html',
            cache: false,
            url: 'fetchTreeDMTableColumns',
            async: true,
            data: {
                fromTable: fromTable,
                toTable: toTable,
                fromConnObj: JSON.stringify(fromConnObj),
                toConnObj: JSON.stringify(toConnObj),
                sourceTables: JSON.stringify(sourceTables)
            },
            success: function (response) {
                stopLoader();
                if (response != null) {
                    var tabsDiv = "<div id='dataMigrationTabs' class='dataMigrationTabs'><ul class='dataMigrationTabsHeader'>"
                            + "<li class='dataMigrationTabsli'><a href='#tabs-1'>Mapped Columns</a></li>"
                            + "<li class='dataMigrationTabsli'><a href='#tabs-2'>Join Mapping</a></li>"
                            + "<li class='dataMigrationTabsli'><a href='#tabs-3'>Where Clause Mapping</a></li>"
                            + "<li class='dataMigrationTabsli'><a href='#tabs-4'>Sql</a></li>"
                            + "</ul>"
                            + "<div id='tabs-1' class='dataMigrationsTabsInner'>"
                            + " </div>"
                            + "<div id='tabs-2' class='dataMigrationsTabsInner'>"
                            + "</div>"
                            + "<div id='tabs-3' class='dataMigrationsTabsInner'>"
                            + "</div>"
                            + "<div id='tabs-4' class='dataMigrationsTabsInner'>"
                            + "</div>";
                    $('.visionTablesComboBox').hide();
                    $('.visionUploadFileDiv').hide();
                    $('.visionConnectToDbDiv').hide();
                    $('#visionERPMain').hide();
                    var response = JSON.parse(response);
                    if (response != null && response.connectionFlag == 'Y') {
                        $("#dialog").html(tabsDiv);
                        $("#dialog").dialog({
                            title: (labelObject['Transformation Rules'] != null ? labelObject['Transformation Rules'] : 'Transformation Rules'),
                            modal: true,
                            width: 1000,
                            height: 'auto',
                            fluid: true,
                            open: function () {
                                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                                $(".visionHeaderMain").css("z-index", "999");
                                $(".visionFooterMain").css("z-index", "999");
                                $(".ui-dialog").addClass('visionDMTreePopup');
                                $("#dataMigrationTabs").jqxTabs({theme: 'ui-redmond'});

                            },
                            beforeClose: function (event, ui)
                            {
                                $(".visionHeaderMain").css("z-index", "99999");
                                $(".visionFooterMain").css("z-index", "99999");

                            }, close: function (event, ui)
                            {

                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }
                        });
                        var columnStr = response['columnStr'];
                        var tablesStr = response['selectedTables'];
                        var selectedJoinTables = response['selectedJoinTables'];

                        $('#tabs-3').html(tablesStr);
                        $('#tabs-1').html(columnStr);
                        $('#tabs-2').html(selectedJoinTables);
                        $('#mapColumns').addClass("active");
                        $('.visionProgressFilesSteps').hide();
                    } else {
                        showMessagePopup(response.connectionMessage);
                    }


                }
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    }
}


function showMessagePopup(message) {
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var labelObject = {};
    $("#dialog").html(message);
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        width: 300,
        height: 135,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}

function fetchTreeDMSelectedColumns() {
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var labelObject = {};
    var fromConnObj = $('#fromConnObj').val();
    var toConnObj = $('#toConnObj').val();
    var fromTable = $('#fromTable').val();
    var toTable = $('#toTable').val();

    var i = 0;
    var colsObj = {};
    var defaultValObj = {};
    var destColArr = [];
    var flag = true;
    $("#sourceDestColsTableId tbody tr").each(function () {
        var sourceColNameStr = $("#SOURCE_SELECT_" + i).val();
        var destColNameStr = $("#DEST_SELECT_" + i).val();
        var sourceColName = "";
        var defaultVal = $("#DEFAULTVALUES_" + i).val();
        if (sourceColNameStr != null) {
            sourceColName = sourceColNameStr.split(":")[1];
            if (destColNameStr != null) {
//                destColObj["TABLE_NAME"] = destColNameStr.split(":")[0];
//                destColObj["COLUMN_NAME"] = destColNameStr.split(":")[1];

                console.log("destColArr::::" + destColArr);
                var col = destColArr.includes(destColNameStr);
                if (destColArr != null && destColArr != '' && destColArr.includes(destColNameStr)) {
                    var message = "Mapped Column is already exist";
                    showMessagePopup(message);
                    flag = false;
                    return;
                } else {
                    destColArr.push(destColNameStr);
                    if (destColNameStr != null && destColNameStr != '' && destColNameStr != 'Select') {
                        colsObj[sourceColName] = destColNameStr;
                    }

                }

            }

            if (defaultVal != null && defaultVal != '')
                defaultValObj[sourceColName] = defaultVal;
        }

        ++i;
    });
    var j = 0;
    var tablesObj = {};
    $("#selectedTables tbody tr").each(function () {
        var sourceTableName = $("#SELECT_TABLE_" + j).text();
        var tableInputValue = $("#TABLE_INPUT" + j).val();
        tablesObj[sourceTableName] = tableInputValue;
        ++j;
    });
    var k = 0;
    var joinTablesArr = [];
    $("#selectedJoinTables tbody tr").each(function () {
        var joinTablesObj = {};
        var fromJoinTable = $("#SOURCE_SELECT_JOIN_LEFT_" + k).val();
        var join = $("#TABLE_JOIN_INPUT_" + k).val();
        var joinCondition = $("#TABLE_JOIN_COND_INPUT_" + k).val();
        var toJoinTable = $("#SOURCE_SELECT_JOIN_RIGHT_" + k).val();
        joinTablesObj['fromJoinTable'] = fromJoinTable;
        joinTablesObj['join'] = join;
        joinTablesObj['joinCondition'] = joinCondition;
        joinTablesObj['toJoinTable'] = toJoinTable;
        joinTablesArr.push(joinTablesObj);
        ++k;
    });
    console.log("defaultValObj:::::::" + defaultValObj);
    if (flag) {
        if (colsObj != null && colsObj != '') {
            $.ajax({
                type: "post",
                traditional: true,
                dataType: 'html',
                cache: false,
                url: "mappingTreeDMSourceColsWithDestCols",
                data: {
                    fromConnObj: fromConnObj,
                    toConnObj: toConnObj,
                    fromTable: fromTable,
                    toTable: toTable,
                    columnsObj: JSON.stringify(colsObj),
                    tablesObj: JSON.stringify(tablesObj),
                    defaultValObj: JSON.stringify(defaultValObj),
                    joinTablesObj: JSON.stringify(joinTablesArr),
                    sourceTables: JSON.stringify(sourceTables)
                },
                success: function (response) {
                    if (response != null)
                    {

                        var result = JSON.parse(response);
                        if (result != null && result.connectionFlag == 'Y')
                        {
                            //var message = result.Message;
                            $('#dialog').html(result.Message);
                        } else {
                            $('#dialog').html(result.connectionMessage);
                        }
                        $("#dialog").dialog({
                            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                            modal: true,
                            width: 300,
                            height: 135,
                            fluid: true,
                            buttons: [{
                                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                    click: function () {
                                        $('.visionProgressSteps').hide();
                                        $('.visionProgressFilesSteps').hide();
                                        $('#mappingColumns').hide();
                                        $('#visionERPMain').hide();
                                        $("#" + flowChartWorkSpaceId).val("");
                                        $(this).html("");
                                        $(this).dialog("close");
                                        $(this).dialog("destroy");
                                    }

                                }],
                            open: function () {
                                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                                $(".visionHeaderMain").css("z-index", "999");
                                $(".visionFooterMain").css("z-index", "999");
                            },
                            beforeClose: function (event, ui)
                            {
                                $(".visionHeaderMain").css("z-index", "99999");
                                $(".visionFooterMain").css("z-index", "99999");
                            }
                        });
                    }
                },
                error: function (e) {
                    sessionTimeout(e);
                }
            });
        }
    }



}

function getDMTableColumnsData(fromTable, toTable, fromConnObj, toConnObj)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }

    if ((fromConnObj != null && !jQuery.isEmptyObject(fromConnObj)) && (toConnObj != null && !jQuery.isEmptyObject(toConnObj))) {
        $.ajax({
            type: 'post',
            traditional: true,
            dataType: 'html',
            cache: false,
            url: 'fetchTreeDMTableColumns',
            async: true,
            data: {
                fromTable: fromTable,
                toTable: toTable,
                fromConnObj: JSON.stringify(fromConnObj),
                toConnObj: JSON.stringify(toConnObj),
                sourceTables: JSON.stringify(sourceTables)
            },
            success: function (response) {
                stopLoader();
                if (response != null) {
                    var tableData = "<div id='mappingColumns' class='visionColumnsMapping' style='display:none'>"
                            //            +    "<div id= 'showConnectionName' style='margin-left:15px;margin-top:15px'>  </div>"
                            + "<div id='showSourceTablesList' class='visionSourceTablesMain'></div>"
                            + "<div id='showSourceJoinIcon' class='visionSourceJoinIcon'></div>"
                            + "<div id='showSourceTablesJoinList' class='visionSourceTablesMain'></div>"
                            + "<div class='visionMappedTable' id= 'MappedTable'></div>"
                            + "<div class='visionProcessCols'>"
                            + "<input type='button' value='Process' name='Process' id='processCols' onclick = 'fetchTreeDMSelectedColumns()' class='visionProcessColsBtn'>"
                            + "</div>"
                            + "</div>";
                    $('.visionTablesComboBox').hide();
                    $('.visionUploadFileDiv').hide();
                    $('.visionConnectToDbDiv').hide();
                    $('#visionERPMain').hide();
                    var response = JSON.parse(response);
                    if (response != null && response.connectionFlag == 'Y') {
                        $("#dialog").html(tableData);
                        $("#dialog").dialog({
                            title: (labelObject['Table Columns'] != null ? labelObject['Table Columns'] : 'Table Columns'),
                            modal: true,
                            width: 900,
                            height: 'auto',
                            fluid: true,
                            open: function () {
                                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                                $(".visionHeaderMain").css("z-index", "999");
                                $(".visionFooterMain").css("z-index", "999");
                                $(".ui-dialog").addClass('visionDMTreePopup');

                            },
                            beforeClose: function (event, ui)
                            {
                                $(".visionHeaderMain").css("z-index", "99999");
                                $(".visionFooterMain").css("z-index", "99999");

                            }, close: function (event, ui)
                            {

                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }
                        });


                        var columnStr = response['columnStr'];
                        var tablesStr = response['selectedTables'];
                        var selectedJoinTables = response['selectedJoinTables'];
                        var showSourceJoinIcon = response['showSourceJoinIcon'];
                        $('#mappingColumns').show();
                        $('#showSourceTablesList').html(tablesStr);
                        $('#MappedTable').html(columnStr);
                        // var matchedSelectStr = response['matchedSelectStr'];
                        $("#showSourceJoinIcon").html(showSourceJoinIcon);
                        $('#showSourceTablesJoinList').html(selectedJoinTables);
                        $('#mapColumns').addClass("active");
                        $('.visionProgressFilesSteps').hide();
                    } else {
                        showMessagePopup(response.connectionMessage);
                    }


                }
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    }
}
function getDMFileColumnsData(fromTable, selectType, fromConnObj)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }

    if (fromConnObj != null && !jQuery.isEmptyObject(fromConnObj)) {
        $("#selectType").val(selectType);
        if (selectType == 'XLSX' || selectType == 'XLS') {
            //$("#downloadData").attr("action");
            $("#downloadData").attr("action", "exportDMXlsxData");
            $("#downloadData").submit();
        } else if (selectType == 'CSV') {
            $("#downloadData").attr("action", "exportDMCSVData");
            $("#downloadData").submit();
        } else if (selectType == 'PDF') {
            $("#downloadData").attr("action", "exportPDFData");
            // $("#downloadData").submit();
        } else if (selectType == 'XML') {
            $("#downloadData").attr("action", "exportDMXMLData");
            $("#downloadData").submit();

        }
    }
}


function getDMFileDataColumnsData(fromTable, toTable, connectionObj)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    if (connectionObj != null && !jQuery.isEmptyObject(connectionObj)) {
        $.ajax({
            type: 'post',
            traditional: true,
            dataType: 'html',
            cache: false,
            url: 'fetchTreeDMTableFileColumns',
            async: true,
            data: {
                fromTable: fromTable,
                toTable: toTable,
                fromConnObj: JSON.stringify(connectionObj),
            },
            success: function (response) {
                stopLoader();
                if (response != null) {
                    var tableData = "<div id='mappingColumns' class='visionColumnsMapping' style='display:none'>"
                            //            +    "<div id= 'showConnectionName' style='margin-left:15px;margin-top:15px'>  </div>"
                            + "<div id='showSourceTablesList' class='visionSourceTablesMain'></div>"
                            + "<div class='visionMappedTable' id= 'MappedTable'></div>"
                            + "<div class='visionProcessCols'>"
                            + "<input type='button' value='Process' name='Process' id='processCols' onclick = 'fetchTreeDMFileSelectedColumns()' class='visionProcessColsBtn'>"
                            + "</div>"
                            + "</div>";
                    $('.visionTablesComboBox').hide();
                    $('.visionUploadFileDiv').hide();
                    $('.visionConnectToDbDiv').hide();
                    $('#visionERPMain').hide();
                    var response = JSON.parse(response);
                    if (response != null && response.connectionFlag == 'Y') {
                        $("#dialog").html(tableData);
                        $("#dialog").dialog({
                            title: (labelObject['Table Columns'] != null ? labelObject['Table Columns'] : 'Table Columns'),
                            modal: true,
                            width: 800,
                            height: 'auto',
                            fluid: true,
                            open: function () {
                                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                                $(".visionHeaderMain").css("z-index", "999");
                                $(".visionFooterMain").css("z-index", "999");
                                $(".ui-dialog").addClass('visionDMTreePopup');

                            },
                            beforeClose: function (event, ui)
                            {
                                $(".visionHeaderMain").css("z-index", "99999");
                                $(".visionFooterMain").css("z-index", "99999");

                            }, close: function (event, ui)
                            {

                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }
                        });


                        var columnStr = response['columnStr'];
                        var tablesStr = response['selectedTables'];
                        $('#mappingColumns').show();
                        $('#showSourceTablesList').html(tablesStr);
                        $('#MappedTable').html(columnStr);
                        var matchedSelectStr = response['matchedSelectStr'];
                        $('#mapColumns').addClass("active");
                        $('.visionProgressFilesSteps').hide();
                    } else {
                        showMessagePopup(response.connectionMessage);
                    }


                }
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    }
}
function showUploadedFiles(treeId, divId)
{
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: "getTreeParentFile",
        cache: false,
        data: {
            treeId: treeId,
            divId: divId,
        },
        success: function (data, status, xhr) {
            if (data != null && data != '' && data != undefined) {
                var treeConfigObj = data['treeConfigObj'];
                var dragEndFunction = data['dragEnd'];
                treeConfigObj.allowDrag = true;
                treeConfigObj.allowDrop = true;
                treeConfigObj.dragEnd = eval('(' + dragEndFunction + ')');
                $('#' + divId).jqxTree(treeConfigObj);
                $('#' + divId).jqxTree('focus');
                $('#' + divId).on('expand', function (event) {
                    var parentItem = $('#' + divId).jqxTree('getItem', event.args.element);
                    var $element = $(event.args.element);
                    var loader = false;
                    var loaderItem = null;
                    var children = $element.find('ul:first').children();
                    $.each(children, function () {
                        var item = $('#' + divId).jqxTree('getItem', this);
                        if (item && item.value == 'ajax') {
                            loaderItem = item;
                            loader = true;
                            return false;
                        }

                    });
                    if (loaderItem != null) {
                        var level = parentItem.level;
                        $('#' + divId).jqxTree('removeItem', loaderItem.element);
                        console.log("level is :::" + level);
                        $.ajax({
                            type: "post",
                            traditional: true,
                            dataType: 'json',
                            url: "getTreeUploadedFiles",
                            cache: false,
                            data: {
                                treeId: divId,
                            },
                            success: function (data, status, xhr) {
                                if (data != null && data != '' && data != undefined) {
                                    $('#' + divId).jqxTree('addTo', data, $element[0]);
                                    var items = $('#' + divId).jqxTree('getItems');
                                    $.each(items, function () {
                                        $(this.titleElement).attr('title', this.label);

                                    });
                                }
                            },
                            error: function (e) {
                                console.log(e);
                                sessionTimeout(e);
                                stopLoader();
                            }
                        });
                    }
                });
            }
        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}


function fetchTreeDMFileSelectedColumns() {
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var labelObject = {};
    var fromConnObj = $('#fromConnObj').val();
    var fromTable = $('#fromTable').val();
    var toTable = $('#toTable').val();

    var i = 0;
    var mappedFileColsObj = {};
    var defaultValObj = {};
    $("#sourceDestColsFilesTableId tbody tr").each(function () {
        var destColNameStr = $("#DEST_FILE_SELECT_" + i).val();
        var sourceColNameStr = $("#SOURCE_FILE_SELECT_" + i).val();
        var defaultVal = $("#DEFAULTVALUESFILES_" + i).val();
        if (destColNameStr != null && destColNameStr != '' && destColNameStr != 'Select'
                && sourceColNameStr != null && sourceColNameStr != '' && sourceColNameStr != 'Select') {
            mappedFileColsObj[destColNameStr] = sourceColNameStr;
        }
        if (defaultVal != null && defaultVal != '') {
            defaultValObj[destColNameStr] = defaultVal;
        }

        ++i;
    });

    if (mappedFileColsObj != null && !jQuery.isEmptyObject(mappedFileColsObj)) {
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'html',
            cache: false,
            url: "mappingTreeDMFileColsWithDestCols",
            data: {
                fromConnObj: fromConnObj,
                fromTable: fromTable,
                toTable: toTable,
                'mappedFileColsObj': JSON.stringify(mappedFileColsObj),
                'defaultValObj': JSON.stringify(defaultValObj),
            },
            success: function (response) {
                if (response != null)
                {
                    $('#dialog').html(response);
                    $("#dialog").dialog({
                        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                        modal: true,
                        width: 300,
                        height: 135,
                        fluid: true,
                        buttons: [{
                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                click: function () {
                                    $('.visionProgressSteps').hide();
                                    $('.visionProgressFilesSteps').hide();
                                    $('#mappingColumns').hide();
                                    $('#visionERPMain').hide();
                                    $(this).html("");
                                    $(this).dialog("close");
                                    $(this).dialog("destroy");
                                }

                            }],
                        open: function () {
                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                            $(".visionHeaderMain").css("z-index", "999");
                            $(".visionFooterMain").css("z-index", "999");
                        },
                        beforeClose: function (event, ui)
                        {
                            $(".visionHeaderMain").css("z-index", "99999");
                            $(".visionFooterMain").css("z-index", "99999");
                        }
                    });
                }
            },
            error: function (e) {
                sessionTimeout(e);
            }
        });
    }




}

function treeSavedConnections(treeObj, treeId)
{
//    var connectionObj;
    var treeConfigObj = treeObj['treeConfigObj'];
    var dragEndFunction = treeObj['dragEndFunction'];
    treeConfigObj.allowDrag = true;
    treeConfigObj.allowDrop = true;
    treeConfigObj.hasThreeStates = true;
    treeConfigObj.checkboxes = true;
    treeConfigObj.dragEnd = eval('(' + dragEndFunction + ')');
    var columnsObj = treeObj['treeColumnObj'];
    $('#' + treeId).jqxTree(treeConfigObj);
    $('#' + treeId).jqxTree('focus');
    var filterItems = ['TABLES', 'VIEWS', 'SYNONYMS'];
    $('#' + treeId).on('select', function (event) {
        var selectedItem = $('#' + treeId).jqxTree('getItem', event.args.element);
        var $selectedElement = $(event.args.element);
        if (selectedItem != null && !jQuery.isEmptyObject(selectedItem) && selectedItem['value'] != null
                && selectedItem['value'] != '' && filterItems.indexOf(selectedItem['value']) > -1) {
            selectColumnsObj = columnsObj
            var parentSelectId = selectedItem['parentId'];
            var parentDiv = $("#" + parentSelectId);
            var childObj = parentDiv[0].children[1];
            var valueObj = childObj.treeItem['value'];
            selectedDataBase = valueObj;
            if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
            {

                var selectConnsObj = savedDBData[valueObj];
                if (selectConnsObj != null && !jQuery.isEmptyObject(selectConnsObj))
                {
                    selectConnObj = selectConnsObj;
                }
            }
            var hiddenFieldId = "DATABASE_" + selectedDataBase + "_" + selectedItem.value + "_hidden";
            hiddenFieldId = hiddenFieldId.replace(/ /g, '_');
            hiddenFieldId = hiddenFieldId.replace(/\//g, '_');
            var filterValue = $("#" + hiddenFieldId).val();
            if (filterValue != null && filterValue != '' && filterValue != undefined)
            {
                $("#treeETLFilterImage").attr('src', "images/Filter Icon2-01.svg");
            } else
            {
                $("#treeETLFilterImage").attr('src', "images/Filter Icon-01.svg");
            }
        } else if (selectedItem != null && !jQuery.isEmptyObject(selectedItem) && selectedItem['value'] != null
                && selectedItem['value'] != '' && selectedItem['value'] == "Show More") {
            selectColumnsObj = columnsObj;
            var valueObj;
            var selectedValue;
            var selectedLevel;
            var parentElement = event.args.element.parentElement.parentElement;
            var parent = $('#' + treeId).jqxTree('getItem', parentElement);
            var $selectedElement = $(parentElement);
            if (parent != null) {
                selectedValue = parent.value;
                selectedLevel = parent.level;
                var parentSelectId = parent['parentId'];
                var parentDiv = $("#" + parentSelectId);
                var childObj = parentDiv[0].children[1];
                valueObj = childObj.treeItem['value'];
            }
            if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
            {

                var selectConnsObj = savedDBData[valueObj];
                if (selectConnsObj != null && !jQuery.isEmptyObject(selectConnsObj))
                {
                    selectConnObj = selectConnsObj;
                }
            }
            var parentEventItem = parentElement;
            for (var i = selectedLevel; i > 1; i--)
            {
                parentEventItem = parentEventItem.parentElement.parentElement;
            }
            var selectedItem = $('#' + treeId).jqxTree('getItem', parentEventItem);
            var selectedParentValue = selectedItem['value'];
            treePaging(selectedValue, selectConnObj, $selectedElement[0], selectedLevel, selectColumnsObj, valueObj, selectedParentValue);
//            treePaging(selectedValue, selectConnObj, $selectedElement[0], selectedLevel, selectColumnsObj, valueObj);
        }
    });
    $('#' + treeId).on('expand', function (event) {
        var connectionObj;
        var parentItem = $('#' + treeId).jqxTree('getItem', event.args.element);
        //------------ file expand code
        if (parentItem.level == '2') {
            globalFileTreeItem[parentItem.value.toUpperCase()] = parentItem.element;
        }

        var $element = $(event.args.element);
        var loader = false;
        var loaderItem = null;
        var children = $element.find('ul:first').children();
        $.each(children, function () {
            var item = $('#' + treeId).jqxTree('getItem', this);
            if (item && item.value == 'ajax') {
                loaderItem = item;
                loader = true;
                return false
            }
        });
        if (loaderItem != null) {
            showLoader();
            var extTreeParams = $("#extTreeParams").val();
            var value;
            var level = parentItem.level;
            $('#' + treeId).jqxTree('removeItem', loaderItem.element);
            if (parentItem.level > 3)
            {
                //var prevObj = parentItem['prevItem'];
//                value = parentItem['value'];
                var parentEventItem = event.args.element;
                for (var i = level; i > 3; i--)
                {
                    parentEventItem = parentEventItem.parentElement.parentElement;
                }
                var selectedItem = $('#' + treeId).jqxTree('getItem', parentEventItem);
                value = selectedItem['value'];
            }

            if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
            {
                var conObj = savedDBData[value];
                if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                    connectionObj = conObj;
                }

            }
            var data = {
                parentkey: parentItem.value,
                treeId: treeObj['treeId'],
                level: parentItem.level,
                extTreeParams: extTreeParams,
                columnsObj: JSON.stringify(columnsObj),
                connectionObj: JSON.stringify(connectionObj),
                startIndex: 0,
                endIndex: $("#treePageSize").val()
            };
            // -------------  JAGADISH CODE START ------------ line 1764

            if (parentItem.level == '3') { // JAGADISH CODE START ETL_QUERY 
                var superParentEle = parentItem['parentElement'];
                var superParentValue = superParentEle['children'][2];
                data['superParentValue'] = superParentValue['innerText'];
            }
            // JAGADISH CODE END
            var hiddenFieldId = "DATABASE_" + value + "_" + parentItem.value + "_hidden";
            var hiddenPagingId = "DATABASE_" + value + "_" + parentItem.value + "paging__hidden";
            hiddenFieldId = hiddenFieldId.replace(/ /g, '_');
            hiddenPagingId = hiddenPagingId.replace(/ /g, '_');
            hiddenFieldId = hiddenFieldId.replace(/\//g, '_');
            hiddenPagingId = hiddenPagingId.replace(/\//g, '_');
            var hiddenPagingField = "<input type='hidden' id='" + hiddenPagingId + "'value=''/>";
            $("#savedConnections").append(hiddenPagingField);
            var prevFilterVal = $("#" + hiddenFieldId).val();
            if (prevFilterVal != null && prevFilterVal != '' && prevFilterVal != undefined)
            {
                prevFilterVal = JSON.parse(prevFilterVal);
                data['filterValue'] = prevFilterVal['filterType'];
                data['filterCondition'] = prevFilterVal['filterValue'];
            }
            var url = "getTreePagingDataOpt";
            var treePagingObj = {};
            treePagingObj['startIndex'] = '0';
            treePagingObj['endIndex'] = $("#treePageSize").val();
            $("#" + hiddenPagingId).val(JSON.stringify(treePagingObj));
//            var url = "getTreeDataOpt";
            var filesParentElement = parentItem['parentElement'];

            var selectedFilesItem = $('#' + treeId).jqxTree('getItem', filesParentElement);
            if (parentItem.value == 'FILES'
                    || (selectedFilesItem != null
                            && selectedFilesItem['value'] == 'FILES'))
            {
                url = 'getTreeUploadedFiles';
            }

            if (parentItem.level > 3)
            {
                var parentEventItem = event.args.element;
                var immideateParent = parentEventItem.parentElement.parentElement;
                immideateParent = immideateParent.parentElement.parentElement;
                for (var i = level; i > 1; i--)
                {
                    parentEventItem = parentEventItem.parentElement.parentElement;
                }

                var selectedItem = $('#' + treeId).jqxTree('getItem', parentEventItem);
                var selectedParentValue = selectedItem['value'];
                if (selectedParentValue != null && selectedParentValue != '' &&
                        selectedParentValue != undefined && selectedParentValue == 'ERP')
                {
                    url = 'getTreeErpConnectionDetails';
                    var immideateParentItem = $('#' + treeId).jqxTree('getItem', immideateParent);
                    var immideateParentValue = immideateParentItem['value'];
                    if (immideateParentValue == "Oracle_ERP") {
                        url = 'getTreePagingDataOpt';
                    }
                }
            }
            $.ajax({
                type: "post",
                traditional: true,
                dataType: 'json',
                url: url,
                cache: false,
                data: data,
                success: function (data, status, xhr) {
                    stopLoader();
                    if (parentItem.level == 2) {
                        var parentParentItem = $('#' + treeId).jqxTree("getItem", parentItem.parentElement);
                        if (parentParentItem.value != "FILES") {

                            if (data != null)
                            {
                                savedDBData = data[0].connectionObj;
                            }
                        }
                    }

                    $('#' + treeId).jqxTree('addTo', data, $element[0]);
                    var items = $('#' + treeId).jqxTree('getItems');
                    $.each(items, function () {
                        $(this.titleElement).attr('title', this.label);
                        $("#" + this.titleElement[0].id).removeClass('visionETLParentHighight');
                        if (this.value == "Show More")
                        {
                            var childLength = this.element.children['length'];
                            var expandDiv = this.element.children[0];
                            if (childLength > 3) {
                                var div = this.element.children[1];
                                var checkBoxDiv = this.element.children[2];
                                $("#" + expandDiv.id).remove();
                                $("#" + div.id).remove();
                                $("#" + checkBoxDiv.id).addClass('visionETLCheckboxEmptySpace');
                            } else
                            {
                                $("#" + expandDiv.id).remove();
                            }
                        }
                    });
                    if (parentItem != null)
                    {
                        var parentItemEle = event.args.element;
                        for (var p = level; p >= 0; p--)
                        {
                            var parentItemId = $('#' + treeId).jqxTree('getItem', parentItemEle);
                            if (parentItemId != null)
                            {
                                var divItemId = parentItemId.titleElement[0];
                                $("#" + divItemId.id).addClass('visionETLParentHighight');
                            }
                            parentItemEle = parentItemEle.parentElement.parentElement;
                        }
                    }
                    $('#mainSplitter').resize();
                },
                error: function (e) {
                    console.log(e);
                    sessionTimeout(e);
                    stopLoader();
                }
            });
        }



    });
}

function treeRefreshSavedConnections()
{
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: "getTreeDataPiping",
        cache: false,
        data: {
            treeId: 'MM_SOURCE_SAVED_CONNECTION_TREE',
        },
        success: function (response) {

            if (response != null && !jQuery.isEmptyObject(response))
            {
                $("#savedConnections").html("");
                treeSavedConnections(response, 'savedConnections');
            }

        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}

function treeDestinationConnections()
{
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: "getTreeDataPiping",
        cache: false,
        data: {
            treeId: 'MM_SOURCE_SAVED_CONNECTION_TREE',
        },
        success: function (response) {

            if (response != null && !jQuery.isEmptyObject(response))
            {
                $("#descSplitterContainerHeader").html("");
                treeSavedConnections(response, 'descSplitterContainerHeader');
            }

        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}


function treeSourcesMenus(menuId, treeId)
{
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var labelObject = {};
    $.ajax({
        type: 'POST',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'getTreeDataMigrationMenus',
        data: {menuId: menuId},
        success: function (response) {
            stopLoader();
            if (response != null) {
//                console.log("response:::" + response);
                response = JSON.parse(response);
                var menuResult = response.menuResult;
                var treeMenuData = JSON.parse(menuResult);
                var source =
                        {
                            datatype: "json",
                            datafields: [
                                {name: 'MENU_ID'},
                                {name: 'PARENT_ID'},
                                {name: 'PARENT_MENU_ID'},
                                {name: 'MENU_DESCRIPTION'},
                                {name: 'icon'},
                                {name: 'value'},
                                {name: 'iconsize'},
                                {name: 'TOOL_TIP'},
                                {name: 'MAIN_DESCRIPTION'}
                            ],
                            localdata: treeMenuData
                        };
                // create data adapter.
                var dataAdapter = new $.jqx.dataAdapter(source);
                // perform Data Binding.
                dataAdapter.dataBind();
                var records = dataAdapter.getRecordsHierarchy('MENU_ID',
                        'PARENT_ID',
                        'items',
                        [{name: 'MENU_DESCRIPTION', map: 'html'}]
                        );
//                        'MENU_ID','PARENT_MENU_ID','TOOL_TIP');

                if (treeId != null && treeId != "" && treeId != undefined && treeId == "savedSources")
                {
                    $('#' + treeId).jqxTree({source: records, allowDrag: true, allowDrop: true, height: '90%', width: '100%', toggleMode: 'click', theme: 'energyblue',
                        dragEnd: function (item) {
                            createImageSourcesFlowchart(item, item.value, 'File');
                            createImageSourcesDataModellerFlowchart(item, item.value, 'File');
                            return true;
                        }
                    });

                } else if (treeId != null && treeId != "" && treeId != undefined && treeId == "descSplitterContainer")
                {
                    $('#' + treeId).jqxTree({source: records, allowDrag: true,
                        allowDrop: true, height: '90%', width: '100%',
                        toggleMode: 'click', theme: 'energyblue',
                        dragEnd: function (item) {
                            createImageDestinationFlowchart(item, item.value, 'File');
                            createImageDestinationDataModellerFlowchart(item, item.value, 'File');
                            return true;
                        }
                    });
                }
                $('#' + treeId).css('visibility', 'visible');
                $('#' + treeId).on('select', function (event) {
                    var item = $('#' + treeId).jqxTree('getItem', event.args.element);
                    if (item != null && !jQuery.isEmptyObject(item) && item['value'] != null
                            && item['value'] != ''
                            && item['value'] != '#') {
                        eval(item['value']);
                    }

                });
                $('.visionProgressSteps').hide();
                $("#" + treeId).jqxTree('expandAll');
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }
    });
}

function getTreeDataBase(type, typeName)
{
    console.log(type + ":::iam in getTreeDataBasemethod:::" + typeName);
    if (type != null && type != "" && type != undefined && type == "FILE")
    {
        var response = "<div id ='treeDMFileId' class ='treeDMFileDivClass'>"
                + "<div id='visionShowFileUploadMsg'></div>";
        response += "<input type='file' name='importTreeDMFile'  id='importTreeDMFile' class='visionTreeDMFilesInput'/>";
        response += "<div class='visionTreeDMFileUploadclass' id='visionTreeDmFileUpload'>";
        response += "<input type='hidden' id='selectedTreeTypeName' value=''>";
        response += "<input type='hidden' id='selectedTreeType' value=''>";
        response += "<p class='VisionDMUploadFileContent'>Upload Files(" + typeName + ") Here</p></div></div>";
        uploadFilePopup(response, type, typeName);
    } else if (type != null && type != "" && type != undefined && type == "DB") {
        var formString = "<div class='visionEtlConnectDbMain'>"
                + "<div id='visionShowConnectionMsg'></div>"
                + "<table class='visionEtlDbTable' autocomplete='false'>"
                + "<tr><td><p style='font-weight:bold'>Connection Type:</p></td>"
                + "<td>" + typeName + "</td></tr>"
                + "<tr>"
                + "<td> <label class='visionDbLabels'>Connection Name</label></td>"
                + "<td> <input type='text'  name='ConnectionName' id='DbEtlConnectionName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlConnectionNameError'></div></td>"
                + " </tr>"
                + "<tr>"
                + "<td> <label class='visionDbLabels'>Host Name</label></td>"
                + "<td> <input type='text'  name='HostName' id='DbEtlHostName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlHostNameError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Port</label></td>"
                + "<td><input type='text' value='' name='Port' id='DbEtlPort' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlPortError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Username</label></td>"
                + "<td> <input type='text'  name='EtlUsername' id='DbEtlUserName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlUserNameError'></div></td>"
                + "</tr>"
                + " <tr>"
                + "<td>  <label class='visionDbLabels'>Password</label></td>"
                + "<td>    <input type='password'   name='EtlPassword' id='DbEtlPassword' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlPasswordError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Database/Service Name</label></td>"
                + "<td>    <input type='text'  name='ServiceName' id='DbEtlServiceName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlServiceNameError'></div></td>"
                + "</tr>"
                + "<tr style='display:none'>"
                + "<td>  <label class='visionDbLabels'>Audit Id</label></td>"
                + "<td>    <input type='hidden'  name='auditId' id='EtlAuditId' class='visionInputDbFields'></td>"
                + "</tr>"
                + "<tr><td><input type='checkbox' name='checkBoxDetails' id = 'EtlCheckBoxChecked' value='checked' checked>Save Details"
                + "<div class='visionDataMigrationError' style='display:none'>Please check the box</div></td></tr>"
                + "<tr>"
                + "<td class='visionDbConnectBtn' id='connectEtlDbTd' colspan = '2'><input type='button' value='Connect' name='Connect'  onclick = \"connectEtlDatabase('" + type + "','" + typeName + "')\" class='visionInputDbButton'></td>"

                + "</tr>"
                + "</table></div>";
        ShowEtlConnectionPopup(formString, type, typeName, 'Connect Database');
    } else if (type != null && type != "" && type != undefined && type == "ERP" && typeName == "SAP") {
        var erpTable = "<div class='visionEtlErpDiv'>"
                + "<div id='visionShowErpEtlMsg'></div>"
                + "<table class='visionERPEtlTable'>"
                + "<tr><td><p style='font-weight:bold'>Connection Type:</p></td>"
                + "<td>" + typeName + "</td></tr>"
                + " <tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'> <label class='visionERPDbLabels'>Connection Name</label></td>"
                + "<td class='visionERPDbTd'> <input type='text' value='' name='ConnectionName' id='ErpEtlDbConnectionName' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ErpEtlDbConnectionNameError'></div></td>"
                + " </tr>"
                + " <tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'> <label class='visionERPDbLabels'>Client</label></td>"
                + "<td class='visionERPDbTd'> <input type='text' value='' name='Client' id='ERPEtlClientName' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlClientNameError'></div></td>"
                + " </tr>"
                + "<tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'> <label class='visionERPDbLabels'>Host Name</label></td>"
                + "<td class='visionERPDbTd'> <input type='text' value='' name='ERP HostName' id='ERPEtlHostName' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlHostNameError'></div></td>"
                + "</tr>"
                + "<tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'>  <label class='visionERPDbLabels'>Username</label></td>"
                + "<td class='visionERPDbTd'> <input type='text' value='' name='Username' id='ERPEtlUserName' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlUserNameError'></div></td>"
                + "</tr>"
                + " <tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'>  <label class='visionERPDbLabels'>Password</label></td>"
                + "<td class='visionERPDbTd'>    <input type='password' value='' name='Password' id='ERPEtlPassword' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlPasswordError'></div></td>"
                + "</tr>"
                + "<tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'>  <label class='visionERPDbLabels'>Language Id</label></td>"
                + "<td class='visionERPDbTd'>    <input type='text' value='' name='languageId' id='ERPEtlLanguageId' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlLanguageIdError'></div></td>"
                + "</tr>"
                + "<tr class='visionERPDbTr'>"
                + "<tr class='visionERPDbTr' style='display:none'>"
                + "<td class='visionERPDbTr'>  <label class='visionERPDbLabels'>Audit Id</label></td>"
                + "<td class='visionERPDbTr'>    <input type='hidden' value='' name='auditId' id='ErpEtlauditId' class='visionInputDbFields'></td>"
                + "</tr>"
                + "<tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd'>  <label class='visionERPDbLabels'>System Id</label></td>"
                + "<td class='visionERPDbTd'>    <input type='text' value='' name='ERPSystemId' id='ERPEtlSystemId' class='visionInputDbFields'>"
                + "<div class='dataMigrationInputError' id='ERPEtlSystemIdError'></div></td>"
                + "</tr>"
                + "<tr class='visionERPDbTr'><td><input type='checkbox' name='checkBoxDetails' id = 'checkBoxChecked' value='checked' checked>Save Details"
                + "<div class='visionDataMigrationError' style='display:none'>Please check the box</div></td></tr>"
                + "<tr class='visionERPDbTr'>"
                + "<td class='visionERPDbTd visionERPDbConnectBtn' id='connectERPEtlDbTd' colspan = '2'><input type='button' value='Connect' name='Connect'  onclick = \"connectErpEtlDatabase('" + type + "','" + typeName + "')\" class='visionInputDbButton'></td>"

                + "</tr>"
                + "</table>";
        ShowEtlConnectionPopup(erpTable, type, typeName, 'Connect ERP');

    } else if (typeName == 'Oracle_ERP') {
        var formString = "<div class='visionEtlConnectDbMain'>"
                + "<div id='visionShowConnectionMsg'></div>"
                + "<table class='visionErpEtlDbTable' autocomplete='false'>"
                + "<tr><td><p style='font-weight:bold'>Connection Type:</p></td>"
                + "<td>" + typeName + "</td></tr>"
                + "<tr>"
                + "<td> <label class='visionDbLabels'>Connection Name</label></td>"
                + "<td> <input type='text'  name='ConnectionName' id='DbEtlConnectionName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlConnectionNameError'></div></td>"
                + " </tr>"
                + "<tr>"
                + "<td> <label class='visionDbLabels'>Host Name</label></td>"
                + "<td> <input type='text'  name='HostName' id='DbEtlHostName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlHostNameError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Port</label></td>"
                + "<td><input type='text' value='' name='Port' id='DbEtlPort' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlPortError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Username</label></td>"
                + "<td> <input type='text'  name='EtlUsername' id='DbEtlUserName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlUserNameError'></div></td>"
                + "</tr>"
                + " <tr>"
                + "<td>  <label class='visionDbLabels'>Password</label></td>"
                + "<td>    <input type='password'   name='EtlPassword' id='DbEtlPassword' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlPasswordError'></div></td>"
                + "</tr>"
                + "<tr>"
                + "<td>  <label class='visionDbLabels'>Database/Service Name</label></td>"
                + "<td>    <input type='text'  name='ServiceName' id='DbEtlServiceName' class='visionInputDbFields' autocomplete='false'>"
                + "<div class='dataMigrationInputError' id='DbEtlServiceNameError'></div></td>"
                + "</tr>"
                + "<tr style='display:none'>"
                + "<td>  <label class='visionDbLabels'>Audit Id</label></td>"
                + "<td>    <input type='hidden'  name='auditId' id='EtlAuditId' class='visionInputDbFields'></td>"
                + "</tr>"
                + "<tr><td><input type='checkbox' name='checkBoxDetails' id = 'EtlCheckBoxChecked' value='checked' checked>Save Details"
                + "<div class='visionDataMigrationError' style='display:none'>Please check the box</div></td></tr>"
                + "<tr>"
                + "<td class='visionDbConnectBtn' id='connectEtlDbTd' colspan = '2'><input type='button' value='Connect' name='Connect'  onclick = \"connectEtlDatabase('" + type + "','" + typeName + "')\" class='visionInputDbButton'></td>"

                + "</tr>"
                + "</table></div>";
        ShowEtlConnectionPopup(formString, type, typeName, 'Connect ERP');
    } else if (type == 'WEB_SERVICE') {
        if (typeName == 'SOAP') {
            var formString = "<div class='visionEtlConnectDbMain'>"
                    + "<div id='visionShowConnectionMsg'></div>"
                    + "<table class='visionErpEtlDbTable' autocomplete='false'>"
                    + "<tr><td><p style='font-weight:bold'>Webservice Type:</p></td>"
                    + "<td>" + typeName + "</td></tr>"
                    + "<tr>"
                    + "<td> <label class='visionDbLabels'>WSDL URL</label></td>"
                    + "<td> <input type='text'  name='wsdlURL' id='wsdlURL' class='visionInputDbFields' autocomplete='false'>"
                    + "<div class='dataMigrationInputError' id='wsdlURLError'></div></td>"
                    + " </tr>"
                    + "<tr>"
                    + "<td> <label class='visionDbLabels'>End Point URL</label></td>"
                    + "<td> <input type='text'  name='endPointURL' id='endPointURL' class='visionInputDbFields' autocomplete='false'>"
                    + "<div class='dataMigrationInputError' id='endPointURLError'></div></td>"
                    + "</tr>"
                    + "<tr>"
                    + "<tr style='display:none'>"
                    + "<td>  <label class='visionDbLabels'>Audit Id</label></td>"
                    + "<td>    <input type='hidden'  name='auditId' id='EtlAuditId' class='visionInputDbFields'></td>"
                    + "</tr>"
                    + "<tr><td><input type='checkbox' name='checkBoxDetails' id = 'EtlCheckBoxChecked' value='checked' checked>Save Details"
                    + "<div class='visionDataMigrationError' style='display:none'>Please check the box</div></td></tr>"
                    + "<tr>"
                    + "<td class='visionDbConnectBtn' id='connectEtlDbTd' colspan = '2'><input type='button' value='Import' name='Import'  onclick = \"connectEtlWSSOAP('" + type + "','" + typeName + "')\" class='visionInputDbButton'></td>"

                    + "</tr>"
                    + "</table></div>";
        } else if (typeName == 'REST') {

        }
        ShowEtlConnectionPopup(formString, type, typeName, 'Connect Webservice');
    }
}

function uploadFilePopup(response, type, typeName)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    $("#dialog").html(response);
    $("#dialog").dialog({
        title: (labelObject['Upload'] != null ? labelObject['Upload'] : 'Upload'),
//        modal: true,
        width: 500,
        height: 350,
        fluid: true,
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $("#savedSources").jqxTree('selectItem', null);
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
    $("#selectedTreeType").val(type);
    $("#selectedTreeTypeName").val(typeName);
    $("#importTreeDMFile").hide();
    setTimeout(function () {
        $("html").on("dragover", function (e) {
            e.preventDefault();
            e.stopPropagation();
        });
        $("html").on("drop", function (e) {
            e.preventDefault();
            e.stopPropagation();
        });
        $('.treeDMFileDivClass').on('drop', function (event) {

            $("#wait").css("display", "block");
            var filetype = $('#selectedTreeTypeName').val();
//            dmTreeFileUpload("Y", filetype);

            if (filetype == 'XLSX' || filetype == 'XLS')
            {
                var files = event.target.files; // FileList object
                parseExcel(files[0], filetype);
            } else {
//                dmTreeFileUpload("N", filetype);
                uploadSelectedFile(files[0], filetype);
            }
        });
        $("#visionTreeDmFileUpload").click(function () {
            var filetype = $('#selectedTreeTypeName').val();
            console.log("iam in clickable ");
//            dmTreeFileUpload("N", filetype);

            $("#importTreeDMFile").click();
        });
        $("#importTreeDMFile").on('change', function (event) {

            var filetype = $('#selectedTreeTypeName').val();
            console.log("iam in files change ");
//            dmTreeFileUpload("N", filetype);
            if (filetype == 'XLSX' || filetype == 'XLS')
            {
                var files = event.target.files; // FileList object
                parseExcel(files[0], filetype);
            } else {
                var files = event.target.files;
//                dmTreeFileUpload("N", filetype);
                uploadSelectedFile(files[0], filetype);

            }

        });
    }, 300);
}

function dmTreeFileUpload(draganddropInd, fileType)
{
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var params = {};
    params['selectedFiletype'] = fileType;
    var browseId = "#importTreeDMFile";
    $(browseId).ajaxfileupload({
        'action': 'importTreeDMFile',
        params: params,
        'onComplete': function (response) {
            $("#Loader").css("display", "none");
            $("body").css({"pointer-events": "auto"});
            var message = response.message;
            if (message != null && message.indexOf("{") > -1 && message.indexOf("}") > -1) {
                message = message.substring(message.indexOf("{"), message.indexOf("}") + 1);
            }
            message = JSON.parse(message);
            var fileName = message.fileName;
            var result = message.result;
            if (result != null && result.indexOf("successfully") > -1) {
                $("#visionShowFileUploadMsg").html('<p style="color:green">' + result + '</p>');
            } else {
                $("#visionShowFileUploadMsg").html('<p style="color:red">' + result + '</p>');
            }
            $("#importTreeDMFile").remove();
            var fileImprtDiv = "<input type='file' name='importTreeDMFile' id='importTreeDMFile' style='display:none'>";
            $("#visionTreeDmFileUpload").parent().append(fileImprtDiv);
            console.log("On Complete::");
            // files expand ravi start
            if (fileType != null) {
                var treeItemElement = globalFileTreeItem[fileType];
                if (treeItemElement != null) {
                    var $element = $(treeItemElement);
                    var children = $element.find('ul:first').children();
                    if (children != null && children.length > 0) {
                        $.each(children, function (index) {
                            $('#savedConnections').jqxTree('removeItem', this)
                        })
                        $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
                        $('#savedConnections').jqxTree('collapseItem', treeItemElement);
                        $('#savedConnections').jqxTree('expandItem', treeItemElement);
                    }
                }
            }
//            var treeItemElement = globalFileTreeItem[fileType];
//            var $element = $(treeItemElement);
//            var children = $element.find('ul:first').children();
//            $.each(children, function (index) {
//                $('#savedConnections').jqxTree('removeItem', this)
//            })
//            $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
//            $('#savedConnections').jqxTree('collapseItem', treeItemElement);
//            $('#savedConnections').jqxTree('expandItem', treeItemElement);
            // files expand ravi end 
        },
        'onStart': function () {
            $('#Loader').show();
            $("body").css({"pointer-events": "none"});
            $("#Loader").css("display", "block");
        }
    });
    if (draganddropInd == 'N') {
        $("#importTreeDMFile").click();
    }

}

function refreshMappingArea()
{
    var contentSplitterStyle = $("#contentSplitter").css("display");
    var contentSplitter1Style = $("#contentSplitter1").css("display");
    var flowChartId;
    var containerId;
    if (contentSplitterStyle == "block") {

        flowChartId = flowChartWorkSpaceId;
//        flowChartId = 'flowchartworkSourcesspace';
        containerId = 'feedHeader';

//        flowChartId = 'flowchartworkSourcesspace';
//        containerId = 'feedHeader';
    } else if (contentSplitter1Style == "block") {
        flowChartId = 'dataModellerFlowchartworkSourcesspace';
        containerId = 'feedHeader1';
    }
    $("#dialog").html("Are you sure you want to clear the Mapping Area??");
    $("#dialog").dialog({
        title: (labelObject['Confirmation'] != null ? labelObject['Confirmation'] : 'Confirmation'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
//                    $("#currentJobId").val("");
//                    $("#currentJobName").val("");
//                    $("#currentGroupJobName").val("");
                    var jobDescr = $("#currentJobName").val();
                    var jobId = $("#" + flowChartId).attr("jobId");
                    var folderId = $("#" + flowChartId).attr("folderId");
                    var folderName = $("#" + flowChartId).attr("folderName");
                    $("#" + flowChartId).remove();
                    refreshWorkSpaceFlag = true;

                    var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
                    if (flowChartId.indexOf("flowchartworkSourcesspace") > -1) {
                        var length = $('#flowChartTabs').jqxTabs('length');
                        if (length != null) {
                            $('#flowChartTabs').jqxTabs('removeAt', selectedItemIndex);
                        }
                        var divStr = "<div>";
                        divStr += "<div  style='display: flex;float:left;margin-top:5px;'>";
                        divStr += "</div>";
                        divStr += '<div  id="flowchartworkSourcesspace" class="flowchart-example-container"></div>';
                        $('#flowChartTabs').jqxTabs('addAt', selectedItemIndex, "New Tab", divStr);
                        $("#" + flowChartId).flowchart({
                            linkWidth: 2,
                            defaultSelectedLinkColor: '#000055',
                            grid: 10,
                            distanceFromArrow: 0,
                            //                defaultOperatorClass:'VisionWorkFlowTest',
                            //                multipleLinksOnInput: true,
                            //                multipleLinksOnOutput: true,
                            defaultSelectedLinkColor: 'red',
                            onOperatorContextMenu: function (operatorId) {
                                console.log("operatorId:::" + operatorId);
                                openOpeartorContextMenu(operatorId);
                                return true;
                            },
                        });
                        $("#" + flowChartId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                            onLinkCreate: function (linkId, linkData) {

                                var fromOperatorId = linkData['fromOperator'];
                                var toOperatorId = linkData['toOperator'];
                                var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                                var connectedTo = fromOperatorData['connectedTo'];
                                connectedTo = (connectedTo != null) ? connectedTo : [];
                                if (connectedTo.indexOf(toOperatorId) == -1) {
                                    connectedTo.push(toOperatorId)
                                }

                                fromOperatorData['connectedTo'] = connectedTo;
                                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                                var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                                var connectedFrom = toOperatorData['connectedFrom'];
                                connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                                if (connectedFrom.indexOf(fromOperatorId) == -1) {
                                    connectedFrom.push(fromOperatorId)
                                }

                                toOperatorData['connectedFrom'] = connectedFrom;
                                if (toOperatorData['component'] == 'Y') {
                                    toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                                    if (toOperatorData['connObj'] == null) {
                                        toOperatorData['connObj'] = savedDBData["Current_V10"];
                                    }
                                }
                                var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                                var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                                if (originalSources.indexOf(fromTable) == -1) {
                                    originalSources.push(fromTable);
                                }
                                toOperatorData['originalSources'] = originalSources;

                                var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                                if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                                    originalSourceOp.push(fromOperatorId);
                                }
                                toOperatorData['originalSourceOp'] = originalSourceOp;
                                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                                //            setToOpDblCLickFuncName(fromOperator, toOperator);
                                return true;
                            },
                            onAfterChange: function (changeType) {

                                if (!operatorDoublClick) {
                                    trfmRulesChanged = true;
                                    console.error("trfmRulesChanged : " + trfmRulesChanged);
                                    return true;
                                }
                            },
                            onOperatorSelect: function (changeType) {
                                $(document).find("input").blur();
                                return true;

                            },
                            onLinkSelect: function (changeType) {
                                $(document).find("input").blur();
                                return true;
                            }
                        });

                    } else {
                        var htmlDiv = '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                        $('#flowChartTabs').jqxTabs('setContentAt', selectedItemIndex, htmlDiv);
                        setTimeout(function () {
                            $("#" + flowChartId).flowchart({
                                linkWidth: 2,
                                defaultSelectedLinkColor: '#000055',
                                grid: 10,
                                distanceFromArrow: 0,
                                //                defaultOperatorClass:'VisionWorkFlowTest',
                                //                multipleLinksOnInput: true,
                                //                multipleLinksOnOutput: true,
                                defaultSelectedLinkColor: 'red',
                                onOperatorContextMenu: function (operatorId) {
                                    console.log("operatorId:::" + operatorId);
                                    openOpeartorContextMenu(operatorId);
                                    return true;
                                },
                            });
                        }, 100)

                        $("#" + flowChartId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                            onLinkCreate: function (linkId, linkData) {

                                var fromOperatorId = linkData['fromOperator'];
                                var toOperatorId = linkData['toOperator'];
                                var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                                var connectedTo = fromOperatorData['connectedTo'];
                                connectedTo = (connectedTo != null) ? connectedTo : [];
                                if (connectedTo.indexOf(toOperatorId) == -1) {
                                    connectedTo.push(toOperatorId)
                                }

                                fromOperatorData['connectedTo'] = connectedTo;
                                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                                var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                                var connectedFrom = toOperatorData['connectedFrom'];
                                connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                                if (connectedFrom.indexOf(fromOperatorId) == -1) {
                                    connectedFrom.push(fromOperatorId)
                                }

                                toOperatorData['connectedFrom'] = connectedFrom;
                                if (toOperatorData['component'] == 'Y') {
                                    toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                                    if (toOperatorData['connObj'] == null) {
                                        toOperatorData['connObj'] = savedDBData["Current_V10"];
                                    }
                                }
                                var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                                var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                                if (originalSources.indexOf(fromTable) == -1) {
                                    originalSources.push(fromTable);
                                }
                                toOperatorData['originalSources'] = originalSources;

                                var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                                if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                                    originalSourceOp.push(fromOperatorId);
                                }
                                toOperatorData['originalSourceOp'] = originalSourceOp;
                                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                                //            setToOpDblCLickFuncName(fromOperator, toOperator);
                                return true;
                            },
                            onAfterChange: function (changeType) {

                                if (!operatorDoublClick) {
                                    trfmRulesChanged = true;
                                    console.error("trfmRulesChanged : " + trfmRulesChanged);
                                    return true;
                                }
                            },
                            onOperatorSelect: function (changeType) {
                                $(document).find("input").blur();
                                return true;

                            },
                            onLinkSelect: function (changeType) {
                                $(document).find("input").blur();
                                return true;
                            }
                        });
                    }
//                    $("#dataMigrationTabs").html("");
                    $("#dataMigrationTabs").remove();
                    $("#normalizeOptionsTabs").remove(); // ravi normalise
                    $("#deNormalizeOptionsTabs").remove();
                    previousOperatorId = null;
                    prevTargetOperatorId = null;
                    $("#currentTrnsOpId").val(""); // ravi updated code changes

                }},
            {
                text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                    // $("#labeld").empty();

                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });

}

function deleteSelectedOporLink() {

    $("#" + flowChartWorkSpaceId + " .selected, #dataModellerFlowchartworkSourcesspace .selected").each(function () {
        var currentFlowcharArea = $(this).parent().parent().attr("id");
        var selectedOpeartorId = $(this).data("operator_id");
        console.log(":::::;" + selectedOpeartorId);
        $('#' + currentFlowcharArea).flowchart('deleteOperator', selectedOpeartorId);

    });

    var linkId = $("#" + flowChartWorkSpaceId + ", #dataModellerFlowchartworkSourcesspace").flowchart('getSelectedLinkId');
    if (linkId != null) {
        $("#" + flowChartWorkSpaceId + ", #dataModellerFlowchartworkSourcesspace").flowchart('deleteLink', linkId);
    }

    try {
        var currentFlowcharArea = $(this).parent().parent().attr("id");
        $('#' + currentFlowcharArea).flowchart('deleteSelected');
    } catch (e) {
    }
    trfmRulesChanged = true;
//    

}

function saveJob(jobName, jobId, data, folderName, folderId, processFlag) { // ravi save new job
    showLoader();

    var contentSplitterStyle = $("#contentSplitter").css("display");
    var contentSplitter1Style = $("#contentSplitter1").css("display");
    var flowChartId;
    var containerId;
    var jobDetails = {};
    if (contentSplitterStyle == "block") {
        flowChartId = flowChartWorkSpaceId;
        containerId = 'feedHeader';
        jobDetails['jobType'] = "ETL";
    } else if (contentSplitter1Style == "block") {
        flowChartId = 'dataModellerFlowchartworkSourcesspace';
        containerId = 'feedHeader1';
        jobDetails['jobType'] = "DM";
    }
// ravi start

    var data = {};
    try {
        data = $('#' + flowChartId).flowchart('getData');
    } catch (e) {
    }

    console.log("Data::::" + JSON.stringify(data))
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'html',
        cache: false,
        url: "saveMappings",
        data: {
            mappedData: JSON.stringify(data),
            jobName: jobName,
            jobId: jobId, // ravi save new job
            folderName: folderName,
            folderId: folderId,
            jobDetails: JSON.stringify(jobDetails)
                    //trfmRulesArray: JSON.stringify(trfmRulesArray)
        },
        success: function (response) {
//            if (processFlag == 'Y') {
//                return false;
//            }
            // ravi start
            var response = JSON.parse(response);
//            showSavedJobs();
            var message = response['message'];
            var jobId = response['jobId'];
            var jobName = response['jobName'];
            $("#currentJobId").val(jobId);
            $("#currentJobName").val(jobName);
            var flowChartData = JSON.parse(response['flowChartData']);
            var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
            $("#" + flowChartId).remove();
            if (flowChartId == "flowchartworkSourcesspace") {
                var length = $('#flowChartTabs').jqxTabs('length');
                if (length != null) {
                    $('#flowChartTabs').jqxTabs('removeAt', selectedItemIndex);
                }
                var divStr = "<div>";
                divStr += "<div  style='display: flex;float:left;margin-top:5px;'>";
                divStr += "</div>";
                divStr += '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobName + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                var selectedItemIndex1 = $('#flowChartTabs').jqxTabs('selectedItem');
                $('#flowChartTabs').jqxTabs('addAt', selectedItemIndex, jobName, divStr);
                flowChartWorkSpaceId = "workSpace_" + jobId;
            } else {
                var length = $('#flowChartTabs').jqxTabs('length');
                if (length != null) {
                    $('#flowChartTabs').jqxTabs('removeAt', selectedItemIndex);
                }
                var divStr = "<div>";
                divStr += "<div  style='display: flex;float:left;margin-top:5px;'>";
                divStr += "</div>";
                divStr += '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobName + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                var selectedItemIndex1 = $('#flowChartTabs').jqxTabs('selectedItem');
                $('#flowChartTabs').jqxTabs('addAt', selectedItemIndex, jobName, divStr);
                flowChartWorkSpaceId = "workSpace_" + jobId;
            }



            $('#' + flowChartWorkSpaceId).flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $('#' + flowChartWorkSpaceId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });

            var count = 0;
            var OperatorsData = {};
            var linksData = {};
            try {
                for (var key in flowChartData.operators) {

                    OperatorsData[count] = flowChartData.operators[key];
                    for (var i in flowChartData.links) {
                        if (parseInt(key) == flowChartData.links[i].fromOperator) {
                            flowChartData.links[i].fromOperator = count;
                        }
                        if (parseInt(key) == flowChartData.links[i].toOperator) {
                            flowChartData.links[i].toOperator = count;
                        }

                    }

                    count = count + 1;
                }
                for (var key in OperatorsData) {
                    $('#' + flowChartWorkSpaceId).flowchart('addOperator', OperatorsData[key]);
                }
            } catch (e) {
            }



            var count = 0;
            //   try {

            for (var key in flowChartData.links) {

                linksData[count] = flowChartData.links[key];
                count = count + 1;

            }
            for (var key in linksData) {
                $('#' + flowChartWorkSpaceId).flowchart('addLink', linksData[key]);
            }

            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();


            // ravi end

            stopLoader();
            ajaxStop();

            trfmRulesChanged = false;
            if (processFlag == "Y") {
                processJob();
            } else {

                showMesg(message);

            }
            // ravi end
        },
        error: function (e) {
            stopLoader();
            sessionTimeout(e);
        }
    });
}


function showEtlList(treeId, listId) {
    $('#mainSplitter').jqxSplitter({width: '99.1%',
        panels: [{size: "20%", min: 10}, {min: "60%", size: "80%"}]});
    $("#savedSources").hide();
    $("#savedConnectionsIconsDiv").hide();
    $("#availableJobsDiv").hide();
    $("#schemaObjectsDiv").hide();
    $("#dataModellerJobsDiv").hide();

//    $("#cubeRelatedICONS").hide();
//    $("#availableMapTools").show();
//    $("#panelContentpanelavaialableJobsTree").show();


    $("#" + listId).parent().find('li.visionHighlightEtlIcons').removeClass('visionHighlightEtlIcons');
    $("#" + listId).addClass('visionHighlightEtlIcons');
    var mainSplitterHeight = $('#mainSplitter').height();
    console.log("mainSplitter:::" + mainSplitterHeight);
    var styleAttr = $(".savedConnectionsClass").attr('style');
    if (styleAttr != null && styleAttr != '') {
        styleAttr += ';height:' + (parseInt(mainSplitterHeight) - 20) + 'px !important;';
    } else {
        styleAttr = 'height:' + (parseInt(mainSplitterHeight) - 20) + 'px !important;';
    }
    $(".savedConnectionsClass").attr('style', styleAttr);
    $("#" + treeId).show();
    $(".visionObjectNameDiv").removeClass("visionSelectedObject");
    $('#mainSplitter').resize();
    // ravi tree issue
    try {
        $('#savedConnections').jqxTree('refresh'); //---------code edit
    } catch (e) {
    }
}

//function showEtlList(treeId, listId) {
//    $('#mainSplitter').jqxSplitter({width: '99.1%',
//        panels: [{size: "20%", min: 10}, {min: "60%", size: "80%"}]});
//    $("#savedSources").hide();
//    $("#savedConnectionsIconsDiv").hide();
//    $("#availableJobsDiv").hide(); // ravi predefined jobs
//    $("#schemaObjectsDiv").hide();
//    $("#" + listId).parent().find('li.visionHighlightEtlIcons').removeClass('visionHighlightEtlIcons');
//    $("#" + listId).addClass('visionHighlightEtlIcons');
//    var mainSplitterHeight = $('#mainSplitter').height();
//    console.log("mainSplitter:::" + mainSplitterHeight);
//    var styleAttr = $(".savedConnectionsClass").attr('style');
//    if (styleAttr != null && styleAttr != '') {
//        styleAttr += ';height:' + (parseInt(mainSplitterHeight) - 20) + 'px !important;';
//    } else {
//        styleAttr = 'height:' + (parseInt(mainSplitterHeight) - 20) + 'px !important;';
//    }
//    $(".savedConnectionsClass").attr('style', styleAttr);
//    $("#" + treeId).show();
//    $(".visionObjectNameDiv").removeClass("visionSelectedObject");
//    $('#mainSplitter').resize();
//    // ravi tree issue
//    try {
//        $('#savedConnections').jqxTree('refresh'); //---------code edit
//    } catch (e) {
//    }
//}
function showTranformationRules($this) {
    showLoader();
    console.log("::showTranformationRules::");
    var t_rules = {};
    var selectedMapOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    $("#currentTrnsOpId").val(selectedMapOperatorId);
    var normalizeOptionsObj = {};
    var deNormalizeOptionsObj = {};

    if (previousOperatorId != null) {
        var previousMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
        if (previousMapOperatorData['trfmRules-data'] != null) {
            t_rules = previousMapOperatorData['trfmRules-data'];
        }
    }

    var destinationColumnEmpty = false;
    var colMappingsData = []
    var rowCount = $('#sourceDestColsTableId tbody tr').length;
    var columnCount = $('#sourceDestColsTableId th').length;
    t_rules['primaryKey'] = "";
    for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
        var rowData = {};
        var tr = $('#sourceDestColsTableId tbody tr')[rowIndex];
        var destinationColumnStyle = $(tr.children[2]).attr("style");

        var destinationColumnVal = $(tr.children[2]).find('input').val();

        if (destinationColumnStyle == "display:none;" || destinationColumnStyle == "display:none") {
            destinationColumnVal = "N/A:N/A";
        }
        if (destinationColumnVal == null || destinationColumnVal == "") {
            destinationColumnEmpty = true;
        }


        if (destinationColumnEmpty) {
            showMesg("Destination Column Cannot be empty");
            throw new Error();
        }

        //        if (destinationColumnVal != null &&
        //                destinationColumnVal != "" &&
        //                destinationColumnVal != "undefined"
        //                && destinationColumnVal.indexOf(":")==-1){
        //            destinationColumnVal = "N/A:"+destinationColumnVal; // ravi process job issues 
        //        }

        var dataFunobjStr = $(tr.children[5]).find('input').attr("data-funobjstr");
        //funobjstr
        var funObj = {};
        if (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') {
            funObj['funobjstr'] = dataFunobjStr;
        }

        rowData['primaryKey'] = $(tr.children[1]).find('input').prop('checked') ? "Y" : "N";
        rowData['destinationColumn'] = destinationColumnVal;
        rowData['sourceColumn'] = $(tr.children[3]).find('input').val();
        rowData['defaultValue'] = $(tr.children[4]).find('input').val();
        rowData['appendValue'] = $(tr.children[5]).find('input').val();
        rowData['columnClause'] = (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') ? funObj : $(tr.children[6]).find('input').val();
        rowData['data-funobjstr'] = $(tr.children[6]).find('input').attr("data-funobjstr"); // ravi change new
        rowData['data-columnClause'] = $(tr.children[6]).find('input').val(); // ravi change new
        colMappingsData[rowIndex] = rowData;
        if (rowData['primaryKey'] == 'Y') {
            t_rules['primaryKey'] = "Y";
        }
    }

    t_rules['colMappingsData'] = colMappingsData;
    // ---------------------------------
    var masterTable = "";
    var childTables = [];
    var fromTables = [];

    var rowCount = $('#EtlMappingTable thead tr').length;
    for (var rowIndex = 1; rowIndex < rowCount; rowIndex++) {
        var rowData = {};
        var tr = $('#EtlMappingTable thead tr')[rowIndex];
        fromTables.push($(tr.children[0]).find('select').val());
        if (rowIndex == 1) {
            masterTable = $(tr.children[0]).find('select').val();
        } else {
            childTables.push($(tr.children[0]).find('select').val());
        }
    }

    if (masterTable == "") {

        var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', previousOperatorId);
        if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
            var fromOpArray = mapingObj['fromOpArray'];
        }
        if (fromOpArray != null && fromOpArray.length != 0) {
            masterTable = fromOpArray[0]['tableName'];
        }
//            try{
//               masterTable = $($(".visionOpIcons")[0]).parent().next().text().trim();
//            }catch(e){}
    }

    t_rules['masterTableName'] = masterTable;
    t_rules['masterTableName'] = masterTable;
    t_rules['childTables'] = childTables;
    t_rules['fromTables'] = fromTables;
    //------------------------------------
    var joinClauseData = []
    var mapIcons = $("#EtlMappingTable").find(".visionEtlJoinClauseMapIcon");
    $.each(mapIcons, function (index) {
        var mappedColumnData = $(this).attr('data-mappedcolumns');
        if (mappedColumnData != null
                && mappedColumnData != ''
                && mappedColumnData != 'null'
                && mappedColumnData != '{}') {
//            if (mappedColumnData == "") {
//                mappedColumnData = "{}";
//            }
            joinClauseData[index] = mappedColumnData;
        }
    });
    if (joinClauseData.length > 0) {
        t_rules['joinClauseData'] = joinClauseData;
    }

    //------------------------------------
    var whereClauseData = []
    var mapIcons = $("#selectedTables").find(".visionEtlWhereClauseMapIcon");
    $.each(mapIcons, function (index) {
        var mappedColumnData = $(this).attr('data-whereclause');
        if (mappedColumnData != null) {
            if (mappedColumnData == "") {
                mappedColumnData = "{}";
            }
            whereClauseData[index] = mappedColumnData;
        }

    });
    if (whereClauseData.length > 0) {
        t_rules['whereClauseData'] = whereClauseData;
    }
    //------------------------------------

    var orderByData = []

    var rowCount = $('#fromTablesOrderCauseTable tbody tr').length;
    for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
        var rowData = {};
        var tr = $('#fromTablesOrderCauseTable tbody tr')[rowIndex];
        rowData['columnName'] = $(tr.children[1]).find('input').val();
        rowData['order'] = $(tr.children[2]).find('select').val();
        orderByData[rowIndex] = rowData;
    }
    t_rules['orderByData'] = orderByData;
    //------------------------------------

    var groupByData = []

    var rowCount = $('#fromTablesGroupCauseTable tbody tr').length;
    for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
        var rowData = {};
        var tr = $('#fromTablesGroupCauseTable tbody tr')[rowIndex];
        rowData['columnName'] = $(tr.children[1]).find('input').val();
        groupByData[rowIndex] = rowData;
    }
    t_rules['groupByData'] = groupByData;
    //t_rules['trfmRulesId'] = currentMapId;
    var uniqueRowsFlag = $("#distinctRowsInput").val();
    t_rules['uniqueRowsFlag'] = (uniqueRowsFlag == true) ? "Y" : "N";
    var rowsCountFrom = $("#rowsCountFromInput").val();
    t_rules['rowsCountFrom'] = rowsCountFrom;
    var rowsCountTo = $("#rowsCountToInput").val();
    t_rules['rowsCountTo'] = rowsCountTo;

    var showRejectedRecords = $("#showRejectedRecords").val();
    t_rules['showRejectedRecords'] = (showRejectedRecords == true) ? "Y" : "N";

    var normalizeOptionsObj = {};
    var deNormalizeOptionsObj = {};
    var normalizeColsObj = {};
    if (previousOperatorId != null) {

        if (previousMapOperatorData.iconType == "UNGROUP") {


            var normalizeOptionsObj = {};
            var colsObj = {};
            var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', previousOperatorId);
            console.log("::::::::" + JSON.stringify(mapingObj));
            if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
                var toOpArray = mapingObj['toOpArray'];
                var fromOpArray = mapingObj['fromOpArray'];
            }

            var fromOperator = fromOpArray[0];
            var toOperator = toOpArray[0];

            var cols = $("#selectNormalizeColHeader").find("option");
            if (cols != null && cols.length > 0) {
                if (toOperator.dragType != null && toOperator.dragType == "Table") {
                    $.each(cols, function (index) {
                        if (index != 0) {
                            colsObj[this.value.split(":")[1]] = this.value;
                        }
                    })

                } else {
                    $.each(cols, function (index) {
                        if (index != 0) {
                            colsObj[this.value] = this.value;
                        }
                    })
                }

                normalizeColsObj = colsObj;
                normalizeOptionsObj['colsObj'] = colsObj;
                normalizeOptionsObj['normalizeFlag'] = "normalize";
                normalizeOptionsObj['itemSeparator'] = $("#itemSeparator").val();
                normalizeOptionsObj['normalizeColumn'] = $("#selectNormalizeColHeader").val();

                t_rules['normalizeOptionsObj'] = normalizeOptionsObj;
                previousMapOperatorData['normalizeOptionsObj'] = normalizeOptionsObj;
            }

        } else if (previousMapOperatorData.iconType == "GROUP") {
            var deNormalizeOptionsObj = {};
            var colsObj = {};
            var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', previousOperatorId);
            console.log("::::::::" + JSON.stringify(mapingObj));
            if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
                var toOpArray = mapingObj['toOpArray'];
                var fromOpArray = mapingObj['fromOpArray'];
            }

            var fromOperator = fromOpArray[0];
            var toOperator = toOpArray[0];

            var cols = $("#selectDenormalizeColHeader").find("option");
            if (cols != null && cols.length > 0) {
                if (toOperator.dragType != null && toOperator.dragType == "Table") {
                    $.each(cols, function (index) {
                        if (index != 0) {
                            colsObj[this.value.split(":")[1]] = this.value;
                        }
                    })

                } else {
                    $.each(cols, function (index) {
                        if (index != 0) {
                            colsObj[this.value] = this.value;
                        }
                    })
                }

                normalizeColsObj = colsObj;
                deNormalizeOptionsObj['colsObj'] = colsObj;
                deNormalizeOptionsObj['normalizeFlag'] = "deNormalize";
                deNormalizeOptionsObj['delimiter'] = $("#delimiter").val();
                deNormalizeOptionsObj['deNormalizeColumn'] = $("#selectDenormalizeColHeader").val();

                deNormalizeOptionsObj['keyColumn'] = $("#selectDenormalizeKeyColumn").val(); // ravi updated code

                t_rules['normalizeOptionsObj'] = deNormalizeOptionsObj;
                previousMapOperatorData['normalizeOptionsObj'] = deNormalizeOptionsObj;
            }

        }

//        var previousMapOperatorData = $('#'+flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
        previousMapOperatorData['trfmRules-data'] = t_rules;
        $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', previousOperatorId, previousMapOperatorData);
        var previousMapOperatorData2 = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
        $(".flowchart-operator-connector-label").hide();
        $(".flowchart-operator-title").hide();
    }
//    if (previousOperatorId != null) {
//        var previousMapOperatorData = $('#'+flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
//        previousMapOperatorData['trfmRules-data'] = t_rules
//        $('#'+flowChartWorkSpaceId).flowchart('setOperatorData', previousOperatorId, previousMapOperatorData);
//        var previousMapOperatorData2 = $('#'+flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
//        $(".flowchart-operator-connector-label").hide();
//        $(".flowchart-operator-title").hide();
//    }


    if (destinationColumnEmpty && previousOperatorId != selectedMapOperatorId) {
        showMesg("Destination Column Cannot be empty");
        return false;
    }


    previousOperatorId = selectedMapOperatorId;

//    var selectedMapOperatorId = $('#'+flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedMapOperatorId);
    if (selectedMapOperatorData['iconType'] == "UNGROUP") {
        normalizeData();
        return false;
    } else if (selectedMapOperatorData['iconType'] == "GROUP") {
        deNormalizeData();
        return false;
    }
    var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', selectedMapOperatorId);
    console.log("::::::::" + JSON.stringify(mapingObj));
    if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
        var toOpArray = mapingObj['toOpArray'];
        var fromOpArray = mapingObj['fromOpArray'];
    }

    if (toOpArray != null && toOpArray.length != 0) {

        var processFlag = true;
        var toTableName = "";
        var noSQLCount = 0;
        for (var i = 0; i < toOpArray.length != 0; i++) {
            var toOperator = toOpArray[i];
            if (toOperator['dragType'] == 'Table'
                    ) {
                var toConnectionObj = toOperator['connObj'];
                toTableName += toOperator['tableName'];
                if (toOperator['tableName'] != null && toOperator['tableName'] != '') {
                    noSQLCount++;
                    if (i != toOpArray.length - 1) {
                        toTableName += ",";
                    }
                }

            } else if (toOperator['dragType'] == 'SQL'
                    || toOperator['iconType'] == 'SQL') {
                toTableName += toOperator['tableName'];
                if (toOperator['tableName'] != null && toOperator['tableName'] != '') {
                    noSQLCount++;
                    if (i != toOpArray.length - 1) {
                        toTableName += ",";
                    }
                } else {
                    noSQLCount = 0;
                    break;
                }

            } else {
                noSQLCount++;
            }
//            if (processFlag && toOperator['iconType'] == 'SQL') {
//                var toTableName = toOperator['tableName'];
//                
//            }
        }

        if (noSQLCount == 0) {
            processFlag = false;
        }
        if (fromOpArray != null && fromOpArray.length != 0) {
            var fromConnectionObj = {};
            var fromTableName = "";
            for (var i = 0; i < fromOpArray.length; i++) {
                var fromOperator = fromOpArray[i];
                if (fromOperator != null && !jQuery.isEmptyObject(fromOperator)) {
                    fromConnectionObj = fromOperator['connObj'];
                    fromTableName += fromOperator['tableName'];
                    if (i != fromOpArray.length - 1) {
                        fromTableName += ",";
                    }
                }

            }
            if (processFlag) {
                displayTransformationTabsOpt(fromConnectionObj,
                        toConnectionObj,
                        fromTableName,
                        toTableName,
                        toOperator['iconType'],
                        toOperator['createTableObj'],
                        toOpArray,
                        fromOpArray
                        );
            } else {
                stopLoader();
                showMesg("Please select target table/Create target table by double click on SQL icon.");
            }

        }
    } else {
        stopLoader();
        showMesg("Source Table/File not mapped");
        console.log("Source Table/File not mapped")
    }



}

function filterMappingTables()
{
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    var item = $("#savedConnections").jqxTree('getSelectedItem');
    //['Tables', 'Views', 'Synonyms'];
    if (item != null && (item['value'] == 'TABLES'
            || item['value'] == 'VIEWS'
            || item['value'] == 'SYNONYMS')) {
        var hiddenFieldId = "DATABASE_" + selectedDataBase + "_" + item['value'] + "_hidden";
        hiddenFieldId = hiddenFieldId.replace(/ /g, '_');
        hiddenFieldId = hiddenFieldId.replace(/\//g, '_');
        var prevFilterVal = $("#" + hiddenFieldId).val();
        var tableData = "<input type='text' id='tableId' class='visionETLFilterInputs' readonly=true value='" + item['label'] + "'/>"
                + "<select id='operatorId' class='visionETLFilterInputs'>"
                + "<option value='LIKE'>LIKE</option>"
                + "<option value='NOT LIKE'>NOT LIKE</option>"
                + "<option value='='>=</option>"
                + "<option value='!='>!=</option>"
                + "</select>"
                + "<input type='text' id='valueId' class='visionETLFilterInputs' value= ''/>";
        $("#dialog").html(tableData);
        $("#dialog").dialog({
            title: (labelObject[item['label'] + ' Filter Form'] != null ? labelObject[item['label'] + ' Filter Form'] : item['label'] + ' Filter Form'),
            modal: true,
            width: 600,
            height: 150,
            fluid: true,
            buttons: [{
                    text: (labelObject['Search'] != null ? labelObject['Search'] : 'Search'),
                    id: 'tableSearchButton', // --------code edit---
                    click: function () {
                        var value = $("#valueId").val();
                        var selectBoxValue = $("#operatorId option:selected").text();
                        $("#" + hiddenFieldId).remove();
                        var hiddenField = "<input type='hidden' id='" + hiddenFieldId + "' value=''/>";
                        $("#savedConnections").append(hiddenField);
                        var jsFilterObj = {};
                        jsFilterObj.filterType = selectBoxValue;
                        jsFilterObj.filterValue = value;
                        $("#" + hiddenFieldId).val(JSON.stringify(jsFilterObj));
                        showLoader();
                        getFilteredValues(value, item['value'], selectConnObj, item['level'], selectColumnsObj, selectBoxValue);

                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }

                }, {
                    text: (labelObject['Reset'] != null ? labelObject['Reset'] : 'Reset'),
                    click: function () {
                        $("#valueId").val("");
                        $("#operatorId").val("LIKE");
                        $("#" + hiddenFieldId).remove();
                        var hiddenField = "<input type='hidden' id='" + hiddenFieldId + "' value=''/>";
                        $("#savedConnections").append(hiddenField);
                        $("#treeETLFilterImage").attr('src', "images/Filter Icon-01.svg");
                    }

                }],
            open: function () {
                //-----------  enter func start---------------
                $("#valueId").keyup(function (event) {
                    if (event.keyCode === 13) {
                        $("#tableSearchButton").click();
                    }
                });
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $(".ui-dialog").addClass('visionDMTreePopup');
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }, close: function (event, ui)
            {


            }
        });
        if (prevFilterVal != null && prevFilterVal != '' && prevFilterVal != undefined)
        {
            prevFilterVal = JSON.parse(prevFilterVal);
            $("#operatorId").val(prevFilterVal['filterType']);
            $("#valueId").val(prevFilterVal['filterValue']);
        }
    } else {
        $("#dialog").html(labelObject['Please Select Views/Tables/Synonyms for filter'] != null ? labelObject['Please Select Views/Tables/Synonyms for filter'] : 'Please Select Views/Tables/Synonyms for filter');
        $("#dialog").dialog({
            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
            modal: true,
            width: 300,
            height: 120,
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }

                }],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $(".ui-dialog").addClass('visionDMTreePopup');
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }, close: function (event, ui)
            {

            }
        });
    }

}


function getFilteredValues(value, selectedLevelValue, selectConnObj, selectedLevel, selectColumnsObj, selectBoxValue)
{
    selectedLevelValue = selectedLevelValue.toUpperCase();
    var item = $("#savedConnections").jqxTree('getSelectedItem');
    var url = 'getTreePagingDataOpt';
    if (item != null)
    {
        var level = item['level'];
        var parentEventItem = item['parentElement'];
        var immideateParent = parentEventItem['parentElement'];
        immideateParent = immideateParent['parentElement'];
        for (var i = level; i > 0; i--)
        {
            parentEventItem = parentEventItem['parentElement'];
        }
        var selectedItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
        var selectedParentValue = selectedItem['value'];
        if (selectedParentValue != null && selectedParentValue != ''
                && selectedParentValue != undefined && selectedParentValue == 'ERP')
        {
            url = 'getTreeErpConnectionDetails';
            var immideateParentItem = $('#savedConnections').jqxTree('getItem', immideateParent);
            var immideateParentValue = immideateParentItem['value'];
            if (immideateParentValue == "Oracle_ERP") {
                url = 'getTreePagingDataOpt';
            }
        }
    }





    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: url,
        cache: false,
        data: {
            parentkey: ((selectedLevelValue != null && selectedLevelValue != '') ? selectedLevelValue.toUpperCase() : ""),
            level: selectedLevel,
            columnsObj: JSON.stringify(selectColumnsObj),
            connectionObj: JSON.stringify(selectConnObj),
            filterValue: value,
            filterCondition: selectBoxValue,
            startIndex: 0,
            endIndex: $("#treePageSize").val()
        },
        success: function (data, status, xhr) {
            stopLoader();
            var selectedItem = $("#savedConnections").jqxTree('getSelectedItem');
            var count;
            var children;
            if (selectedItem != null) {
                children = $(selectedItem.element).find('li');
                count = children.length;
                for (var i = 0; i < count; i += 1) {
                    if (i < count - 1) {
                        $("#savedConnections").jqxTree('removeItem', children[i], false);
                    } else {
                        $("#savedConnections").jqxTree('removeItem', children[i], true);
                    }
                }
            }


            $("#savedConnections").jqxTree('addTo', data, selectedItem);
            $('#savedConnections').jqxTree('expandItem', selectedItem);
            var items = $("#savedConnections").jqxTree('getItems');
            $.each(items, function () {
                $(this.titleElement).attr('title', this.label);

            });
            var itemsList = $("#" + selectedItem.id);
            try {
                var itemsLists = itemsList[0].children[3];
                var childrens = itemsLists['children'];
                var childData = childrens[childrens['length'] - 1];
                var childrenData = $("#savedConnections").jqxTree('getItem', childData);
                if (childrenData['value'] == "Show More")
                {
                    var expandDiv = childrenData.element.children[0];
                    var div = childrenData.element.children[1];
                    var checkBoxDiv = childrenData.element.children[2];
                    $("#" + expandDiv.id).remove();
                    $("#" + div.id).remove();
                    $("#" + checkBoxDiv.id).addClass('visionETLCheckboxEmptySpace');
                }
            } catch (e)
            {

            }
            $("#treeETLFilterImage").attr('src', "images/Filter Icon2-01.svg");
//            $("#savedConnections").jqxTree('selectItem', null);
            var hiddenPagingId = "DATABASE_" + selectedDataBase + "_" + selectedLevelValue + "paging__hidden";
            hiddenPagingId = hiddenPagingId.replace(/ /g, '_');
            hiddenPagingId = hiddenPagingId.replace(/\//g, '_');
            $("#" + hiddenPagingId).remove();
            var hiddenPagingField = "<input type='hidden' id='" + hiddenPagingId + "'value=''/>";
            $("#savedConnections").append(hiddenPagingField);
            var dataPagingObj = {};
            dataPagingObj['startIndex'] = '0';
            dataPagingObj['endIndex'] = $("#treePageSize").val();
            $("#" + hiddenPagingId).val(JSON.stringify(dataPagingObj));
        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}
function displayTransformationTabsOpt(fromConnectionObj,
        toConnectionObj,
        fromTableName,
        toTableName,
        toIconType,
        createTableObj,
        toOpArray,
        fromOpArray) {
    // ravi start
    var selectedMapOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedMapOperatorId);
    var trfmRulesId = selectedMapOperatorData['trfmRulesId'];
    var trfmRulesData = selectedMapOperatorData['trfmRules-data'];
    // ravi end
    if ((fromConnectionObj != null && !jQuery.isEmptyObject(fromConnectionObj))) {
        showLoader();
        if (!(toConnectionObj != null && !jQuery.isEmptyObject(toConnectionObj))) {
            toConnectionObj = {};
        }
        $.ajax({
            type: 'post',
            traditional: true,
            dataType: 'html',
            cache: false,
            url: 'fetchTransformationRules',
            async: true,
            data: {
                fromTable: fromTableName,
                toTable: toTableName,
                fromConnObj: JSON.stringify(fromConnectionObj),
                toConnObj: JSON.stringify(toConnectionObj),
                sourceTables: JSON.stringify(fromTableName.split(",")),
                toIconType: toIconType,
                createTableObj: JSON.stringify(createTableObj),
                trfmRulesId: trfmRulesId,
                trfmRulesData: JSON.stringify(trfmRulesData),
                trfmRulesChanged: (trfmRulesChanged == true) ? "Y" : "N",
                toOpArray: JSON.stringify(toOpArray),
                fromOpArray: JSON.stringify(fromOpArray),
            },
            success: function (response) {
                stopLoader();
                if (response != null) {
                    $('.visionTablesComboBox').hide();
                    $('.visionUploadFileDiv').hide();
                    $('.visionConnectToDbDiv').hide();
                    $('#visionERPMain').hide();
                    var response = JSON.parse(response);
                    if (response != null && response.connectionFlag == 'Y') {
                        $("#feedContentArea").html(response['tabsString']);
                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "130px", position: 'top', theme: 'ui-redmond', reorder: true});

                        $('#dataMigrationTabs').unbind('selected').on('selected', function (event) {
                            $('#iconsdiv').attr('style', 'margin-top:4px !important');
                        });
//                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                        var columnStr = response['columnMapping'];
                        $("#toConnObjPK").val(JSON.stringify(response['toTablePKColumnList']));  //PKH PKIcon
                        var selectedJoinTables = response['selectedJoinTables'];
                        $('#tabs-1').html(columnStr);
                        $('#tabs-1').append("<div id='selectedColumnStr' style='display:none'></div>");
                        $("#toTableColsArray_hidden").remove();
                        $("#fromTableColsArray_hidden").remove();
                        var hiddenData = "<input type='hidden' id='toTableColsArray_hidden'/><input type='hidden' id='fromTableColsArray_hidden'/>";
                        $('#tabs-1').append(hiddenData);
                        $("#toTableColsArray_hidden").val(JSON.stringify(response['toTableColsArray']));
                        $("#fromTableColsArray_hidden").val(JSON.stringify(response['fromTableColsArray']));
                        $('#tabs-2').html(selectedJoinTables);
                        $('#mapColumns').addClass("active");
                        $('.visionProgressFilesSteps').hide();
                        $("#selectedColumnStr").html(response['colMapTrString']);//colMapTrString
                        var selectedTableWhereClause = response['selectedTableWhereClause'];
                        if (selectedTableWhereClause != null) {
                            var hiddenDataWhere = "<input type='hidden' id='whereClauseTableColsArray_hidden'/><input type='hidden' id='currentClauseMapId'/>"
                                    + "<div id='wherClauseTrString' style='display:none;'></div><div id='wherClauseColsString' style='display:none;'></div>";
                            $('#tabs-3').html(selectedTableWhereClause['whereClauseCondition'] + hiddenDataWhere);//whereClauseCondition
                            $("#whereClauseTableColsArray_hidden").val(JSON.stringify(selectedTableWhereClause['fromTableColsArray']));
                        }
                        var selectedTableOrderGroupClause = response['selectedTableOrderGroupClause'];
                        if (selectedTableOrderGroupClause != null) {
                            var hiddenDataOrderBy = ""
                                    + "<div id='orderClauseTrString' style='display:none;'></div>";
                            $('#tabs-4').html(selectedTableOrderGroupClause['orderByCondition'] + hiddenDataOrderBy);//
                            var hiddenDataGroupBy = ""
                                    + "<div id='groupClauseTrString' style='display:none;'></div>";
                            $('#tabs-5').html(selectedTableOrderGroupClause['groupByCondition'] + hiddenDataGroupBy);//
                            $("#groupClauseTrString").html(selectedTableOrderGroupClause['groupByTrString']);
                            $("#orderClauseTrString").html(selectedTableOrderGroupClause['orderByTrString']);
                        }
                        // sql Editor
//                        var sqlEditor = ace.edit("tabs-6");
//                        sqlEditor.setOptions({
//                            enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
//                            showPrintMargin: false, // hides the vertical limiting strip
//                            fontSize: "100%" // ensures that the editor fits in the environment
//                        });
//
//                        sqlEditor.getSession().setMode("ace/mode/sql");
                        $("#dataMigrationTabs").change(function (event) {
                            trfmRulesChanged = true;
                        });
                        if (response['uniqueRowsFlag'] == "Y") {
                            $("#distinctRowsInput").prop("checked", true);
                        }

                        if (response['showRejectedRecords'] == "Y") {
                            $("#showRejectedRecords").prop("checked", true);
                        }
                        $("#rowsCountFromInput").val(response['rowsFrom']);
                        $("#rowsCountToInput").val(response['rowsTo']);
//                        //importColMapFile
//                        var fileslist = [];
//                        $("#importColMapFile").on('change', function (event) {
//                            console.log("iam in files change ");
//                           fileslist  = event.target.files;
//                            srsFileNames(fileslist);
//
//                        });
                        $(".visionETLColMapImage").mousedown(function (event) {
                            treeIconClickEvent = event;
                        });

                        try {
                            $("#sourceDestColsTableId").colResizable({
                                disable: true
                            });
                            $("#sourceDestColsTableId").tableDnD({
                                onDragStyle: null,
                                onDropStyle: null,
                                onDragClass: "tDnD_whileDrag",
                            });

                        } catch (e) {
                        }
                        $("#sourceDestColsTableId").colResizable();

                        $('#dataMigrationTabs').on('selected', function (event) {
                            var selectedTab = event.args.item;
                            if (selectedTab == '0' || selectedTab == 0) {// mapping
                                try {
                                    $("#sourceDestColsTableId").colResizable({
                                        disable: true
                                    });
                                    $("#sourceDestColsTableId").tableDnD({
                                        onDragStyle: null,
                                        onDropStyle: null,
                                        onDragClass: "tDnD_whileDrag",
                                    });

                                } catch (e) {
                                }
                                $("#sourceDestColsTableId").colResizable();
                            } else if (selectedTab == '1' || selectedTab == 1) {// join
                                try {
                                    $("#EtlMappingTable").colResizable({
                                        disable: true
                                    });
                                } catch (e) {
                                }
                                $("#EtlMappingTable").colResizable();
                            } else if (selectedTab == '2' || selectedTab == 2) {//where clause
                                try {
                                    $("#selectedTables").colResizable({
                                        disable: true
                                    });
                                } catch (e) {
                                }
                                $("#selectedTables").colResizable();
                            } else if (selectedTab == '3' || selectedTab == 3) {//order clause
                                try {
                                    $("#fromTablesOrderCauseTable").colResizable({
                                        disable: true
                                    });
                                } catch (e) {
                                }
                                $("#fromTablesOrderCauseTable").colResizable();
                            } else if (selectedTab == '4' || selectedTab == 4) {//group clause
                                try {
                                    $("#fromTablesGroupCauseTable").colResizable({
                                        disable: true
                                    });
                                } catch (e) {
                                }
                                $("#fromTablesGroupCauseTable").colResizable();
                            }
                        });

                    } else {
                        stopLoader();
                        showMessagePopup(response.connectionMessage);
                    }


                }
            },
            error: function (e)
            {
                stopLoader();
                sessionTimeout(e);
            }

        });
    } else {
        stopLoader();
    }


}
function displayTransformationTabs(fromConnectionObj, toConnectionObj, fromTableName, toTableName, toIconType, createTableObj) {
    // ravi start
    var selectedMapOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedMapOperatorId);
    var trfmRulesId = selectedMapOperatorData['trfmRulesId'];
    var trfmRulesData = selectedMapOperatorData['trfmRules-data'];
    // ravi end
    if ((fromConnectionObj != null && !jQuery.isEmptyObject(fromConnectionObj))) {
        showLoader();
        if (!(toConnectionObj != null && !jQuery.isEmptyObject(toConnectionObj))) {
            toConnectionObj = {};
        }
        $.ajax({
            type: 'post',
            traditional: true,
            dataType: 'html',
            cache: false,
            url: 'fetchTransformationRules',
            async: true,
            data: {
                fromTable: fromTableName,
                toTable: toTableName,
                fromConnObj: JSON.stringify(fromConnectionObj),
                toConnObj: JSON.stringify(toConnectionObj),
                sourceTables: JSON.stringify(fromTableName.split(",")),
                toIconType: toIconType,
                createTableObj: JSON.stringify(createTableObj),
                trfmRulesId: trfmRulesId,
                trfmRulesData: JSON.stringify(trfmRulesData),
                trfmRulesChanged: (trfmRulesChanged == true) ? "Y" : "N"
            },
            success: function (response) {
                stopLoader();
                if (response != null) {
                    $('.visionTablesComboBox').hide();
                    $('.visionUploadFileDiv').hide();
                    $('.visionConnectToDbDiv').hide();
                    $('#visionERPMain').hide();
                    var response = JSON.parse(response);
                    if (response != null && response.connectionFlag == 'Y') {
                        $("#feedContentArea").html(response['tabsString']);
                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "130px", position: 'top', theme: 'ui-redmond', reorder: true});

                        $('#dataMigrationTabs').unbind('selected').on('selected', function (event) {
                            $('#iconsdiv').attr('style', 'margin-top:4px !important');
                        });
//                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                        var columnStr = response['columnMapping'];
                        $("#toConnObjPK").val(JSON.stringify(response['toTablePKColumnList']));  //PKH PKIcon
                        var selectedJoinTables = response['selectedJoinTables'];
                        $('#tabs-1').html(columnStr);
                        $('#tabs-1').append("<div id='selectedColumnStr' style='display:none'></div>");
                        $("#toTableColsArray_hidden").remove();
                        $("#fromTableColsArray_hidden").remove();
                        var hiddenData = "<input type='hidden' id='toTableColsArray_hidden'/><input type='hidden' id='fromTableColsArray_hidden'/>";
                        $('#tabs-1').append(hiddenData);
                        $("#toTableColsArray_hidden").val(JSON.stringify(response['toTableColsArray']));
                        $("#fromTableColsArray_hidden").val(JSON.stringify(response['fromTableColsArray']));
                        $('#tabs-2').html(selectedJoinTables);
                        $('#mapColumns').addClass("active");
                        $('.visionProgressFilesSteps').hide();
                        $("#selectedColumnStr").html(response['colMapTrString']);//colMapTrString
                        var selectedTableWhereClause = response['selectedTableWhereClause'];
                        if (selectedTableWhereClause != null) {
                            var hiddenDataWhere = "<input type='hidden' id='whereClauseTableColsArray_hidden'/><input type='hidden' id='currentClauseMapId'/>"
                                    + "<div id='wherClauseTrString' style='display:none;'></div><div id='wherClauseColsString' style='display:none;'></div>";
                            $('#tabs-3').html(selectedTableWhereClause['whereClauseCondition'] + hiddenDataWhere);//whereClauseCondition
                            $("#whereClauseTableColsArray_hidden").val(JSON.stringify(selectedTableWhereClause['fromTableColsArray']));
                        }
                        var selectedTableOrderGroupClause = response['selectedTableOrderGroupClause'];
                        if (selectedTableOrderGroupClause != null) {
                            var hiddenDataOrderBy = ""
                                    + "<div id='orderClauseTrString' style='display:none;'></div>";
                            $('#tabs-4').html(selectedTableOrderGroupClause['orderByCondition'] + hiddenDataOrderBy);//
                            var hiddenDataGroupBy = ""
                                    + "<div id='groupClauseTrString' style='display:none;'></div>";
                            $('#tabs-5').html(selectedTableOrderGroupClause['groupByCondition'] + hiddenDataGroupBy);//
                            $("#groupClauseTrString").html(selectedTableOrderGroupClause['groupByTrString']);
                            $("#orderClauseTrString").html(selectedTableOrderGroupClause['orderByTrString']);
                        }
                        // sql Editor
//                        var sqlEditor = ace.edit("tabs-6");
//                        sqlEditor.setOptions({
//                            enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
//                            showPrintMargin: false, // hides the vertical limiting strip
//                            fontSize: "100%" // ensures that the editor fits in the environment
//                        });
//
//                        sqlEditor.getSession().setMode("ace/mode/sql");
                        $("#dataMigrationTabs").change(function (event) {
                            trfmRulesChanged = true;
                        });
                        if (response['uniqueRowsFlag'] == "Y") {
                            $("#distinctRowsInput").prop("checked", true);
                        }
                        if (response['showRejectedRecords'] == "Y") {
                            $("#showRejectedRecords").prop("checked", true);
                        }

                        $("#rowsCountFromInput").val(response['rowsFrom']);
                        $("#rowsCountToInput").val(response['rowsTo']);
//                        //importColMapFile
//                        var fileslist = [];
//                        $("#importColMapFile").on('change', function (event) {
//                            console.log("iam in files change ");
//                           fileslist  = event.target.files;
//                            srsFileNames(fileslist);
//
//                        });
                        $(".visionETLColMapImage").mousedown(function (event) {
                            treeIconClickEvent = event;
                        })
                    } else {
                        stopLoader();
                        showMessagePopup(response.connectionMessage);
                    }


                }
            },
            error: function (e)
            {
                stopLoader();
                sessionTimeout(e);
            }

        });
    } else {
        stopLoader();
    }


}

function treePaging(selectedLevelValue, selectConnObj, selectedItem, selectedLevel, selectColumnsObj, selectedDataBase, selectedParentValue)
{
    showLoader();
    var hiddenPagingId = "DATABASE_" + selectedDataBase + "_" + selectedLevelValue + "paging__hidden";
    hiddenPagingId = hiddenPagingId.replace(/ /g, '_');
    hiddenPagingId = hiddenPagingId.replace(/\//g, '_');
    var pagingStr = $("#" + hiddenPagingId).val();
    if (pagingStr != null && pagingStr != '' && pagingStr != undefined)
    {
        var pagingObj = JSON.parse(pagingStr);
        var startIndex = pagingObj['startIndex'];
        var endIndex = pagingObj['endIndex'];
        var pagesize = $("#treePageSize").val();
        if (startIndex != null && startIndex != '' && startIndex != undefined &&
                endIndex != null && endIndex != '' && endIndex != undefined)
        {
            startIndex = parseInt(startIndex);
            endIndex = parseInt(endIndex);
            startIndex = endIndex + 1;
            pagesize = parseInt(pagesize);
            endIndex = pagesize + endIndex;
        }
    }
    var hiddenFieldId = "DATABASE_" + selectedDataBase + "_" + selectedLevelValue + "_hidden";
    hiddenFieldId = hiddenFieldId.replace(/ /g, '_');
    hiddenFieldId = hiddenFieldId.replace(/\//g, '_');
    var prevFilterVal = $("#" + hiddenFieldId).val();
    var filterType;
    var filterValue;
    if (prevFilterVal != null && prevFilterVal != '' && prevFilterVal != undefined)
    {
        prevFilterVal = JSON.parse(prevFilterVal);
        filterType = prevFilterVal['filterType'];
        filterValue = prevFilterVal['filterValue'];
    }
    selectedLevelValue = selectedLevelValue.toUpperCase();
    var url = 'getTreePagingDataOpt';
    if (selectedParentValue != null && selectedParentValue != '' && selectedParentValue != undefined
            && selectedParentValue == 'ERP')
    {
        url = 'getTreeErpConnectionDetails';
    }
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: url,
        cache: false,
        data: {
            parentkey: selectedLevelValue,
            level: selectedLevel,
            columnsObj: JSON.stringify(selectColumnsObj),
            connectionObj: JSON.stringify(selectConnObj),
            startIndex: startIndex,
            endIndex: endIndex,
            filterValue: filterValue,
            filterCondition: filterType
        },
        success: function (data, status, xhr) {
            stopLoader();
            if (data != null) {


                var children = $(selectedItem).find('li');
                var count = children.length;
                for (var i = count - 2; i < count; i += 1) {
                    $("#savedConnections").jqxTree('removeItem', children[i], false);
                }

                $('#savedConnections').jqxTree('addTo', data, selectedItem);
                var items = $('#savedConnections').jqxTree('getItems');
                $.each(items, function () {
                    $(this.titleElement).attr('title', this.label);
                });
                try {
                    var itemsLists = selectedItem.children[3];
                    var childrens = itemsLists['children'];
                    var childData = childrens[childrens['length'] - 1];
                    var childrenData = $('#savedConnections').jqxTree('getItem', childData);
                    if (childrenData['value'] == "Show More")
                    {
                        var expandDiv = childrenData.element.children[0];
                        var div = childrenData.element.children[1];
                        var checkBoxDiv = childrenData.element.children[2];
                        $("#" + expandDiv.id).remove();
                        $("#" + div.id).remove();
                        $("#" + checkBoxDiv.id).addClass('visionETLCheckboxEmptySpace');
                    }
                } catch (e)
                {

                }
//                $('#savedConnections').jqxTree('selectItem', null);
                $("#" + hiddenPagingId).remove();
                var hiddenPagingField = "<input type='hidden' id='" + hiddenPagingId + "'value=''/>";
                $("#savedConnections").append(hiddenPagingField);
                var dataPagingObj = {};
                dataPagingObj['startIndex'] = startIndex;
                dataPagingObj['endIndex'] = endIndex;
                $("#" + hiddenPagingId).val(JSON.stringify(dataPagingObj));
            }
        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}
function showJoinsPopup(event, tableName, tableMapId, iconIndex) {

    var dbObj = $("#SOURCE_SELECT_JOIN_TABLES_" + iconIndex).attr("data-table-db");
    showLoader();
    var prevTables = [];
    $(event.target).closest('tr').prevAll('tr').each(function (index) {
        if (this.rowIndex != 0) {
            var tableName = this.cells[0].children[0].value;
            prevTables.push(tableName)
        }

    });
    tableName = $("#SOURCE_SELECT_JOIN_TABLES_" + iconIndex).val();
    var joinColumnMapping = $("#" + tableMapId).attr("data-mappedcolumns");
    // ravi start
    var trfmRulesId = null;
    var trfmRulesData = null;
    if (joinColumnMapping == null || joinColumnMapping == "" || joinColumnMapping == "{}") {


        // var selectedMapOperatorId = $('#'+flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
        var selectedMapOperatorData = {};
        if (previousOperatorId != null) {
            selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
        } else {
            var selectedMapOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
            selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedMapOperatorId);

        }
        trfmRulesData = selectedMapOperatorData['trfmRules-data'];
        trfmRulesId = selectedMapOperatorData['trfmRulesId'];
        if (trfmRulesData != null && trfmRulesData['joinClauseData'] != null) {
            var joinColumnMappings = trfmRulesData['joinClauseData']
            var joinMapId = event.target.id;
            var joinMapIndexStr = joinMapId.substring(joinMapId.indexOf("_") + 1, joinMapId.length);
            var joinMapIndex = parseInt(joinMapIndexStr) - 1;
            joinColumnMapping = trfmRulesData['joinClauseData'][joinMapIndex];

        }


    }
    var currentJoinTableId = $("#currentJoinTableId").val();
    if (currentJoinTableId != null && currentJoinTableId != '') {
        var columnJoinMapping = {};
        var joinType = $("#joinType").val();
        var i = 1;
        $("#etlJoinClauseTable tbody tr").each(function () {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var joinObj = {};
                var childTableDataFunStr = $(tdArray[1]).find("input").attr("data-funobjstr");
                var childTableColumn = $(tdArray[1]).find("input").val();
                var operator = $(tdArray[2]).find("option:selected").val();
                var masterTableDataFunStr = $(tdArray[3]).find("input").attr("data-funobjstr");
                var masterTableColumn = $(tdArray[3]).find("input").val();
                var staticValue = $(tdArray[4]).find("input").val();
                var andOrOperator = $(tdArray[5]).find("option:selected").val();
                if (childTableColumn != null && childTableColumn != '') {
                    joinObj['childTableDataFunStr'] = childTableDataFunStr;
                    joinObj['childTableColumn'] = (childTableColumn != null && childTableColumn == 'Select') ? "" : childTableColumn;
                    joinObj['operator'] = operator;
                    joinObj['masterTableDataFunStr'] = masterTableDataFunStr;
                    joinObj['masterTableColumn'] = (masterTableColumn != null && masterTableColumn == 'Select') ? "" : masterTableColumn;
                    joinObj['andOrOperator'] = andOrOperator;
                    joinObj['staticValue'] = staticValue;
                    joinObj['joinType'] = joinType;
                    //$("#operatorId option:selected").text();
                    console.log("childTableColumn::" + childTableColumn);
                    console.log("operator::" + operator);
                    console.log("masterTableColumn::" + masterTableColumn);
                    console.log("andOrOperator::" + andOrOperator);
                    columnJoinMapping[i] = joinObj;
                    i++;
                }
            }

        });
        if (columnJoinMapping != null) {
            $("#" + currentJoinTableId).attr("data-mappedcolumns", JSON.stringify(columnJoinMapping));

        }
    }
    var joinDBStr = $("#EtlMappingTable").attr("data-join-db");
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'fetchJoinTablesData',
        async: true,
        data: {
            tableName: tableName,
            dbObj: dbObj,
            sourceTables: JSON.stringify(prevTables),
            iconIndex: iconIndex,
            joinColumnMapping: joinColumnMapping,
            trfmRulesId: trfmRulesId, // ravi start
            trfmRulesData: JSON.stringify(trfmRulesData),
            trfmRulesChanged: (trfmRulesChanged == true) ? "Y" : "N",
            joinDBStr: joinDBStr
                    //joinConditionsMapId: $("#" + currentMapId).attr("trfmRules-data")
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var response = JSON.parse(response);
                var joinsDataStr = response['joinsDataStr'];
                var trString = response['trString'];
                $("#joinMapColumnsDivId").html(joinsDataStr);
                var hiddenData = "<input type='hidden' id='childTableColsArray_hidden'/>\n\
                <input type='hidden' id='masterTableColsArray_hidden'/><input type='hidden' id='currentJoinTableId'/>";
                $('#joinMapColumnsDivId').append(hiddenData);
                $("#childTableColsArray_hidden").val(JSON.stringify(response['childTableColsArray']));
                $("#masterTableColsArray_hidden").val(JSON.stringify(response['masterTableColsArray']));
                $("#currentJoinTableId").val(tableMapId);
                $("#joinTableColumnTr").html(trString);
                var contentSplitterWidth = $("#contentSplitter").width();
                if (contentSplitterWidth > 1121) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80% !important');

                } else if (contentSplitterWidth > 1100 && contentSplitterWidth < 1120) {
                    $(".visionColJoinMappingInput").attr('style', 'width:81% !important');
                    $(".visionColFuncInput").attr('style', 'width:68% !important');


                } else if (contentSplitterWidth > 1000 && contentSplitterWidth < 1100) {
                    $(".visionColJoinMappingInput").attr('style', 'width:81% !important');
                    $(".visionColFuncInput").attr('style', 'width:68% !important');

                } else if (contentSplitterWidth > 900 && contentSplitterWidth < 1000) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80% !important');

                } else if (contentSplitterWidth > 800 && contentSplitterWidth < 900) {
                    $(".visionColJoinMappingInput").attr('style', 'width:78% !important');

                } else if (contentSplitterWidth > 700 && contentSplitterWidth < 800) {
                    $(".visionColJoinMappingInput").attr('style', 'width:75% !important');

                }
                var currentJoinTableId = $("#currentJoinTableId").val();
                if (currentJoinTableId != null && currentJoinTableId != '') {
                    var columnJoinMapping = {};
                    var joinType = $("#joinType").val();
                    var i = 1;

                    $("#etlJoinClauseTable tbody tr").each(function () {
                        var tdArray = this.cells;
                        if (tdArray != null && tdArray.length != 0) {
                            var joinObj = {};
                            var childTableDataFunStr = $(tdArray[1]).find("input").attr("data-funobjstr");
                            var childTableColumn = $(tdArray[1]).find("input").val();

//                            var replacedChildColumn =childTableColumn.replace(/"/g, '\''); // uttez double quote issue
//                            childTableColumn=replacedChildColumn;
//                            $(tdArray[1]).find("input").val(childTableColumn);

                            var operator = $(tdArray[2]).find("option:selected").val();
                            var masterTableDataFunStr = $(tdArray[3]).find("input").attr("data-funobjstr");
                            var masterTableColumn = $(tdArray[3]).find("input").val();

//                            var replacedMasterColumn =masterTableColumn.replace(/"/g, '\''); // uttez double quote issue
//                            masterTableColumn=replacedMasterColumn;
//                            $(tdArray[3]).find("input").val(replacedMasterColumn);

                            var staticValue = $(tdArray[4]).find("input").val();
                            var andOrOperator = $(tdArray[5]).find("option:selected").val();
                            if (childTableColumn != null && childTableColumn != '') {
                                joinObj['childTableDataFunStr'] = childTableDataFunStr;
                                joinObj['childTableColumn'] = (childTableColumn != null && childTableColumn == 'Select') ? "" : childTableColumn;
                                joinObj['operator'] = operator;
                                joinObj['masterTableDataFunStr'] = masterTableDataFunStr;
                                joinObj['masterTableColumn'] = (masterTableColumn != null && masterTableColumn == 'Select') ? "" : masterTableColumn;
                                joinObj['andOrOperator'] = andOrOperator;
                                joinObj['staticValue'] = staticValue;
                                joinObj['joinType'] = joinType;
                                //$("#operatorId option:selected").text();
                                console.log("childTableColumn::" + childTableColumn);
                                console.log("operator::" + operator);
                                console.log("masterTableColumn::" + masterTableColumn);
                                console.log("andOrOperator::" + andOrOperator);
                                columnJoinMapping[i] = joinObj;
                                i++;
                            }


                        }

                    });
                    if (columnJoinMapping != null) {
                        $("#" + currentJoinTableId).attr("data-mappedcolumns", JSON.stringify(columnJoinMapping));

                    }
                }
                try {
                    var feedContentAreaHeight = $("#feedContentArea").height();
                    $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);

                } catch (e) {
                }
                try {
                    $("#etlJoinClauseTable").colResizable({
                        disable: true
                    });
                } catch (e) {
                }
                $("#etlJoinClauseTable").colResizable();
                $(".visionETLColMapImage").mousedown(function (event) {
                    treeIconClickEvent = event;
                });
            }

        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
        }

    });

}
function addNewJoinsRow(event, dbObject, id) {
    var trstring = $("#joinTableColumnTr").html();
    $("#etlJoinClauseTable tbody").append(trstring);
    $("#tabs-2").animate({
        scrollTop: $("#tabs-2").prop("scrollHeight")
    }, 1000);

}

function deleteSelectedRow($this) {
//    $(this).parents("tr").remove();
    $($this).parents("tr").remove();
    // ravi file headers start
    try {
        var trArray = $("#fileColumnHeadersTable tbody tr");
        $.each(trArray, function (index) {
            $(this.children[1]).html(this.rowIndex);
        })
    } catch (e) {
    }
    // ravi file headers end
    console.log("$this");
    trfmRulesChanged = true;  // ravi edit new
    try {
        $("#mainSplitter").resize();
    } catch (e) {
    }
}

function processJob1() {

    showLoader();
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }

    var data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var operators = data['operators'];
    if (operators != null && !jQuery.isEmptyObject(operators)) {
        var groupJob = false;

        for (var key of Object.keys(operators)) {
            var operator = operators[key];
            if (operator['iconType'] == 'GROUP_JOB') {
                groupJob = true;
            }
            break;

        }


        if (groupJob) {
            executeProcessGroupJob();
            return false;
        }
    }


    var selectedToOperatorId = $("#currentTrnsOpId").val();

    try {
        if (selectedToOperatorId != null && selectedToOperatorId != '') {
            selectedToOperatorId = parseInt(selectedToOperatorId);
        }
    } catch (e) {
    }
    var t_rules = {};

    var previousTargetOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedToOperatorId);


    var isEmpty = jQuery.isEmptyObject(previousTargetOperatorData);

    if (!isEmpty) {
        if (previousTargetOperatorData['trfmRules-data'] != null) {
            t_rules = previousTargetOperatorData['trfmRules-data'];
        }

        var componentOperator = {};
        var fromOpLinkArray = $('#' + flowChartWorkSpaceId).flowchart('getAllFromOperatorsByToOpId', selectedToOperatorId);
        if (fromOpLinkArray != null) {
            if (fromOpLinkArray != null && fromOpLinkArray.length != 0) {
                for (var i = 0; i < fromOpLinkArray.length; i++) {
                    var operatorData = fromOpLinkArray[i];
                    if (operatorData != null
                            && operatorData['iconType'] != null
                            && operatorData['iconType'] != '') {
                        componentOperator = operatorData;
                        break;
                    }

                }
            }

        }


        if (componentOperator['iconType'] == "MAP") {
            var destinationColumnEmpty = false;

            var colMappingsData = []

            var rowCount = $('#sourceDestColsTableId tbody tr').length;
            var columnCount = $('#sourceDestColsTableId th').length;
            t_rules['primaryKey'] = "";
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#sourceDestColsTableId tbody tr')[rowIndex];
                var destinationColumnStyle = $(tr.children[2]).attr("style");

                var destinationColumnVal = $(tr.children[2]).find('input').val();

                if (destinationColumnStyle == "display:none;" || destinationColumnStyle == "display:none") {
                    destinationColumnVal = "N/A:N/A";
                }
                if (destinationColumnVal == null || destinationColumnVal == "") {
                    destinationColumnEmpty = true;
                }


                if (destinationColumnEmpty) {
                    showMesg("Destination Column Cannot be empty");
                    throw new Error();
                }

                //        if (destinationColumnVal != null &&
                //                destinationColumnVal != "" &&
                //                destinationColumnVal != "undefined"
                //                && destinationColumnVal.indexOf(":")==-1){
                //            destinationColumnVal = "N/A:"+destinationColumnVal; // ravi process job issues 
                //        }

                var dataFunobjStr = $(tr.children[5]).find('input').attr("data-funobjstr");
                //funobjstr
                var funObj = {};
                if (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') {
                    funObj['funobjstr'] = dataFunobjStr;
                }
                rowData['primaryKey'] = $(tr.children[1]).find('input').prop('checked') ? "Y" : "N";
                rowData['destinationColumn'] = destinationColumnVal;
                rowData['sourceColumn'] = $(tr.children[3]).find('input').val();
                rowData['defaultValue'] = $(tr.children[4]).find('input').val();
                rowData['appendValue'] = $(tr.children[5]).find('input').val();
                rowData['columnClause'] = (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') ? funObj : $(tr.children[6]).find('input').val();
                rowData['data-funobjstr'] = $(tr.children[6]).find('input').attr("data-funobjstr"); // ravi change new
                rowData['data-columnClause'] = $(tr.children[6]).find('input').val(); // ravi change new
                colMappingsData[rowIndex] = rowData;
                if (rowData['primaryKey'] == 'Y') {
                    t_rules['primaryKey'] = "Y";
                }
            }

            t_rules['colMappingsData'] = colMappingsData;

            // ---------------------------------

            var masterTable = "";
            var childTables = [];
            var fromTables = [];

            var rowCount = $('#EtlMappingTable thead tr').length;
            for (var rowIndex = 1; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#EtlMappingTable thead tr')[rowIndex];
                fromTables.push($(tr.children[0]).find('select').val());
                if (rowIndex == 1) {
                    masterTable = $(tr.children[0]).find('select').val();
                } else {
                    childTables.push($(tr.children[0]).find('select').val());
                }
            }

            if (masterTable == "") {

                var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', selectedToOperatorId);
                if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
                    var fromOpArray = mapingObj['fromOpArray'];
                }
                if (fromOpArray != null && fromOpArray.length != 0) {
                    masterTable = fromOpArray[0]['tableName'];
                }
                //            try{
                //               masterTable = $($(".visionOpIcons")[0]).parent().next().text().trim();
                //            }catch(e){}
            }

            t_rules['masterTableName'] = masterTable;
            t_rules['masterTableName'] = masterTable;
            t_rules['childTables'] = childTables;
            t_rules['fromTables'] = fromTables;
            //------------------------------------

            var joinClauseData = []
            var mapIcons = $("#EtlMappingTable").find(".visionEtlJoinClauseMapIcon");

            $.each(mapIcons, function (index) {
                var mappedColumnData = $(this).attr('data-mappedcolumns');
                if (mappedColumnData != null
                        && mappedColumnData != ''
                        && mappedColumnData != 'null'
                        && mappedColumnData != '{}') {
//                    if (mappedColumnData == "") {
//                        mappedColumnData = "{}";
//                    }
                    joinClauseData[index] = mappedColumnData;
                }
            });
            if (joinClauseData.length > 0) {
                t_rules['joinClauseData'] = joinClauseData;
                var fromTablesList = $(".sourceJoinColsTd").find("select");
                if (fromTablesList.length > 0) {
                    var reOrderFromTables = [];
                    $.each(fromTablesList, function (i) {
                        reOrderFromTables.push(this.value);
                    })
                    t_rules['fromTables'] = reOrderFromTables;
                }
            }

            //------------------------------------
            var whereClauseData = []
            var mapIcons = $("#selectedTables").find(".visionEtlWhereClauseMapIcon");
            $.each(mapIcons, function (index) {
                var mappedColumnData = $(this).attr('data-whereclause');
                if (mappedColumnData != null) {
                    if (mappedColumnData == "") {
                        mappedColumnData = "{}";
                    }
                    whereClauseData[index] = mappedColumnData;
                }

            });
            if (whereClauseData.length > 0) {
                t_rules['whereClauseData'] = whereClauseData;
            }
            //---------------------------------------------------- advanced settings  
            var selectTabObj = {};
            var uniqueRowsFlag = "N";
            if ($("#distinctRowsInput").is(":checked")) {
                uniqueRowsFlag = "Y";
            }
            selectTabObj['uniqueRowsFlag'] = uniqueRowsFlag;

            var showRejectedRecords = "N";
            if ($("#showRejectedRecords").is(":checked")) {
                showRejectedRecords = "Y";
            }
            selectTabObj['showRejectedRecords'] = showRejectedRecords;

            var minRows = $("#rowsCountFromInput").val();
            var maxRows = $("#rowsCountToInput").val();
            if (!(minRows != null && minRows != '') && (maxRows != null && maxRows != '')) {
                minRows = 0;
            }



            selectTabObj['minRows'] = minRows;
            selectTabObj['maxRows'] = maxRows;

            var operatorType = $("#operatorType").val();
            selectTabObj['operatorType'] = operatorType;

            var scdType = $('input[name="scdType"]:checked').val();
            if (scdType != null) {
                selectTabObj['scdType'] = scdType;
            }

            t_rules['selectTabObj'] = selectTabObj;

            //------------------------------------

            var orderByData = []

            var rowCount = $('#fromTablesOrderCauseTable tbody tr').length;
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#fromTablesOrderCauseTable tbody tr')[rowIndex];
                rowData['columnName'] = $(tr.children[1]).find('input').val();
                rowData['order'] = $(tr.children[2]).find('select').val();
                orderByData[rowIndex] = rowData;
            }
            t_rules['orderByData'] = orderByData;
            //------------------------------------

            var groupByData = []

            var rowCount = $('#fromTablesGroupCauseTable tbody tr').length;
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#fromTablesGroupCauseTable tbody tr')[rowIndex];
                rowData['columnName'] = $(tr.children[1]).find('input').val();
                groupByData[rowIndex] = rowData;
            }
            t_rules['groupByData'] = groupByData;

        } else if (componentOperator['iconType'] == "UNGROUP") {

            var normalizeOptionsObj = {};
            normalizeOptionsObj['normalizeFlag'] = "normalize";
            normalizeOptionsObj['itemSeparator'] = $("#itemSeparator").val();
            normalizeOptionsObj['normalizeColumn'] = $("#selectNormalizeColHeader").val();
            t_rules['normalizeOptionsObj'] = normalizeOptionsObj;
            var colMappingsData = [];
            var fromColsArray = $("#selectNormalizeColHeader").find("option");
            if (fromColsArray != null && fromColsArray.length > 0) {
                $.each(fromColsArray, function (rowIndex) {
                    if (rowIndex != 0) {
                        var rowData = {};
                        var destFileHeaders = t_rules['fileHeaders'];
                        if (destFileHeaders != null) {
                            var destinationColumn = destFileHeaders[rowIndex];
                        }
                        rowData['sourceColumn'] = this.value;
                        rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                        colMappingsData[rowIndex - 1] = rowData;
                    }

                })

                t_rules['colMappingsData'] = colMappingsData;
            }
        } else if (componentOperator['iconType'] == "GROUP") {

            var deNormalizeOptionsObj = {};
            deNormalizeOptionsObj['normalizeFlag'] = "deNormalize";
            deNormalizeOptionsObj['delimiter'] = $("#delimiter").val();
            deNormalizeOptionsObj['deNormalizeColumn'] = $("#selectDenormalizeColHeader").val();

            deNormalizeOptionsObj['keyColumn'] = $("#selectDenormalizeKeyColumn").val(); // ravi updated code

            t_rules['normalizeOptionsObj'] = deNormalizeOptionsObj;
            var colMappingsData = [];
            var fromColsArray = $("#selectDenormalizeColHeader").find("option");
            if (fromColsArray != null && fromColsArray.length > 0) {
                $.each(fromColsArray, function (rowIndex) {
                    if (rowIndex != 0) {
                        var rowData = {};
                        var destFileHeaders = t_rules['fileHeaders'];
                        if (destFileHeaders != null) {
                            var destinationColumn = destFileHeaders[rowIndex];
                        }
                        rowData['sourceColumn'] = this.value;
                        rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                        colMappingsData[rowIndex - 1] = rowData;
                    }

                })

                t_rules['colMappingsData'] = colMappingsData;
            }
        }

        previousTargetOperatorData['trfmRules-data'] = t_rules;
        previousTargetOperatorData['targetOperator'] = "Y";
        $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedToOperatorId, previousTargetOperatorData);
        var previousTargetOperatorData2 = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedToOperatorId);
        $(".flowchart-operator-connector-label").hide();
        $(".flowchart-operator-title").hide();

    }


    data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var parallelJobsData = {};
    var operators = data['operators'];
    $.each(operators, function (i) {
        var body = this['properties']['body'];
        var ele = document.createElement('div');
        ele.innerHTML = body;
        $(ele).find(".visionCountLabelsDiv").remove();
        this['properties']['body'] = $(ele).html();
        $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);

        if (this['targetOperator'] == 'Y') {
            this['timeStamp'] = new Date().getTime();
            $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);
        }

        if (this['executeType'] == 'PARALLELJOB') {
            var subJobId = this['subJobId'];
            if (!(subJobId in parallelJobsData)) {
                var data = $('#' + flowChartWorkSpaceId).flowchart('getFlowchartDataConnectedtoOP', this['operatorId']);
                parallelJobsData[this['subJobId']] = data;

            }

        }

    });

    var data = {};
    try {
        data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    } catch (e) {
    }
    console.log("Mapped Data::::" + JSON.stringify(data));
    if (data != null && !jQuery.isEmptyObject(data)) {
        //sourceDestColsTableId
        var operators = data['operators'];
        var links = data['links'];
        if (operators != null && !jQuery.isEmptyObject(operators)
                && links != null && !jQuery.isEmptyObject(links)) {

            var jobId = $("#currentJobId").val();
            var processJobData = {
                mappedData: JSON.stringify(data),
                jobId: jobId,
                parallelJobsData: JSON.stringify(parallelJobsData)
            }

            $.ajax({
                type: 'post',
                traditional: true,
                dataType: 'json',
                cache: false,
                url: 'processETLData',
                async: true,
                data: processJobData,
                success: function (response) {
                    stopLoader();

                    try {
                        $("#currentJobId").val(response['jobId']);
                        $("#currentJobName").val(response['jobName']);
                    } catch (e) {
                    }

                    openLogFile();

                },
                error: function (e)
                {
                    sessionTimeout(e);
                    stopLoader();
                    if (processLogInterval != null) {
                        clearInterval(processLogInterval);
                    }
                }

            });
        } else {
            stopLoader();
            $("#dialog").html(labelObject['No Mapped Objects to Process'] != null ? labelObject['No Mapped Objects to Process'] : 'No Mapped Objects to Process');
            $("#dialog").dialog({
                title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                modal: true,
                height: 'auto',
                minWidth: 300,
                maxWidth: 'auto',
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");

                        }}],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });
        }

    } else {
        stopLoader();
        $("#dialog").html(labelObject['No Mapped Objects to Process'] != null ? labelObject['No Mapped Objects to Process'] : 'No Mapped Objects to Process');
        $("#dialog").dialog({
            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");

                    }}],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    }
    selectFunColumnValue

}

function selectColumn($this, tableColType, dataArray) {
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    //dddw
    // prepare the data
    var data = [];
    if (tableColType == 'fromColumn') {
        var dataStr = $("#fromTableColsArray_hidden").val();
        if (dataStr != null && dataStr != '') {
            data = JSON.parse(dataStr);
        }
    } else if (tableColType == 'toColumn') {
        var dataStr = $("#toTableColsArray_hidden").val();
        if (dataStr != null && dataStr != '') {
            data = JSON.parse(dataStr);
        }
    } else if (tableColType == 'childColumn') {
        var dataStr = $("#childTableColsArray_hidden").val();
        if (dataStr != null && dataStr != '') {
            data = JSON.parse(dataStr);
        }
    } else if (tableColType == 'masterColumn') {
        var dataStr = $("#masterTableColsArray_hidden").val();
        if (dataStr != null && dataStr != '') {
            data = JSON.parse(dataStr);
        }
    } else if (tableColType == 'fromWhereClauseColumn') {
        var dataStr = $("#whereClauseTableColsObj_hidden").val();
        if (dataStr != null && dataStr != '') {
            data = JSON.parse(dataStr);
        }
    } else if (tableColType == 'LOOKUP_TABLE,COLUMN') {
        data = dataArray;
    }
    var source =
            {
                datatype: "json",
                datafields: [
                    {name: 'id'},
                    {name: 'parentid'},
                    {name: 'text'},
                    {name: 'icon'},
                    {name: 'value'},
                    {name: 'datatype'}
                ],
                id: 'id',
                icon: 'icon',
                localdata: data
            };

    // create data adapter.
    var dataAdapter = new $.jqx.dataAdapter(source);
    // perform Data Binding.
    dataAdapter.dataBind();
    // get the tree items. The first parameter is the item's id. The second parameter is the parent item's id. The 'items' parameter represents 
    // the sub items collection name. Each jqxTree item has a 'label' property, but in the JSON data, we have a 'text' field. The last parameter 
    // specifies the mapping between the 'text' and 'label' fields.  
    var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{name: 'text', map: 'label'}]);
    $("#columnMappingDialog").html("<div class='treeSearchInputDiv'><input id='treeSearchValue' type='text' class='treeSearchValueInput' placeholder='Search'/>\n\
    <img id='treeNodeSearchIconId' src='images/icon.png' style='height:12px;width:12px;cursor:pointer;' onclick=searchTreeNode('columnMappingTree')  /><div id='searchTreeErrorMesg' style='color:red;'></div></div>\n\
    <div id='columnMappingTree' class='columnMappingTree'></div>");
    $("#columnMappingDialog").dialog({
        title: (labelObject['Columns'] != null ? labelObject['Columns'] : 'Columns'),
        modal: true,
        width: 'auto',
        maxWidth: 500,
        height: 330,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
                    if (selectedItem != null) {
                        $($this).parents("td").find("input").val(selectedItem['value']);
                        $($this).parents("td").find("input").attr("title", selectedItem['value']);
                        var tablesList = [];
                        var tablesListstr = $($this).parents("td").find("input").attr("tableName");
                        if (tablesListstr != null && tablesListstr != "") {
                            tablesList = JSON.parse(tablesListstr);
                        }
                        if (tablesList.indexOf(selectedItem['parentId']) == -1) {
                            tablesList.push(selectedItem['parentId']);
                        }
                        $($this).parents("td").find("input").attr("tableName", JSON.stringify(tablesList));
//                       $($this).parent.find("input").val(selectedItem['value']); 
                        trfmRulesChanged = true;
                    }

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }],
        open: function () {
            $('#columnMappingTree').jqxTree({source: records, width: 300,
                toggleMode: 'click', theme: 'energyblue',
                enableHover: true,
                incrementalSearch: true,
                keyboardNavigation: true
            });
            $("#treeSearchValue").keyup(function (event) {
                if (event.keyCode === 13) {
                    // Cancel the default action, if needed
//            event.preventDefault();
                    $("#treeNodeSearchIconId").click();
                }
            });
            $('#columnMappingTree').jqxTree('expandItem', $("#columnMappingTree").find('li:first')[0]);
            $("#columnMappingTree li").on('dblclick', function (event) {
                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
                    $($this).parents("td").find("input").val(selectedItem['value']);
                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
                    var tablesList = [];
                    var tablesListstr = $($this).parents("td").find("input").attr("tableName");
                    if (tablesListstr != null && tablesListstr != "") {
                        tablesList = JSON.parse(tablesListstr);
                    }
                    if (tablesList.indexOf(selectedItem['parentId']) == -1) {
                        tablesList.push(selectedItem['parentId']);
                    }
                    $($this).parents("td").find("input").attr("tableName", JSON.stringify(tablesList));

                    $("#columnMappingDialog").dialog("close");
                    $("#columnMappingDialog").dialog("destroy");
                    trfmRulesChanged = true;
                }

            });
            var inputFieldsArray = [];

            var columnIndex = treeIconClickEvent.target.parentElement.cellIndex;

            var trs = treeIconClickEvent.target.parentElement.offsetParent.children[1].children;
            ;

            $.each(trs, function (index) {
                var inputVal = this.children[columnIndex].children[0].value.trim()
                inputFieldsArray.push(inputVal);
            })

            var columnsArray = $(this).find('li');

            $.each(columnsArray, function (index) {
                var _this = this;
                var colVal = this.id.trim();
                $.each(inputFieldsArray, function (index) {
                    var inputVal = this.trim();
                    if (colVal == inputVal) {
                        if ($(_this).find(".tickMark").length == 0) {
                            $(_this.children[0]).prepend("<div class='tickMark'></div>");
                        }
                        // $(_this).addClass("visionHighlightColumn");
                        // $(_this).parent().css("background-color","yellow");
                    }
                })
            });
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
            $(".ui-dialog").addClass('visionDMTreePopup');


        },
        beforeClose: function (event, ui)
        {

            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");

        }, close: function (event, ui)
        {

            $(this).html("");
            try {
                $("#columnMappingTree").jqxTree('destroy');
                $("#columnMappingTree").remove();
                $("#treeSearchInputDiv").remove();

            } catch (e) {
            }
//            try {
//                $(this).dialog("destroy");
//            } catch (e) {
//            }
//                       
//                        
//                       
        }
//        , create: function (event, ui) {
//            $("#columnMappingTree li").on('dblclick', function (event) {
//                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
//                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
//                    $($this).parents("td").find("input").val(selectedItem['value']);
//                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
//                }
//                $(this).dialog("close");
//                $(this).dialog("destroy");
//            });
//        }
    });

}

function addColumnMapping(event, $this) {
    var selectedColumnStr = $("#selectedColumnStr").html();
    $("#sourceDestColsTableId tbody").append(selectedColumnStr);
    try {
        $("#sourceDestColsTableId").colResizable({
            disable: true
        });

        $("#sourceDestColsTableId").tableDnD({
            onDragStyle: null,
            onDropStyle: null,
            onDragClass: "tDnD_whileDrag",
        });
    } catch (e) {
    }
    $("#sourceDestColsTableId").colResizable();
    $("#tabs-1").animate({
        scrollTop: $("#tabs-1").prop("scrollHeight")
    }, 1000);
}

function saveJoinMapping(event, id) {
    var currentJoinTableId = $("#currentJoinTableId").val();
    if (currentJoinTableId != null && currentJoinTableId != '') {
        var columnJoinMapping = {};
        var joinType = $("#joinType").val();
        var i = 1;

        $("#etlJoinClauseTable tbody tr").each(function () {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var joinObj = {};
                var childTableDataFunStr = $(tdArray[1]).find("input").attr("data-funobjstr");
                var childTableColumn = $(tdArray[1]).find("input").val();
                var operator = $(tdArray[2]).find("option:selected").val();
                var masterTableDataFunStr = $(tdArray[3]).find("input").attr("data-funobjstr");
                var masterTableColumn = $(tdArray[3]).find("input").val();
                var staticValue = $(tdArray[4]).find("input").val();
                var andOrOperator = $(tdArray[5]).find("option:selected").val();
                if (childTableColumn != null && childTableColumn != '') {
                    joinObj['childTableDataFunStr'] = childTableDataFunStr;
                    joinObj['childTableColumn'] = (childTableColumn != null && childTableColumn == 'Select') ? "" : childTableColumn;
                    joinObj['operator'] = operator;
                    joinObj['masterTableDataFunStr'] = masterTableDataFunStr;
                    joinObj['masterTableColumn'] = (masterTableColumn != null && masterTableColumn == 'Select') ? "" : masterTableColumn;
                    joinObj['andOrOperator'] = andOrOperator;
                    joinObj['staticValue'] = staticValue;
                    joinObj['joinType'] = joinType;
                    //$("#operatorId option:selected").text();
                    console.log("childTableColumn::" + childTableColumn);
                    console.log("operator::" + operator);
                    console.log("masterTableColumn::" + masterTableColumn);
                    console.log("andOrOperator::" + andOrOperator);
                    columnJoinMapping[i] = joinObj;
                    i++;
                }


            }

        });
        if (columnJoinMapping != null) {
            $("#" + currentJoinTableId).attr("data-mappedcolumns", JSON.stringify(columnJoinMapping));

        }
    }
    var dialogSplitMessage = dialogSplitIconText((labelObject['Saved Successfully'] != null ? labelObject['Saved Successfully'] : 'Saved Successfully'), "Y");
    $("#dialog").html(dialogSplitMessage);
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                }}],
        open: function () {
            stopLoader();
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}

function viewJoinQuery() {
    //EtlMappingTable
    var query = "<ul><li> <font color='#0071c5'>FROM</font> ";
    var i = 0;

    $("#EtlMappingTable thead tr").each(function () {
        if (i != 0) {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var tableName = $(tdArray[0]).find("option:selected").val();
                tableName = "<font color='#F911E9'>" + tableName + "</font>"
                if (i == 1) {
                    query += " " + tableName + "</li><li><ul>";
                } else {
                    var mappedcolumnsObjStr = $(tdArray[1]).find("img").attr("data-mappedcolumns");
                    //data-mappedcolumns  
                    console.log("mappedcolumnsObjStr:::" + mappedcolumnsObjStr);
                    if (mappedcolumnsObjStr != null && mappedcolumnsObjStr != '') {
                        var mappedcolumnsObj = JSON.parse(mappedcolumnsObjStr);
                        if (mappedcolumnsObj != null && !jQuery.isEmptyObject(mappedcolumnsObj)) {
                            var j = 0;
                            var mapObjLength = Object.keys(mappedcolumnsObj).length;
                            for (var key in mappedcolumnsObj) {
                                var mappedColObj = mappedcolumnsObj[key];

                                if (mappedColObj != null && !jQuery.isEmptyObject(mappedColObj)) {
                                    var childTableColumn = mappedColObj['childTableColumn'];
                                    if (childTableColumn != null && childTableColumn != '') {
                                        var childTableColumnArray = childTableColumn.split(":");
                                        childTableColumn = "<font color='#F911E9'>" + childTableColumnArray[0] + "</font>." + childTableColumnArray[1];
                                    }
                                    var masterTableColumn = mappedColObj['masterTableColumn'];
                                    if (masterTableColumn != null && masterTableColumn != '') {
                                        var masterTableColumnArray = masterTableColumn.split(":");
                                        masterTableColumn = "<font color='#F911E9'>" + masterTableColumnArray[0] + "</font>." + masterTableColumnArray[1];
                                    }
                                    if (j == 0) {
                                        query += "<li><font color='#0071c5'> " + mappedColObj['joinType'] + "</font> " + tableName + " <font color='#0071c5'>ON</font> </li><li><ul>"
                                    }
                                    var colValue = mappedColObj['staticValue'];
                                    if (colValue != null && colValue != '' && colValue != 'null') {
                                        if (mappedColObj['operator'] == 'IN' || mappedColObj['operator'] == 'NOT IN') {

                                            if (colValue.indexOf("##") > -1) {
                                                colValue = "('" + colValue.replace(/#{2,}/g, "','") + "')";
                                            } else {
                                                colValue = "('" + colValue + "')";

                                            }
                                        } else {
                                            colValue = "'" + colValue + "'";
                                        }
                                    }
                                    query += " <li> " + childTableColumn + " <font color='#0071c5'>" + mappedColObj['operator'] + "</font> "
                                            + ((mappedColObj['staticValue'] != null && mappedColObj['staticValue'] != '') ? (" <font color='#FF0000'>" + colValue + "</font> ") : masterTableColumn);//staticValue

                                    if (j != parseInt(mapObjLength) - 1) {
                                        query += " <font color='#0071c5'>" + mappedColObj['andOrOperator'] + "</font> ";
                                    }
                                    query += "</li>";
                                }
                                j++;
                            }
                            query += "</ul></li>";
                        }
                    }
                }


            }
        }

        i++;
    });
    query += "</ul></li></ul>";

    console.log("Query:::" + query);
    $("#viewJoinQueryId").html(query);
}

function showWhereClausePopup(event, tableName, id, $this, index) {
    showLoader();

    var prevMapIconId = $("#currentClauseMapId").val();
    if (prevMapIconId != null && prevMapIconId != '') {
        var query = "";
        //fromTablesWhereCauseTable
        var columnClauseMapping = {};
        var i = 1;
        var rowCount = $('#fromTablesWhereCauseTable >tbody >tr').length;
        $("#fromTablesWhereCauseTable tbody tr").each(function () {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var clauseObj = {};
                var datafunobjstr = $(tdArray[1]).find("input").attr("data-funobjstr");
                var columnName = $(tdArray[1]).find("input").val();

                var operator = $(tdArray[2]).find("option:selected").val();
                var staticValue = $(tdArray[3]).find("input").val();
                var andOrOperator = $(tdArray[4]).find("option:selected").val();
                var staticValueMod = staticValue; // ravi whereclause issue
                if (columnName != null && columnName != '') {
                    if (staticValueMod != null && staticValueMod != '' && staticValueMod != 'null' && staticValueMod != 'NULL') {
                        if (operator == 'IN' || operator == 'NOT IN') {
                            if (staticValueMod.indexOf("##") > -1) {
                                staticValueMod = "(" + staticValueMod.replace(/#{2,}/g, "','") + ")";
                            } else {
                                staticValueMod = "(" + staticValueMod + ")";
                            }
                        } else {
                            staticValueMod = "" + staticValueMod + "";
                        }
                    }
                    query += " " + columnName.replace(":", ".") + " " + operator + " " + staticValueMod + " ";
//                    query += " " + columnName.replace(":", ".") + " " + operator + " '" + staticValue + "' ";
                    if ((parseInt(i) - 1) != (parseInt(rowCount) - 1)) {
                        query += " " + andOrOperator;
                    }
                    clauseObj['datafunobjstr'] = datafunobjstr;
                    clauseObj['columnName'] = columnName;
                    clauseObj['operator'] = operator;
                    clauseObj['andOrOperator'] = andOrOperator;
                    clauseObj['staticValue'] = staticValue;
                    columnClauseMapping[i] = clauseObj;
                    i++;
                }


            }

        });
        if (columnClauseMapping != null) {
            var currentClauseAreaId = prevMapIconId.replace("whereClauseConditionsMap_", "whereClauseConditionsArea_");
            $("#" + currentClauseAreaId).val(query);
            $("#" + prevMapIconId).attr("data-whereclause", JSON.stringify(columnClauseMapping));

        }
    }
    var whereClauseTableColsArrayStr = $("#whereClauseTableColsArray_hidden").val();
    var currentTableTreeArray = [];
    if (whereClauseTableColsArrayStr != null && whereClauseTableColsArrayStr != '') {
        var whereClauseTableColsArrayObj = JSON.parse(whereClauseTableColsArrayStr);
        if (whereClauseTableColsArrayObj != null && !jQuery.isEmptyObject(whereClauseTableColsArrayObj)) {
            currentTableTreeArray = whereClauseTableColsArrayObj[tableName];
        }
    }
    var whereClauseStr = $("#" + id).attr("data-whereclause");
    // ravi start
    var trfmRulesData;
    var trfmRulesId;
    if (whereClauseStr == null || whereClauseStr == "" || whereClauseStr == "{}") {
        var selectedMapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', previousOperatorId);
        trfmRulesData = selectedMapOperatorData['trfmRules-data'];
        trfmRulesId = selectedMapOperatorData['trfmRulesId'];


        if (trfmRulesData != null && trfmRulesData['whereClauseData'] != null) {

            var whereClasesConditions = trfmRulesData['whereClauseData']
            var whereClauseMapId = event.target.id;
            var whereClauseMapIndexStr = whereClauseMapId.substring(whereClauseMapId.indexOf("_") + 1, whereClauseMapId.length);
            var whereClauseMapIndex = parseInt(whereClauseMapIndexStr);
            whereClauseStr = trfmRulesData['whereClauseData'][whereClauseMapIndex];
        }
    }

    // ravi end
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'showingClauseColumns',
        async: true,
        data: {
            whereClauseStr: whereClauseStr,
            trfmRulesId: trfmRulesId,
            trfmRulesChanged: (trfmRulesChanged == true) ? "Y" : "N"
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var response = JSON.parse(response);
                $("#currentClauseMapId").val(id);
                $("#whereClauseMapColumnsDivId").html("");
                $("#whereClauseMapColumnsDivId").html(response['whereClauseColsCondition']);
                $("#wherClauseTrString").html(response['trString']);
                $("#whereClauseMapColumnsDivId").append("<input type='hidden' id='whereClauseTableColsObj_hidden'/>");
                $("#whereClauseTableColsObj_hidden").val(JSON.stringify(currentTableTreeArray));
                var contentSplitterWidth = $("#contentSplitter").width();
                if (contentSplitterWidth > 1121) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80%');

                } else if (contentSplitterWidth > 1100 && contentSplitterWidth < 1120) {
                    $(".visionColFuncInput").attr('style', 'width:68% !important');

                } else if (contentSplitterWidth > 1000 && contentSplitterWidth < 1100) {
                    $(".visionColFuncInput").attr('style', 'width:68% !important');

                } else if (contentSplitterWidth > 900 && contentSplitterWidth < 1000) {
                    $(".visionColJoinMappingInput").attr('style', 'width:80%');

                } else if (contentSplitterWidth > 800 && contentSplitterWidth < 900) {
                    $(".visionColJoinMappingInput").attr('style', 'width:78%');

                } else if (contentSplitterWidth > 700 && contentSplitterWidth < 800) {
                    $(".visionColJoinMappingInput").attr('style', 'width:75%');

                }
                var prevMapIconId = $("#currentClauseMapId").val();
                if (prevMapIconId != null && prevMapIconId != '') {
                    var query = "";
                    //fromTablesWhereCauseTable
                    var columnClauseMapping = {};
                    var i = 1;
                    var rowCount = $('#fromTablesWhereCauseTable >tbody >tr').length;
                    $("#fromTablesWhereCauseTable tbody tr").each(function () {
                        var tdArray = this.cells;
                        if (tdArray != null && tdArray.length != 0) {
                            var clauseObj = {};
                            var datafunobjstr = $(tdArray[1]).find("input").attr("data-funobjstr");
                            var columnName = $(tdArray[1]).find("input").val();

                            var operator = $(tdArray[2]).find("option:selected").val();
                            var staticValue = $(tdArray[3]).find("input").val();
                            var andOrOperator = $(tdArray[4]).find("option:selected").val();
                            var staticValueMod = staticValue; // ravi whereclause issue
                            if (columnName != null && columnName != '') {
                                if (staticValueMod != null && staticValueMod != '' && staticValueMod != 'null' && staticValueMod != 'NULL') {
                                    if (operator == 'IN' || operator == 'NOT IN') {
                                        if (staticValueMod.indexOf("##") > -1) {
                                            staticValueMod = "(" + staticValueMod.replace(/#{2,}/g, "','") + ")";
                                        } else {
                                            staticValueMod = "(" + staticValueMod + ")";
                                        }
                                    } else {
                                        staticValueMod = "" + staticValueMod + "";
                                    }
                                }
                                query += " " + columnName.replace(":", ".") + " " + operator + " " + staticValueMod + " ";
                                if ((parseInt(i) - 1) != (parseInt(rowCount) - 1)) {
                                    query += " " + andOrOperator;
                                }
                                clauseObj['datafunobjstr'] = datafunobjstr;
                                clauseObj['columnName'] = columnName;
                                clauseObj['operator'] = operator;
                                clauseObj['andOrOperator'] = andOrOperator;
                                clauseObj['staticValue'] = staticValue;
                                columnClauseMapping[i] = clauseObj;
                                i++;
                            }


                        }

                    });
                    if (columnClauseMapping != null) {
                        var currentClauseAreaId = prevMapIconId.replace("whereClauseConditionsMap_", "whereClauseConditionsArea_");
                        $("#" + currentClauseAreaId).val(query);
                        $("#" + prevMapIconId).attr("data-whereclause", JSON.stringify(columnClauseMapping));

                    }
                }
                // scroll bar issue fixed by SHI
                var feedContentAreaHeight = $("#feedContentArea").height();
                var tbodyHeight = feedContentAreaHeight - 105;
                $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                // scroll bar issue fixed by SHI
                try {
                    $("#fromTablesWhereCauseTable").colResizable({
                        disable: true
                    });
                } catch (e) {
                }
                $("#fromTablesWhereCauseTable").colResizable();


            }

        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
        }

    });


}
function addNewClauseRow(event, id, $this) {
    var trstring = $("#wherClauseTrString").html();
    $("#fromTablesWhereCauseTable tbody").append(trstring);
    $("#tabs-3").animate({
        scrollTop: $("#tabs-3").prop("scrollHeight")
    }, 1000);
}
function addNewOrderClauseRow(event, id, $this) {
    var trstring = $("#orderClauseTrString").html();
    $("#fromTablesOrderCauseTable tbody").append(trstring);
    $("#tabs-4").animate({
        scrollTop: $("#tabs-4").prop("scrollHeight")
    }, 1000);
}
function addNewGroupClauseRow(event, id, $this) {
    var trstring = $("#groupClauseTrString").html();
    $("#fromTablesGroupCauseTable tbody").append(trstring);
    $("#tabs-5").animate({
        scrollTop: $("#tabs-5").prop("scrollHeight")
    }, 1000);
}

function saveClauseMapping(event, id, $this) {
    var currentClauseMapId = $("#currentClauseMapId").val();
    if (currentClauseMapId != null && currentClauseMapId != '') {
        //fromTablesWhereCauseTable
        var columnClauseMapping = {};

        var i = 1;
        var rowCount = $('#fromTablesWhereCauseTable >tbody >tr').length;
        var query = "";
        $("#fromTablesWhereCauseTable tbody tr").each(function () {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var clauseObj = {};
                var datafunobjstr = $(tdArray[1]).find("input").attr("data-funobjstr");

                var columnName = $(tdArray[1]).find("input").val();
                var operator = $(tdArray[2]).find("option:selected").val();
                var staticValue = $(tdArray[3]).find("input").val();
                var andOrOperator = $(tdArray[4]).find("option:selected").val();
                var staticValueMod = staticValue; // ravi whereclause issue
                if (columnName != null && columnName != '') {
                    if (staticValueMod != null && staticValueMod != '' && staticValueMod != 'null' && staticValueMod != 'NULL') {
                        if (operator == 'IN' || operator == 'NOT IN') {
                            if (staticValueMod.indexOf("##") > -1) {
                                staticValueMod = "('" + staticValueMod.replace(/#{2,}/g, "','") + ")";
                            } else {
                                staticValueMod = "('" + staticValueMod + "')";
                            }
                        } else {
                            staticValueMod = "'" + staticValueMod + "'";
                        }

                    }
                    query += " " + columnName.replace(":", ".") + " " + operator + " " + staticValueMod + " ";
                    if ((parseInt(i) - 1) != (parseInt(rowCount) - 1)) {
                        query += " " + andOrOperator;
                    }
                    clauseObj['datafunobjstr'] = datafunobjstr;
                    clauseObj['columnName'] = columnName;
                    clauseObj['operator'] = operator;
                    clauseObj['andOrOperator'] = andOrOperator;
                    clauseObj['staticValue'] = staticValue;
                    columnClauseMapping[i] = clauseObj;
                    i++;
                }


            }

        });
        if (columnClauseMapping != null) {
//            var whereClauseConditionsArea_
            var currentClauseAreaId = currentClauseMapId.replace("whereClauseConditionsMap_", "whereClauseConditionsArea_");
            $("#" + currentClauseAreaId).val(query);
//          var tdArray = this.cells;  $($this).parents("tr").find("textarea").val(query);
            $("#" + currentClauseMapId).attr("data-whereclause", JSON.stringify(columnClauseMapping));

        }
    }
    var dialogSplitMessage = dialogSplitIconText((labelObject['Saved Successfully'] != null ? labelObject['Saved Successfully'] : 'Saved Successfully'), "Y");
    $("#dialog").html(dialogSplitMessage);
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                }}],
        open: function () {
            stopLoader();
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}

function viewTotalSQLQuery($this, sqlQueryTabId) {
    var selectQuery = "";
    // col mappings
    var query = "<font color='#0071c5'>SELECT</font> ";
    selectQuery += "SELECT ";
    var selectTabObj = {};
    if ($("#distinctRowsInput").is(":checked")) {
        query += "<font color='#0071c5'>DISTINCT</font>  ";
        selectQuery += " DISTINCT "
    }
//    selectTabObj['uniqueRowsFlag'] = uniqueRowsFlag;
//    selectTabObj['minRows'] = $("#rowsCountFromInput").val();
//    selectTabObj['maxRows'] = $("#rowsCountToInput").val();

    var i = 0;
    var rowCount = $('#sourceDestColsTableId >tbody >tr').length;
    $("#sourceDestColsTableId tbody tr").each(function () {
        var tdArray = this.cells;
        if (tdArray != null && tdArray.length != 0) {
            var toTableColumn = $(tdArray[2]).find("input").val();
            var fromTableColumn = $(tdArray[3]).find("input").val();
            var defaultValue = $(tdArray[4]).find("input").val();
            var appendValue = $(tdArray[5]).find("input").val();
            var columnClause = $(tdArray[6]).find("input").val();
            if ((fromTableColumn != null && fromTableColumn != '')
                    || (defaultValue != null && defaultValue != '')
                    || (columnClause != null && columnClause != '')
                    ) {
                if (fromTableColumn != null && fromTableColumn != '') {
                    query += " " + fromTableColumn.replace(":", ".") + "  ";
                    selectQuery += " " + fromTableColumn.replace(":", ".") + "  ";

                } else if (defaultValue != null && defaultValue != '') {
                    query += " <font color='#FF0000'>'" + defaultValue + "'</font> AS " + toTableColumn.replace(":", ".") + "  ";
                    selectQuery += " '" + defaultValue + "' AS " + toTableColumn.split(":")[1] + "  ";

                } else if (columnClause != null && columnClause != '') {
//                    if (columnClause.indexOf("'") > -1) {
//                        var quotetedStr = "'"+columnClause.substring(columnClause.indexOf("'") + 1, 
//                        columnClause.indexOf("'", columnClause.indexOf("'") + 1))+"'";
//                        columnClause = columnClause.replace(quotetedStr,"<font color='#FF0000'>"+quotetedStr+"</font>");
////                        var columnClauseArray 
//                    }
                    query += " (" + columnClause + ") AS " + toTableColumn.replace(":", ".") + "  ";
                    selectQuery += " (" + columnClause + ") AS " + toTableColumn.split(":")[1] + "  ";
                }
                if ((parseInt(i)) != (parseInt(rowCount) - 1)) {
                    query += " , ";
                    selectQuery += " , ";
                }
            }

        }

        i++;
    });
    query += " <ul><li> <font color='#0071c5'>FROM</font> ";
    selectQuery += " FROM ";
    var i = 0;
    var joinQuery = "";
    $("#EtlMappingTable thead tr").each(function () {
        if (i != 0) {
            var tdArray = this.cells;
            if (tdArray != null && tdArray.length != 0) {
                var tableName = $(tdArray[0]).find("option:selected").val();
                tableName = "<font color='#F911E9'>" + tableName + "</font>"
                if (i == 1) {
                    joinQuery += " " + tableName + "</li><li><ul>";
                    selectQuery += " " + tableName.replace("<font color='#F911E9'>", "").replace("</font>", "") + " ";
                } else {
                    var mappedcolumnsObjStr = $(tdArray[1]).find("img").attr("data-mappedcolumns");
                    //data-mappedcolumns  
                    console.log("mappedcolumnsObjStr:::" + mappedcolumnsObjStr);
                    if (mappedcolumnsObjStr != null && mappedcolumnsObjStr != '') {
                        var mappedcolumnsObj = JSON.parse(mappedcolumnsObjStr);
                        if (mappedcolumnsObj != null && !jQuery.isEmptyObject(mappedcolumnsObj)) {
                            var j = 0;
                            var mapObjLength = Object.keys(mappedcolumnsObj).length;
                            for (var key in mappedcolumnsObj) {
                                var mappedColObj = mappedcolumnsObj[key];
                                if (mappedColObj != null && !jQuery.isEmptyObject(mappedColObj)) {
                                    var childTableColumn = mappedColObj['childTableColumn'];
                                    if (childTableColumn != null && childTableColumn != '') {
                                        var childTableColumnArray = childTableColumn.split(":");
                                        childTableColumn = "<font color='#F911E9'>" + childTableColumnArray[0] + "</font>." + childTableColumnArray[1];
                                    }
                                    var masterTableColumn = mappedColObj['masterTableColumn'];
                                    if (masterTableColumn != null && masterTableColumn != '') {
                                        var masterTableColumnArray = masterTableColumn.split(":");
                                        masterTableColumn = "<font color='#F911E9'>" + masterTableColumnArray[0] + "</font>." + masterTableColumnArray[1];
                                    }
                                    if (j == 0) {
                                        joinQuery += "<li><font color='#0071c5'> " + mappedColObj['joinType'] + "</font> " + tableName + " <font color='#0071c5'>ON</font> </li><li><ul>"
                                        selectQuery += " " + mappedColObj['joinType'] + "  " + tableName.replace("<font color='#F911E9'>", "").replace("</font>", "") + "  ON ";
                                    }
                                    var colValue = mappedColObj['staticValue'];
                                    if (colValue != null && colValue != '' && colValue != 'null') {
                                        if (mappedColObj['operator'] == 'IN' || mappedColObj['operator'] == 'NOT IN') {

                                            if (colValue.indexOf("##") > -1) {
                                                colValue = "('" + colValue.replace(/#{2,}/g, "','") + "')";
                                            } else {
                                                colValue = "('" + colValue + "')";

                                            }
                                        } else {
                                            colValue = "'" + colValue + "'";
                                        }
                                    }
                                    joinQuery += " <li> " + childTableColumn + " <font color='#0071c5'>" + mappedColObj['operator'] + "</font> "
                                            + ((mappedColObj['staticValue'] != null && mappedColObj['staticValue'] != '') ? (" <font color='#FF0000'>'" + mappedColObj['staticValue'] + "'</font> ") : masterTableColumn); //staticValue
                                    selectQuery += "  " + childTableColumn.replace("<font color='#F911E9'>", "").replace("</font>", "") + "  " + mappedColObj['operator'] + "  "
                                            + ((mappedColObj['staticValue'] != null && mappedColObj['staticValue'] != '') ? ("  " + colValue + "  ") : masterTableColumn.replace("<font color='#F911E9'>", "").replace("</font>", "")); //staticValue

                                    if (j != parseInt(mapObjLength) - 1) {
                                        joinQuery += " <font color='#0071c5'>" + mappedColObj['andOrOperator'] + "</font> ";
                                        selectQuery += "  " + mappedColObj['andOrOperator'] + "  ";
                                    }
                                    joinQuery += "</li>";
                                }
                                j++;
                            }
                            joinQuery += "</ul></li>";
                        }
                    }
                }


            }
        }

        i++;
    }
    );
    joinQuery += "</ul></li></ul>";
    query += joinQuery;
// where clause selectedTables
    var whereClauseCondition = "";
    var j = 0;
    var rowCount = $('#selectedTables >tbody >tr').length;
    $("#selectedTables tbody tr").each(function () {
        var tdArray = this.cells;
        if (tdArray != null && tdArray.length != 0) {
            var tableName = $(tdArray[0]).text();
            if (rowCount == 1) {
                query += " <font color='#F911E9'>" + tableName + "</font>";
                selectQuery += "  " + tableName + " ";
            }
            var condition = $("#whereClauseConditionsArea_" + j).val();
            if (condition != null && condition != '' && $.trim(condition)) {
                if (whereClauseCondition != null && whereClauseCondition != '') {
                    whereClauseCondition += "AND " + condition;
                } else {
                    whereClauseCondition += condition
                }

            }

        }
        j++;
    });
    if (whereClauseCondition != null && whereClauseCondition != '') {
        query += "<font color='#0071c5'> WHERE </font>" + whereClauseCondition;
        selectQuery += "  WHERE  " + whereClauseCondition;
    }
    var orderByObj = {};
    var i = 1;
    var rowCount = $('#fromTablesOrderCauseTable >tbody >tr').length;
    $("#fromTablesOrderCauseTable tbody tr").each(function () {
        var tdArray = this.cells;
        if (tdArray != null && tdArray.length != 0) {
            var columnName = $(tdArray[1]).find("input").val();
            var direction = $(tdArray[2]).find("option:selected").val();
            if (columnName != null && columnName != '') {
                if (i == 1) {
                    query += " <font color='#0071c5'> ORDER BY </font>";
                    selectQuery += "   ORDER BY  ";
                }
                var columnsArray = columnName.split(":");
                query += " <font color='#F911E9'>" + columnsArray[0] + "</font>." + columnsArray[1] + " <font color='#0071c5'>" + direction + "</font>";
                selectQuery += "  " + columnsArray[0] + "." + columnsArray[1] + "  " + direction + " ";
                if (i != parseInt(rowCount)) {
                    query += " , ";
                    selectQuery += " , ";
                }
            }
            i++;
        }
    });
    var groupByColumns = "";
    var rowCount = $('#fromTablesGroupCauseTable >tbody >tr').length;
    var i = 0;
    $("#fromTablesGroupCauseTable tbody tr").each(function () {
        var tdArray = this.cells;
        if (tdArray != null && tdArray.length != 0) {
            var columnName = $(tdArray[1]).find("input").val();
            if (columnName != null && columnName != '') {
                var columnsArray = columnName.split(":");
                groupByColumns += " <font color='#F911E9'>" + columnsArray[0] + "</font>." + columnsArray[1];
                if (i != parseInt(rowCount) - 1) {
                    groupByColumns += ",";
                }
            }

            i++;
        }
    });
    if (groupByColumns != null && groupByColumns != '') {
        query += "<font color='#0071c5'> GROUP BY </font> " + groupByColumns;
        selectQuery += " GROUP BY  " + groupByColumns.replace("<font color='#F911E9'>", "").replace("</font>", "");
    }

    $("#" + sqlQueryTabId).html('<div id = "visionSqlViewQuery" class = "visionSqlViewQuery1"><div id="sqlQueryIcons"><img src="images/SQL ICON-01.svg" id="validateTotalQuery" '
            + 'onclick="validateQuery()" title="Click here to validate query" style="width:15px;height: 15px;cursor:pointer;">'
            + '<input type="hidden" id="generatedTotalQuery"/></div>' + query + '</div>');
    $("#generatedTotalQuery").val(selectQuery);
}
function showTablesListInTab() {
    showLoader();
    //var startIndex = parseInt(startIndx);
    var endIndex = $("#treePageSize").val();
    var connectionObj;
    var tableListHtml = '';
    var selectedItem = $('#savedConnections').jqxTree('selectedItem');

    var selecteddbLiItem = $('#savedConnections').jqxTree('getItem', selectedItem.parentElement);
    var parentItemLabel = selecteddbLiItem.value;
    var selectedItemLabel = selectedItem.label;
    var liId = ('li-' + parentItemLabel + '-' + selectedItemLabel);
    var divId = ('div-' + parentItemLabel + '-' + selectedItemLabel);
    currentTabId = divId;
    var splitterHeight = (parseInt($(window).height()) - parseInt(pageHeight));
    var value = parentItemLabel;
    var parentkey = selectedItem.value;
    var level = selectedItem.level;

    var filterId = divId.replace("div-", "filter-");
    var filterInput = '<div class ="visionFilterObjectsDiv"><input id="' + filterId + '" class="visionFilterObjectsInput" onkeyup="filterTables(event)" type="text" autocomplete="off" placeholder="Search Tables" value=""/></div>'

    var selectedItemIndex = $('#jqxtabs').jqxTabs('selectedItem');

    if (selectedItemIndex != null) {
        var html = $('#jqxtabs').html();
        if (html.indexOf(divId) > -1) {
            var length = $('#jqxtabs').jqxTabs('length');
            for (var i = 0; i < length; i++) {
                var content = $('#jqxtabs').jqxTabs('getContentAt', i);
                var id = $(content).attr("id");
                if ($(content).attr("id") == divId) {
                    showEtlList("schemaObjectsDiv", "schemaObjects");
                    $('#jqxtabs').jqxTabs('select', i);
                    break;
                }
            }
            stopLoader();
            return false;
        }

    }

    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        var conObj = savedDBData[value];
        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
            connectionObj = conObj;
        }

    }
    var columnsObj = globalTreeObj['treeColumnObj'];
    var extTreeParams = $("#extTreeParams").val();
    var data = {
        parentkey: parentkey,
        treeId: globalTreeObj['treeId'],
        level: level,
        extTreeParams: extTreeParams,
        columnsObj: JSON.stringify(columnsObj),
        connectionObj: JSON.stringify(connectionObj),
        startIndex: 0,
        endIndex: endIndex
    };
    var url = 'getTreePagingDataOpt';
    if (selectedItem.level > 3)
    {
        var parentEventItem = selectedItem.element;

        var immideateParent = parentEventItem.parentElement.parentElement;
        immideateParent = immideateParent.parentElement.parentElement;
        for (var i = level; i > 1; i--)
        {
            parentEventItem = parentEventItem.parentElement.parentElement;
        }
        var selectedSuperParentItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
        var selectedParentValue = selectedSuperParentItem['value'];
        if (selectedParentValue != null && selectedParentValue != '' &&
                selectedParentValue != undefined && selectedParentValue == 'ERP')
        {
            url = 'getTreeErpConnectionDetails';
            var immideateParentItem = $('#savedConnections').jqxTree('getItem', immideateParent);
            var immideateParentValue = immideateParentItem['value'];
            if (immideateParentValue == "Oracle_ERP") {
                url = 'getTreePagingDataOpt';
            }
        }
    }
//    if (selecteddbLiItem != null) {
//        var selectedParentValue = selecteddbLiItem['value'];
//        if (selectedParentValue != null && selectedParentValue != ''
//                && selectedParentValue != undefined && selectedParentValue == 'ERP')
//        {
//            url = 'getTreeErpConnectionDetails';
//        }
//    }
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: url,
        cache: false,
        data: data,
        success: function (data, status, xhr) {
//            $(".showEtlIcons").css("margin-top", "223px");
//            $(".showEtlIcons").css("margin-left", "-265");
            stopLoader();
            showEtlList("schemaObjectsDiv", "schemaObjects");
            stopLoader();
            tableListHtml += '<div id ="' + divId + '-div">';
            $.each(data, function (index) {
                if (this.value == "Show More") {

                } else {
                    tableListHtml += '<div title="' + connectionObj['CONNECTION_NAME'] + ' . ' + this.label + '" class = "visionObjectNameDiv" style="cursor:pointer">'
                            + '<img class="visionTableIcon" src="images/GridDB.png"/>'
                            + '<span> ' + this.label + '</span></div>'
                }
            });
            tableListHtml += '</div>';
            if (selectedItemIndex != null) {
                $('#jqxtabs').jqxTabs('addLast', selectedItem.label, tableListHtml);


            } else {
                $("#jqxtabs").find("ul").append('<li title="' + liId.replace("li-", "").replace("-", ".") + '">' + selectedItem.label + ' </li>');// <img src="images/delete_icon_white.png" id="'+liId.replace("li_","close_")+'" class ="visionCloseTab" onclick = "closeCurrentTab(event)" />
                $("#jqxtabs").append('<div id="' + divId + '" class="visionObjectsListDiv">' + filterInput + tableListHtml + '</div>');
                $('#jqxtabs').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                $('#jqxtabs').jqxTabs('showAllCloseButtons');
                $("#jqxtabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                $("#jqxtabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                var height = $('#connectionsDiv').height();
                var width = $('#connectionsDiv').width();

                $('#schemaObjectsDiv').css("height", height);
                $('#schemaObjectsDiv').css("width", width);
            }

            $('#jqxtabs').unbind('selected').on('selected', function (event) {
                var $thid = this;
                $("#jqxtabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                $("#jqxtabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

            });

            $('#jqxtabs').unbind('add').on('add', function (event) {
                var tabContent = $('#jqxtabs').jqxTabs('getContentAt', event.args.item);
//                tabContent.id = currentTabId;
                $(tabContent).attr("class", "visionObjectsListDiv");
                $(tabContent).attr("id", currentTabId);
//                tabContent.attr("class", "visionObjectsListDiv");

                var filterId = currentTabId.replace("div-", "filter-");
                var filterInput = '<div class ="visionFilterObjectsDiv"><input id="' + filterId + '" class="visionFilterObjectsInput" onkeyup="filterTables(event)" autocomplete="off"  type="text" placeholder="Search Tables" value=""/></div>'
                $(tabContent).prepend(filterInput);
                $("#jqxtabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                $("#jqxtabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                //var title = $('#jqxtabs').jqxTabs('getTitleAt',event.args.item);
                var selectedTabLi = $("#jqxtabs").find("li.jqx-tabs-title-selected-top");
//                var cancelButton = selectedTabLi.find("div.jqx-tabs-close-button-selected");
//                cancelButton.css("background-image","url(images/close_white.png)");
                $(selectedTabLi).attr("title", currentTabId.replace("div-", "").replace("-", "."));


                // $('#jqxtabs').jqxTabs('select', event.args.item); 
            });

            var i = 0;
            var singleSelectedItem;
            $("div.visionObjectNameDiv").click(function (e) {
                if (e.ctrlKey) {
                    $(this).toggleClass("selectedTabs");
                    if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                        selectedItems[0] = singleSelectedItem;
                    }
                    selectedItems[i] = $(this).text();
                    i++;
                } else {
                    $(this).addClass("selectedTabs").siblings().removeClass('selectedTabs');
                    singleSelectedItem = $(this).text();
                    selectedItems = [];

                    if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                        i = 1;
                    } else {
                        i = 0;
                    }

                }
            });

            var timeout;
            $(".visionObjectsListDiv").unbind("scroll").on("scroll", function (event) {
                console.log("scrolled ;;")
                if (($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) && ($(this)[0].scrollHeight > $(this).innerHeight())) {
                    console.log("iam in scroll functionality...........");
                    clearTimeout(timeout);
                    timeout = setTimeout(function () {
                        loadOnScrollDown(event);
                    }, 50);

                }
            });


            $("div.visionObjectNameDiv").draggable({
                cursor: "move",
                opacity: 0.7,
                helper: 'clone',
//                                appendTo: 'body',
                zIndex: 1000,
                helper: function (event, ui) {
                    var $this = $(this);
                    var innerText = $this.text();
                    var title = innerText;
                    var descripttion = $this.attr("title");
                    var value = this.parentElement.id.split("-")[1];
                    var connectionObj;
                    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                    {
                        var conObj = savedDBData[value];
                        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                            connectionObj = conObj;
                        }

                    }

                    var operatorData = {
                        top: event.screenX,
                        left: event.screenY,
                        statusLebel: innerText.trim(),
                        tableName: (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + innerText.trim()) : innerText.trim(),
//                        tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
                        dragType: "Table",
                        CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
                        CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
                        CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
                        connObj: connectionObj,
                        properties: {
                            //body: '<div title="' + innerText + '" class="visionOpLabelDiv">' + innerText + '</div>',
                            body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                    + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;padding-top: 6px;"/></div>'

                                    + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                            inputs: {
                                input_1: {
                                    label: '',
                                    multipleLinks: true
                                }
                            },
                            outputs: {
                                output_1: {
                                    label: '',

                                }
                            }
                        }
                    };
//            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
                    var contentSplitterStyle = $("#contentSplitter").css("display");

                    var contentSplitter1Style = $("#contentSplitter1").css("display");

                    var $flowchart;

                    if (contentSplitterStyle == "block") {
                        $flowchart = $('#' + flowChartWorkSpaceId);

                    } else if (contentSplitter1Style == "block") {
                        $flowchart = $('#dataModellerFlowchartworkSourcesspace');

                    }
                    return  $flowchart.flowchart('getOperatorElement', operatorData);
//                    return  $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
                },
                stop: function (e, ui) {
                    var selItems = [];
                    if (!(selectedItems != null && selectedItems.length != null && selectedItems.length > 0)) {
                        selItems[0] = this.innerText;
                    } else {
                        selItems = selectedItems;
//                        for (var i = 0; i < selectedItems.length; i++) {
//                            selItems[i] = selectedItems[i];
//                        }
                    }
                    $(".flowchart-operator-connector-label").hide();

                    var contentSplitterStyle = $("#contentSplitter").css("display");

                    var contentSplitter1Style = $("#contentSplitter1").css("display");

                    var $flowchart;
                    var $container;
                    if (contentSplitterStyle == "block") {
                        $flowchart = $('#' + flowChartWorkSpaceId);
                        $container = $('#' + flowChartWorkSpaceId);
                    } else if (contentSplitter1Style == "block") {
                        $flowchart = $('#dataModellerFlowchartworkSourcesspace');
                        $container = $('#dataModellerFlowchartworkSourcesspace');
                    }
//                    var $flowchart = $('#'+flowChartWorkSpaceId);
//
//                    var $container = $('#'+flowChartWorkSpaceId);
                    var elOffset = ui.offset;
                    var containerOffset = $container.offset();
                    if (elOffset.left > containerOffset.left &&
                            elOffset.top > containerOffset.top &&
                            elOffset.left < containerOffset.left + $container.width() &&
                            elOffset.top < containerOffset.top + $container.height()) {
                        var flowchartOffset = $flowchart.offset();
                        var relativeLeft = elOffset.left - flowchartOffset.left;
                        var relativeTop = elOffset.top - flowchartOffset.top;
                        var positionRatio = $flowchart.flowchart('getPositionRatio');
                        relativeLeft /= positionRatio;
                        relativeTop /= positionRatio;
                        elOffset.left = relativeLeft;
                        elOffset.top = relativeTop;
                    }
                    var top = elOffset.top;
                    for (var j = 0; j < selItems.length; j++) {
                        // ravi start
                        trfmRulesChanged = true;
                        // ravi end
                        var $this = $(this);
                        var innerText = selItems[j];
                        var title = innerText;
                        var value = this.parentElement.id.split("-")[1];
                        var connectionObj;
                        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                        {
                            var conObj = savedDBData[value];
                            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                                connectionObj = conObj;
                            }

                        }


                        var data = {
                            top: top,
                            left: elOffset.left,
                            statusLebel: innerText.trim(),
                            tableName: (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + innerText.trim()) : innerText.trim(),
//                            tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
                            CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
                            CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
                            CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
                            dragType: "Table",
                            connObj: connectionObj,
//                statusLebel: innerText,
                            properties: {

//                                title: innerText,
                                //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;padding-top: 6px;"/></div>'

                                        + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: 'I-MAP',
                                        multipleLinks: true
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: 'O-MAP',

                                    }
                                }
                            }
                        };
                        var operatorId = $flowchart.flowchart('addOperator', data);
//                        $dataModellerFlowchart.flowchart('addOperator', data);
                        $(".flowchart-operator-connector-label").hide();
                        $(".flowchart-operator-title").hide();
                        top = top + 70;
                        var component = $(this).attr("component");
                        if (component != "Y") {
                            inputOutPutPopUp(operatorId);
                        }
                    }
                }
//                stop: function (e, ui) {
//                    var selItems = [];
//                    if (!(selectedItems != null && selectedItems.length != null && selectedItems.length > 0)) {
//                        selItems[0] = this.innerText;
//                    } else {
//                        selItems = selectedItems;                       
//                    }
//                    $(".flowchart-operator-connector-label").hide();
//                    var $flowchart = $('#'+flowChartWorkSpaceId);
//                    var $container = $('#'+flowChartWorkSpaceId);
//                    // ravi start
//                    trfmRulesChanged = true;
//                    // ravi end
//                    var $this = $(this);
//                    var innerText = this.innerText;
//                    var title = innerText;
//                    var value = this.parentElement.id.split("-")[1];
//                    var connectionObj;
//                    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//                    {
//                        var conObj = savedDBData[value];
//                        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//                            connectionObj = conObj;
//                        }
//
//                    }
//
//
//                    var elOffset = ui.offset;
//                    var containerOffset = $container.offset();
//                    if (elOffset.left > containerOffset.left &&
//                            elOffset.top > containerOffset.top &&
//                            elOffset.left < containerOffset.left + $container.width() &&
//                            elOffset.top < containerOffset.top + $container.height()) {
//                        var flowchartOffset = $flowchart.offset();
//                        var relativeLeft = elOffset.left - flowchartOffset.left;
//                        var relativeTop = elOffset.top - flowchartOffset.top;
//                        var positionRatio = $flowchart.flowchart('getPositionRatio');
//                        relativeLeft /= positionRatio;
//                        relativeTop /= positionRatio;
//                        elOffset.left = relativeLeft;
//                        elOffset.top = relativeTop;
//                    }
//
//                    var data = {
//                        top: elOffset.top,
//                        left: elOffset.left,
//                        statusLebel: innerText.trim(),
//                        tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
//                        CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
//                        CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
//                        CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
//                        dragType: "Table",
//                        connObj: connectionObj,
////                statusLebel: innerText,
//                        properties: {
//
////                                title: innerText,
//                            //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
//                            body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
//                                    + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv">' + title + '</div>'
//
//                                    + '</div>',
//                            inputs: {
//                                input_1: {
//                                    label: 'I-MAP',
//                                    multipleLinks: true
//                                }
//                            },
//                            outputs: {
//                                output_1: {
//                                    label: 'O-MAP',
//
//                                }
//                            }
//                        }
//                    };
//                    $flowchart.flowchart('addOperator', data);
//                    $(".flowchart-operator-connector-label").hide();
//                    $(".flowchart-operator-title").hide();
//                }
            });



        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });


}

var timeOut = null;
function filterTables(event) {

    clearTimeout(timeOut);

    timeOut = setTimeout(function () {
        showLoader();
        var inputValue = $(event.target).val();
//if (inputValue.length<3){
//    return false;
//}
        var filterValue = $(event.target).val();
        if (filterValue != null && filterValue != "") {
            filterValue = "%" + filterValue + "%";
        }
        var inputId = $(event.target).attr("id");
        var divId = inputId.replace("filter-", "div-");
        var dbLabel = inputId.split("-")[1];

        var selectedLevelValue = inputId.split("-")[2].toUpperCase();
        var selectConnObj = savedDBData[dbLabel];
        var selectedLevel = '4'
        var selectColumnsObj = globalTreeObj['treeColumnObj']
        var selectBoxValue = "LIKE"

        selectedLevelValue = selectedLevelValue.toUpperCase();
        var item = $("#savedConnections").jqxTree('getSelectedItem');
        var url = 'getTreePagingDataOpt';
        if (item != null)
        {
            var level = item['level'];
            var parentEventItem = item['parentElement'];

            var immideateParent = parentEventItem['parentElement'];
            immideateParent = immideateParent['parentElement'];

            for (var i = level; i > 0; i--)
            {
                parentEventItem = parentEventItem['parentElement'];
            }
            var selectedItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
            var selectedParentValue = selectedItem['value'];
            if (selectedParentValue != null && selectedParentValue != ''
                    && selectedParentValue != undefined && selectedParentValue == 'ERP')
            {
                url = 'getTreeErpConnectionDetails';
                var immideateParentItem = $('#savedConnections').jqxTree('getItem', immideateParent);
                var immideateParentValue = immideateParentItem['value'];
                if (immideateParentValue == "Oracle_ERP") {
                    url = 'getTreePagingDataOpt';
                }

            }
        }
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: url,
            cache: false,
            data: {
                parentkey: ((selectedLevelValue != null && selectedLevelValue != '') ? selectedLevelValue.toUpperCase() : ""),
                level: selectedLevel,
                columnsObj: JSON.stringify(selectColumnsObj),
                connectionObj: JSON.stringify(selectConnObj),
                filterValue: filterValue,
                filterCondition: selectBoxValue,
                startIndex: 0,
                endIndex: $("#treePageSize").val()
            },
            success: function (data, status, xhr) {
                var tableListHtml = "";
                stopLoader();

                $.each(data, function (index) {
                    if (this.label == "Show More...") {

                    } else {
                        tableListHtml += '<div class = "visionObjectNameDiv" style="cursor:pointer"><img class="visionTableIcon" src="images/GridDB.png"/><span> ' + this.label + '</span></div>'
                    }
                });

//            var filterInput = '<div class ="visionFilterObjectsDiv"><input id="' + inputId + '" class="visionFilterObjectsInput" onkeyup="filterTables(event)" type="text" placeholder="Search Tables" /></div>'
//            $("[id='" + divId + "']").html(filterInput + tableListHtml);
//            $("[id='" + inputId + "']").focus();
//            $("[id='" + inputId + "']").val(inputValue);

                $("[id='" + divId + "-div']").html(tableListHtml);
                selectedItems = [];
                var i = 0;
                var singleSelectedItem;
                $("div.visionObjectNameDiv").click(function (e) {
                    $(document).find("input").blur();
                    if (e.ctrlKey) {
                        $(this).toggleClass("selectedTabs");
                        if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                            selectedItems[0] = singleSelectedItem;
                        }
                        selectedItems[i] = $(this).text();
                        i++;
                    } else {
                        $(this).addClass("selectedTabs").siblings().removeClass('selectedTabs');
                        singleSelectedItem = $(this).text();
                        selectedItems = [];

                        if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                            i = 1;
                        } else {
                            i = 0;
                        }

                    }
                });
                $("div.visionObjectNameDiv").draggable({
                    cursor: "move",
                    opacity: 0.7,
                    helper: 'clone',
//                                appendTo: 'body',
                    zIndex: 1000,
                    helper: function (event, ui) {
                        var $this = $(this);
                        var innerText = $this.text();
                        var title = innerText;
                        var descripttion = $this.attr("title");
                        var value = this.parentElement.id.split("-")[1];
                        var connectionObj;
                        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                        {
                            var conObj = savedDBData[value];
                            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                                connectionObj = conObj;
                            }

                        }

                        var operatorData = {
                            top: event.screenX,
                            left: event.screenY,
                            statusLebel: innerText.trim(),
                            tableName: (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + innerText.trim()) : innerText.trim(),
//                            tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
                            dragType: "Table",
                            CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
                            CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
                            CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
                            connObj: connectionObj,
                            properties: {
                                //body: '<div title="' + innerText + '" class="visionOpLabelDiv">' + innerText + '</div>',

                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;padding-top: 6px;"/></div>'

                                        + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: '',
                                        multipleLinks: true
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: '',

                                    }
                                }
                            }
                        };
//            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
                        var contentSplitterStyle = $("#contentSplitter").css("display");

                        var contentSplitter1Style = $("#contentSplitter1").css("display");

                        var $flowchart;

                        if (contentSplitterStyle == "block") {
                            $flowchart = $('#' + flowChartWorkSpaceId);

                        } else if (contentSplitter1Style == "block") {
                            $flowchart = $('#dataModellerFlowchartworkSourcesspace');

                        }
                        return  $flowchart.flowchart('getOperatorElement', operatorData);
                    },
                    stop: function (e, ui) {
                        $(document).find("input").blur();
                        var selItems = [];
                        if (!(selectedItems != null && selectedItems.length != null && selectedItems.length > 0)) {
                            selItems[0] = this.innerText;
                        } else {
                            selItems = [];
                            for (var i = 0; i < selectedItems.length; i++) {
                                selItems[i] = selectedItems[i];
                            }
                        }
                        $(".flowchart-operator-connector-label").hide();
                        var contentSplitterStyle = $("#contentSplitter").css("display");

                        var contentSplitter1Style = $("#contentSplitter1").css("display");

                        var $flowchart;
                        var $container;
                        if (contentSplitterStyle == "block") {
                            $flowchart = $('#' + flowChartWorkSpaceId);
                            $container = $('#' + flowChartWorkSpaceId);
                        } else if (contentSplitter1Style == "block") {
                            $flowchart = $('#dataModellerFlowchartworkSourcesspace');
                            $container = $('#dataModellerFlowchartworkSourcesspace');
                        }
//                        var $flowchart = $('#'+flowChartWorkSpaceId);
//                        var $container = $('#'+flowChartWorkSpaceId);
                        var elOffset = ui.offset;
                        var containerOffset = $container.offset();
                        if (elOffset.left > containerOffset.left &&
                                elOffset.top > containerOffset.top &&
                                elOffset.left < containerOffset.left + $container.width() &&
                                elOffset.top < containerOffset.top + $container.height()) {
                            var flowchartOffset = $flowchart.offset();
                            var relativeLeft = elOffset.left - flowchartOffset.left;
                            var relativeTop = elOffset.top - flowchartOffset.top;
                            var positionRatio = $flowchart.flowchart('getPositionRatio');
                            relativeLeft /= positionRatio;
                            relativeTop /= positionRatio;
                            elOffset.left = relativeLeft;
                            elOffset.top = relativeTop;
                        }
                        var top = elOffset.top;
                        for (var j = 0; j < selItems.length; j++) {
                            var $this = $(this);
                            var innerText = selItems[j];
                            var title = innerText;
                            var value = this.parentElement.id.split("-")[1];
                            var connectionObj;
                            if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                            {
                                var conObj = savedDBData[value];
                                if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                                    connectionObj = conObj;
                                }

                            }



//            var divId = "mapDivId_" + 0;
//            if ($("#" + divId).length == 0) {
//                //it doesn't exist
//            }else{
//                
//            }
                            //mapDivId:'',
                            var data = {
                                top: top,
                                left: elOffset.left,
                                statusLebel: innerText.trim(),
                                tableName: (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + innerText.trim()) : innerText.trim(),
//                                tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
                                dragType: "Table",
                                connObj: connectionObj,
                                CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
                                CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
                                CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
//                statusLebel: innerText,
                                properties: {

//                                title: innerText,
                                    //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
                                    body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                            + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;"/></div>'

                                            + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                    inputs: {
                                        input_1: {
                                            label: 'I-MAP',
                                            multipleLinks: true
                                        }
                                    },
                                    outputs: {
                                        output_1: {
                                            label: 'O-MAP',

                                        }
                                    }
                                }
                            };
                            var operatorId = $flowchart.flowchart('addOperator', data);
                            $(".flowchart-operator-connector-label").hide();
                            $(".flowchart-operator-title").hide();
                            top = top + 70;
                            var component = $(this).attr("component");
                            if (component != "Y") {
                                inputOutPutPopUp(operatorId);
                            }
                        }
                    }
                });

                stopLoader();
            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });

    }, 1000);
}
//function filterTables(event) {
//
//    clearTimeout(timeOut);
//
//    timeOut = setTimeout(function () {
//        showLoader();
//        var inputValue = $(event.target).val();
////if (inputValue.length<3){
////    return false;
////}
//        var filterValue = $(event.target).val();
//        if (filterValue != null && filterValue != "") {
//            filterValue = "%" + filterValue + "%";
//        }
//        var inputId = $(event.target).attr("id");
//        var divId = inputId.replace("filter-", "div-");
//        var dbLabel = inputId.split("-")[1];
//
//        var selectedLevelValue = inputId.split("-")[2].toUpperCase();
//        var selectConnObj = savedDBData[dbLabel];
//        var selectedLevel = '4'
//        var selectColumnsObj = globalTreeObj['treeColumnObj']
//        var selectBoxValue = "LIKE"
//
//        selectedLevelValue = selectedLevelValue.toUpperCase();
//        var item = $("#savedConnections").jqxTree('getSelectedItem');
//        var url = 'getTreePagingDataOpt';
//        if (item != null)
//        {
//            var level = item['level'];
//            var parentEventItem = item['parentElement'];
//            for (var i = level; i > 0; i--)
//            {
//                parentEventItem = parentEventItem['parentElement'];
//            }
//            var selectedItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
//            var selectedParentValue = selectedItem['value'];
//            if (selectedParentValue != null && selectedParentValue != ''
//                    && selectedParentValue != undefined && selectedParentValue == 'ERP')
//            {
//                url = 'getTreeErpConnectionDetails';
//            }
//        }
//        $.ajax({
//            type: "post",
//            traditional: true,
//            dataType: 'json',
//            url: url,
//            cache: false,
//            data: {
//                parentkey: ((selectedLevelValue != null && selectedLevelValue != '') ? selectedLevelValue.toUpperCase() : ""),
//                level: selectedLevel,
//                columnsObj: JSON.stringify(selectColumnsObj),
//                connectionObj: JSON.stringify(selectConnObj),
//                filterValue: filterValue,
//                filterCondition: selectBoxValue,
//                startIndex: 0,
//                endIndex: $("#treePageSize").val()
//            },
//            success: function (data, status, xhr) {
//                var tableListHtml = "";
//                stopLoader();
//
//                $.each(data, function (index) {
//                    if (this.label == "Show More...") {
//
//                    } else {
//                        tableListHtml += '<div class = "visionObjectNameDiv" style="cursor:pointer"><img class="visionTableIcon" src="images/GridDB.png"/><span> ' + this.label + '</span></div>'
//                    }
//                });
//
////            var filterInput = '<div class ="visionFilterObjectsDiv"><input id="' + inputId + '" class="visionFilterObjectsInput" onkeyup="filterTables(event)" type="text" placeholder="Search Tables" /></div>'
////            $("[id='" + divId + "']").html(filterInput + tableListHtml);
////            $("[id='" + inputId + "']").focus();
////            $("[id='" + inputId + "']").val(inputValue);
//                $("[id='" + divId + "-div']").html(tableListHtml);
//                $("div.visionObjectNameDiv").draggable({
//                    cursor: "move",
//                    opacity: 0.7,
//                    helper: 'clone',
////                                appendTo: 'body',
//                    zIndex: 1000,
//                    helper: function (event, ui) {
//                        var $this = $(this);
//                        var innerText = $this.text();
//                        var title = innerText;
//                        var descripttion = $this.attr("title");
//                        var value = this.parentElement.id.split("-")[1];
//                        var connectionObj;
//                        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//                        {
//                            var conObj = savedDBData[value];
//                            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//                                connectionObj = conObj;
//                            }
//
//                        }
//
//                        var operatorData = {
//                            top: event.screenX,
//                            left: event.screenY,
//                            statusLebel: innerText.trim(),
//                            tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
//                            dragType: "Table",
//                            CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
//                            CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
//                            CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
//                            connObj: connectionObj,
//                            properties: {
//                                //body: '<div title="' + innerText + '" class="visionOpLabelDiv">' + innerText + '</div>',
//
//                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
//                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv">' + title + '</div>'
//
//                                        + '</div>',
//                                inputs: {
//                                    input_1: {
//                                        label: '',
//                                        multipleLinks: true
//                                    }
//                                },
//                                outputs: {
//                                    output_1: {
//                                        label: '',
//
//                                    }
//                                }
//                            }
//                        };
////            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
//                        return  $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
//                    },
//                    stop: function (e, ui) {
//                        $(".flowchart-operator-connector-label").hide();
//                        var $flowchart = $('#'+flowChartWorkSpaceId);
//                        var $container = $('#'+flowChartWorkSpaceId);
//                        var $this = $(this);
//                        var innerText = this.innerText;
//                        var title = innerText;
//                        var value = this.parentElement.id.split("-")[1];
//                        var connectionObj;
//                        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//                        {
//                            var conObj = savedDBData[value];
//                            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//                                connectionObj = conObj;
//                            }
//
//                        }
//
//
//                        var elOffset = ui.offset;
//                        var containerOffset = $container.offset();
//                        if (elOffset.left > containerOffset.left &&
//                                elOffset.top > containerOffset.top &&
//                                elOffset.left < containerOffset.left + $container.width() &&
//                                elOffset.top < containerOffset.top + $container.height()) {
//                            var flowchartOffset = $flowchart.offset();
//                            var relativeLeft = elOffset.left - flowchartOffset.left;
//                            var relativeTop = elOffset.top - flowchartOffset.top;
//                            var positionRatio = $flowchart.flowchart('getPositionRatio');
//                            relativeLeft /= positionRatio;
//                            relativeTop /= positionRatio;
//                            elOffset.left = relativeLeft;
//                            elOffset.top = relativeTop;
//                        }
////            var divId = "mapDivId_" + 0;
////            if ($("#" + divId).length == 0) {
////                //it doesn't exist
////            }else{
////                
////            }
//                        //mapDivId:'',
//                        var data = {
//                            top: elOffset.top,
//                            left: elOffset.left,
//                            statusLebel: innerText.trim(),
//                            tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
//                            dragType: "Table",
//                            connObj: connectionObj,
//                            CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
//                            CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
//                            CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
////                statusLebel: innerText,
//                            properties: {
//
////                                title: innerText,
//                                //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
//                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
//                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv">' + title + '</div>'
//
//                                        + '</div>',
//                                inputs: {
//                                    input_1: {
//                                        label: 'I-MAP',
//                                        multipleLinks: true
//                                    }
//                                },
//                                outputs: {
//                                    output_1: {
//                                        label: 'O-MAP',
//
//                                    }
//                                }
//                            }
//                        };
//                        $flowchart.flowchart('addOperator', data);
//                        $(".flowchart-operator-connector-label").hide();
//                        $(".flowchart-operator-title").hide();
//                    }
//                });
//
//                stopLoader();
//            },
//            error: function (e) {
//                console.log(e);
//                sessionTimeout(e);
//                stopLoader();
//            }
//        });
//
//    }, 1000);
//}
function loadOnScrollDown(event) {
    showLoader();
    var divId = $(event.target).attr("id");
    // filter issue
    var filterDivId = divId.replace("div-", "filter-");
    var filterValue = $("#" + filterDivId).val();
    if (filterValue != null && filterValue != "") {
        filterValue = "%" + filterValue + "%";
    }
    // filter issue
    var value = divId.split("-")[1];
    var parentkey = divId.split("-")[2].toUpperCase();
    ;
    var level = '4';
    var arr = $("[id='" + divId + "']").find(".visionObjectNameDiv");

    var startIndex = arr.length + 1;
    var endIndex = arr.length + parseInt($("#treePageSize").val());
    var connectionObj;
    var tableListHtml = '';

    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        var conObj = savedDBData[value];
        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
            connectionObj = conObj;
        }

    }
    var item = $("#savedConnections").jqxTree('getSelectedItem');
    var url = 'getTreePagingDataOpt';
    if (item != null)
    {
        var level = item['level'];
        var parentEventItem = item['parentElement'];
        for (var i = level; i > 0; i--)
        {
            parentEventItem = parentEventItem['parentElement'];
        }
        var selectedItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
        var selectedParentValue = selectedItem['value'];
        if (selectedParentValue != null && selectedParentValue != ''
                && selectedParentValue != undefined && selectedParentValue == 'ERP')
        {
            url = 'getTreeErpConnectionDetails';
        }
    }
    var columnsObj = globalTreeObj['treeColumnObj'];
    var extTreeParams = $("#extTreeParams").val();
    var data = {
        parentkey: parentkey,
        treeId: globalTreeObj['treeId'],
        level: level,
        filterValue: filterValue,
        filterCondition: "LIKE",
        extTreeParams: extTreeParams,
        columnsObj: JSON.stringify(columnsObj),
        connectionObj: JSON.stringify(connectionObj),
        startIndex: startIndex,
        endIndex: endIndex
    };

    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: url,
        cache: false,
        data: data,
        success: function (data, status, xhr) {

            $.each(data, function (index) {
                if (this.label == "Show More...") {

                } else {
                    tableListHtml += '<div title=' + connectionObj['CONNECTION_NAME'] + ' . ' + this.label + ' class = "visionObjectNameDiv">\n\
                                     <img class="visionTableIcon" src="images/GridDB.png"/><span> ' + this.label + '</span></div>'
                }
            });
            $("#" + divId + "-div").append(tableListHtml);
            var i = 0;
            var singleSelectedItem;
            $("div.visionObjectNameDiv").click(function (e) {
                if (e.ctrlKey) {
                    $(this).toggleClass('selectedTabs', true);
                    if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                        selectedItems[0] = singleSelectedItem;
                    }
                    selectedItems[i] = $(this).text();
                    i++;
                } else {
                    $(this).addClass("selectedTabs").siblings().removeClass('selectedTabs');
                    singleSelectedItem = $(this).text();
                    selectedItems = [];

                    if (singleSelectedItem !== null && singleSelectedItem !== '' && singleSelectedItem !== undefined) {
                        i = 1;
                    } else {
                        i = 0;
                    }
                }
            });

            $("div.visionObjectNameDiv").draggable({
                cursor: "move",
                opacity: 0.7,
                helper: 'clone',
//                                appendTo: 'body',
                zIndex: 1000,
                helper: function (event, ui) {
                    var $this = $(this);
                    var innerText = $this.text();
                    var title = innerText;
                    var descripttion = $this.attr("title");
                    var value = this.parentElement.id.split("-")[1];
                    var connectionObj;
                    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                    {
                        var conObj = savedDBData[value];
                        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                            connectionObj = conObj;
                        }

                    }

                    var operatorData = {
                        top: event.screenX,
                        left: event.screenY,
                        statusLebel: innerText.trim(),
                        tableName: innerText.trim(),
                        dragType: "Table",
                        connObj: connectionObj,
                        properties: {
                            //body: '<div title="' + innerText + '" class="visionOpLabelDiv">' + innerText + '</div>',

                            body: '<div  title="' + title + '" class=""><div><img src="images/GridDB.png"\n\
                            class="visionOpIcons"  style="width:18px;height: 18px;"/></div></div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                            inputs: {
                                input_1: {
                                    label: '',
                                    multipleLinks: true
                                }
                            },
                            outputs: {
                                output_1: {
                                    label: '',

                                }
                            }
                        }
                    };
//            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
                    var contentSplitterStyle = $("#contentSplitter").css("display");

                    var contentSplitter1Style = $("#contentSplitter1").css("display");

                    var $flowchart;

                    if (contentSplitterStyle == "block") {
                        $flowchart = $('#' + flowChartWorkSpaceId);

                    } else if (contentSplitter1Style == "block") {
                        $flowchart = $('#dataModellerFlowchartworkSourcesspace');

                    }
                    return  $flowchart.flowchart('getOperatorElement', operatorData);
                },
                stop: function (e, ui) {
                    var selItems = [];
                    if (!(selectedItems != null && selectedItems.length != null && selectedItems.length > 0)) {
                        selItems[0] = this.innerText;
                    } else {
                        selItems = [];
                        for (var i = 0; i < selectedItems.length; i++) {
                            selItems[i] = selectedItems[i];
                        }
                    }
                    $(".flowchart-operator-connector-label").hide();
                    var contentSplitterStyle = $("#contentSplitter").css("display");

                    var contentSplitter1Style = $("#contentSplitter1").css("display");

                    var $flowchart;
                    var $container;
                    if (contentSplitterStyle == "block") {
                        $flowchart = $('#' + flowChartWorkSpaceId);
                        $container = $('#' + flowChartWorkSpaceId);
                    } else if (contentSplitter1Style == "block") {
                        $flowchart = $('#dataModellerFlowchartworkSourcesspace');
                        $container = $('#dataModellerFlowchartworkSourcesspace');
                    }
//                    var $flowchart = $('#'+flowChartWorkSpaceId);
//                    var $container = $('#'+flowChartWorkSpaceId);
                    var elOffset = ui.offset;
                    var containerOffset = $container.offset();
                    if (elOffset.left > containerOffset.left &&
                            elOffset.top > containerOffset.top &&
                            elOffset.left < containerOffset.left + $container.width() &&
                            elOffset.top < containerOffset.top + $container.height()) {
                        var flowchartOffset = $flowchart.offset();
                        var relativeLeft = elOffset.left - flowchartOffset.left;
                        var relativeTop = elOffset.top - flowchartOffset.top;
                        var positionRatio = $flowchart.flowchart('getPositionRatio');
                        relativeLeft /= positionRatio;
                        relativeTop /= positionRatio;
                        elOffset.left = relativeLeft;
                        elOffset.top = relativeTop;
                    }
                    var top = elOffset.top;
                    for (var j = 0; j < selItems.length; j++) {
                        // ravi start
                        trfmRulesChanged = true;
                        // ravi end
                        var $this = $(this);
                        var innerText = selItems[j];
                        var title = innerText;
                        var value = this.parentElement.id.split("-")[1];
                        var connectionObj;
                        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
                        {
                            var conObj = savedDBData[value];
                            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                                connectionObj = conObj;
                            }

                        }



//            var divId = "mapDivId_" + 0;
//            if ($("#" + divId).length == 0) {
//                //it doesn't exist
//            }else{
//                
//            }
                        //mapDivId:'',
                        var data = {
                            top: top,
                            left: elOffset.left,
                            statusLebel: innerText.trim(),
                            tableName: (connectionObj['CONN_CUST_COL1'] != 'SAP') ? (connectionObj['CONN_USER_NAME'] + '.' + innerText.trim()) : innerText.trim(),
//                            tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
                            dragType: "Table",
                            CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
                            CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
                            CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
                            connObj: connectionObj,
//                statusLebel: innerText,
                            properties: {

//                                title: innerText,
                                //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
                                body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
                                        + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;padding-top: 6px;"/></div>'

                                        + '</div><div class="visionOpLabelDiv" title="Double click to Rename" ondblclick="renameOperatorDisplayLabel(\'' + title + '\',this)" style="width:' + (title.length * 5) + 'px;margin-left:' + (((title.length * -5) / 2) + 14) + 'px;">' + title + '</div>',
                                inputs: {
                                    input_1: {
                                        label: 'I-MAP',
                                        multipleLinks: true
                                    }
                                },
                                outputs: {
                                    output_1: {
                                        label: 'O-MAP',

                                    }
                                }
                            }
                        };
                        var operatorId = $flowchart.flowchart('addOperator', data);
                        $(".flowchart-operator-connector-label").hide();
                        $(".flowchart-operator-title").hide();
                        top = top + 70;
                        var component = $(this).attr("component");
                        if (component != "Y") {
                            inputOutPutPopUp(operatorId);
                        }
                    }
                }
            });
            stopLoader();
        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });


}
//function loadOnScrollDown(event) {
//    showLoader();
//    var divId = $(event.target).attr("id");
//    // filter issue
//    var filterDivId = divId.replace("div-", "filter-");
//    var filterValue = $("#" + filterDivId).val();
//    if (filterValue != null && filterValue != "") {
//        filterValue = "%" + filterValue + "%";
//    }
//    // filter issue
//    var value = divId.split("-")[1];
//    var parentkey = divId.split("-")[2].toUpperCase();
//    ;
//    var level = '4';
//    var arr = $("[id='" + divId + "']").find(".visionObjectNameDiv");
//
//    var startIndex = arr.length + 1;
//    var endIndex = arr.length + parseInt($("#treePageSize").val());
//    var connectionObj;
//    var tableListHtml = '';
//
//    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//    {
//        var conObj = savedDBData[value];
//        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//            connectionObj = conObj;
//        }
//
//    }
//    var item = $("#savedConnections").jqxTree('getSelectedItem');
//    var url = 'getTreePagingDataOpt';
//    if (item != null)
//    {
//        var level = item['level'];
//        var parentEventItem = item['parentElement'];
//        for (var i = level; i > 0; i--)
//        {
//            parentEventItem = parentEventItem['parentElement'];
//        }
//        var selectedItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
//        var selectedParentValue = selectedItem['value'];
//        if (selectedParentValue != null && selectedParentValue != ''
//                && selectedParentValue != undefined && selectedParentValue == 'ERP')
//        {
//            url = 'getTreeErpConnectionDetails';
//        }
//    }
//    var columnsObj = globalTreeObj['treeColumnObj'];
//    var extTreeParams = $("#extTreeParams").val();
//    var data = {
//        parentkey: parentkey,
//        treeId: globalTreeObj['treeId'],
//        level: level,
//        filterValue: filterValue,
//        filterCondition: "LIKE",
//        extTreeParams: extTreeParams,
//        columnsObj: JSON.stringify(columnsObj),
//        connectionObj: JSON.stringify(connectionObj),
//        startIndex: startIndex,
//        endIndex: endIndex
//    };
//
//    $.ajax({
//        type: "post",
//        traditional: true,
//        dataType: 'json',
//        url: url,
//        cache: false,
//        data: data,
//        success: function (data, status, xhr) {
//
//            $.each(data, function (index) {
//                if (this.label == "Show More...") {
//
//                } else {
//                    tableListHtml += '<div title=' + connectionObj['CONNECTION_NAME'] + ' . ' + this.label + ' class = "visionObjectNameDiv">\n\
//                                     <img class="visionTableIcon" src="images/GridDB.png"/><span> ' + this.label + '</span></div>'
//                }
//            });
//            $("#" + divId + "-div").append(tableListHtml);
//
//
//            $("div.visionObjectNameDiv").draggable({
//                cursor: "move",
//                opacity: 0.7,
//                helper: 'clone',
////                                appendTo: 'body',
//                zIndex: 1000,
//                helper: function (event, ui) {
//                    var $this = $(this);
//                    var innerText = $this.text();
//                    var title = innerText;
//                    var descripttion = $this.attr("title");
//                    var value = this.parentElement.id.split("-")[1];
//                    var connectionObj;
//                    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//                    {
//                        var conObj = savedDBData[value];
//                        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//                            connectionObj = conObj;
//                        }
//
//                    }
//
//                    var operatorData = {
//                        top: event.screenX,
//                        left: event.screenY,
//                        statusLebel: innerText.trim(),
//                        tableName: innerText.trim(),
//                        dragType: "Table",
//                        connObj: connectionObj,
//                        properties: {
//                            //body: '<div title="' + innerText + '" class="visionOpLabelDiv">' + innerText + '</div>',
//
//                            body: '<div  title="' + title + '" class=""><div><img src="images/GridDB.png"\n\
//                            class="visionOpIcons"  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv">' + title + '</div></div>',
//                            inputs: {
//                                input_1: {
//                                    label: '',
//                                    multipleLinks: true
//                                }
//                            },
//                            outputs: {
//                                output_1: {
//                                    label: '',
//
//                                }
//                            }
//                        }
//                    };
////            var obj = $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
//                    return  $('#'+flowChartWorkSpaceId).flowchart('getOperatorElement', operatorData);
//                },
//                stop: function (e, ui) {
//                    $(".flowchart-operator-connector-label").hide();
//                    var $flowchart = $('#'+flowChartWorkSpaceId);
//                    var $container = $('#'+flowChartWorkSpaceId);
//                    // ravi start
//                    trfmRulesChanged = true;
//                    // ravi end
//                    var $this = $(this);
//                    var innerText = this.innerText;
//                    var title = innerText;
//                    var value = this.parentElement.id.split("-")[1];
//                    var connectionObj;
//                    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//                    {
//                        var conObj = savedDBData[value];
//                        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//                            connectionObj = conObj;
//                        }
//
//                    }
//
//
//                    var elOffset = ui.offset;
//                    var containerOffset = $container.offset();
//                    if (elOffset.left > containerOffset.left &&
//                            elOffset.top > containerOffset.top &&
//                            elOffset.left < containerOffset.left + $container.width() &&
//                            elOffset.top < containerOffset.top + $container.height()) {
//                        var flowchartOffset = $flowchart.offset();
//                        var relativeLeft = elOffset.left - flowchartOffset.left;
//                        var relativeTop = elOffset.top - flowchartOffset.top;
//                        var positionRatio = $flowchart.flowchart('getPositionRatio');
//                        relativeLeft /= positionRatio;
//                        relativeTop /= positionRatio;
//                        elOffset.left = relativeLeft;
//                        elOffset.top = relativeTop;
//                    }
////            var divId = "mapDivId_" + 0;
////            if ($("#" + divId).length == 0) {
////                //it doesn't exist
////            }else{
////                
////            }
//                    //mapDivId:'',
//                    var data = {
//                        top: elOffset.top,
//                        left: elOffset.left,
//                        statusLebel: innerText.trim(),
//                        tableName: connectionObj['CONN_USER_NAME'] + "." + innerText.trim(),
//                        dragType: "Table",
//                        CONNECTION_NAME: connectionObj['CONNECTION_NAME'], //CONNECTION_NAME
//                        CONN_DB_NAME: connectionObj['CONN_DB_NAME'], //CONN_DB_NAME
//                        CONN_CUST_COL1: connectionObj['CONN_CUST_COL1'], //CONN_CUST_COL1
//                        connObj: connectionObj,
////                statusLebel: innerText,
//                        properties: {
//
////                                title: innerText,
//                            //  body: '<div  title="' + title + '"  class="visionOpLabelDiv">' + innerText + '</div>',
//                            body: '<div  title="' + connectionObj['CONNECTION_NAME'] + ' . ' + title + '" class=""><div title="Double Click here to view the Transformations rules(' + connectionObj['CONNECTION_NAME'] + '.' + title + ')" style="cursor:pointer"><img src="images/GridDB.png"'
//                                    + 'class="visionOpIcons"  ondblclick=viewTrfmRules()  style="width:18px;height: 18px;"/></div><div class="visionOpLabelDiv">' + title + '</div>'
//
//                                    + '</div>',
//                            inputs: {
//                                input_1: {
//                                    label: 'I-MAP',
//                                    multipleLinks: true
//                                }
//                            },
//                            outputs: {
//                                output_1: {
//                                    label: 'O-MAP',
//
//                                }
//                            }
//                        }
//                    };
//                    $flowchart.flowchart('addOperator', data);
//                    $(".flowchart-operator-connector-label").hide();
//                    $(".flowchart-operator-title").hide();
//                }
//            });
//            stopLoader();
//        },
//        error: function (e) {
//            console.log(e);
//            sessionTimeout(e);
//            stopLoader();
//        }
//    });
//
//
//}

function viewTableData(DBValue, parentkey, connectionObj) {

//    var DBValue;
    var tableName;
    var connName;
//    var parentkey;
    var extTreeParams = $("#extTreeParams").val();
    var columnsObj = globalTreeObj['treeColumnObj'];
    var target = $("#jqxtabs").find(".visionSelectedObject")[0];
    if (!(parentkey != null && parentkey != '' && DBValue != null && DBValue != '')) {
        if (target != null) {
            tableName = target.textContent.trim();
            var div = $(target).parents('div.visionObjectsListDiv')[0];
            var divId = div.id;

            parentkey = target.textContent.trim().toUpperCase();

            DBValue = divId.split("-")[1];
            var liItems = $("#savedConnections").find("li :contains('" + DBValue + "')");
            $.each(liItems, function (index) {
                var liItem = $('#savedConnections').jqxTree('getItem', this);
                if (liItem != null && liItem.level == 3 && liItem.value == DBValue) {

                    var connItem = this.parentElement.parentElement;
                    var selectedConnItem = $('#savedConnections').jqxTree('getItem', connItem);
                    if (selectedConnItem != null && selectedConnItem.level == 2) {
                        connName = selectedConnItem.value;
                    }
                    stopLoader();
                    return false;
                }

            })

            // var selectedDBItem = $('#savedConnections').jqxTree('getItem', dbItem);
            //DBValue = selectedDBItem['value'];

//        var connItem = dbItem.parentElement.parentElement;
//        var selectedConnItem = $('#savedConnections').jqxTree('getItem', connItem);
//        if (selectedConnItem.level==2){
//             connName = selectedConnItem.value;
//        }

//            tableName = target.textContent.trim();
//            var div = $(target).parents('div.visionObjectsListDiv')[0];
//            var divId = div.id;
//
//            parentkey = target.textContent.trim().toUpperCase();
//
//            DBValue = divId.split("-")[1];
        } else {
            var parentItem = $('#savedConnections').jqxTree('getSelectedItem');
            tableName = parentItem.label;
            parentkey = parentItem.value
            var $element = $(parentItem.element);

            var dbItem = parentItem.element.parentElement.parentElement.parentElement.parentElement;

            //var dbItemvalue = parentItem.element.parentElement.parentElement.parentElement.parentElement.children[2].title;

            var selectedDBItem = $('#savedConnections').jqxTree('getItem', dbItem);
            DBValue = selectedDBItem['value'];

            var connItem = dbItem.parentElement.parentElement;
            var selectedConnItem = $('#savedConnections').jqxTree('getItem', connItem);
            if (selectedConnItem.level == 2) {
                connName = selectedConnItem.value;
            }

//            var parentItem = $('#savedConnections').jqxTree('getSelectedItem');
//            tableName = parentItem.label;
//            parentkey = parentItem.value
//            var $element = $(parentItem.element);
//
//            var dbItem = parentItem.element.parentElement.parentElement.parentElement.parentElement
//            //var dbItemvalue = parentItem.element.parentElement.parentElement.parentElement.parentElement.children[2].title;
//
//            var selectedDBItem = $('#savedConnections').jqxTree('getItem', dbItem);
//            DBValue = selectedDBItem['value'];
        }
    }

    if (!(tableName != null && tableName != '')) {
        tableName = parentkey;
    }



    var contentDivId = ("divGrid-" + DBValue + "-" + tableName).replace(/\s/g, '');
    var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');
    if (selectedItemIndex != null) {
        var html = $('#dataViewDiv').html();
        if (html.indexOf('"' + contentDivId + '"') > -1
                || html.indexOf('"' + contentDivId.replace(/\//g, '') + '"') > -1) {
            var length = $('#dataViewDiv').jqxTabs('length');
            for (var i = 0; i < length; i++) {
                var content = $('#dataViewDiv').jqxTabs('getContentAt', i);
                var id = $(content).children('div:nth-child(3)').attr("id");
                if (id == null) {
                    id = $(content).children('div:first').children('div:nth-child(3)').attr("id");
                }
                if (id == contentDivId || id == contentDivId.replace(/\//g, '')) {

                    switchETLDesignTabs("li_contentView", "dataViewDiv");

                    $('#dataViewDiv').jqxTabs('select', i);
                    if (connName == "SAP") {
                        $('#dataViewDiv').jqxTabs('removeAt', i);

                    }


                    break;

                }

            }
            if (connName == "SAP") {
            } else {
                return false;
            }

        }

    }
//    if (selectedItemIndex != null) {
//        var html = $('#dataViewDiv').html();
//        if (html.indexOf(contentDivId) > -1
//                || html.indexOf('"' + contentDivId.replace(/\//g, '') + '"') > -1) {
//            var length = $('#dataViewDiv').jqxTabs('length');
//            for (var i = 0; i < length; i++) {
//                var content = $('#dataViewDiv').jqxTabs('getContentAt', i);
//                var id = $(content).children('div:nth-child(3)').attr("id");
//                if (id == null) {
//                    id = $(content).children('div:first').children('div:nth-child(3)').attr("id");
//                }
//                if (id == contentDivId || id == contentDivId.replace(/\//g, '')) {
//                    switchETLDesignTabs("li_contentView", "dataViewDiv");
//                    $('#dataViewDiv').jqxTabs('select', i);
//                    break;
//                }
//            }
//            return false;
//        }
//
//    }
//    if (selectedItemIndex != null) {
//        var html = $('#dataViewDiv').html();
//        if (html.indexOf(contentDivId) > -1
//                || html.indexOf('"' + contentDivId.replace(/\//g, '') + '"') > -1) {
//            var length = $('#dataViewDiv').jqxTabs('length');
//            for (var i = 0; i < length; i++) {
//                var content = $('#dataViewDiv').jqxTabs('getContentAt', i);
//                var id = $(content).attr("id");
//                if (id == null) {
//                    id = $(content).children('div:first').attr("id");
//                }
//                if (id == contentDivId || id == contentDivId.replace(/\//g, '')) {
//                    switchETLDesignTabs("li_contentView", "dataViewDiv");
//                    $('#dataViewDiv').jqxTabs('select', i);
//                    break;
//                }
//            }
//            return false;
//        }
//
//    }


    if (connectionObj == null || connectionObj == 'undefined') {
        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
        {
            var conObj = savedDBData[DBValue];
            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                connectionObj = conObj;
            }

        }
    }

//    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
//    {
//        var conObj = savedDBData[DBValue];
//        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
//            connectionObj = conObj;
//        }
//
//    }

    var data = {
        parentkey: parentkey,
        treeId: globalTreeObj['treeId'],
        level: '5',
        extTreeParams: extTreeParams,
        columnsObj: JSON.stringify(columnsObj),
        connectionObj: JSON.stringify(connectionObj),
        startIndex: 0,
        endIndex: $("#treePageSize").val(),
        DBValue: DBValue,
        tableName: tableName
    };

//    var data = {
//        parentkey: parentkey,
//        treeId: globalTreeObj['treeId'],
//        level: '5',
//        extTreeParams: extTreeParams,
//        columnsObj: JSON.stringify(columnsObj),
//        connectionObj: JSON.stringify(connectionObj),
//        startIndex: 0,
//        endIndex: $("#treePageSize").val(),
//         tableName:tableName
//    };
    if (connName == null) { // ----------------ravi sap issue
        connName = connectionObj['CONN_CUST_COL1'];
    }
//    if (connName == "SAP") {
//        selectSapTableColumns(data);
//    } else {
//        viewTableDataGrid(data);
//    }
    viewTableDataGrid(data);
//    $.ajax({
//        type: "post",
//        traditional: true,
//        dataType: 'json',
//        url: 'getSchemaObjectMetaData',
//        cache: false,
//        data: data,
//
//        success: function (response) {
//            stopLoader();
//            if (response != null) {
//                // var responseObj = JSON.parse(response);
//                var dataArray = response['dataArray'];
//                var dataFieldsArray = response['dataFieldsArray'];
//                var columnsArray = response['columnsArray'];
//                var totalCount = response['totalCount'];
//                var gridId = ("divGrid-" + DBValue + "-" + tableName).replace(/\s/g, '');
//                gridId = gridId.replace(/\//g, '');
//                var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');
//                if (selectedItemIndex == null) {
//
//                    //$("#designViewTab").jqxTabs('select', 1);
//                    switchETLDesignTabs("li_contentView", "dataViewDiv");
//                    $("#dataViewDiv").prepend("<ul></ul>");
//                    $("#dataViewDiv ul").prepend("<li title='" + DBValue + "." + tableName + "'>" + tableName + "</li>");
//                    $("#dataViewDiv").append("<div id='" + gridId + "'></div>");
//                    $('#dataViewDiv').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
//
//                    $('#dataViewDiv').jqxTabs('showAllCloseButtons');
//                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
//                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
//
//
//
//                } else {
//                    switchETLDesignTabs("li_contentView", "dataViewDiv");
//                    $('#dataViewDiv').jqxTabs('addLast', DBValue + "." + tableName, '<div id="' + gridId + '"></div>');
//                }
//
//
//                var source =
//                        {
//                            type: 'POST',
////                                                async: false,
//                            datatype: "json",
//                            datafields: dataFieldsArray,
//                            data: data,
//                            url: 'getSchemaObjectData',
//                            cache: false,
//                            root: 'Rows',
//                            processdata: function (data) {
//                                data['getOnlyDataArray'] = 'Y';
//
//                            },
//                            beforeSend: function () {
//
//
//                            }, loadError: function (xhr, status, error) {
//                                $('#dataViewDiv').css("width", "102%");
//                            }, loadComplete: function (data)
//                            {
//                                $('#dataViewDiv').css("width", "102%");
//                                //$("#div_" + tableName).jqxGrid('hiderowdetails', 0);
//                                //$("#row0div_" + tableName).hide();
//
//                            },
//                            beforeprocessing: function (data) {
//
//                                source.totalrecords = data[data.length - 1];
//
//                            },
//                            sort: function ()
//                            {
////                                                $("#" + gridResultObj['gridId'] + "_sort_columns").remove();
//                                $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'sort');
//                                try {
//                                    $("[id='" + gridId + "']").jqxGrid('clearselection');
//                                } catch (e) {
//                                }
//                                endTabLoader();
//                            },
//                            filter: function () {
//
//                                $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'filter');
//                                try {
//                                    $("[id='" + gridId + "']").jqxGrid('clearselection');
//                                } catch (e) {
//                                }
//                                endTabLoader();
//                            }
//
//
//                        };
////                var source =
////                        {
////                            localdata: dataArray,
////                            datatype: "array",
////                            datafields: dataFieldsArray
////                        };
//                var dataAdapter = new $.jqx.dataAdapter(source);
//
//                $("[id='" + gridId + "']").jqxGrid(
//                        {
//                            width: "100%",
//                            height: "90%",
//                            theme: 'energyblue',
//                            autoshowloadelement: false,
//                            source: dataAdapter,
//                            pageable: true,
//                            pagesize: 50,
//                            showfilterrow: true,
//                            filterable: true,
//                            sortable: true,
//                            virtualmode: true,
//                            pagesizeoptions: ['50', '100', '500'],
//                            rendergridrows: function (params) {
//                                return params.data;
//                            },
//                            columnsresize: true,
//                            columns: columnsArray
//                        });
//
//
//
//
//
//                $('#dataViewDiv').unbind('selected').on('selected', function (event) {
//                    var $thid = this;
//
//                    $('#dataViewDiv').jqxTabs('getContentAt', i);
//
//                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
//                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
//
//                });
//
//                $('#dataViewDiv').unbind('add').on('add', function (event) {
//
//                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
////                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
//                    setTimeout(function () {
//                        $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
//
//                    }, 100);
//                    var selectedTabTitle = $("#dataViewDiv").jqxTabs("getTitleAt", event.args.item);
//                    $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle.split(".")[1]);
//                    var selectedTabLi = $("#dataViewDiv").find("li.jqx-tabs-title-selected-top");
//                    selectedTabLi.attr("title", selectedTabTitle);
//
//
//                });
//
//
//
//            }
//        },
//        error: function (e)
//        {
//            sessionTimeout(e);
//        }
//
//    });
}

function switchETLDesignTabs(liId, divId) {

    $("#" + liId).parent().find('li.visionETLDesignTabHighLight').removeClass('visionETLDesignTabHighLight');
    $("#" + liId).addClass('visionETLDesignTabHighLight');
    $("#dataModellerDiv").hide();
    $("#contentSplitter").hide();
    $("#dataViewDiv").hide();
    $("#editorViewDiv").hide();
    $("#jobSchedulingViewDiv").hide();
    $("#cubeRelatedICONS").hide();

    $("#childJobDiv").hide();

    $("#availableMapTools").show();


    $("#" + divId).show();
    if (liId == 'li_SQLEditor') {
        $("#scriptsExecuteIcon").show();
        $("#showComponents").hide();
        $("#etlIconGroup").hide();

    } else {
        $("#scriptsExecuteIcon").hide();
        $("#showComponents").show();
    }
    if (liId == 'li_JobScheduling') {
        loadScheduledJobs();
    }
    if (liId == 'li_DataModeller') {

        $("#availableMapTools").hide();
        $("#cubeRelatedICONS").show();
    }
    if (liId == 'li_ChildJob') {
        $("#availableMapTools").hide();
    }
}

//function switchETLDesignTabs(liId, divId) {
//    $("#" + liId).parent().find('li.visionETLDesignTabHighLight').removeClass('visionETLDesignTabHighLight');
//    $("#" + liId).addClass('visionETLDesignTabHighLight');
//    $("#contentSplitter").hide();
//    $("#dataViewDiv").hide();
//    $("#editorViewDiv").hide();
//    $("#jobSchedulingViewDiv").hide();
//    $("#" + divId).show();
//    if (liId == 'li_SQLEditor') {
//        $("#scriptsExecute").show();
//    } else {
//        $("#scriptsExecute").hide();
//    }
//    if (liId == 'li_JobScheduling') {
//        loadScheduledJobs();
//    }
//}
function searchTreeNode(treeId) {

    $('#' + treeId).jqxTree('collapseAll');
    var items = $('#' + treeId).jqxTree("getItems");
    var searchedValue = $("#treeSearchValue").val();
    if (searchedValue != null && searchedValue != '') {
        $("#searchTreeErrorMesg").hide();
        searchedValue = searchedValue.toUpperCase();
        var itemFound = false;
        for (var i = 0; i < items.length; i++) {
            //.toLowerCase().indexOf(searchedValue)
            if (items[i].level != 0) { // ravi colums search issue
//                var treeNodeValue = items[i].value;
                var treeNodeValue = items[i].label;// ravi colums search issue
                if (treeNodeValue != null && treeNodeValue != '') {
                    treeNodeValue = treeNodeValue.toUpperCase();

                    if (treeNodeValue.indexOf(searchedValue) > -1) {
                        if (!($(items[i].element).hasClass("searched"))) {
                            itemFound = true;
                            $(items[i].element).addClass("searched");
                            $('#' + treeId).jqxTree('expandItem', items[i].parentElement);
                            $('#' + treeId).jqxTree('selectItem', items[i]);
                            var elementTop = items[i].element['offsetTop'];
                            $("#" + treeId).animate({
                                scrollTop: parseInt(elementTop) - 100
                            });
                            break;
                        }
                    }
                }
            }
        }
        if (!itemFound) {
            $('#' + treeId + ' li').removeClass("searched");
        }
    } else {
        $("#searchTreeErrorMesg").html("Please provide value to search in tree");
        $("#searchTreeErrorMesg").show();
    }

}
function downloadExportedFile(fileName, orginalName) {
    $("#fileName").val(fileName);
    $("#orginalName").val(orginalName);
    $("#exportFinalData").submit();
}

function selectColumnFun($this, tableColType) {
    showLoader();
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    //dddw
    // prepare the data
    var data = [];
    var dataStr = $("#functionNameObj").val();
    if (dataStr != null && dataStr != '') {
        data = JSON.parse(dataStr);
        var source =
                {
                    dataType: "json",
                    dataFields: [
                        {name: "FUN_ID", type: "string"},
                        {name: "FUN_DISP_NAME", type: "string"},
                        {name: "FUN_DESCR", type: "string"},
                        {name: "FUN_NAME", type: "string"},
                        {name: "HL_FUN_ID", type: "string"},
                        {name: "FUN_FORM_ID", type: "string"},
                        {name: "FUN_LVL_TYPE", type: "string"},
                        {name: "DM_FUN_CUST_COL1", type: "string"},
                        {name: "DM_FUN_CUST_COL2", type: "string"},
                        {name: "ICON_PATH", type: "string"}
                    ],
                    hierarchy:
                            {
                                keyDataField: {name: 'FUN_ID'},
                                parentDataField: {name: 'HL_FUN_ID'}
                            },
                    id: 'FUN_ID',
                    localData: data
                };

        var dataAdapter = new $.jqx.dataAdapter(source);
        // create jqxTreeGrid.

        $("#columnMappingDialog").html("<div id='visionEtlColFuncText'></div><div id='columnMappingTree' class='columnMappingTree'></div>");
        $("#columnMappingDialog").dialog({
            title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
            modal: true,
            width: 400,
            maxWidth: 1000,
            height: 400,
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
                        if (selection != null && selection.length != 0) {
                            var selectedRowData = selection[0];
                            if (selectedRowData != null
                                    && !jQuery.isEmptyObject(selectedRowData)
                                    && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                var source = $("#columnMappingTree").jqxTreeGrid('source');
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                                openFunctionForm(selection[0], source, $this, tableColType);
                            }
                        } else
                        {
                            var textAreaVal = $("#visionEtlColFuncTextId").val();
                            if (textAreaVal != null && textAreaVal != '' && textAreaVal != undefined)
                            {
                                var input = $($this).parents("td").find("input");//uttej
                                input.val(textAreaVal);
                                $($this).parents("td").find("input").attr("title", textAreaVal);

                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }
                        }
                    }

                }],
            open: function () {
                $("#columnMappingTree").jqxTreeGrid(
                        {
                            source: dataAdapter,
                            width: "100%",
                            height: 300,
                            sortable: true,
                            columnsResize: true,
                            columnsReorder: true,
                            enableHover: true,
                            enableBrowserSelection: true,
                            filterable: true,
//                            filterMode: 'simple',
//                        hierarchicalCheckboxes: true,
                            pageable: true,
                            pagerMode: 'advanced',
                            pagerPosition: 'bottom',
                            pageSize: 100,
                            pageSizeOptions: ['100', '200', '300'],
                            theme: 'energyblue',
                            selectionMode: 'singleRow',
                            autoShowLoadElement: false,
                            columns: [
                                {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
                                {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
                                {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
                                {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
                                {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
                                {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
                                {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
                                {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
                                {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
                                {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
                            ]
                        });
                $('#columnMappingTree').on('rowDoubleClick', function (event) {
                    var args = event.args;
                    var selectedRowData = args.row;
                    if (selectedRowData != null
                            && !jQuery.isEmptyObject(selectedRowData)
                            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                        var source = $("#columnMappingTree").jqxTreeGrid('source');
                        $("#columnMappingDialog").html("");
                        $("#columnMappingDialog").dialog("close");
                        $("#columnMappingDialog").dialog("destroy");
                        openFunctionForm(selectedRowData, source, $this, tableColType);
                    }


                });

                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $(".ui-dialog").addClass('visionDMTreePopup');

                stopLoader();
            },
            beforeClose: function (event, ui)
            {

                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");

            }, close: function (event, ui)
            {

                $(this).html("");
                try {
                    $("#columnMappingTree").jqxTreeGrid('destroy');
                    $("#columnMappingTree").remove();
                    $("#treeSearchInputDiv").remove();

                } catch (e) {
                }

            }

        });
        var textStr = "<textarea class='visionEtlColFuncTextClass' id='visionEtlColFuncTextId' rows='5' cols='50'></textarea>";
        $("#visionEtlColFuncText").html(textStr);
        var input = $($this).parents("td").find("input");
        var textVal = input.val();
        $("#visionEtlColFuncTextId").val(textVal);


    } else {
        $.ajax({
            type: "post",
            traditional: true,
            url: 'getETLDBFunction',
            cache: false,
            data: {
                selectedRowData: JSON.stringify(selectedRowData)
            },
            success: function (response, status, xhr) {
                //columnMappingFormDialog
                if (response != null && response != '') {
                    stopLoader();
                    $("#functionNameObj").val(response);
                    data = JSON.parse(response);
                    var source =
                            {
                                dataType: "json",
                                dataFields: [
                                    {name: "FUN_ID", type: "string"},
                                    {name: "FUN_DISP_NAME", type: "string"},
                                    {name: "FUN_DESCR", type: "string"},
                                    {name: "FUN_NAME", type: "string"},
                                    {name: "HL_FUN_ID", type: "string"},
                                    {name: "FUN_FORM_ID", type: "string"},
                                    {name: "FUN_LVL_TYPE", type: "string"},
                                    {name: "DM_FUN_CUST_COL1", type: "string"},
                                    {name: "DM_FUN_CUST_COL2", type: "string"},
                                    {name: "ICON_PATH", type: "string"}
                                ],
                                hierarchy:
                                        {
                                            keyDataField: {name: 'FUN_ID'},
                                            parentDataField: {name: 'HL_FUN_ID'}
                                        },
                                id: 'FUN_ID',
                                localData: data
                            };

                    var dataAdapter = new $.jqx.dataAdapter(source);
                    // create jqxTreeGrid.

                    $("#columnMappingDialog").html("<div id='visionEtlColFuncText'></div><div id='columnMappingTree' class='columnMappingTree'></div>");
                    $("#columnMappingDialog").dialog({
                        title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
                        modal: true,
                        width: 400,
                        maxWidth: 1000,
                        height: 400,
                        fluid: true,
                        buttons: [{
                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                click: function () {
                                    var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
                                    if (selection != null && selection.length != 0) {
                                        var selectedRowData = selection[0];
                                        if (selectedRowData != null
                                                && !jQuery.isEmptyObject(selectedRowData)
                                                && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                            var source = $("#columnMappingTree").jqxTreeGrid('source');
                                            $(this).html("");
                                            $(this).dialog("close");
                                            $(this).dialog("destroy");
                                            openFunctionForm(selection[0], source, $this, tableColType);
                                        }
                                    } else
                                    {
                                        var textAreaVal = $("#visionEtlColFuncTextId").val();
                                        if (textAreaVal != null && textAreaVal != '' && textAreaVal != undefined)
                                        {
                                            var id = $($this).parents("td").find("input").attr("id");
                                            $("#" + id).val(textAreaVal);
                                            $(this).html("");
                                            $(this).dialog("close");
                                            $(this).dialog("destroy");
                                        }
                                    }
                                }

                            }],
                        open: function () {
                            $("#columnMappingTree").jqxTreeGrid(
                                    {
                                        source: dataAdapter,
                                        width: "100%",
                                        height: 300,
                                        sortable: true,
                                        columnsResize: true,
                                        columnsReorder: true,
                                        enableHover: true,
                                        enableBrowserSelection: true,
                                        filterable: true,
//                            filterMode: 'simple',
//                        hierarchicalCheckboxes: true,
                                        pageable: true,
                                        pagerMode: 'advanced',
                                        pagerPosition: 'bottom',
                                        pageSize: 100,
                                        pageSizeOptions: ['100', '200', '300'],
                                        theme: 'energyblue',
                                        selectionMode: 'singleRow',
                                        autoShowLoadElement: false,
                                        columns: [
                                            {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
                                            {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
                                            {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
                                            {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
                                            {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
                                            {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
                                            {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
                                            {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
                                            {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
                                            {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
                                        ]
                                    });
                            $('#columnMappingTree').on('rowDoubleClick', function (event) {
                                var args = event.args;
                                var selectedRowData = args.row;
                                var source = $("#columnMappingTree").jqxTreeGrid('source');
                                if (selectedRowData != null
                                        && !jQuery.isEmptyObject(selectedRowData)
                                        && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                    $("#columnMappingDialog").html("");
                                    $("#columnMappingDialog").dialog("close");
                                    $("#columnMappingDialog").dialog("destroy");
                                    openFunctionForm(selectedRowData, source, $this, tableColType);
                                }



                            });

                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                            $(".visionHeaderMain").css("z-index", "999");
                            $(".visionFooterMain").css("z-index", "999");
                            $(".ui-dialog").addClass('visionDMTreePopup');

                            stopLoader();
                        },
                        beforeClose: function (event, ui)
                        {

                            $(".visionHeaderMain").css("z-index", "99999");
                            $(".visionFooterMain").css("z-index", "99999");

                        }, close: function (event, ui)
                        {

                            $(this).html("");
                            try {
                                $("#columnMappingTree").jqxTreeGrid('destroy');
                                $("#columnMappingTree").remove();
                                $("#treeSearchInputDiv").remove();

                            } catch (e) {
                            }

                        }

                    });
                    var textStr = "<textarea class='visionEtlColFuncTextClass' id='visionEtlColFuncTextId' rows='5' cols='50'></textarea>";
                    $("#visionEtlColFuncText").html(textStr);
                    var input = $($this).parents("td").find("input");
                    var textVal = input.val();
                    $("#visionEtlColFuncTextId").val(textVal);
                    $("#visionEtlColFuncTextId").val(textVal);
                }


            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    }



}

//function selectColumnFun($this, tableColType) {
//    showLoader();
//    labelObject = {};
//    try {
//        labelObject = JSON.parse($("#labelObjectHidden").val());
//    } catch (e) {
//
//    }
//    //dddw
//    // prepare the data
//    var data = [];
//    var dataStr = $("#functionNameObj").val();
//    if (dataStr != null && dataStr != '') {
//        data = JSON.parse(dataStr);
//        var source =
//                {
//                    dataType: "json",
//                    dataFields: [
//                        {name: "FUN_ID", type: "string"},
//                        {name: "FUN_DISP_NAME", type: "string"},
//                        {name: "FUN_DESCR", type: "string"},
//                        {name: "FUN_NAME", type: "string"},
//                        {name: "HL_FUN_ID", type: "string"},
//                        {name: "FUN_FORM_ID", type: "string"},
//                        {name: "FUN_LVL_TYPE", type: "string"},
//                        {name: "DM_FUN_CUST_COL1", type: "string"},
//                        {name: "DM_FUN_CUST_COL2", type: "string"},
//                        {name: "ICON_PATH", type: "string"}
//                    ],
//                    hierarchy:
//                            {
//                                keyDataField: {name: 'FUN_ID'},
//                                parentDataField: {name: 'HL_FUN_ID'}
//                            },
//                    id: 'FUN_ID',
//                    localData: data
//                };
//
//        var dataAdapter = new $.jqx.dataAdapter(source);
//        // create jqxTreeGrid.
//
//        $("#columnMappingDialog").html("<div id='columnMappingTree' class='columnMappingTree'></div>");
//        $("#columnMappingDialog").dialog({
//            title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
//            modal: true,
//            width: 400,
//            maxWidth: 1000,
//            height: 400,
//            fluid: true,
//            buttons: [{
//                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
//                    click: function () {
//                        var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
//                        if (selection != null && selection.length != 0) {
//                            var selectedRowData = selection[0];
//                            if (selectedRowData != null
//                                    && !jQuery.isEmptyObject(selectedRowData)
//                                    && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
//                                var source = $("#columnMappingTree").jqxTreeGrid('source');
//                                $(this).html("");
//                                $(this).dialog("close");
//                                $(this).dialog("destroy");
//                                openFunctionForm(selection[0], source, $this);
//                            }
//                        }
//
////                    var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                    if (selectedItem != null) {
////                        $($this).parents("td").find("input").val(selectedItem['value']);
////                        $($this).parents("td").find("input").attr("title", selectedItem['value']);
//////                       $($this).parent.find("input").val(selectedItem['value']); 
////                    }
//
//
//                    }
//
//                }],
//            open: function () {
//                $("#columnMappingTree").jqxTreeGrid(
//                        {
//                            source: dataAdapter,
//                            width: "100%",
//                            height: 300,
//                            sortable: true,
//                            columnsResize: true,
//                            columnsReorder: true,
//                            enableHover: true,
//                            enableBrowserSelection: true,
//                            filterable: true,
////                            filterMode: 'simple',
////                        hierarchicalCheckboxes: true,
//                            pageable: true,
//                            pagerMode: 'advanced',
//                            pagerPosition: 'bottom',
//                            pageSize: 100,
//                            pageSizeOptions: ['100', '200', '300'],
//                            theme: 'energyblue',
//                            selectionMode: 'singleRow',
//                            autoShowLoadElement: false,
//                            columns: [
//                                {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
//                                {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
//                                {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
//                                {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
//                                {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
//                                {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
//                                {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
//                                {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
//                                {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
//                                {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
//                            ]
//                        });
//                $('#columnMappingTree').on('rowDoubleClick', function (event) {
//                    var args = event.args;
//                    var selectedRowData = args.row;
//                    if (selectedRowData != null
//                            && !jQuery.isEmptyObject(selectedRowData)
//                            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
//                        var source = $("#columnMappingTree").jqxTreeGrid('source');
//                        $("#columnMappingDialog").html("");
//                        $("#columnMappingDialog").dialog("close");
//                        $("#columnMappingDialog").dialog("destroy");
//                        openFunctionForm(selectedRowData, source, $this);
//                    }
//
//
//                });
////            $("#treeSearchValue").keyup(function (event) {
////                if (event.keyCode === 13) {
////                    // Cancel the default action, if needed
//////            event.preventDefault();
////                    $("#treeNodeSearchIconId").click();
////                }
////            });
////            $('#columnMappingTree').jqxTree('expandItem', $("#columnMappingTree").find('li:first')[0]);
////            $("#columnMappingTree li").on('dblclick', function (event) {
////                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
////                    $($this).parents("td").find("input").val(selectedItem['value']);
////                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
////                    $("#columnMappingDialog").dialog("close");
////                    $("#columnMappingDialog").dialog("destroy");
////                }
////
////            });
//                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
//
//                $(".visionHeaderMain").css("z-index", "999");
//                $(".visionFooterMain").css("z-index", "999");
//                $(".ui-dialog").addClass('visionDMTreePopup');
//
//                stopLoader();
//            },
//            beforeClose: function (event, ui)
//            {
//
//                $(".visionHeaderMain").css("z-index", "99999");
//                $(".visionFooterMain").css("z-index", "99999");
//
//            }, close: function (event, ui)
//            {
//
//                $(this).html("");
//                try {
//                    $("#columnMappingTree").jqxTreeGrid('destroy');
//                    $("#columnMappingTree").remove();
//                    $("#treeSearchInputDiv").remove();
//
//                } catch (e) {
//                }
////            try {
////                $(this).dialog("destroy");
////            } catch (e) {
////            }
////                       
////                        
////                       
//            }
////        ,resizeStop: function(event, ui) {
////          
////          var width = ui.size.width;
////          var height = ui.size.height;
////          var orginalWidth = ui.originalSize.width;
////          var orginalHeight = ui.originalSize.height;
////            var treeHeight = $('#columnMappingTree').jqxTree('height');
////            if (!(treeHeight != null && treeHeight != '')) {
////                treeHeight = $('.columnMappingTree').height();
////            }
////            if (parseInt(width) < 300) {
////                width = 300;
////            }else{
////               width = parseInt(width)-10;
////            }
////            if (parseInt(height) <= 350) {
////                height = 300;
////                treeHeight = 180;
////            }else{
////                height = parseInt(height) - 130;
////                treeHeight = height;
////            }
////            var inputDivHeight = $("#treeSearchInputDiv").height();
//////            treeHeight = parseInt(treeHeight)-parseInt(inputDivHeight);
////            $('.columnMappingTree').height(treeHeight);
////            var treeWidth =   $('#columnMappingTree').jqxTree('width');
////            $('#columnMappingTree').jqxTree({width:parseInt(width)});
////            console.log("resizeStop");
////        }
////        , create: function (event, ui) {
////            $("#columnMappingTree li").on('dblclick', function (event) {
////                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
////                    $($this).parents("td").find("input").val(selectedItem['value']);
////                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
////                }
////                $(this).dialog("close");
////                $(this).dialog("destroy");
////            });
////        }
//        });
//
//    } else {
//        $.ajax({
//            type: "post",
//            traditional: true,
//            url: 'getETLDBFunction',
//            cache: false,
//            data: {
//                selectedRowData: JSON.stringify(selectedRowData)
//            },
//            success: function (response, status, xhr) {
//                //columnMappingFormDialog
//                if (response != null && response != '') {
//                    stopLoader();
//                    $("#functionNameObj").val(response);
//                    data = JSON.parse(response);
//                    var source =
//                            {
//                                dataType: "json",
//                                dataFields: [
//                                    {name: "FUN_ID", type: "string"},
//                                    {name: "FUN_DISP_NAME", type: "string"},
//                                    {name: "FUN_DESCR", type: "string"},
//                                    {name: "FUN_NAME", type: "string"},
//                                    {name: "HL_FUN_ID", type: "string"},
//                                    {name: "FUN_FORM_ID", type: "string"},
//                                    {name: "FUN_LVL_TYPE", type: "string"},
//                                    {name: "DM_FUN_CUST_COL1", type: "string"},
//                                    {name: "DM_FUN_CUST_COL2", type: "string"},
//                                    {name: "ICON_PATH", type: "string"}
//                                ],
//                                hierarchy:
//                                        {
//                                            keyDataField: {name: 'FUN_ID'},
//                                            parentDataField: {name: 'HL_FUN_ID'}
//                                        },
//                                id: 'FUN_ID',
//                                localData: data
//                            };
//
//                    var dataAdapter = new $.jqx.dataAdapter(source);
//                    // create jqxTreeGrid.
//
//                    $("#columnMappingDialog").html("<div id='columnMappingTree' class='columnMappingTree'></div>");
//                    $("#columnMappingDialog").dialog({
//                        title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
//                        modal: true,
//                        width: 400,
//                        maxWidth: 1000,
//                        height: 400,
//                        fluid: true,
//                        buttons: [{
//                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
//                                click: function () {
//                                    var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
//                                    if (selection != null && selection.length != 0) {
//                                        var selectedRowData = selection[0];
//                                        if (selectedRowData != null
//                                                && !jQuery.isEmptyObject(selectedRowData)
//                                                && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
//                                            var source = $("#columnMappingTree").jqxTreeGrid('source');
//                                            $(this).html("");
//                                            $(this).dialog("close");
//                                            $(this).dialog("destroy");
//                                            openFunctionForm(selection[0], source, $this);
//                                        }
//                                    }
//
////                    var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                    if (selectedItem != null) {
////                        $($this).parents("td").find("input").val(selectedItem['value']);
////                        $($this).parents("td").find("input").attr("title", selectedItem['value']);
//////                       $($this).parent.find("input").val(selectedItem['value']); 
////                    }
//
//
//                                }
//
//                            }],
//                        open: function () {
//                            $("#columnMappingTree").jqxTreeGrid(
//                                    {
//                                        source: dataAdapter,
//                                        width: "100%",
//                                        height: 300,
//                                        sortable: true,
//                                        columnsResize: true,
//                                        columnsReorder: true,
//                                        enableHover: true,
//                                        enableBrowserSelection: true,
//                                        filterable: true,
////                            filterMode: 'simple',
////                        hierarchicalCheckboxes: true,
//                                        pageable: true,
//                                        pagerMode: 'advanced',
//                                        pagerPosition: 'bottom',
//                                        pageSize: 100,
//                                        pageSizeOptions: ['100', '200', '300'],
//                                        theme: 'energyblue',
//                                        selectionMode: 'singleRow',
//                                        autoShowLoadElement: false,
//                                        columns: [
//                                            {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
//                                            {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
//                                            {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
//                                            {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
//                                            {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
//                                            {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
//                                            {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
//                                            {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
//                                            {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
//                                            {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
//                                        ]
//                                    });
//                            $('#columnMappingTree').on('rowDoubleClick', function (event) {
//                                var args = event.args;
//                                var selectedRowData = args.row;
//                                var source = $("#columnMappingTree").jqxTreeGrid('source');
//                                if (selectedRowData != null
//                                        && !jQuery.isEmptyObject(selectedRowData)
//                                        && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
//                                    $("#columnMappingDialog").html("");
//                                    $("#columnMappingDialog").dialog("close");
//                                    $("#columnMappingDialog").dialog("destroy");
//                                    openFunctionForm(selectedRowData, source, $this);
//                                }
//
//
//
//                            });
////            $("#treeSearchValue").keyup(function (event) {
////                if (event.keyCode === 13) {
////                    // Cancel the default action, if needed
//////            event.preventDefault();
////                    $("#treeNodeSearchIconId").click();
////                }
////            });
////            $('#columnMappingTree').jqxTree('expandItem', $("#columnMappingTree").find('li:first')[0]);
////            $("#columnMappingTree li").on('dblclick', function (event) {
////                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
////                    $($this).parents("td").find("input").val(selectedItem['value']);
////                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
////                    $("#columnMappingDialog").dialog("close");
////                    $("#columnMappingDialog").dialog("destroy");
////                }
////
////            });
//                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
//
//                            $(".visionHeaderMain").css("z-index", "999");
//                            $(".visionFooterMain").css("z-index", "999");
//                            $(".ui-dialog").addClass('visionDMTreePopup');
//
//                            stopLoader();
//                        },
//                        beforeClose: function (event, ui)
//                        {
//
//                            $(".visionHeaderMain").css("z-index", "99999");
//                            $(".visionFooterMain").css("z-index", "99999");
//
//                        }, close: function (event, ui)
//                        {
//
//                            $(this).html("");
//                            try {
//                                $("#columnMappingTree").jqxTreeGrid('destroy');
//                                $("#columnMappingTree").remove();
//                                $("#treeSearchInputDiv").remove();
//
//                            } catch (e) {
//                            }
////            try {
////                $(this).dialog("destroy");
////            } catch (e) {
////            }
////                       
////                        
////                       
//                        }
////        ,resizeStop: function(event, ui) {
////          
////          var width = ui.size.width;
////          var height = ui.size.height;
////          var orginalWidth = ui.originalSize.width;
////          var orginalHeight = ui.originalSize.height;
////            var treeHeight = $('#columnMappingTree').jqxTree('height');
////            if (!(treeHeight != null && treeHeight != '')) {
////                treeHeight = $('.columnMappingTree').height();
////            }
////            if (parseInt(width) < 300) {
////                width = 300;
////            }else{
////               width = parseInt(width)-10;
////            }
////            if (parseInt(height) <= 350) {
////                height = 300;
////                treeHeight = 180;
////            }else{
////                height = parseInt(height) - 130;
////                treeHeight = height;
////            }
////            var inputDivHeight = $("#treeSearchInputDiv").height();
//////            treeHeight = parseInt(treeHeight)-parseInt(inputDivHeight);
////            $('.columnMappingTree').height(treeHeight);
////            var treeWidth =   $('#columnMappingTree').jqxTree('width');
////            $('#columnMappingTree').jqxTree({width:parseInt(width)});
////            console.log("resizeStop");
////        }
////        , create: function (event, ui) {
////            $("#columnMappingTree li").on('dblclick', function (event) {
////                var selectedItem = $("#columnMappingTree").jqxTree('getSelectedItem');
////                if (selectedItem != null && !(selectedItem['icon'] != null && selectedItem['icon'] != '')) {
////                    $($this).parents("td").find("input").val(selectedItem['value']);
////                    $($this).parents("td").find("input").attr("title", selectedItem['value']);
////                }
////                $(this).dialog("close");
////                $(this).dialog("destroy");
////            });
////        }
//                    });
//                }
//
//
//            },
//            error: function (e) {
//                console.log(e);
//                sessionTimeout(e);
//                stopLoader();
//            }
//        });
//    }
//
//
//
//}
//function openFunctionForm(selectedRowData, source, $this) {
//
//    if (selectedRowData != null
//            && !jQuery.isEmptyObject(selectedRowData)
//            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
//        if (selectedRowData != null
//                && !jQuery.isEmptyObject(selectedRowData)
//                && selectedRowData['FUN_FORM_ID'] != null
//                && selectedRowData['FUN_FORM_ID'] != ''
//                ) {//FUN_FORM_ID
//            var selectedRowDataMain = {};
//            var columns = source._source.datafields;
//            if (columns != null && columns.length != 0) {
//                for (var i = 0; i < columns.length; i++) {
//                    var columnObj = columns[i];
//                    selectedRowDataMain[columnObj['name']] = selectedRowData[columnObj['name']];
//                }
//            }
//            var dataFunobjstr = $($this).parents("td").find("input").attr("data-funobjstr");
//            $.ajax({
//                type: "post",
//                traditional: true,
//                url: 'getETLFunctionForm',
//                cache: false,
//                data: {
//                    selectedRowData: JSON.stringify(selectedRowDataMain),
//                    dataFunobjstr: dataFunobjstr
//                },
//                success: function (data, status, xhr) {
//                    //columnMappingFormDialog
//                    if (data != null && data != '') {
//                        var response = JSON.parse(data);
//                        if (response['messageFlag']) {
//                            $("#columnMappingFormDialog").html(response['funFormStr'] + "<div id='funFormETLTableTr' style='display:none'></div>");
//
//                            $("#columnMappingFormDialog").dialog({
//                                title: (labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] != null ? labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] : selectedRowDataMain['FUN_DISP_NAME'] + ' Form'),
//                                modal: true,
//                                width: 650,
//                                maxWidth: 1000,
//                                height: 'auto',
//                                maxHeight: 1000,
//                                fluid: true,
//                                buttons: [{
//                                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
//                                        click: function () {
//                                            var selectedFunctionName = selectedRowData['FUN_NAME'];
//                                            var FUN_LVL_TYPE = selectedRowData['FUN_LVL_TYPE'];
//                                            var HL_FUN_ID = selectedRowData['HL_FUN_ID'];
//                                            var functionFormObj = {};
//                                            var funStr = "";
//                                            functionFormObj['functionName'] = selectedFunctionName;
//                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
//                                                funStr += "" + selectedFunctionName + "(";
//                                            } else {
//                                                funStr += "" + selectedFunctionName + "";
//
//                                            }
//                                            var mainFunStr = "";
//                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
//                                                mainFunStr += "" + selectedFunctionName + "(";
//                                            } else {
//                                                mainFunStr += "" + selectedFunctionName + "";
//
//                                            }
//                                            var rowCount = $('#funFormETLTable tr').length;
////                                        $('#myTable tr').length
//                                            var loopCount = 0;
//                                            var multiColumnsObj = {};
//                                            $("#funFormETLTable tr").each(function () {
//                                                var tdArray = this.cells;
//                                                if (tdArray != null && tdArray.length != 0) {
//                                                    if (FUN_LVL_TYPE == 'MULTI_COLUMNS') {
//                                                        if (loopCount != 0) {
//                                                            var multiColsObj = {};
//                                                            for (var i = 1; i < tdArray.length; i++) {
//
//                                                                var funValue = $(tdArray[i]).find("input").val();
//
//                                                                if (!(funValue != null && funValue != '' && funValue != 'null')) {
//                                                                    funValue = $(tdArray[i]).find("select").val();
//                                                                }
//                                                                if (funValue != null && funValue != '') {
//                                                                    funValue = $.trim(funValue);
//                                                                }
//                                                                var funValueId = $(tdArray[i]).find("input").attr("id");
//                                                                if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
//                                                                    funValueId = $(tdArray[i]).find("select").attr("id");
//                                                                }
//                                                                if (funValueId != null && funValueId != '') {
//                                                                    funValueId = $.trim(funValueId);
//                                                                }
//                                                                if (!(funValue != null
//                                                                        && funValue != ''
//                                                                        && funValue != undefined
//                                                                        && funValue != 'undefined')) {
//                                                                    funValue = "";
//                                                                }
//                                                                multiColsObj[funValueId] = funValue;
//
//                                                                funStr += "'" + funValue + "'";
//                                                                if ($(tdArray[i]).is(":visible")) {
//                                                                    if (funValue.indexOf(".") > -1 ||
//                                                                            funValueId == 'CASE_COND'
//                                                                            || funValueId == 'OPERATOR') {
//                                                                        mainFunStr += " " + funValue + " ";
//                                                                    } else {
//
//                                                                        mainFunStr += " '" + funValue + "' ";
//                                                                    }
//
//                                                                }
//                                                                if (loopCount != parseInt(rowCount) - 1) {
//                                                                    funStr += ",";
//
//
//                                                                }
//                                                                if (loopCount == 1 && i == 1) {
//                                                                    functionFormObj['FUN_LVL_TYPE'] = FUN_LVL_TYPE;
//                                                                }
//                                                            }
//                                                            multiColumnsObj[loopCount] = multiColsObj;
//                                                        }
//
//                                                    } else {
//                                                        var funFormLabel = $(tdArray[0]).text();
//                                                        var funValue = $(tdArray[1]).find("input").val();
//
//                                                        if (!(funValue != null && funValue != '' && funValue != 'null')) {
//                                                            funValue = $(tdArray[1]).find("select").val();
//                                                        }
//                                                        var funValueId = $(tdArray[1]).find("input").attr("id");
//                                                        if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
//                                                            funValueId = $(tdArray[1]).find("select").attr("id");
//                                                        }
//                                                        if (funValue != null && funValue != '') {
//                                                            funValue = $.trim(funValue);
//                                                        }
//                                                        if (funValueId != null && funValueId != '') {
//                                                            funValueId = $.trim(funValueId);
//                                                        }
//                                                        funStr += "'" + funValue + "'";
//                                                        if ($(this).is(":visible")) {
//                                                            if (funValue.indexOf(".") > -1) {
//                                                                mainFunStr += " " + funValue + " ";
//                                                            } else {
//                                                                mainFunStr += "'" + funValue + "'";
//                                                            }
//                                                        }
//
//                                                        functionFormObj[funValueId] = funValue;
//                                                        if (loopCount != parseInt(rowCount) - 1) {
//                                                            funStr += ",";
//                                                            if ($(this).is(":visible") && loopCount != 0) {
//                                                                mainFunStr += ",";
//
//                                                            }
//
//                                                        }
//
//
//                                                    }
//
//                                                    loopCount++;
//                                                }
//                                            });
//                                            funStr += ")";
//                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
//                                                mainFunStr += ")";
//                                            }
//
//                                            functionFormObj['funStr'] = funStr;
//                                            functionFormObj['mainFunStr'] = mainFunStr;
//                                            functionFormObj['HL_FUN_ID'] = HL_FUN_ID;
//                                            functionFormObj['multiColumnsObj'] = multiColumnsObj;
////                                            $($this).parents("td").find("input").attr("value", funStr);
//                                            $($this).parents("td").find("input").attr("value", mainFunStr);
////                                            $($this).parents("td").find("input").val(funStr);
////                                            $($this).parents("td").find("input").attr("title", funStr);
//                                            $($this).parents("td").find("input").attr("title", mainFunStr);
//                                            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
////                                            $(this).html("");
////                                            $(this).dialog("close");
////                                            $(this).dialog("destroy");
//                                            $(this).html("");
//                                            try {
//                                                $(this).dialog("close");
//                                            } catch (e) {
//                                            }
//                                            try {
//                                                $(this).dialog("destroy");
//                                            } catch (e) {
//                                            }
//                                        }
//
//                                    }],
//                                open: function () {
//                                    $("#viewFunQuery").click(function () {
//                                        console.log("iam in clickable ");
//                                        viewFunQuery('funFormETLTable', selectedRowData);
//                                    });
////                                    $("#viewFunQuery")
//                                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
//
//                                    $(".visionHeaderMain").css("z-index", "999");
//                                    $(".visionFooterMain").css("z-index", "999");
//                                    $(".ui-dialog").addClass('visionDMTreePopup');
//
//
//                                },
//                                beforeClose: function (event, ui)
//                                {
//
//                                    $(".visionHeaderMain").css("z-index", "99999");
//                                    $(".visionFooterMain").css("z-index", "99999");
//
//
//                                }, close: function (event, ui)
//                                {
//                                    $(this).html("");
//                                    try {
//                                        $(this).dialog("close");
//                                    } catch (e) {
//                                    }
//                                    try {
//                                        $(this).dialog("destroy");
//                                    } catch (e) {
//                                    }
//
//                                }
//                            });
//                            $("#funFormETLTableTr").html(response['addTrString']);
//                        }
//
//                    }
//
//
//                },
//                error: function (e) {
//                    console.log(e);
//                    sessionTimeout(e);
//                    stopLoader();
//                }
//            });
//        } else {
//            var selectedFunctionName = selectedRowData['FUN_NAME'];
//            var functionFormObj = {};
//            functionFormObj['functionName'] = selectedFunctionName;
//            functionFormObj['FUN_LVL_TYPE'] = selectedRowData['FUN_LVL_TYPE'];
//            functionFormObj['DM_FUN_CUST_COL1'] = selectedRowData['DM_FUN_CUST_COL1'];
//            functionFormObj['DM_FUN_CUST_COL2'] = selectedRowData['DM_FUN_CUST_COL2'];
//            $($this).parents("td").find("input").val(selectedFunctionName);
//            $($this).parents("td").find("input").attr("title", selectedFunctionName);
//            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
//        }
//    } else {
//        console.log("Please select function name");
//    }
//
//
//}
//function selectFunColumnValue($this, columnType, titleName, connCustCol2) {
//    if (columnType == 'ALL_TABLE' || columnType == 'ALL_SCHEMA') {//ALL_TABLE 
//        if (!(titleName != null && titleName != '')) {
//            titleName = "Functions";
//        }
//        $("#columnMappingDialog").html("<div id='columnMappingTree' class='columnMappingTree'></div>");
//        $("#columnMappingDialog").dialog({
//            title: (labelObject[titleName] != null ? labelObject[titleName] : titleName),
//            modal: true,
//            width: 400,
//            maxWidth: 1000,
//            height: 430,
//            fluid: true,
//            buttons: [{
//                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
//                    click: function () {
//                        var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
//                        if (selection != null && selection.length != 0) {
//                            var selectedRowData = selection[0];
//                            if (selectedRowData != null
//                                    && !jQuery.isEmptyObject(selectedRowData)
//                                    && selectedRowData['CONNECTION_NAME'] != null && selectedRowData['CONNECTION_NAME'] != '') {
//                                $(this).html("");
//                                $(this).dialog("close");
//                                $(this).dialog("destroy");
//                                $($this).parents("td").find("input").val(selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
//                                $($this).parents("td").find("input").attr("title", selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
//                                $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
//                                $($this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);
//                            } else if (columnType == 'ALL_SCHEMA' && selectedRowData != null
//                                    && !jQuery.isEmptyObject(selectedRowData)) {
//                                $(this).html("");
//                                $(this).dialog("close");
//                                $(this).dialog("destroy");
//                                //$($this).parents("td").find("input").val(selectedRowData['TABLE_NAME']);
//                                $($this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
//                                $($this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
//                                $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
//                                $($this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);
//
//                                // ravi predefined job
//                                var tableId = $($this).closest('table').attr('id');
//                                if (tableId != null) {
//                                    if (tableId == "selectSourceConnections") {
//                                        $("#selectAllSourceConnectionsDiv").remove();
//                                        var checkBoxStr = '<div id="selectAllSourceConnectionsDiv"><input type="checkbox" id="selectAllSourceConnections" name="selectAllSourceConnections" value=""><label for="selectAllSourceConnections">Select same connection to all Tables</label></div>'
//                                        $("#selectSourceConnections").parent('div').prepend(checkBoxStr);
//                                        $("#selectAllSourceConnections").change(function (evnt) {
//                                            var inputArr = $("#selectSourceConnections").find('input');
//                                            var checked = $("#selectAllSourceConnections").prop('checked');
//                                            if (checked) {
//                                                $.each(inputArr, function (inx) {
//                                                    $(this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
//                                                    $(this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
//                                                    $(this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
//                                                    $(this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);
//
//                                                })
//                                            }
//                                        });
//
//                                    }
//                                    if (tableId == "selectDestConnections") {
//                                        $("#selectAllDestConnectionsDiv").remove();
//                                        var checkBoxStr = '<div id="selectAllDestConnectionsDiv"><input type="checkbox" id="selectAllDestConnections" name="selectAllDestConnections" value=""><label for="selectAllDestConnections">Select same connection to all Tables</label></div>';
//                                        $("#selectDestConnections").parent('div').prepend(checkBoxStr);
//                                        $("#selectAllDestConnections").change(function (evnt) {
//                                            var inputArr = $("#selectDestConnections").find('input');
//                                            var checked = $("#selectAllDestConnections").prop('checked');
//                                            if (checked) {
//                                                $.each(inputArr, function (inx) {
//                                                    $(this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
//                                                    $(this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
//                                                    $(this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
//                                                    $(this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);
//
//                                                })
//                                            }
//                                        });
//                                    }
//
//                                }
//                            }
//                        }
//
//                    }
//
//                }],
//            open: function () {
//                $("#columnMappingTree").jqxTreeGrid(
//                        {
//                            width: "100%",
//                            virtualModeCreateRecords: function (expandedRecord, done) {
//                                // expandedRecord is equal to null when the function is initially called, because there is still no record to be expanded.
//                                // prepare the data
//                                var source =
//                                        {
//                                            dataType: "json",
//                                            dataFields: [
//                                                {name: 'CONNECTION_OBJ', type: 'string'},
//                                                {name: 'TABLE_NAME', type: 'string'},
//                                                {name: 'CONNECTION_NAME', type: 'string'},
//                                                {name: 'LEVEL_TYPE', type: 'string'},
//                                                {name: 'icon', type: 'string'},
//                                                {name: 'ID', type: 'string'},
//                                                {name: 'CONNECTION_TYPE', type: 'string'}
//                                            ],
//                                            hierarchy:
//                                                    {
//                                                        keyDataField: {name: 'TABLE_NAME'},
//                                                        parentDataField: {name: 'CONNECTION_NAME'}
//                                                    },
//                                            id: 'ID',
//                                            url: "getLookupAllTables",
//                                            method: "post",
//                                            data: {
//                                                expandedRecord: JSON.stringify(expandedRecord),
//                                                columnType: columnType,
//                                                connCustCol2: connCustCol2 // ravi predefined connections
//                                            }
//                                        };
//                                var dataAdapter = new $.jqx.dataAdapter(source,
//                                        {
//                                            formatData: function (data) {
//                                                if (expandedRecord == null) {
//                                                    data.$filter = "(CONNECTION_NAME eq null)"
//                                                } else {
//                                                    data.$filter = "(CONNECTION_NAME eq " + expandedRecord.TABLE_NAME + ")"
//                                                }
//                                                return data;
//                                            },
//                                            loadComplete: function ()
//                                            {
//                                                done(dataAdapter.records);
//                                                stopLoader();
//                                            },
//                                            loadStart: function ()
//                                            {
//                                                showLoader();
//                                            },
//                                            loadError: function (xhr, status, error) {
//                                                stopLoader();
//                                                done(false);
//                                                throw new Error("Error: " + error.toString());
//
//                                            }
//                                        }
//                                );
//                                dataAdapter.dataBind();
//                            },
//                            virtualModeRecordCreating: function (record) {
//
//                            },
//                            height: 350,
//                            sortable: true,
//                            columnsResize: true,
//                            columnsReorder: true,
//                            enableHover: true,
//                            enableBrowserSelection: true,
////                           filterable: true,
//                            filterable: true,
////                            filterMode: 'simple',
//                            icons: true,
//                            hierarchicalCheckboxes: true,
//                            pageable: true,
//                            pagerMode: 'advanced',
//                            pagerPosition: 'bottom',
//                            pageSize: 100,
//                            pageSizeOptions: ['100', '200', '300'],
//                            theme: 'energyblue',
//                            selectionMode: 'singleRow',
//                            autoShowLoadElement: false,
//                            columns: [
//                                {text: 'Table/Schem Name', dataField: 'TABLE_NAME', width: '80%', filterable: true},
//                                {text: 'Database Type', dataField: 'CONNECTION_TYPE', width: '30%', filterable: true},
//                                {text: 'CONNECTION_NAME', dataField: 'CONNECTION_NAME', hidden: true, width: 160, filterable: false},
//                                {text: 'LEVEL_TYPE', dataField: 'LEVEL_TYPE', hidden: true, width: 160, filterable: false},
//                                {text: 'ID', dataField: 'ID', hidden: true, width: 160, filterable: false},
//                                {text: 'CONNECTION_OBJ', dataField: 'CONNECTION_OBJ', hidden: true, width: 160, filterable: false}
//                            ]
//                        });
//                $('#columnMappingTree').on('rowDoubleClick', function (event) {
//                    var args = event.args;
//                    var selectedRowData = args.row;
//                    var source = $("#columnMappingTree").jqxTreeGrid('source');
//                    if (selectedRowData != null
//                            && !jQuery.isEmptyObject(selectedRowData)
//                            && selectedRowData['CONNECTION_NAME'] != null && selectedRowData['CONNECTION_NAME'] != '') {
//                        $("#columnMappingDialog").html("");
//                        $("#columnMappingDialog").dialog("close");
//                        $("#columnMappingDialog").dialog("destroy");
////                      
//                        $($this).parents("td").find("input").val(selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
//                        $($this).parents("td").find("input").attr("title", selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
//                        $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
//                    }
//
//
//
//                });
//
//                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
//
//                $(".visionHeaderMain").css("z-index", "999");
//                $(".visionFooterMain").css("z-index", "999");
//                $(".ui-dialog").addClass('visionDMTreePopup');
//
//
//            },
//            beforeClose: function (event, ui)
//            {
//
//                $(".visionHeaderMain").css("z-index", "99999");
//                $(".visionFooterMain").css("z-index", "99999");
//
//            }, close: function (event, ui)
//            {
//
//                $(this).html("");
//                try {
//                    $("#columnMappingTree").jqxTreeGrid('destroy');
//                    $("#columnMappingTree").remove();
//                    $("#treeSearchInputDiv").remove();
//
//                } catch (e) {
//                }
//            }
//        });
//    } else if (columnType == 'TO_COLUMN') {
//        selectColumn($this, 'toColumn');
//    } else if (columnType == 'LOOKUP_TABLE,COLUMN') {
//
//        var lookupTableName = $("#" + columnType.split(",")[0]).val();
//        if (lookupTableName != null && lookupTableName != '') {
//            lookupTableName = lookupTableName.split(".")[1];
//        }
//        var connObjStr = $("#" + columnType.split(",")[0]).attr("data-conobjstr");
//        $.ajax({
//            datatype: "json",
//            type: "post",
//            traditional: true,
//            url: 'getSelectedLookupTableColumns',
//            cache: false,
//            data: {
//                lookupTableName: lookupTableName,
//                connObj: connObjStr
//            },
//            success: function (response, status, xhr) {
//
//                selectColumn($this, columnType, response);
//
//            },
//            error: function (e) {
//                console.log(e);
//                sessionTimeout(e);
//                stopLoader();
//            }
//        });
//    } else if (columnType == 'FROM_COLUMN') {
//        selectColumn($this, 'fromColumn');
//    }
//}


function openFunctionForm(selectedRowData, source, $this, columnType) {

    if (selectedRowData != null
            && !jQuery.isEmptyObject(selectedRowData)
            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
        if (selectedRowData != null
                && !jQuery.isEmptyObject(selectedRowData)
                && selectedRowData['FUN_FORM_ID'] != null
                && selectedRowData['FUN_FORM_ID'] != ''
                ) {//FUN_FORM_ID
            var selectedRowDataMain = {};
            var columns = source._source.datafields;
            if (columns != null && columns.length != 0) {
                for (var i = 0; i < columns.length; i++) {
                    var columnObj = columns[i];
                    selectedRowDataMain[columnObj['name']] = selectedRowData[columnObj['name']];
                }
            }
            var dataFunobjstr = $($this).parents("td").find("input").attr("data-funobjstr");
            $.ajax({
                type: "post",
                traditional: true,
                url: 'getETLFunctionForm',
                cache: false,
                data: {
                    selectedRowData: JSON.stringify(selectedRowDataMain),
                    dataFunobjstr: dataFunobjstr,
                    columnType: columnType
                },
                success: function (data, status, xhr) {
                    //columnMappingFormDialog
                    if (data != null && data != '') {
                        var response = JSON.parse(data);
                        if (response['messageFlag']) {
                            var sourceTablesArray = $("#sourceTablesArray").val();
                            sourceTablesArray = JSON.parse(sourceTablesArray);

                            $("#columnMappingFormDialog").html(response['funFormStr'] + "<div id='funFormETLTableTr' style='display:none'></div>");

                            $("#columnMappingFormDialog").dialog({
                                title: (labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] != null ? labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] : selectedRowDataMain['FUN_DISP_NAME'] + ' Form'),
                                modal: true,
                                width: 650,
                                maxWidth: 1000,
                                height: 'auto',
                                maxHeight: 1000,
                                fluid: true,
                                buttons: [{
                                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                        click: function () {


                                            var selectedFunctionName = selectedRowData['FUN_NAME'];
                                            if (selectedFunctionName != null && selectedFunctionName != '') {
                                                selectedFunctionName = $.trim(selectedFunctionName);
                                            }
                                            var FUN_LVL_TYPE = selectedRowData['FUN_LVL_TYPE'];
                                            var HL_FUN_ID = selectedRowData['HL_FUN_ID'];
                                            var functionFormObj = {};
                                            var funStr = "";
                                            functionFormObj['functionName'] = selectedFunctionName;
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                funStr += "" + selectedFunctionName + "(";
                                            } else {
                                                funStr += "" + selectedFunctionName + "";

                                            }
                                            var mainFunStr = "";
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                mainFunStr += "" + selectedFunctionName + "(";
                                            } else {
                                                mainFunStr += "" + selectedFunctionName + "";

                                            }
                                            var rowCount = $('#funFormETLTable tr').length;
                                            var displayRowCount = $('#funFormETLTable tr:visible').length;
//                                        $('#myTable tr').length
                                            var loopCount = 0;
                                            var multiColumnsObj = {};
                                            $("#funFormETLTable tr").each(function () {
                                                var tdArray = this.cells;
                                                if (tdArray != null && tdArray.length != 0) {
                                                    if (FUN_LVL_TYPE == 'MULTI_COLUMNS') {
                                                        if (loopCount != 0) {
                                                            var multiColsObj = {};
                                                            for (var i = 1; i < tdArray.length; i++) {

                                                                var funValue = $(tdArray[i]).find("input").val();

                                                                if (!(funValue != null && funValue != '' && funValue != 'null')) {
                                                                    funValue = $(tdArray[i]).find("select").val();
                                                                }
                                                                if (funValue != null && funValue != '') {
                                                                    var trimval = $.trim(funValue)
                                                                    if (trimval.length > 0) {
                                                                        funValue = trimval;
                                                                    }
//                                                                                funValue = $.trim(funValue);
                                                                }
                                                                var funValueId = $(tdArray[i]).find("input").attr("id");
                                                                if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
                                                                    funValueId = $(tdArray[i]).find("select").attr("id");
                                                                }
                                                                if (funValueId != null && funValueId != '') {
                                                                    var trimval = $.trim(funValueId)
                                                                    if (trimval.length > 0) {
                                                                        funValueId = trimval;
                                                                    }
//                                                                    funValueId = $.trim(funValueId);
                                                                }
                                                                if (!(funValue != null
                                                                        && funValue != ''
                                                                        && funValue != undefined
                                                                        && funValue != 'undefined')) {
                                                                    funValue = "";
                                                                }
                                                                multiColsObj[funValueId] = funValue;

                                                                funStr += "'" + funValue + "'";
                                                                var isTableColumn = false;
                                                                $.each(sourceTablesArray, function (indx) {
                                                                    var currentVal = sourceTablesArray[indx];
                                                                    if (funValue != null && funValue.indexOf(currentVal) > -1) {
                                                                        isTableColumn = true;
                                                                    }
                                                                })
                                                                if ($(tdArray[i]).is(":visible")) {
                                                                    if (funValue != null
                                                                            && funValue != ''
                                                                            && isTableColumn ||
                                                                            funValueId == 'CASE_COND'
                                                                            || funValueId == 'OPERATOR') {
                                                                        mainFunStr += " " + funValue + " ";
                                                                    } else if (funValue != null
                                                                            && funValue != ''
                                                                            && funValue != undefined
                                                                            ) {

                                                                        mainFunStr += " '" + funValue + "' ";
                                                                    }

                                                                }
                                                                if (loopCount != parseInt(rowCount) - 1) {
                                                                    funStr += ",";


                                                                }
                                                                if (loopCount == 1 && i == 1) {
                                                                    functionFormObj['FUN_LVL_TYPE'] = FUN_LVL_TYPE;
                                                                }
                                                            }
                                                            multiColumnsObj[loopCount] = multiColsObj;
                                                        }

                                                    } else {
                                                        var funFormLabel = $(tdArray[0]).text();
                                                        var funValue = $(tdArray[1]).find("input").val();

                                                        if (!(funValue != null && funValue != '' && funValue != 'null')) {
                                                            funValue = $(tdArray[1]).find("select").val();
                                                        }
                                                        var funValueId = $(tdArray[1]).find("input").attr("id");
                                                        if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
                                                            funValueId = $(tdArray[1]).find("select").attr("id");
                                                        }
                                                        if (funValue != null && funValue != '' && funValue != undefined) {
                                                            var trimval = $.trim(funValue)
                                                            if (trimval.length > 0) {
                                                                funValue = trimval;
                                                            }


//                                                            funValue = funValue.replace(":", ".");
                                                        }
                                                        if (funValueId != null && funValueId != '') {
                                                            var trimval = $.trim(funValue)
                                                            if (trimval.length > 0) {
                                                                funValueId = $.trim(funValueId);
                                                            }

                                                        }

                                                        funStr += "'" + funValue + "'";

                                                        if ($(this).is(":visible")) {
                                                            if (funValue != null
                                                                    && funValue != ''
                                                                    && funValue != undefined && funValue.indexOf(":") > -1) {
                                                                mainFunStr += "" + funValue + "";
                                                            } else if (funValue != null
                                                                    && funValue != ''
                                                                    && funValue != undefined) {
                                                                mainFunStr += "'" + funValue + "'";
                                                            }
                                                        }

                                                        functionFormObj[funValueId] = funValue;
                                                        if (loopCount != parseInt(rowCount) - 1) {
                                                            funStr += ",";
                                                            if ($(this).is(":visible")) {
                                                                if (funValue != null
                                                                        && funValue != ''
                                                                        && funValue != undefined) {
                                                                    if (loopCount < parseInt(displayRowCount) - 1) {
                                                                        mainFunStr += ",";
                                                                    }
                                                                } else {
                                                                    mainFunStr = mainFunStr.replace(/,(\s+)?$/, '');
                                                                }
                                                            }

                                                        }


                                                    }

                                                    loopCount++;
                                                }
                                            });
                                            funStr += ")";
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                mainFunStr += ")";
                                            }

                                            functionFormObj['funStr'] = funStr;
                                            functionFormObj['mainFunStr'] = mainFunStr;
                                            functionFormObj['HL_FUN_ID'] = HL_FUN_ID;
                                            functionFormObj['multiColumnsObj'] = multiColumnsObj;
//                                            var id = $($this).parents("td").find("input").attr("id");
//                                            $("#" + id).val(mainFunStr);
                                            var input = $($this).parents("td").find("input");
                                            input.val(mainFunStr);

//                                            $($this).parents("td").find("input").attr("value", mainFunStr);
                                            $($this).parents("td").find("input").attr("title", mainFunStr);
                                            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
//                                            $(this).html("");
//                                            $(this).dialog("close");
//                                            $(this).dialog("destroy");
                                            $(this).html("");
                                            try {
                                                $(this).dialog("close");
                                            } catch (e) {
                                            }
                                            try {
                                                $(this).dialog("destroy");
                                            } catch (e) {
                                            }
                                        }

                                    }],
                                open: function () {
                                    $("#viewFunQuery").click(function () {
                                        console.log("iam in clickable ");
                                        viewFunQuery('funFormETLTable', selectedRowData);
                                    });
//                                    $("#viewFunQuery")
                                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                                    $(".visionHeaderMain").css("z-index", "999");
                                    $(".visionFooterMain").css("z-index", "999");
                                    $(".ui-dialog").addClass('visionDMTreePopup');


                                },
                                beforeClose: function (event, ui)
                                {

                                    $(".visionHeaderMain").css("z-index", "99999");
                                    $(".visionFooterMain").css("z-index", "99999");


                                }, close: function (event, ui)
                                {
                                    $(this).html("");
                                    try {
                                        $(this).dialog("close");
                                    } catch (e) {
                                    }
                                    try {
                                        $(this).dialog("destroy");
                                    } catch (e) {
                                    }

                                }
                            });
                            $("#funFormETLTableTr").html(response['addTrString']);
                        }

                    }


                },
                error: function (e) {
                    console.log(e);
                    sessionTimeout(e);
                    stopLoader();
                }
            });
        } else {
            var selectedFunctionName = selectedRowData['FUN_NAME'];
            var functionFormObj = {};
            functionFormObj['functionName'] = selectedFunctionName;
            functionFormObj['FUN_LVL_TYPE'] = selectedRowData['FUN_LVL_TYPE'];
            functionFormObj['DM_FUN_CUST_COL1'] = selectedRowData['DM_FUN_CUST_COL1'];
            functionFormObj['DM_FUN_CUST_COL2'] = selectedRowData['DM_FUN_CUST_COL2'];
            $($this).parents("td").find("input").val(selectedFunctionName);
            $($this).parents("td").find("input").attr("title", selectedFunctionName);
            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
        }
    } else {
        console.log("Please select function name");
    }


}
function selectFunColumnValue($this, columnType, titleName, connCustCol2) {
    if (columnType == 'ALL_TABLE' || columnType == 'ALL_SCHEMA') {//ALL_TABLE 
        if (!(titleName != null && titleName != '')) {
            titleName = "Functions";
        }
        $("#columnMappingDialog").html("<div id='columnMappingTree' class='columnMappingTree'></div>");
        $("#columnMappingDialog").dialog({
            title: (labelObject[titleName] != null ? labelObject[titleName] : titleName),
            modal: true,
            width: 400,
            maxWidth: 1000,
            height: 430,
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        var selection = $("#columnMappingTree").jqxTreeGrid('getSelection');
                        if (selection != null && selection.length != 0) {
                            var selectedRowData = selection[0];
                            if (selectedRowData != null
                                    && !jQuery.isEmptyObject(selectedRowData)
                                    && selectedRowData['CONNECTION_NAME'] != null && selectedRowData['CONNECTION_NAME'] != '') {
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                                $($this).parents("td").find("input").val(selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
                                $($this).parents("td").find("input").attr("title", selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
                                $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
                                $($this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);
                            } else if (columnType == 'ALL_SCHEMA' && selectedRowData != null
                                    && !jQuery.isEmptyObject(selectedRowData)) {
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                                //$($this).parents("td").find("input").val(selectedRowData['TABLE_NAME']);
                                $($this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
                                $($this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
                                $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
                                $($this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);

                                // ravi predefined job
                                var tableId = $($this).closest('table').attr('id');
                                if (tableId != null) {
                                    if (tableId == "selectSourceConnections") {
                                        $("#selectAllSourceConnectionsDiv").remove();
                                        var checkBoxStr = '<div id="selectAllSourceConnectionsDiv"><input type="checkbox" id="selectAllSourceConnections" name="selectAllSourceConnections" value=""><label for="selectAllSourceConnections">Select same connection to all Tables</label></div>'
                                        $("#selectSourceConnections").parent('div').prepend(checkBoxStr);
                                        $("#selectAllSourceConnections").change(function (evnt) {
                                            var inputArr = $("#selectSourceConnections").find('input');
                                            var checked = $("#selectAllSourceConnections").prop('checked');
                                            if (checked) {
                                                $.each(inputArr, function (inx) {
                                                    $(this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
                                                    $(this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
                                                    $(this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
                                                    $(this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);

                                                })
                                            }
                                        });

                                    }
                                    if (tableId == "selectDestConnections") {
                                        $("#selectAllDestConnectionsDiv").remove();
                                        var checkBoxStr = '<div id="selectAllDestConnectionsDiv"><input type="checkbox" id="selectAllDestConnections" name="selectAllDestConnections" value=""><label for="selectAllDestConnections">Select same connection to all Tables</label></div>';
                                        $("#selectDestConnections").parent('div').prepend(checkBoxStr);
                                        $("#selectAllDestConnections").change(function (evnt) {
                                            var inputArr = $("#selectDestConnections").find('input');
                                            var checked = $("#selectAllDestConnections").prop('checked');
                                            if (checked) {
                                                $.each(inputArr, function (inx) {
                                                    $(this).parents("td").find("input").attr("value", selectedRowData['TABLE_NAME']);
                                                    $(this).parents("td").find("input").attr("title", selectedRowData['TABLE_NAME']);
                                                    $(this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
                                                    $(this).parents("td").find("input").attr("data-tosystype", selectedRowData['CONNECTION_TYPE']);

                                                })
                                            }
                                        });
                                    }

                                }
                            }
                        }

                    }

                }],
            open: function () {
                $("#columnMappingTree").jqxTreeGrid(
                        {
                            width: "100%",
                            virtualModeCreateRecords: function (expandedRecord, done) {
                                // expandedRecord is equal to null when the function is initially called, because there is still no record to be expanded.
                                // prepare the data
                                var source =
                                        {
                                            dataType: "json",
                                            dataFields: [
                                                {name: 'CONNECTION_OBJ', type: 'string'},
                                                {name: 'TABLE_NAME', type: 'string'},
                                                {name: 'CONNECTION_NAME', type: 'string'},
                                                {name: 'LEVEL_TYPE', type: 'string'},
                                                {name: 'icon', type: 'string'},
                                                {name: 'ID', type: 'string'},
                                                {name: 'CONNECTION_TYPE', type: 'string'}
                                            ],
                                            hierarchy:
                                                    {
                                                        keyDataField: {name: 'TABLE_NAME'},
                                                        parentDataField: {name: 'CONNECTION_NAME'}
                                                    },
                                            id: 'ID',
                                            url: "getLookupAllTables",
                                            method: "post",
                                            data: {
                                                expandedRecord: JSON.stringify(expandedRecord),
                                                columnType: columnType,
                                                connCustCol2: connCustCol2 // ravi predefined connections
                                            }
                                        };
                                var dataAdapter = new $.jqx.dataAdapter(source,
                                        {
                                            formatData: function (data) {
                                                if (expandedRecord == null) {
                                                    data.$filter = "(CONNECTION_NAME eq null)"
                                                } else {
                                                    data.$filter = "(CONNECTION_NAME eq " + expandedRecord.TABLE_NAME + ")"
                                                }
                                                return data;
                                            },
                                            loadComplete: function ()
                                            {
                                                done(dataAdapter.records);
                                                stopLoader();
                                            },
                                            loadStart: function ()
                                            {
                                                showLoader();
                                            },
                                            loadError: function (xhr, status, error) {
                                                stopLoader();
                                                done(false);
                                                throw new Error("Error: " + error.toString());

                                            }
                                        }
                                );
                                dataAdapter.dataBind();
                            },
                            virtualModeRecordCreating: function (record) {

                            },
                            height: 350,
                            sortable: true,
                            columnsResize: true,
                            columnsReorder: true,
                            enableHover: true,
                            enableBrowserSelection: true,
//                           filterable: true,
                            filterable: true,
//                            filterMode: 'simple',
                            icons: true,
                            hierarchicalCheckboxes: true,
                            pageable: true,
                            pagerMode: 'advanced',
                            pagerPosition: 'bottom',
                            pageSize: 100,
                            pageSizeOptions: ['100', '200', '300'],
                            theme: 'energyblue',
                            selectionMode: 'singleRow',
                            autoShowLoadElement: false,
                            columns: [
                                {text: 'Table/Schem Name', dataField: 'TABLE_NAME', width: '80%', filterable: true},
                                {text: 'Database Type', dataField: 'CONNECTION_TYPE', width: '30%', filterable: true},
                                {text: 'CONNECTION_NAME', dataField: 'CONNECTION_NAME', hidden: true, width: 160, filterable: false},
                                {text: 'LEVEL_TYPE', dataField: 'LEVEL_TYPE', hidden: true, width: 160, filterable: false},
                                {text: 'ID', dataField: 'ID', hidden: true, width: 160, filterable: false},
                                {text: 'CONNECTION_OBJ', dataField: 'CONNECTION_OBJ', hidden: true, width: 160, filterable: false}
                            ]
                        });
                $('#columnMappingTree').on('rowDoubleClick', function (event) {
                    var args = event.args;
                    var selectedRowData = args.row;
                    var source = $("#columnMappingTree").jqxTreeGrid('source');
                    if (selectedRowData != null
                            && !jQuery.isEmptyObject(selectedRowData)
                            && selectedRowData['CONNECTION_NAME'] != null && selectedRowData['CONNECTION_NAME'] != '') {
                        $("#columnMappingDialog").html("");
                        $("#columnMappingDialog").dialog("close");
                        $("#columnMappingDialog").dialog("destroy");
//                      
                        $($this).parents("td").find("input").val(selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
                        $($this).parents("td").find("input").attr("title", selectedRowData['CONNECTION_NAME'] + "." + selectedRowData['TABLE_NAME']);
                        $($this).parents("td").find("input").attr("data-conobjstr", selectedRowData['CONNECTION_OBJ']);
                    }



                });

                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $(".ui-dialog").addClass('visionDMTreePopup');


            },
            beforeClose: function (event, ui)
            {

                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");

            }, close: function (event, ui)
            {

                $(this).html("");
                try {
                    $("#columnMappingTree").jqxTreeGrid('destroy');
                    $("#columnMappingTree").remove();
                    $("#treeSearchInputDiv").remove();

                } catch (e) {
                }
            }
        });
    } else if (columnType == 'TO_COLUMN') {
        selectColumn($this, 'toColumn');
    } else if (columnType == 'LOOKUP_TABLE,COLUMN') {

        var lookupTableName = $("#" + columnType.split(",")[0]).val();
        if (lookupTableName != null && lookupTableName != '') {
            lookupTableName = lookupTableName.split(".")[1];
        }
        var connObjStr = $("#" + columnType.split(",")[0]).attr("data-conobjstr");
        $.ajax({
            datatype: "json",
            type: "post",
            traditional: true,
            url: 'getSelectedLookupTableColumns',
            cache: false,
            data: {
                lookupTableName: lookupTableName,
                connObj: connObjStr
            },
            success: function (response, status, xhr) {

                selectColumn($this, columnType, response);

            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    } else if (columnType == 'FROM_COLUMN') {
        selectColumn($this, 'fromColumn');
    } else if (columnType == 'CHILD_COLUMN') {
        selectColumn($this, 'childColumn');
    } else if (columnType == 'MASTER_COLUMN') {
        selectColumn($this, 'masterColumn');
    } else if (columnType == 'FROM_WHERE_CLAUSE_COLUMN') {
        selectColumn($this, 'fromWhereClauseColumn');
    }
}

function showSQLPopup($this) {
    showLoader();
    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedSQLOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
    var getLinksTo = $('#' + flowChartWorkSpaceId).flowchart('getLinksTo', selectedOperatorId);


    if (getLinksTo != null && getLinksTo.length != 0) {
        var fromOperatorsArray = $('#' + flowChartWorkSpaceId).flowchart('getFromOperatorsByToOpId', selectedOperatorId);
        var createTableObj = selectedSQLOperatorData['createTableObj'];
        $.ajax({
            datatype: "json",
            type: "post",
            traditional: true,
            url: 'getFromTableColumns',
            cache: false,
            data: {
                fromOperators: JSON.stringify(fromOperatorsArray),
                createTableObj: (createTableObj != null ? JSON.stringify(createTableObj) : "")
            },
            success: function (response, status, xhr) {
                stopLoader();

                $("#columnSQLMappingDialog").html(response['sqlPopupDiv']);
                $("#columnSQLMappingDialog").dialog({
                    title: (labelObject['Create Table'] != null ? labelObject['Create Table'] : 'Create Table'),
                    modal: true,
                    width: 890,
                    maxWidth: 1000,
                    height: 350,
                    maxHeight: 1000,
                    fluid: true,
                    buttons: [{
                            text: (labelObject['Create'] != null ? labelObject['Create'] : 'Create'),
                            click: function () {
                                //sqlToTableName
                                //sqlToTableColumnsTable
                                var tableName = $("#sqlToTableName").val();
                                if (tableName != null && tableName != '') {
                                    tableName = tableName.toUpperCase();
                                    var dataSourceName = $("#sqlToDataSourceName").val();
                                    var dataSourceObj = $("#sqlToDataSourceName").attr("data-conobjstr");
                                    var rowCount = $('#sqlToTableColumnsTable >tbody >tr').length;
                                    if (rowCount != 0) {
                                        var createTableObj = {};
                                        createTableObj['tableName'] = tableName;
                                        createTableObj['dataSourceName'] = dataSourceName;
                                        createTableObj['dataSourceObj'] = dataSourceObj;
                                        var tableColsArray = [];
                                        $("#sqlToTableColumnsTable tbody tr").each(function () {
                                            var tdArray = this.cells;
                                            if (tdArray != null && tdArray.length != 0) {
                                                var columnName = $(tdArray[2]).find("input").val();
                                                var dataType = $(tdArray[3]).find("input").val();
                                                if (columnName != null && columnName != '' && dataType != null && dataType != '') {
                                                    var colsObj = {};
                                                    colsObj['COLUMN_NAME'] = $(tdArray[2]).find("input").val();

                                                    //PKH default value
                                                    if ($(tdArray[4]).find("input[type=\"checkbox\"]").is(":checked")) {
                                                        colsObj['NOTNULL'] = "Y";
                                                    } else {
                                                        colsObj['NOTNULL'] = "N";
                                                    }
                                                    colsObj['DEFAULT_VALUE'] = $(tdArray[5]).find("input").val();
                                                    //PKH default value


                                                    if ($(tdArray[1]).find("input[type=\"checkbox\"]").is(":checked")) {//input[type="checkbox"]:checked
                                                        colsObj['PK'] = "Y";
                                                    } else {
                                                        colsObj['PK'] = "N";
                                                    }
                                                    colsObj['DATA_TYPE'] = $(tdArray[3]).find("input").val();

                                                    tableColsArray.push(colsObj);
                                                }

                                            }
                                        });
                                        createTableObj['colsObj'] = tableColsArray;
                                        var tableName = createTableObj['tableName'];
                                        if (dataSourceObj != null && dataSourceObj != '') {
                                            var dataSourceObject = JSON.parse(dataSourceObj);
                                            if (dataSourceObject != null) {
                                                if (dataSourceObject['CONN_USER_NAME'] != null
                                                        && dataSourceObject['CONN_USER_NAME'] != ''
                                                        && tableName.indexOf(".") == -1
                                                        ) {
                                                    tableName = dataSourceObject['CONN_USER_NAME'] + "." + tableName;
                                                }
                                            }
                                        }
                                        selectedSQLOperatorData['tableName'] = tableName;
                                        selectedSQLOperatorData['createTableObj'] = createTableObj;
                                        selectedSQLOperatorData['statusLebel'] = createTableObj['tableName'];
                                        var dataSourceName = createTableObj['dataSourceName'];
                                        var connectionObj = {};
                                        if (!(dataSourceName != null && dataSourceName != '')) {//dataSourceName
                                            dataSourceName = 'Current V10';
                                        }
//                                        if (dataSourceName == 'Current V10') {
//                                            connectionObj = savedDBData['Current_V10'];
//                                        } else {
                                        //dataSourceObj
                                        var dataSourceObjStr = createTableObj['dataSourceObj'];
                                        if (dataSourceObjStr != null && dataSourceObjStr != '') {
                                            connectionObj = JSON.parse(dataSourceObjStr);
                                        }
//                                        }

                                        selectedSQLOperatorData['CONNECTION_NAME'] = connectionObj['CONNECTION_NAME'];
                                        selectedSQLOperatorData['CONN_DB_NAME'] = connectionObj['CONN_DB_NAME'];
                                        selectedSQLOperatorData['connObj'] = connectionObj;
                                        selectedSQLOperatorData['dragType'] = "Table";

                                        //PKH DBIcon
//                                        var toTableName = tableName.split(".");
//                                        var body = "<div title='" + tableName + "'>"
//                                                + "<div  title='Double Click here to viewTransformationRules (" + tableName + ")' ondblclick=viewTrfmRules() class='visionMapOperator'><img src='images/SQL ICON-01.svg' class='visionETLIcons' style='width:30px;height: 30px;'/></div>"
//                                                + "<div class='visionSQLLabelDiv'>" + toTableName[1] + "</div>";
//                                        +"</div>"
//                                        selectedSQLOperatorData['properties']['body'] = body;
                                        //PKH DBIcon

                                        operatorDoublClick = true;
                                        $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedSQLOperatorData);
                                        $(".flowchart-operator-connector-label").hide();
                                        $(".flowchart-operator-title").hide();
                                        operatorDoublClick = false;
                                        addPropsToSQLOp($this, createTableObj, 'columnSQLMappingDialog');
                                    } else {
                                        showMesg("You must specify some columns to create the table.");
                                    }
                                } else {
                                    showMesg("Table Name Should not empty.");
                                }
                            }

                        }],
                    open: function () {
                        var source =
                                {
                                    dataType: "json",
                                    dataFields: [
                                        {name: 'CONNECTION_OBJ', type: 'string'},
                                        {name: 'TABLE_NAME', type: 'string'},
                                        {name: 'CONNECTION_NAME', type: 'string'},
                                        {name: 'LEVEL_TYPE', type: 'string'},
                                        {name: 'icon', type: 'string'},
                                        {name: 'ID', type: 'string'},
                                        {name: 'DATA_TYPE', type: 'string'},
                                        {name: 'COLUMN_TYPE', type: 'string'},
                                        {name: 'DATA_LENGTH', type: 'string'},
                                        {name: 'TO_COLUMN_TYPE', type: 'string'},
                                        {name: 'CONNECTION_TYPE', type: 'string'}
                                    ],
                                    hierarchy:
                                            {
                                                keyDataField: {name: 'TABLE_NAME'},
                                                parentDataField: {name: 'CONNECTION_NAME'}
                                            },
                                    id: 'ID',
                                    localData: response['fromTableColsArray']
                                };
                        var dataAdapter = new $.jqx.dataAdapter(source);
                        $("#columnSQLMappingTree").jqxTreeGrid(
                                {
                                    width: "100%",
                                    source: dataAdapter,
                                    height: 250,
                                    sortable: true,
                                    columnsResize: true,
                                    columnsReorder: true,
                                    enableHover: true,
                                    enableBrowserSelection: true,
                                    filterable: true,
                                    icons: true,
                                    hierarchicalCheckboxes: true,
                                    pageable: true,
                                    pagerMode: 'advanced',
                                    pagerPosition: 'bottom',
                                    pageSize: 100,
                                    pageSizeOptions: ['100', '200', '300'],
                                    theme: 'energyblue',
                                    selectionMode: 'multipleRows',
                                    autoShowLoadElement: false,
                                    columns: [
                                        {text: 'Table/Column Name', dataField: 'TABLE_NAME', width: '80%', filterable: true},
                                        {text: 'Column Data Type', dataField: 'COLUMN_TYPE', width: '40%', filterable: false},
                                        {text: 'Data Type', dataField: 'DATA_TYPE', hidden: true, width: '30%', filterable: false},
                                        {text: 'Column Length', dataField: 'DATA_LENGTH', hidden: true, width: '10%', filterable: false},
                                        {text: 'Database Type', dataField: 'CONNECTION_TYPE', width: '15%', filterable: true},
                                        {text: 'CONNECTION_NAME', dataField: 'CONNECTION_NAME', hidden: true, width: 160, filterable: false},
                                        {text: 'LEVEL_TYPE', dataField: 'LEVEL_TYPE', hidden: true, width: 160, filterable: false},
                                        {text: 'ID', dataField: 'ID', hidden: true, width: 160, filterable: false},
                                        {text: 'TO_COLUMN_TYPE', dataField: 'TO_COLUMN_TYPE', hidden: true, width: 160, filterable: false},
                                        {text: 'CONNECTION_OBJ', dataField: 'CONNECTION_OBJ', hidden: true, width: 160, filterable: false}
                                    ]
                                });
                        $("#sqlToTableTrDiv").html(response['trString']);//trString
                        var allDataTypeObj = response['allDataTypeObj'];
                        if (allDataTypeObj != null) {
                            $("#sqlAllDataTypeObj").val(JSON.stringify(allDataTypeObj));
                        }
                        var editing = false;
                        $(".editable").attr("title", "Double click here to rename the columns");
                        $(".dataTypePopup").attr("title", "Double click here to change datatype");

                        $('.dataTypePopup').on('dblclick', function () {
                            var val = $(this).text();
                            $(this).find('input').val(val).show().focus();
                            $(this).find('.originalvalue').hide();
                            // need to show the popup
                            dataTypeDialog(this);

                        });
                        $('.editable').on('dblclick', function () {
                            var val = $(this).text();
                            $(this).find('input').val(val).show().focus();
                            $(this).find('.originalvalue').hide();

                        });
                        $('#sqlToTableColumnsTable input').bind('keyup keypress', function (e) {
                            var code = e.keyCode || e.which;
                            if (editing)
                                return editing = false;
                            if (code == 27) {
                                editing = false;
                                $(this).parent().find('.originalvalue').show().focus();
                                $(this).parent().find('input[type="text"],select,textarea').hide();
                            }

                            if (code == 13) {
                                editing = false;

                                $(this).parent().find('.originalvalue').show().focus();
                                $(this).parent().find('input[type="text"],select,textarea').hide();
                            }
                        });

                        $('#sqlToTableColumnsTable input').on('blur', function (e) {
                            var nEl = $(this).val();
                            $(this).parent().find('.originalvalue').text(nEl).show();
                            $(this).parent().find('input[type="text"],select,textarea').hide();
                        });
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                        $(".ui-dialog").addClass('visionDMTreePopup');


                    },
                    resizeStop: function (event, ui) {
                        //   $("#columnSQLMappingTree").jqxTreeGrid( -- 250/350 
                        //.visionEtlCreateSQLTable tbody 156/350
                        var sizes = ui.size;
                        var height = ui.size.height;
                        var width = ui.size.width;
                        var treeHeight = parseInt(height) - 100;
                        var tableHeight = parseInt(height) - 194;
                        $("#columnSQLMappingTree").jqxTreeGrid({height: treeHeight + "px"});
                        $(".visionEtlCreateSQLTable tbody").height(tableHeight + "px");
                    },
                    beforeClose: function (event, ui)
                    {

                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");

                    }, close: function (event, ui)
                    {

                        $(this).html("");
                        try {
                            $("#columnSQLMappingTree").jqxTreeGrid('destroy');
                            $("#columnSQLMappingTree").remove();
                            $("#treeSearchInputDiv").remove();

                        } catch (e) {
                        }
                    }
                });

            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    } else {
        stopLoader();
        showMesg("No mappings found.");
    }
}


function ShowEtlConnectionPopup(response, type, typeName, dialogTitle)
{
    var labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    $("#dialog").html(response);
    $("#dialog").dialog({
        title: (labelObject[dialogTitle] != null ? labelObject[dialogTitle] : dialogTitle),
//        modal: true,
        width: 500,
        height: 'auto',
        maxHeight: 450,
        fluid: true,
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $("#savedSources").jqxTree('selectItem', null);
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });


}

function connectEtlDatabase(type, typeName) {
//    var selectedDbType = $('#selectedTypeName').val();
//    var ConnectionEtlType = $('#selectedType').val();
    var EtlconName = $('#DbEtlConnectionName').val();
    if (EtlconName != null && EtlconName != '') {
        EtlconName = $.trim(EtlconName);
    }
    var EtlhostName = $('#DbEtlHostName').val();
    if (EtlhostName != null && EtlhostName != '') {
        EtlhostName = $.trim(EtlhostName);
    }
    var Etlport = $('#DbEtlPort').val();
    if (Etlport != null && Etlport != '') {
        Etlport = $.trim(Etlport);
    }
    var EtluserName = $('#DbEtlUserName').val();
    if (EtluserName != null && EtluserName != '') {
        EtluserName = $.trim(EtluserName);
    }
    var Etlpassword = $('#DbEtlPassword').val();
    if (Etlpassword != null && Etlpassword != '') {
        Etlpassword = $.trim(Etlpassword);
    }
    var EtlserviceName = $('#DbEtlServiceName').val();
    if (EtlserviceName != null && EtlserviceName != '') {
        EtlserviceName = $.trim(EtlserviceName);
    }
    // var EtlcheckedVal = $('#EtlcheckBoxChecked').is(':checked');
    var EtlauditId = $('#EtlauditId').val();
    if (EtlauditId != null && EtlauditId != '') {
        EtlauditId = $.trim(EtlauditId);
    }
    if (!EtlconName) {
        $('#DbEtlConnectionNameError').html("Please enter Connection Name");
    }
    if (!EtlhostName) {
        $('#DbEtlHostNameError').html("Please enter Host Name");
    }
    if (!Etlport) {
        $('#DbEtlPortError').html("Please enter Port No");
    }
    if (!EtluserName) {
        $('#DbEtlUserNameError').html("Please enter Username");
    }
    if (!Etlpassword) {
        $('#DbEtlPasswordError').html("Please enter Password");
    }
    if (!EtlserviceName) {
        $('#DbEtlServiceNameError').html("Please enter Service Name");
    } else {

        $('.dataMigrationInputError').hide();
        $('.visionDataMigrationError').hide();

        connectEtlDatabaseProcess(EtlconName, EtlhostName, Etlport, EtluserName, Etlpassword, EtlserviceName, typeName, EtlauditId, type);
    }
}

function connectEtlDatabaseProcess(EtlconName, EtlhostName, Etlport, EtluserName, Etlpassword, EtlserviceName, typeName, EtlauditId, type) {
    $('#visionShowConnectionMsg').hide();
    showLoader();
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'getConnectionDetails',
        async: true,
        data: {
            connectionName: EtlconName,
            hostName: EtlhostName,
            port: Etlport,
            userName: EtluserName,
            password: Etlpassword,
            serviceName: EtlserviceName,
            checkedVal: true,
            selectedItemLabel: typeName,
            auditId: EtlauditId,
            ConnectionType: type,
            EtlFlag: 'Y'

        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var result = JSON.parse(response);
                var messageFlag = result['messageFlag'];
                if (messageFlag) {

                    $("#dialog").html("");
                    $("#dialog").dialog("close");
                    $("#dialog").dialog("destroy");
                    showEtlList('savedConnectionsIconsDiv', 'availableConnections');
//                    getDbSchemas(typeName,type);
                    getDBtables(EtlconName, typeName, type);

                    $('#visionShowConnectionMsg').show();
                    $('#visionShowConnectionMsg').html('<p style="color:green">' + result['connectionMessage'] + '</p>');
//                    $("#connectEtlDbTd").html("<input type='button' value='Close' name='Close'  onclick = \"closeEtlConnectionDialog()\" class='visionEtlCloseButton'>");
                    // showMessagePopup(result['connectionMessage']);
                } else {
                    // showMessagePopup(result['connectionMessage']);
                    $('#visionShowConnectionMsg').show();
                    $('#visionShowConnectionMsg').html('<p style="color:red">' + result['connectionMessage'] + '</p>');
                }
                // files expand ravi start
                if (typeName != null) {
                    var treeItemElement = globalFileTreeItem[typeName];
                    if (treeItemElement != null) {
                        var $element = $(treeItemElement);
                        var children = $element.find('ul:first').children();
                        if (children != null && children.length > 0) {
                            $.each(children, function (index) {
                                $('#savedConnections').jqxTree('removeItem', this)
                            })
                            $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
                            $('#savedConnections').jqxTree('collapseItem', treeItemElement);
                            $('#savedConnections').jqxTree('expandItem', treeItemElement);
                        }
                    }
                }
//                var treeItemElement = globalFileTreeItem[typeName.toUpperCase()];
//                var $element = $(treeItemElement);
//                var children = $element.find('ul:first').children();
//                $.each(children, function (index) {
//                    $('#savedConnections').jqxTree('removeItem', this)
//                })
//                $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
//                $('#savedConnections').jqxTree('collapseItem', treeItemElement);
//                $('#savedConnections').jqxTree('expandItem', treeItemElement);
                // files expand ravi end 


            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function closeEtlConnectionDialog() {
    $("#dialog").html("");
    $("#dialog").dialog("close");
    $("#dialog").dialog("destroy");
}

function moveTableColumns(treeId, selectionType) {
    var selection = $("#" + treeId).jqxTreeGrid('getSelection');
    var tableStr = "";
    if (selection != null && selection.length != 0) {
        var rowCount = $('#sqlToTableColumnsTable >tbody >tr').length;
        for (var i = 0; i < selection.length; i++) {
            // get a selected row.
            var selectedRowData = selection[i];
            if (selectedRowData != null && !jQuery.isEmptyObject(selectedRowData)) {
                var connObjStr = selectedRowData['CONNECTION_OBJ'];//CONNECTION_OBJ
                var connObj = {};
                if (connObjStr != null && connObjStr != '') {
                    connObj = JSON.parse(connObjStr);
                }
                var toColumnTypeStr = selectedRowData['TO_COLUMN_TYPE'];//CONNECTION_OBJ
                var toColumnTypeObj = {};
                if (toColumnTypeStr != null && toColumnTypeStr != '') {
                    toColumnTypeObj = JSON.parse(toColumnTypeStr);
                }
                //conntype
                var toSysType = $("#sqlToDataSourceName").attr("data-tosystype");
                if (toSysType != null && toSysType != '') {
                    toSysType = toSysType.toUpperCase();
                }
                var isExistColumn = false;
                if (rowCount != 0) {
                    $("#sqlToTableColumnsTable tbody tr").each(function () {
                        var tdArray = this.cells;
                        if (tdArray != null && tdArray.length != 0) {
                            var columnName = $(tdArray[2]).find("input").val();
                            if (columnName != null && columnName != '' && columnName == selectedRowData['TABLE_NAME']) {
                                isExistColumn = true;
                                return false;
                            }

                        }
                    });
                }
                if (!isExistColumn) {
                    var toColumnType = "";
                    if (toColumnTypeObj != null
                            && !jQuery.isEmptyObject(toColumnTypeObj)
                            && toSysType != null && toSysType != '') {
                        toColumnType = toColumnTypeObj[toSysType];
                        if (!(toColumnType != null && toColumnType != '')) {
                            toColumnType = selectedRowData['COLUMN_TYPE'];
                        }
                    }
                    if (!(toColumnType != null && toColumnType != '')) {
                        toColumnType = selectedRowData['COLUMN_TYPE'];
                    }
                    if (!(toColumnType != null && toColumnType != '')) {
                        toColumnType = "";
                    }
                    if (toSysType == "MSSQL") { // praksh MSSQL datatype issue
//                        toColumnType = toColumnType + "(" + selectedRowData['DATA_LENGTH'] + ")";
                        toColumnType = toColumnType;
                    }
                    var columnName = selectedRowData['TABLE_NAME'];
                    if (columnName != null && columnName != '' && columnName.indexOf(" ") > -1) {
                        columnName = columnName.replace(/\s/g, '_');
                    }
                    tableStr += "<tr>"
                            + "<td width='5%'><img src=\"images/Detele Red Icon.svg\" onclick='deleteSelectedRow(this)'  class=\"visionTdETLIcons\""
                            + " title=\"Delete\" style=\"width:15px;height: 15px;cursor:pointer;\"/>"
                            + "</td>"
                            + "<td width='5%' class=\"sourceJoinColsTd\"><input class='visionCreateTableColInput' type='checkbox'/></td>"
                            + "<td width='20%' class=\"sourceJoinColsTd editable\"><input class='visionCreateTableColInput inputvalue' type='text' value='" + columnName + "'/><span class=\"originalvalue\">" + columnName + "</span></td>"
                            + "<td width='20%' class=\"sourceJoinColsTd dataTypePopup\"><input class='visionCreateTableColInput inputvalue' type='text' value='" + toColumnType + "' /><span class=\"originalvalue\">" + toColumnType + "</span></td>"


                            //PKH default value
                            + "<td width='5%' class=\"sourceJoinColsTd\"><input class='visionCreateTableColInput' type='checkbox'/></td>"
                            + "<td width='35%' class=\"editable\"><input type='text' /><span class=\"originalvalue\"></span></td>"
                            //PKH default value

                            + "<td width='5%' class=\"sourceJoinColsTd\" style='display:none' >N</td>"
                            + "</tr>";
                }

            }
        }
    }
    $("#sqlToTableColumnsTable tbody").append(tableStr);
    $(".inputvalue").hide();
    var editing = false;
    $(".editable").attr("title", "Double click here to rename the columns");
    $('.editable').on('dblclick', function () {
        var val = $(this).text();
        $(this).find('input').val(val).show().focus();
        $(this).find('.originalvalue').hide();

    });
    $(".dataTypePopup").attr("title", "Double click here to change datatype");
    $('.dataTypePopup').on('dblclick', function () {
        var val = $(this).text();
        $(this).find('input').val(val).show().focus();
        $(this).find('.originalvalue').hide();
        // need to show the popup
        dataTypeDialog(this);

    });
    $('#sqlToTableColumnsTable input').bind('keyup keypress', function (e) {
        var code = e.keyCode || e.which;
        if (editing)
            return editing = false;
        if (code == 27) {
            editing = false;
            $(this).parent().find('.originalvalue').show().focus();
            $(this).parent().find('input[type="text"],select,textarea').hide();
        }

        if (code == 13) {
            editing = false;

            $(this).parent().find('.originalvalue').show().focus();
            $(this).parent().find('input[type="text"],select,textarea').hide();
        }
    });

    $('#sqlToTableColumnsTable input').on('blur', function (e) {
        var nEl = $(this).val();
        $(this).parent().find('.originalvalue').text(nEl).show();
        $(this).parent().find('input[type="text"],select,textarea').hide();
    });

}

function addNewTableRow(fromTrStrDivId, tableId, $this) {
    var trstring = $("#" + fromTrStrDivId).html();
    $("#" + tableId + " tbody").append(trstring);
    $(".inputvalue").hide();
    var editing = false;
    $(".editable").attr("title", "Double click here to rename the columns");
    $(".sqlToTableColumnsDivClass").animate({
        scrollTop: $(".sqlToTableColumnsDivClass").prop("scrollHeight")
    }, 1000);

    $('.editable').on('dblclick', function () {
        var val = $(this).text();
        $(this).find('input').val(val).show().focus();
        $(this).find('.originalvalue').hide();

    });
    $(".dataTypePopup").attr("title", "Double click here to change datatype");

    $('.dataTypePopup').on('dblclick', function () {
        var val = $(this).text();
        $(this).find('input').val(val).show().focus();
        $(this).find('.originalvalue').hide();
        // need to show the popup
        dataTypeDialog(this);

    });
    $('#' + tableId + ' input').bind('keyup keypress', function (e) {
        var code = e.keyCode || e.which;
        if (editing)
            return editing = false;
        if (code == 27) {
            editing = false;
            $(this).parent().find('.originalvalue').show().focus();
            $(this).parent().find('input[type="text"],select,textarea').hide();
        }

        if (code == 13) {
            editing = false;

            $(this).parent().find('.originalvalue').show().focus();
            $(this).parent().find('input[type="text"],select,textarea').hide();
        }
    });

    $('#' + tableId + ' input').on('blur', function (e) {
        var nEl = $(this).val();
        $(this).parent().find('.originalvalue').text(nEl).show();
        $(this).parent().find('input[type="text"],select,textarea').hide();
    });
}
function addNewTableDataRow(fromTrStrDivId, tableId, $this) {
    var trstring = $("#" + fromTrStrDivId).html();
    $("#" + tableId + " tbody").append(trstring);

}

function showMesg(message) {
    if (message != null) {
        $("#dialog").html(message);
        $("#dialog").dialog({
            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 300,
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }}],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    }
}

function addPropsToSQLOp($this, createTableObj, dialogId) {
    showLoader();

    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'json',
        cache: false,
        url: 'createTableInETL',
        async: true,
        data: {
            createTableObj: JSON.stringify(createTableObj)
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                $("#dialog").html(response['message']);
                $("#dialog").dialog({
                    title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                    modal: true,
                    height: 'auto',
                    minWidth: 300,
                    maxWidth: 'auto',
                    fluid: true,
                    buttons: [{
                            text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                            click: function () {
                                if (response['messageFlag']) {
                                    $("#" + dialogId).html("");
                                    $("#" + dialogId).dialog("close");
                                    $("#" + dialogId).dialog("destroy");
                                }
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }}],
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });


            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}

function connectErpEtlDatabase(type, typeName) {

    var connectionName = $('#ErpEtlDbConnectionName').val();
    if (connectionName != null && connectionName != '') {
        connectionName = $.trim(connectionName);

    }
    var ClientId = $('#ERPEtlClientName').val();
    if (ClientId != null && ClientId != '') {
        ClientId = $.trim(ClientId);

    }
    var hostName = $('#ERPEtlHostName').val();
    if (hostName != null && hostName != '') {
        hostName = $.trim(hostName);

    }
    var userName = $('#ERPEtlUserName').val();
    if (userName != null && userName != '') {
        userName = $.trim(userName);

    }
    var password = $('#ERPEtlPassword').val();
    if (password != null && password != '') {
        password = $.trim(password);

    }
    var LanguageId = $('#ERPEtlLanguageId').val();
    if (LanguageId != null && LanguageId != '') {
        LanguageId = $.trim(LanguageId);

    }
    var ERPSystemId = $('#ERPEtlSystemId').val();
    if (ERPSystemId != null && ERPSystemId != '') {
        ERPSystemId = $.trim(ERPSystemId);

    }
    var checkedVal = $('#checkBoxChecked').is(':checked');
    var auditId = $('#auditId').val();
    if (!ClientId) {
        $('#ERPEtlClientNameError').html("Please enter ClientId");
    }
    if (!hostName) {
        $('#ERPEtlHostNameError').html("Please enter Host Name");
    }
    if (!userName) {
        $('#ERPEtlUserNameError').html("Please enter Username");
    }
    if (!password) {
        $('#ERPEtlPasswordError').html("Please enter Password");
    }
    if (!LanguageId) {
        $('#ERPEtlLanguageIdError').html("Please enter LanguageId");
    }
    if (!ERPSystemId) {
        $('#ERPEtlSystemIdError').html("Please enter ERPSystemId");
    } else {

        $('.dataMigrationInputError').hide();
        $('.visionDataMigrationError').hide();
        connectErpEtlDatabaseProcess(connectionName, hostName, ClientId, userName, password, ERPSystemId, typeName, LanguageId, type);
    }
}
function connectErpEtlDatabaseProcess(connectionName, hostName, ClientId, userName, password, ERPSystemId, selectedDbType, LanguageId, ConnectionType) {
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'getErpConnectionDetails',
        async: true,
        data: {
            connectionName: connectionName,
            ClientId: ClientId,
            hostName: hostName,
            userName: userName,
            password: password,
            LanguageId: LanguageId,
            ERPSystemId: ERPSystemId,
            checkedVal: true,
            selectedItemLabel: selectedDbType,
            EtlERPFlag: 'Y',
            ConnectionType: ConnectionType

        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var responseObj = JSON.parse(response);
                if (responseObj != null && responseObj.connectionFlag == 'Y') {
                    $('#visionShowErpEtlMsg').show();
                    $('#visionShowErpEtlMsg').html('<p style="color:green">' + responseObj['connectionMessage'] + '</p>');
                    $("#connectEtlDbTd").html("<input type='button' value='Close' name='Close'  onclick = \"closeEtlConnectionDialog()\" class='visionEtlCloseButton'>");
                    // showMessagePopup(result['connectionMessage']);
                } else {
                    // showMessagePopup(result['connectionMessage']);
                    $('#visionShowErpEtlMsg').show();
                    $('#visionShowErpEtlMsg').html('<p style="color:red">' + responseObj['connectionMessage'] + '</p>');
                }
                if (selectedDbType != null) {
                    var treeItemElement = globalFileTreeItem[selectedDbType];
                    if (treeItemElement != null) {
                        var $element = $(treeItemElement);
                        var children = $element.find('ul:first').children();
                        if (children != null && children.length > 0) {
                            $.each(children, function (index) {
                                $('#savedConnections').jqxTree('removeItem', this)
                            })
                            $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
                            $('#savedConnections').jqxTree('collapseItem', treeItemElement);
                            $('#savedConnections').jqxTree('expandItem', treeItemElement);
                        }
                    }
                }
//                var treeItemElement = globalFileTreeItem[selectedDbType.toUpperCase()];
//                var $element = $(treeItemElement);
//                var children = $element.find('ul:first').children();
//                $.each(children, function (index) {
//                    $('#savedConnections').jqxTree('removeItem', this)
//                })
//                $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
//                $('#savedConnections').jqxTree('collapseItem', treeItemElement);
//                $('#savedConnections').jqxTree('expandItem', treeItemElement);
                // files expand ravi end 
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
        }

    });
}

function refreshLogFile() {
    var jobId = $("#currentJobId").val();
    stopLoader();


    var currentProcesslogDate = $("#currentProcesslogDate").val();
    var currentProcesslogIndex = $("#currentProcesslogIndex").val();


    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'refreshProcessLog',
        async: true,
        data: {
            currentProcesslogDate: ((currentProcesslogDate != null && currentProcesslogDate != '') ? currentProcesslogDate : ""),
            currentProcesslogIndex: ((currentProcesslogIndex != null && currentProcesslogIndex != '') ? currentProcesslogIndex : ""),
            jobId: jobId
        },
        success: function (response) {
            if (response != null && response != '') {
                var resultObj = JSON.parse(response);
                if (resultObj != null && !jQuery.isEmptyObject(resultObj)) {
                    showRecordCountOnOp(resultObj);
                    $("#previousProcessLogIndex").val($("#currentProcesslogIndex").val());
                    $("#currentProcesslogIndex").val(resultObj['currentProcesslogIndex']);
                    var logTxt = resultObj['logTxt'];
                    if (logTxt != null && logTxt != '') {
                        if ($("#currentProcesslogIndex").val() != $("#previousProcessLogIndex").val()) {
                            $("#processlogTable tbody").append(logTxt);
                        }
                        $("#currentProcesslogDate").val(resultObj['currentProcesslogDate']);
                        if (resultObj['processFlag'] == 'N') {
                            clearInterval(processLogInterval);
                        }

                    } else {

                    }
                } else {

                }
            } else {

            }
        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
            if (processLogInterval != null) {
                clearInterval(processLogInterval);
            }
        }

    });

}
function openLogFile() {
    var jobId = $("#currentJobId").val();
    var processLogTable = "<div id='processLogDiv' class='LogTableMain'>"
            + "<div id=''> "
            + " <div class='logIconDiv'>"
            + "<img src=\"images/StopPocessJob.svg\" class=\"visionETLIcons\" title=\"Cancel Job Execution\" "
            + " style=\"width:15px;height: 15px;cursor:pointer;\""
            + " onclick='cancellCurrentJob()'/>"
            + "<img src=\"images/Refresh Icon.svg\" class=\"visionETLIcons\" title=\"Refresh log\" "
            + " style=\"width:15px;height: 15px;cursor:pointer;margin-left:5px;\""
            + " onclick='refreshLogFile()'/>"
            + "</div>"
            + "</div"
            + "<input type='hidden' id='currentProcesslogDate'/><input type='hidden' id='currentProcesslogIndex'/><input type='hidden' id='previousProcessLogIndex'/>"//currentProcesslogIndex
            + "<table id='processlogTable' class='logtable' style='width:100%'>"
            + "<thead>"
            + "<tr>"
            + "<th width='5%'></th>"
            + "<th width='25%' style='background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center;'>Time Stamp</th>"
            + "<th width='70%' style='background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center;'>Message</th>"
            + "</tr>"
            + "</thead>"
            + "<tbody>"
            + "</tbody>"
            + "</table>"
            + "</div>";
    $("#dialogLogFile").html(processLogTable);
    $("#dialogLogFile").dialog({
        title: (labelObject['Log File'] != null ? labelObject['Log File'] : 'Log File'),
        modal: true,
        width: 'auto',
        maxWidth: 500,
        height: 'auto',
        maxHeight: 500,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    if (processLogInterval != null) {
                        clearInterval(processLogInterval);
                    }
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }],
        open: function () {
            processLogInterval = setInterval(function () {
                refreshLogFile() // this will run after every 1 seconds
            }, 2000);
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
            $(".ui-dialog").addClass('visionDMTreePopup');
//                            $("#dataMigrationTabs").jqxTabs({width: "100%", height: "130px", position: 'top', theme: 'ui-redmond', reorder: true});
//
//                            $('#dataMigrationTabs').unbind('selected').on('selected', function (event) {
//                                $('#iconsdiv').attr('style', 'margin-top:4px !important');
//                            });
//                            $("#dataMigrationTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

        },
        beforeClose: function (event, ui)
        {

            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");

        }, close: function (event, ui)
        {
            if (processLogInterval != null) {
                clearInterval(processLogInterval);
            }
//                        $(this).html("");
//                        $(this).dialog("close");
//                        $(this).dialog("destroy");
        }
    });

}

function recursiveReplaceFont(queryString, replceStr, fontStr) {
    if (queryString != null && queryString != '' && queryString.indexOf(replceStr) > -1) {
        var quotetedStr = "'" + queryString.substring(queryString.indexOf(replceStr) + 1,
                queryString.indexOf(replceStr, queryString.indexOf(replceStr) + 1)) + "'";
        queryString = queryString.replace(quotetedStr, fontStr + quotetedStr + "</font>");
        if (queryString != null && queryString != '' && queryString.indexOf(replceStr) > -1) {
            queryString = recursiveReplaceFont(queryString, replceStr, fontStr);
        }
    }
}

function dataTypeDialog($this) {
    var allDataTypeObjStr = $("#sqlAllDataTypeObj").val();
    if (allDataTypeObjStr != null && allDataTypeObjStr != '') {
        var allDataTypeObj = JSON.parse(allDataTypeObjStr);
        if (allDataTypeObj != null && !jQuery.isEmptyObject(allDataTypeObj)) {
            var toSysType = $("#sqlToDataSourceName").attr("data-tosystype");
            if (toSysType != null && toSysType != '') {
                toSysType = toSysType.toUpperCase();
            }
            var allDataTypeStr = allDataTypeObj[toSysType];
            //dataTypeDialog
            $("#dataTypeDialog").html(allDataTypeStr);
            $("#dataTypeDialog").dialog({
                title: ((labelObject['Data Type'] != null ? labelObject['Data Type'] : 'Data Type') + "(" + toSysType + ")"),
                modal: true,
                height: 'auto',
                minWidth: 700,
                maxWidth: 1000,
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var dataTypeList = $("#dataTypeList").val();
                            var dataTypeLength = $("#dataTypeLength").val();
                            var dataTypeByteChar = $("#dataTypeByteChar").val();
                            var dataTypePrecesion = $("#dataTypePrecesion").val();
                            var dataTypeScale = $("#dataTypeScale").val();
                            if (dataTypeList != null && dataTypeList != '') {
                                var dataType = dataTypeList;

                                if (dataTypeLength != null && dataTypeLength != '' && !$("#dataTypeLength").prop('disabled')) {
                                    dataType += "(" + dataTypeLength;
                                    if (dataTypeByteChar != null && dataTypeByteChar != '' && !$("#dataTypeByteChar").prop('disabled')) {
                                        dataType += " " + dataTypeByteChar;
                                    }
                                    dataType += ")";
                                } else if (dataTypePrecesion != null && dataTypePrecesion != '' && !$("#dataTypePrecesion").prop('disabled')) {
                                    dataType += "(" + dataTypePrecesion;
                                    if (dataTypeScale != null && dataTypeScale != '' && !$("#dataTypeScale").prop('disabled')) {
                                        dataType += " ," + dataTypeScale;
                                    }
                                    dataType += ")";
                                }
                                $($this).find('input').val(dataType);
                                $($this).find('span').html(dataType);
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }

                        }},
                    {
                        text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                        click: function () {
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
                            // $("#labeld").empty();

                        }

                    }],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });
        }
    }
}
function dataTypeChange($this, id) {
    var dataType = $("#" + id).val();
    if (dataType != null && dataType != '') {
        var sysType = $("#" + id).find(':selected').data('sys-type');
        var maxLen = $("#" + id).find(':selected').data('max-len');
        var lengthFlag = $("#" + id).find(':selected').data('length-flag');//visionDataTypeLength
        var byteCharFlag = $("#" + id).find(':selected').data('byte-char-flag');//visionDataTypeByteChar
        var precesionFlag = $("#" + id).find(':selected').data('precesion-flag');//visionDataTypePrecesion
        var scaleFlag = $("#" + id).find(':selected').data('scale-flag');//visionDataTypeScale
        if (lengthFlag == 'Y') {
            $(".visionDataTypeLength").removeAttr("disabled");
        } else {
            $(".visionDataTypeLength").attr("disabled", "disabled");
        }
        if (byteCharFlag == 'Y') {
            $(".visionDataTypeByteChar").removeAttr("disabled");
        } else {
            $(".visionDataTypeByteChar").attr("disabled", "disabled");
        }
        if (precesionFlag == 'Y') {
            $(".visionDataTypePrecesion").removeAttr("disabled");
        } else {
            $(".visionDataTypePrecesion").attr("disabled", "disabled");
        }
        if (scaleFlag == 'Y') {
            $(".visionDataTypeScale").removeAttr("disabled");
        } else {
            $(".visionDataTypeScale").attr("disabled", "disabled");
        }

    } else {
        $(".visionDataTypeLength").removeAttr("disabled");
        $(".visionDataTypeByteChar").removeAttr("disabled");
        $(".visionDataTypePrecesion").removeAttr("disabled");
        $(".visionDataTypeScale").removeAttr("disabled");
    }
}



//function showSavedJobs(newJobId) {
//    $.ajax({
//        type: "post",
//        traditional: true,
//        dataType: 'json',
//        url: 'fetchSavedJobs',
//        cache: false,
//        data: {},
//
//        success: function (response) {
//            ajaxStop();
//            var availableJobshtmlStr = response['availableJobshtmlStr'];
////            var jobIdList = response['jobIdList'];
////            var jobDescrList = response['jobDescrList'];
////            if (jobIdList.length > 0) {
////                var availableJobshtmlStr = '<div id="avaialableJobsTree">\n\
////                                                <ul>\n\
////                                                    <li>Saved Jobs\n\
////                                                        <ul>';
////
////                var imgIconStr = '<img src="images/Process Icon-01.svg" class="visionETLIcons"  style="width:15px;height: 15px;cursor:pointer;"/>';
////                $.each(jobIdList, function (index) {
////                    availableJobshtmlStr += '<li><div id="' + jobIdList[index] + '" class="visionETLAvailableJobs" ondblclick="openSavedJob(event,\'' + jobIdList[index] + '\',\'' + jobDescrList[index] + '\')">' + imgIconStr + '<span style="cursor:pointer;">  ' + (jobDescrList[index]).toUpperCase() + '</span></div></li>'
////
////                });
////                availableJobshtmlStr += '</ul></li></ul></div>';
//            if (availableJobshtmlStr != null && availableJobshtmlStr != '') {
//                $("#availableJobsId").html(availableJobshtmlStr);
//                $('#avaialableJobsTree').jqxTree({height: '98%', width: '98%'});
//                $('#avaialableJobsTree').jqxTree('expandAll');
//                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
//                $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
//                $(currentJobItem).addClass("selectJqxTreeItem");
//                $('#avaialableJobsTree').jqxTree('expandAll');
//            }
//
//
//            var predefinedJobshtmlStr = response['predefinedJobshtmlStr'];
//            if (predefinedJobshtmlStr != null && predefinedJobshtmlStr != '') {
//                $("#preDefinedJobs").html(predefinedJobshtmlStr);
//                $('#predefinedJobsTree').jqxTree({height: '98%', width: '98%'});
//                $('#predefinedJobsTree').jqxTree('expandAll');
//                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
//                $("#predefinedJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
//                $(currentJobItem).addClass("selectJqxTreeItem");
//                $('#predefinedJobsTree').jqxTree('expandAll');
//            }
//
//
//            var dataModellerJobshtmlStr = response['dataModellerJobshtmlStr'];
//            if (dataModellerJobshtmlStr != null && dataModellerJobshtmlStr != '') {
//                $("#dataModellerJobsDiv").html(dataModellerJobshtmlStr);
//                $('#dataModellerJobsTree').jqxTree({height: '98%', width: '98%'});
//                $('#dataModellerJobsTree').jqxTree('expandAll');
//                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
//                $("#dataModellerJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
//                $(currentJobItem).addClass("selectJqxTreeItem");
//                $('#dataModellerJobsTree').jqxTree('expandAll');
//            }
//            // $(".jqx-tree-item").addClass("selectJqxTreeItem");
//
//
////                try{
////                    $('#avaialableJobsTree').jqxTree('destroy');
////                }catch(e){}
//
//
////            }
//        },
//        error: function (e)
//        {
//            sessionTimeout(e);
//        }
//
//    });
//
//}

function openPredefinedJob(event, jobId, jobDescr) {
    $("#currentJobId").val(jobId);
    $("#currentJobName").val(jobDescr);
    showLoader();
    var targetDiv = $(event.target).parents('li:first').find("div:first")[0];
    $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
    $(targetDiv).addClass("selectJqxTreeItem");
    var data = {
        jobDescr: jobDescr,
        jobId: jobId

    };

    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'getSavedJobData',
        cache: false,
        data: data,
        success: function (response) {
            var flowChartData = JSON.parse(response['flowChartData']);
            var operators = flowChartData['operators'];

            var sourceConnectionsDiv =
                    '<div>\n\
                        <table class="visionEtlCreateSQLDS" id="selectSourceConnections" style="width: 100%;" border="1">\n\
                       <tbody>\n\
                       <tr><th width="50%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center">Table Name</th><th width="50%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center"> Connection</th></tr>'
            var destConnectionsDiv =
                    '<div>\n\
                       <table class="visionEtlCreateSQLDS" id="selectDestConnections" style="width: 100%;" border="1">\n\
                       <tbody>\n\
                       <tr><th width="50%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center">Table Name</th><th width="50%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center"> Connection</th></tr>'

            $.each(operators, function (indx) {

                if (this['operatorType'] == 'predefinedSource') {

                    sourceConnectionsDiv += '<tr><td>' + this.tableName + '  </td><td><input id="sourceConn_' + indx + '" class="visionDSMappingInput" type="text" value="" data-conobjstr="" data-tosystype="" readonly="true"><img src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectFunColumnValue(this,\'ALL_SCHEMA\',\'Data Source\',\'' + this['CONN_CUST_COL2'] + '\')" style=""></td></tr>'
                } else if (this['operatorType'] == 'predefinedTarget') {
                    destConnectionsDiv += '<tr><td>' + this.tableName + '  </td><td><input id="destConn_' + indx + '" class="visionDSMappingInput" type="text" value="" data-conobjstr="" data-tosystype="" readonly="true"><img src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectFunColumnValue(this,\'ALL_SCHEMA\',\'Data Source\',\'' + this['CONN_CUST_COL2'] + '\')" style=""></td></tr>'

                }
            })

            sourceConnectionsDiv += ' </tbody></table></div>';
            destConnectionsDiv += ' </tbody></table></div>';




            var divStr = '<div id="selectConnectionsTab">\n\
                            <ul style="margin-left: 20px;"><li>Source Connections</li><li>Destination Connections</li></ul>\n\
                            <div id="sourceConnectionsDiv">' + sourceConnectionsDiv + '</div>\n\
                            <div id="destConnectionsDiv">' + destConnectionsDiv + '</div>\n\
                            </div>';


//            '<div>\n\
//            <table class="visionEtlCreateSQLDS" id="selectConnections" style="width: 100%;" border="1">\n\
//            <tbody>\n\
//            <tr><td>Source Connection:</td><td><input id="sourceConnection" class="visionDSMappingInput" type="text" value="" data-conobjstr="" data-tosystype="" readonly="true"><img src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectFunColumnValue(this,\'ALL_SCHEMA\',\'Data Source\',\'' + dbType + '\')" style=""></td></tr>\n\
//            <tr><td>Destination Connection:</td><td><input id="destConnection" class="visionDSMappingInput" type="text" value="" data-conobjstr="" data-tosystype="" readonly="true"><img src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectFunColumnValue(this,\'ALL_SCHEMA\',\'Data Source\',\'' + dbType + '\')" style=""></td></tr>\n\
//            </tbody></table>\n\
//            </div>'

            $("#dialog1").html(divStr);
            $("#dialog1").dialog({
                title: (labelObject['Select Connections'] != null ? labelObject['Confirmation'] : 'Select Connections'),
                modal: true,
                height: 400,
                minWidth: 300,
                width: 500,
                maxWidth: 'auto',
                maxHeight: 500,
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var connectionEmpty = false;
                            $.each(operators, function (indx, value) {

                                if (this['operatorType'] == 'predefinedSource') {


                                    var sourceOperator = value;
                                    if (sourceOperator != null) {
                                        if ($("#sourceConn_" + indx).val() == null || $("#sourceConn_" + indx).val() == "") {
                                            connectionEmpty = true;

                                        } else {
                                            var connObj = $("#sourceConn_" + indx).attr("data-conobjstr")
                                            connObj = JSON.parse(connObj);
                                            var CONN_CUST_COL1 = $("#sourceConn_" + indx).attr("data-tosystype")
                                            var CONNECTION_NAME = $("#sourceConn_" + indx).val();
                                            sourceOperator['connObj'] = connObj;
                                            sourceOperator['CONN_CUST_COL1'] = CONN_CUST_COL1;
                                            sourceOperator['CONNECTION_NAME'] = CONNECTION_NAME;

                                            $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', value['operatorId'], sourceOperator);


                                        }

                                    }

                                }
                                if (this['operatorType'] == 'predefinedTarget') {

                                    var targetOperator = value;
                                    if (targetOperator != null) {
                                        if ($("#destConn_" + indx).val() == null || $("#destConn_" + indx).val() == "") {
                                            connectionEmpty = true;

                                        } else {
                                            var connObj = $("#destConn_" + indx).attr("data-conobjstr")
                                            connObj = JSON.parse(connObj);
                                            var CONN_CUST_COL1 = $("#destConn_" + indx).attr("data-tosystype")
                                            var CONNECTION_NAME = $("#destConn_" + indx).val();
                                            targetOperator['connObj'] = connObj;
                                            targetOperator['CONN_CUST_COL1'] = CONN_CUST_COL1;
                                            targetOperator['CONNECTION_NAME'] = CONNECTION_NAME;
                                            var abc = indx;
                                            $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', value['operatorId'], targetOperator);


                                        }


                                    }

                                }
                            })

                            if (connectionEmpty) {
                                showMesg("Please select connections");
                                connectionEmpty = false;
                            } else {
                                $(this).dialog("close");
                                $(this).html("");
                                $(this).dialog("destroy");
                            }



                        }}],
                open: function () {
                    $("#selectConnectionsTab").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});



                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                },
                beforeClose: function (event, ui)
                {
                    $.each(operators, function (indx) {
                        if (this['operatorType'] == 'predefinedSource') {
                            if ($("#sourceConn_" + indx).val() == null || $("#sourceConn_" + indx).val() == "") {
                                showMesg("Please select Connections");
                                event.preventDefault();
                            }
                        } else if (this['operatorType'] == 'predefinedTarget') {
                            if ($("#destConn_" + indx).val() == null || $("#destConn_" + indx).val() == "") {
                                showMesg("Please select Connections");
                                event.preventDefault();

                            }
                        }
                    })

                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });


            stopLoader();
            switchETLDesignTabs("li_designView", "contentSplitter"); // -----code start
            var flowChartData = JSON.parse(response['flowChartData']);

            $("#" + flowChartWorkSpaceId).remove();
            $("#feedHeader").append('<div  id="flowchartworkSourcesspace" class="flowchart-example-container"></div>');

            $('#' + flowChartWorkSpaceId).flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $('#' + flowChartWorkSpaceId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });


            var count = 0;
            var OperatorsData = {};
            var linksData = {};
            try {
                for (var key in flowChartData.operators) {

                    OperatorsData[count] = flowChartData.operators[key];
                    for (var i in flowChartData.links) {
                        if (parseInt(key) == flowChartData.links[i].fromOperator) {
                            flowChartData.links[i].fromOperator = count;
                        }
                        if (parseInt(key) == flowChartData.links[i].toOperator) {
                            flowChartData.links[i].toOperator = count;
                        }

                    }

                    count = count + 1;
                }
                for (var key in OperatorsData) {
                    $('#' + flowChartWorkSpaceId).flowchart('addOperator', OperatorsData[key]);
                }
            } catch (e) {
            }



            var count = 0;
            //   try {

            for (var key in flowChartData.links) {

                linksData[count] = flowChartData.links[key];
                count = count + 1;

            }
            for (var key in linksData) {
                $('#' + flowChartWorkSpaceId).flowchart('addLink', linksData[key]);
            }

            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();
            $(".visionMapOperator").removeClass("visionOpLabelDiv");
            // $('#'+flowChartWorkSpaceId).flowchart('setData', flowChartData);
            $("#dataMigrationTabs").remove();
            $("#normalizeOptionsTabs").remove(); // ravi normalise
            $("#deNormalizeOptionsTabs").remove();
            var mapIcons = $(".visionMapOperator");
            $.each(mapIcons, function (index) {
                $(this).attr('job-id', jobId);
                $(this).attr('job-name', jobDescr);
            });

//$("[title='Update']").attr("onclick","updateJob('"+jobId+"','"+jobDescr+"')");

            $('#dataMigrationTabs :input').keyup(function (event) {
                if (event.target.nodeName == 'INPUT') {
                    var $this = $(event.target);
                    $this.attr("value", event.target.value);
                    $this.attr("title", event.target.value);
                    $this.val(event.target.value);
                }

            });
            previousOperatorId = null;
            prevTargetOperatorId = null;
            trfmRulesChanged = false;
            $("#emptyJobName").val(""); // ------------------code start emptyJob
            $("#emptyJobId").val("");

            $("#currentTrnsOpId").val(""); // ravi updated code changes
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function openSavedDataModellerJob(event, jobId, jobDescr, jobType) {
    //   var $flowChart = $("#dataModellerFlowchartworkSourcesspace");
    $("#currentJobId").val(jobId);
    $("#currentJobName").val(jobDescr);
    showLoader();
    var targetDiv = $(event.target).parents('li:first').find("div:first")[0];
    $("#dataModellerJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
    $(targetDiv).addClass("selectJqxTreeItem");
    var data = {
        jobDescr: jobDescr,
        jobId: jobId

    };

    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'getSavedJobData',
        cache: false,
        data: data,

        success: function (response) {
            stopLoader();
            switchETLDesignTabs("li_DataModeller", "dataModellerDiv"); // -----code start
            var flowChartData = JSON.parse(response['flowChartData']);

            $("#dataModellerFlowchartworkSourcesspace").remove();
            $("#feedHeader1").append('<div  id="dataModellerFlowchartworkSourcesspace" class="flowchart-example-container"></div>');

            $("#dataModellerFlowchartworkSourcesspace").flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $("#dataModellerFlowchartworkSourcesspace").flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });

            var count = 0;
            var OperatorsData = {};
            var linksData = {};
            try {
                for (var key in flowChartData.operators) {

                    OperatorsData[count] = flowChartData.operators[key];
                    for (var i in flowChartData.links) {
                        if (parseInt(key) == flowChartData.links[i].fromOperator) {
                            flowChartData.links[i].fromOperator = count;
                        }
                        if (parseInt(key) == flowChartData.links[i].toOperator) {
                            flowChartData.links[i].toOperator = count;
                        }

                    }

                    count = count + 1;
                }
                for (var key in OperatorsData) {
                    $("#dataModellerFlowchartworkSourcesspace").flowchart('addOperator', OperatorsData[key]);
                }
            } catch (e) {
            }



            var count = 0;
            //   try {

            for (var key in flowChartData.links) {

                linksData[count] = flowChartData.links[key];
                count = count + 1;

            }
            for (var key in linksData) {
                $("#dataModellerFlowchartworkSourcesspace").flowchart('addLink', linksData[key]);
            }

            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();
            $(".visionMapOperator").removeClass("visionOpLabelDiv");
            // $('#'+flowChartWorkSpaceId).flowchart('setData', flowChartData);
            $("#dataMigrationTabs").remove();
            $("#normalizeOptionsTabs").remove(); // ravi normalise
            $("#deNormalizeOptionsTabs").remove();
            var mapIcons = $(".visionMapOperator");
            $.each(mapIcons, function (index) {
                $(this).attr('job-id', jobId);
                $(this).attr('job-name', jobDescr);
            });

//$("[title='Update']").attr("onclick","updateJob('"+jobId+"','"+jobDescr+"')");

            $('#dataMigrationTabs :input').keyup(function (event) {
                if (event.target.nodeName == 'INPUT') {
                    var $this = $(event.target);
                    $this.attr("value", event.target.value);
                    $this.attr("title", event.target.value);
                    $this.val(event.target.value);
                }

            });
            previousOperatorId = null;
            prevTargetOperatorId = null;
            trfmRulesChanged = false;
            $("#emptyJobName").val(""); // ------------------code start emptyJob
            $("#emptyJobId").val("");

            $("#currentTrnsOpId").val(""); // ravi updated code changes
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function openSavedJob(event, jobId, jobDescr, folderName, folderId) {
    $("#folderNameHidden").val(folderName);
    $("#folderIdHidden").val(folderId);
    $("#currentGroupJobName").val(jobDescr);
    $("#currentJobId").val(jobId);
    $("#currentJobName").val(jobDescr);
    showLoader();
    var targetDiv = $(event.target).parents('li:first').find("div:first")[0];
    $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
    $(targetDiv).addClass("selectJqxTreeItem");
    var data = {
        jobDescr: jobDescr,
        jobId: jobId
    };
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'getSavedJobData',
        cache: false,
        data: data,
        success: function (response) {
            stopLoader();
            switchETLDesignTabs("li_designView", "contentSplitter"); // -----code start
            var flowChartData = JSON.parse(response['flowChartData']);
//            $("#"+flowChartWorkSpaceId).remove();
            flowChartWorkSpaceId = "workSpace_" + jobId;
            var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');

            if (selectedItemIndex == null) {
                $("#feedHeader").append('<div id="flowChartTabs"  class="flowChartTabs flowChartHeaderTabs" style="width: 100%;height: 9%;"><ul class=flowChartTabList><li></li></ul><div></div></div>');
                $('#flowChartTabs').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                $('#flowChartTabs').jqxTabs('showAllCloseButtons');
                $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                $('#flowChartTabs').jqxTabs('removeAt', 0);
                $('#flowChartTabs').jqxTabs('addFirst', jobDescr, '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>');
            } else {
                var flowChartIndex = 'workSpace_' + jobId;
                var length = $('#flowChartTabs').jqxTabs('length');
                var openedTab = false;
                for (var i = 0; i < length; i++) {
                    var title = $('#flowChartTabs').jqxTabs('getTitleAt', i);
                    if (title != null && title == jobDescr) {
                        $('#flowChartTabs').jqxTabs('select', i);
                        openedTab = true;
                        $("#" + flowChartIndex).remove();
                        var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
                        var htmlDiv = '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                        $('#flowChartTabs').jqxTabs('setContentAt', selectedItemIndex, htmlDiv);
                        break;
                    }
                }
                if (!openedTab) {
                    var divStr = ''
                    divStr += '<div  style="display: flex;float:left;margin-top:5px;">'
                    divStr += '</div>'
                    divStr += '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                    divStr += '';
                    $('#flowChartTabs').jqxTabs('showAllCloseButtons');
                    $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                    $('#flowChartTabs').jqxTabs('addLast', jobDescr, divStr);
                }
            }
            $('#flowChartTabs').on('selected', function (event)
            {
                $("#feedContentArea").html("");

                var clickedItem = event.args.item;
                var jobName = $('#flowChartTabs').jqxTabs('getTitleAt', clickedItem);

                var content = $('#flowChartTabs').jqxTabs('getContentAt', clickedItem);
                var workSpaceId = $(content).attr("id");
                if (workSpaceId != null) {
                    flowChartWorkSpaceId = workSpaceId;
                }
                if (workSpaceId == null) {
                    workSpaceId = $(content).children('div:nth-child(1)').attr("id");
                    var childDiv = $(content).children();
                    var childDivID = childDiv[0];
                    flowChartWorkSpaceId = childDivID['id'];
                }
                if (workSpaceId == null) {
                    workSpaceId = $(content).children('div:nth-child(1)').attr("id");
                    var childDiv = $(content).children();
                    var childDivID = childDiv[1];
                    if (childDivID != null) {
                        flowChartWorkSpaceId = childDivID['id'];
                    }
                    if (childDivID == null) {
                        var lastChildId = $(content).children().last();
                        var getIdDiv = lastChildId[0];
                        var childId = getIdDiv['lastChild'];
                        flowChartWorkSpaceId = childId['id'];
                    }
                }
                var jobId = flowChartWorkSpaceId.substring(10, 100);
                var jobName = $('#flowChartTabs').jqxTabs('getTitleAt', clickedItem);
                $('#currentJobName').val(jobName);
                $("#currentJobId").val(jobId);
                var divHiddenFileds = $('#' + flowChartWorkSpaceId).find('input[type="hidden"]')
                var id = divHiddenFileds[0].id;
                var name = divHiddenFileds[1].id;
                var folderId = $("#" + id).val();
                var folderName = $("#" + name).val();
                $("#folderIdHidden").val(folderId);
                $("#folderNameHidden").val(folderName);

            });



            $("#workSpace_" + jobId).flowchart({
                linkWidth: 2,
                defaultSelectedLinkColor: '#000055',
                grid: 10,
                distanceFromArrow: 0,
                multipleLinksOnInput: true,
                multipleLinksOnOutput: true,
                defaultSelectedLinkColor: 'red',
                onOperatorContextMenu: function (operatorId) {
                    console.log("operatorId:::" + operatorId);
                    openOpeartorContextMenu(operatorId);
                    return true;
                },
            });
            $("#workSpace_" + jobId).flowchart({
                onLinkCreate: function (linkId, linkData) {

                    var fromOperatorId = linkData['fromOperator'];
                    var toOperatorId = linkData['toOperator'];
                    var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                    var connectedTo = fromOperatorData['connectedTo'];
                    connectedTo = (connectedTo != null) ? connectedTo : [];
                    if (connectedTo.indexOf(toOperatorId) == -1) {
                        connectedTo.push(toOperatorId)
                    }

                    fromOperatorData['connectedTo'] = connectedTo;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                    var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                    var connectedFrom = toOperatorData['connectedFrom'];
                    connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                    if (connectedFrom.indexOf(fromOperatorId) == -1) {
                        connectedFrom.push(fromOperatorId)
                    }

                    toOperatorData['connectedFrom'] = connectedFrom;
                    if (toOperatorData['component'] == 'Y') {
                        toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }
                    var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                    var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                    if (originalSources.indexOf(fromTable) == -1) {
                        originalSources.push(fromTable);
                    }
                    toOperatorData['originalSources'] = originalSources;

                    var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                    if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                        originalSourceOp.push(fromOperatorId);
                    }
                    toOperatorData['originalSourceOp'] = originalSourceOp;
                    $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                    //            setToOpDblCLickFuncName(fromOperator, toOperator);
                    return true;
                },
                onAfterChange: function (changeType) {

                    if (!operatorDoublClick) {
                        trfmRulesChanged = true;
                        console.error("trfmRulesChanged : " + trfmRulesChanged);
                        return true;
                    }
                },
                onOperatorSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;

                },
                onLinkSelect: function (changeType) {
                    $(document).find("input").blur();
                    return true;
                }
            });
            var count = 0;
            var OperatorsData = {};
            var linksData = {};
            try {
                for (var key in flowChartData.operators) {

                    OperatorsData[count] = flowChartData.operators[key];
                    for (var i in flowChartData.links) {
                        if (parseInt(key) == flowChartData.links[i].fromOperator) {
                            flowChartData.links[i].fromOperator = count;
                        }
                        if (parseInt(key) == flowChartData.links[i].toOperator) {
                            flowChartData.links[i].toOperator = count;
                        }

                    }

                    count = count + 1;
                }
                for (var key in OperatorsData) {
                    $("#workSpace_" + jobId).flowchart('addOperator', OperatorsData[key]);
                }
            } catch (e) {
            }



            var count = 0;
            //   try {

            for (var key in flowChartData.links) {

                linksData[count] = flowChartData.links[key];
                count = count + 1;

            }
            for (var key in linksData) {
                $("#workSpace_" + jobId).flowchart('addLink', linksData[key]);
            }

            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();
            $(".visionMapOperator").removeClass("visionOpLabelDiv");
            // $('#'+flowChartWorkSpaceId).flowchart('setData', flowChartData);
            $("#dataMigrationTabs").remove();
            $("#normalizeOptionsTabs").remove(); // ravi normalise
            $("#deNormalizeOptionsTabs").remove();
            var mapIcons = $(".visionMapOperator");
            $.each(mapIcons, function (index) {
                $(this).attr('job-id', jobId);
                $(this).attr('job-name', jobDescr);
            });

//$("[title='Update']").attr("onclick","updateJob('"+jobId+"','"+jobDescr+"')");

            $('#dataMigrationTabs :input').keyup(function (event) {
                if (event.target.nodeName == 'INPUT') {
                    var $this = $(event.target);
                    $this.attr("value", event.target.value);
                    $this.attr("title", event.target.value);
                    $this.val(event.target.value);
                }

            });
            previousOperatorId = null;
            prevTargetOperatorId = null;
            trfmRulesChanged = false;
            $("#emptyJobName").val(""); // ------------------code start emptyJob
            $("#emptyJobId").val("");

            $("#currentTrnsOpId").val(""); // ravi updated code changes

            $(".visionCountLabelsDiv").remove();
//            var htmlDiv = $('#'+flowChartWorkSpaceId).html();
////            $("#flowChartTabs").append();
//            $("#flowChartTabs").append(htmlDiv);
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}


function rightClickProcessJob(jobId) {
    showLoader();
    $("#currentJobId").val(jobId);
    $("#currentJobName").val("");
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'html',
        cache: false,
        url: "getJobTransformationRules",
        data: {
            jobId: jobId,
        },
        success: function (response) {
            showLoader();
            try {
                response = JSON.parse(response);
            } catch (e) {
            }

            var processJobData = JSON.parse(response['processJobDataObj']);
            processJobData['mappedData'] = response['mappedObjectData'];
            processJobData['jobId'] = jobId;
            $.ajax({
                type: 'post',
                traditional: true,
                dataType: 'html',
                cache: false,
                url: 'processETLData',
                async: true,
                data: processJobData,
                success: function (response) {
                    stopLoader();
                    try {
                        $("#currentJobId").val(response['jobId']);
                        $("#currentJobName").val(response['jobName']);
                    } catch (e) {
                    }
                    openLogFile();

                },
                error: function (e)
                {
                    sessionTimeout(e);
                    stopLoader();
                    if (processLogInterval != null) {
                        clearInterval(processLogInterval);
                    }
                }

            });

        }

    });
}

function deleteJob(jobId) {
    var selectedItem = $('#avaialableJobsTree').jqxTree('selectedItem');
    var parentFolderElement = selectedItem.element.parentElement.parentElement;
    var parentFolderItem = $('#avaialableJobsTree').jqxTree('getItem', parentFolderElement);
    $("#dialog").html("Are you sure you want to delete the Job ??");
    $("#dialog").dialog({
        title: (labelObject['Confirmation'] != null ? labelObject['Confirmation'] : 'Confirmation'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                click: function () {

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                    showLoader();
                    $.ajax({
                        type: "post",
                        traditional: true,
                        dataType: 'html',
                        cache: false,
                        url: "deleteJob",
                        data: {
                            jobId: jobId,
                        },
                        success: function (response) {
                            stopLoader();
                            try {
                                response = JSON.parse(response);
                            } catch (e) {
                            }
                            var message = response['message'];

                            showMesg(message);
                            $('#avaialableJobsTree').jqxTree('collapseItem', parentFolderElement);
                            $('#avaialableJobsTree').jqxTree('expandItem', parentFolderElement);
//                            showSavedJobs();

                        },
                        error: function (e)
                        {
                            sessionTimeout(e);
                        }

                    });


                }},
            {
                text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                    // $("#labeld").empty();

                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });



}

function showFileNamePopup($this, fileType) {
    showLoader();
    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedFileOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
    var getLinksTo = $('#' + flowChartWorkSpaceId).flowchart('getLinksTo', selectedOperatorId);
    var fileName = selectedFileOperatorData['userFileName'];
    if (!(fileName != null && fileName != '')) {
        fileName = '';
    }
    var fileNameDiv = "<div><input type='text' placeholder='Enter File name' id='targetFileName' value='" + fileName + "'/></div>";
    $("#dialog").html(fileNameDiv);
    $("#dialog").dialog({
        title: (labelObject['File Name'] != null ? labelObject['File Name'] : 'File Name'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var targetFileName = $("#targetFileName").val();
                    if (targetFileName != null && targetFileName != '') {
                        fileType = "." + fileType;
                        if (targetFileName.toLowerCase().indexOf(fileType) == -1) {
                            targetFileName += fileType;
                        }
                        selectedFileOperatorData['userFileName'] = targetFileName;
                        operatorDoublClick = true;
                        $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedFileOperatorData);
                        $(".flowchart-operator-connector-label").hide();
                        $(".flowchart-operator-title").hide();
                        operatorDoublClick = false;
                    }
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                }}],
        open: function () {
            stopLoader();
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}
function showMesgContinue(message, processFlag) {
    if (processFlag) {
        message = message + "  Press Ok to process Job"
    }
    if (message != null) {
        $("#dialog").html(message);
        $("#dialog").dialog({
            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                        if (processFlag) {
                            processJob();
                        }

                    }}],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    }
}


function askSaveJobConfirmation() {
    // ravi pre defined job
//        var data = {};
//    try {
//        data = $('#'+flowChartWorkSpaceId).flowchart('getData');
//    } catch (e) {
//    }
//
//    if (data != null && !jQuery.isEmptyObject(data)) {
//        var operators = data['operators'];
//        if (operators!=null){
//            var jobType = operators[0]['jobType'];
//            if (jobType!=null && jobType=="Bapi"){
//                processPredefinedJob(data);
//                return false;
//            }
//        }
//        
//    }

    // ravi pre defined job

    if (trfmRulesChanged) {
        $("#dialog").html(labelObject['Do you want to save job before processing'] != null ? labelObject['Do you want to save job before processing'] : 'Do you want to save job before processing');
        $("#dialog").dialog({
            title: (labelObject['Confirm'] != null ? labelObject['Confirm'] : 'Confirm'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                        trfmRulesChanged = true;
                        getAllMappedData("Y");

                    }},
                {
                    text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");

                        processJob();


                    }}],

            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    } else {
        processJob();
    }

}
function viewConnection() {
    var selectedItem = $("#savedConnections").jqxTree('getSelectedItem');
    var connectonName = selectedItem.value;
    var parentEventItem = selectedItem.parentElement.parentElement.parentElement;

    var selectedParentItem = $('#savedConnections').jqxTree('getItem', parentEventItem);
    var dBType = selectedParentItem['value'];

//    if (connectonName == "Current_V10") {
//        var connectionObj = savedDBData['Current_V10'];
//
//    }


    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'getConnDetails',
        async: true,
        data: {
            connectonName: connectonName,
//            connectionObj: JSON.stringify(connectionObj)
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                //var responseObj = JSON.parse(response);
                $("#dialog1").html(response);
                $("#dialog1").dialog({
                    title: (labelObject['View Connection'] != null ? labelObject['View Connection'] : 'View Connection'),
                    modal: true,
                    height: 'auto',
                    minWidth: 500,
                    maxWidth: 'auto',
                    fluid: true,
                    buttons: [],
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });


            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function updateConnection(auditId, dbType) {
    var data = {}
    if (dbType == "DB" || dbType == "Oracle_ERP") {
        data = {
            connectionName: $("#connectionNameEtl").val(),
            hostName: $("#hostNameEtl").val(),
            port: $("#portEtl").val(),
            userName: $("#userNameEtl").val(),
            password: $("#passwordEtl").val(),
            serviceName: $("#serviceNameEtl").val(),
            serviceName: $("#serviceNameEtl").val(),
            dbType: dbType,
            auditId: auditId,
        }
    } else if (dbType == "ERP") {
        data = {
            connectionName: $("#erpConnectionNameEtl").val(),
            ClientId: $("#erpClientEtl").val(),
            hostName: $("#erpHostNameEtl").val(),
            userName: $("#erpUserNameEtl").val(),
            password: $("#erpPasswordEtl").val(),
            LanguageId: $("#erpLanguageIdEtl").val(),
            ERPSystemId: $("#erpSystemIdEtl").val(),
            dbType: dbType,
            auditId: auditId,
        }
    }
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'updateConnDetails',
        async: true,
        data: data,
        success: function (response) {
            stopLoader();
            if (response != null) {
                //var responseObj = JSON.parse(response);
                showMesg(response);
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}

function deleteFile() {
    var selectedItem = $("#savedConnections").jqxTree('getSelectedItem');
    var fileName = selectedItem.label;
    var filePath = selectedItem.value;
    $("#dialog").html(labelObject['Are you sure you want to delete file?'] != null ? labelObject['Are you sure you want to delete file?'] : 'Are you sure you want to delete file?');
    $("#dialog").dialog({
        title: (labelObject['Confirmation'] != null ? labelObject['Confirmation'] : 'Confirmation'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                    $.ajax({
                        type: 'post',
                        traditional: true,
                        dataType: 'html',
                        cache: false,
                        url: 'deleteFile',
                        async: true,
                        data: {
                            fileName: fileName,
                            filePath: filePath
                        },
                        success: function (response) {
                            stopLoader();
                            if (response.indexOf("Deleted Succesfully") > 0) {
                                $("#savedConnections").jqxTree('removeItem', selectedItem);
                            }

                            if (response != null) {
                                //var responseObj = JSON.parse(response);
                                showMesg(response);
                            }


                        },
                        error: function (e)
                        {
                            sessionTimeout(e);
                        }

                    });

                }},

            {
                text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }}],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });

}


function deleteConnection(auditId) { // ravi updated code changes
    if (auditId == null) {
        var selectedItem = $("#savedConnections").jqxTree('getSelectedItem');
        var connectionName = selectedItem.label;
    }
    $("#dialog").html(labelObject['Are you sure you want to delete connection?'] != null ? labelObject['Are you sure you want to delete connection?'] : 'Are you sure you want to delete connection?');
    $("#dialog").dialog({
        title: (labelObject['Confirmation'] != null ? labelObject['Confirmation'] : 'Confirmation'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                    $.ajax({
                        type: 'post',
                        traditional: true,
                        dataType: 'JSON',
                        cache: false,
                        url: 'deleteDatabaseDetails',
                        async: true,
                        data: {
                            auditId: auditId,
                            connectionName: connectionName
                        },
                        success: function (response) {
                            stopLoader();
                            if (response != null) {
//                                var responseObj = JSON.parse(response);
                                showMesg(response['message']);
                                if (response['deleteSucessful'] == "Y") {
                                    $('#savedConnections').jqxTree("removeItem", selectedItem);
                                    $("#savedConnections").jqxTree("refresh");
                                }

                            }
                        },
                        error: function (e)
                        {
                            sessionTimeout(e);
                        }

                    });

                }},

            {
                text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }}],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });

}

function validateQuery() {
    showLoader();
    var selectQuery = $("#generatedTotalQuery").val();
    if (selectQuery != null && selectQuery != '') {
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: "validateSQLQuery",
            cache: false,
            data: {
                query: selectQuery
            },
            success: function (data, status, xhr) {
                stopLoader();
                if (data != null && !jQuery.isEmptyObject(data)) {
                    showMesg(data['message']);
                }
            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });

    } else {
        showMesg("Query Empty");
    }
}

function viewFunQuery(tableId, selectedRowData) {
    var selectedFunctionName = selectedRowData['FUN_NAME'];
    var functionFormObj = {};
    var funStr = "";
    functionFormObj['functionName'] = selectedFunctionName;

    var rowCount = $('#' + tableId + ' tr').length;
    var funLvlType = selectedRowData['FUN_LVL_TYPE'];//
    if (funLvlType == 'MULTI_COLUMNS') {
        funStr += "" + selectedFunctionName + "";
    } else {

        funStr += "" + selectedFunctionName + "(";
    }
    var loopCount = 0;
    $("#" + tableId + " tr").each(function () {
        var tdArray = this.cells;
        if (tdArray != null && tdArray.length != 0) {
            var funFormLabel = $(tdArray[0]).text();
            var funValue = $(tdArray[1]).find("input").val();
            var funValueId = $(tdArray[1]).find("input").attr("id");
            if (funValue != null && funValue != '') {
                var trimVal = $.trim(funValue);
                if (trimVal.length > 0) {
                    funValue = trimVal;
                }
//                funValue = $.trim(funValue);
            }
            if (funValueId != null && funValueId != '') {
                var trimVal = $.trim(funValueId);
                if (trimVal.length > 0) {
                    funValueId = trimVal;
                }
//                funValueId = $.trim(funValueId);
            }
            funStr += "'" + funValue + "'";
            functionFormObj[funValueId] = funValue;
            if (loopCount != parseInt(rowCount) - 1) {
                funStr += ",";
            }
            loopCount++;
        }
    });
    if (funLvlType == 'MULTI_COLUMNS') {
        funStr += " END ";
    } else {

        funStr += ")";
    }
    console.log("funStr::" + funStr);
}
function viewSQLEditor(connectionName) {

    var timeOut;
    var currentIndex = $('#editorViewDiv').attr("display")
    if (!$('#editorViewDiv').is(":visible")) {
        switchETLDesignTabs('li_SQLEditor', 'editorViewDiv');
        timeOut = 1100;
        showLoader();
    } else {
        timeOut = 1;
    }
    setTimeout(function () {


        var length = $('#editorViewDiv').jqxTabs('length');
        var title = connectionName + ".Editor-";
        var lastSeq = 1;
        if (length != null && length != '' && parseInt(length) > 0) {
            for (var i = 0; i < parseInt(length); i++) {
                var titleText = $('#editorViewDiv').jqxTabs('getTitleAt', i);
                if (titleText != null && titleText != '' && titleText.indexOf(connectionName) > -1) {
                    var editorStr = titleText.split("-")[1];
                    if (editorStr != null && editorStr != '' && $.trim(editorStr)) {
                        lastSeq = (parseInt(editorStr) + 1);

                    }
                }
            }
        }
        var divId = connectionName.replace(" ", "_") + "_Editor_" + lastSeq;

        title = connectionName + ".Editor-" + lastSeq;
        var divCode = ''
                + '<div id="' + divId + '" class="' + divId + '"></div>'
                + '<div id="' + divId + '_GRID_DIV" class="' + divId + '_GRID_DIV">'
                + '<div id="' + divId + '_GRID" class="' + divId + '_GRID"></div>'
                + '</div>';



        $('#editorViewDiv').jqxTabs('addLast', title, divCode);
        $("#" + divId).parent().attr("id", divId + "_splitter");
// $("."+divId).parent().attr("data-connction-name", connectionName);
// $("."+divId).remove();
        $("#" + divId).attr("data-connction-name", connectionName);
        $('#editorViewDiv').jqxTabs('select', parseInt(length));
        $('#editorViewDiv').jqxTabs('ensureVisible', -1);
        $('#' + divId + '_splitter').jqxSplitter({width: '100%', height: '100%',
            orientation: 'horizontal',
            panels: [{size: "50%", min: 50}, {min: 50, size: "50%"}]});
        var sqlMainEditor = ace.edit(divId, {
            mode: "ace/mode/sql",
// enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
// showPrintMargin: true, // hides the vertical limiting strip
            fontSize: "100%", // ensures that the editor fits in the environment
            minLines: 5,
            maxLines: 20,
            wrap: true,
            autoScrollEditorIntoView: true
        });
// var sqlMainEditor = ace.edit(divId);
// sqlMainEditor.setOptions({
// enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
// showPrintMargin: false, // hides the vertical limiting strip
// fontSize: "100%" // ensures that the editor fits in the environment
// });
// sqlMainEditor.getSession().setMode("ace/mode/sql");

        stopLoader();
    }, timeOut)
}

function executeEditorScripts(tabId) {
    var script = "";
    var divId = "";
    var tabIndex = $("#" + tabId).jqxTabs("val");
    var content = $("#" + tabId).jqxTabs('getContentAt', parseInt(tabIndex));
    if (content != null) {
        var spliterIdDiv = content['0'];
        if (spliterIdDiv != null) {
            var spliterId = spliterIdDiv.id;
            console.log(spliterId);
            if (spliterId != null && spliterId != '') {
                divId = spliterId.replace("_splitter", "");
            }
        } else {
            var spliterId = content.id;
            console.log(spliterId);
            if (spliterId != null && spliterId != '') {
                divId = spliterId.replace("_splitter", "");
            }

        }

    }

    var sqlMainEditor = sqlMainEditor = ace.edit(divId);
    var script = sqlMainEditor.getSelectedText();
    if (script == "") {
        script = String(sqlMainEditor.getSession().getValue());
    }

    console.log("data:::" + script);
    if (script != null
            && $.trim(script) != null
            && $.trim(script) != ''
            && $.trim(script) != 'null'
            && $.trim(script.replace(/[\t\n]+/g, ' ')) != null
            && $.trim(script.replace(/[\t\n]+/g, ' ')) != ''
            && $.trim(script.replace(/[\t\n]+/g, ' ')) != 'null'
            ) {
        var connectionName = $("#" + divId).attr("data-connction-name");
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: "executeSQLQuery",
            cache: false,
            data: {
                script: script,
                connectionName: connectionName
            },
            success: function (response, status, xhr) {
                stopLoader();
                if (response != null && !jQuery.isEmptyObject(response)) {
                    if (response['selectFlag']) {
                        showExecutionResults(script, connectionName, response, divId)
                    } else {
                        $("#dialog").html(response['message']);
                        $("#dialog").dialog({
                            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                            modal: true,
                            height: 'auto',
                            minWidth: 300,
                            maxWidth: 'auto',
                            fluid: true,
                            buttons: [{
                                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                    click: function () {
                                        $(this).html("");
                                        $(this).dialog("close");
                                        $(this).dialog("destroy");
                                    }}],
                            open: function () {
                                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                                $(".visionHeaderMain").css("z-index", "999");
                                $(".visionFooterMain").css("z-index", "999");
                            },
                            beforeClose: function (event, ui)
                            {
                                $(".visionHeaderMain").css("z-index", "99999");
                                $(".visionFooterMain").css("z-index", "99999");
                            }
                        });
                    }

                }
            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    } else {
        showMesg("No scripts/query to be run");
    }
}

function showExecutionResults(script, connectionName, resultObj, divId) {
    showLoader();
    var gridId = divId + "_GRID";
    try {
        $("#" + gridId).jqxGrid("destroy");
    } catch (e) {
    }
    $("#" + gridId).remove();
    $("#" + gridId + "_DIV").html("<div id='" + gridId + "'></div>");
    var gridObj = resultObj['gridObject'];
    var gridPropObj = {};
    gridPropObj = gridObj.gridProperties;
    gridPropObj.columns = gridObj.columns;
    var columns = gridObj.columns;
    var source =
            {
                type: 'POST',
//                                                async: false,
                datatype: "json",
                datafields: gridObj['datafields'],
                data: {
                    columnList: JSON.stringify(gridObj['columnList']),
                    script: script,
                    connectionName: connectionName
                },
                url: 'showExecutionQueryResults',
                cache: false,
                root: 'Rows',
                processdata: function (data) {

                },
                beforeSend: function () {
                    showLoader();

                }, loadError: function (xhr, status, error) {
                    stopLoader();
                }, loadComplete: function (data)
                {
                    stopLoader();
                    //$("#div_" + tableName).jqxGrid('hiderowdetails', 0);
                    //$("#row0div_" + tableName).hide();

                },
                beforeprocessing: function (data) {

                    if (data[0] != null) {
                        source.totalrecords = data[0].TotalRows;
                    } else {
                        source.totalrecords = 0;
                    }
                    stopLoader();
                },
                sort: function ()
                {
//                                                $("#" + gridResultObj['gridId'] + "_sort_columns").remove();
                    $("#" + gridId).jqxGrid('updatebounddata', 'sort');
                    try {
                        $("#" + gridId).jqxGrid('clearselection');
                    } catch (e) {
                    }
                    stopLoader();
                },
                filter: function () {

                    $("#" + gridId).jqxGrid('updatebounddata', 'filter');
                    try {
                        $("#" + gridId).jqxGrid('clearselection');
                    } catch (e) {
                    }
                    stopLoader();
                }


            };
    var dataAdapter = new $.jqx.dataAdapter(source);
//    gridPropObj.source = dataAdapter;
//    for (var i = 0; i < gridPropObj.columns.length; i++) {
//        if (gridPropObj.columns [i].cellsrenderer != null) {
//            gridPropObj.columns [i].cellsrenderer = eval(gridPropObj.columns [i].cellsrenderer);
//        }
//        if (gridPropObj.columns[i].rendered != null) {
//            gridPropObj.columns[i].rendered = eval('(' + gridPropObj.columns[i].rendered + ')');
//        }
//        if (gridPropObj.columns[i].createeditor != null) {
//            gridPropObj.columns[i].createeditor = eval('(' + gridPropObj.columns[i].createeditor + ')');
//        }
//        if (gridPropObj.columns[i].initeditor != null) {
//            gridPropObj.columns[i].initeditor = eval('(' + gridPropObj.columns[i].initeditor + ')');
//        }
//        if (gridPropObj.columns[i].geteditorvalue != null) {
//            gridPropObj.columns[i].geteditorvalue = eval('(' + gridPropObj.columns[i].geteditorvalue + ')');
//        }
//        if (gridPropObj.columns[i].cellvaluechanging != null) {
//            gridPropObj.columns[i].cellvaluechanging = eval('(' + gridPropObj.columns[i].cellvaluechanging + ')');
//        }
//        if (gridPropObj.columns[i].cellbeginedit != null) {
//            gridPropObj.columns[i].cellbeginedit = eval('(' + gridPropObj.columns[i].cellbeginedit + ')');
//        }
//    }
//    if (gridPropObj.rendergridrows != null && gridPropObj.rendergridrows != "") {
//        gridPropObj.rendergridrows = eval('(' + gridPropObj.rendergridrows + ')');
//    }

    $('#' + gridId).jqxGrid(
            {
                width: "100%",
                height: "90%",
                theme: 'energyblue',
                autoshowloadelement: false,
                source: dataAdapter,
                pageable: true,
                pagesize: 50,
                showfilterrow: true,
                filterable: true,
                sortable: true,
                virtualmode: true,
                pagesizeoptions: ['50', '100', '500', '1000', '5000', '10000', '50000'],
                rendergridrows: function (params) {
                    return params.data;
                },
                columnsresize: true,
                columns: columns
            });
    $('#' + gridId).on('celldoubleclick', function (event) {
        var args = event.args;
        var dataField = args.datafield;
        var dataField1 = args.text;
        var rowIndex = args.rowindex;
        var cellValue = args.value;
        var column = $('#' + gridId).jqxGrid('getcolumn', event.args.datafield).text;
        popupedit(column, cellValue);
    });
//    $('#' + gridId).jqxGrid(gridPropObj);

}

function createNewJob() {

    var selectedItem = $('#avaialableJobsTree').jqxTree('selectedItem');
    var selectedItemElement = selectedItem.element;
    var parentFolderId = $($(selectedItemElement).find('div.visionEtlTreeFolders')[0]).attr("id");
    var folderValue = selectedItem.label;
    var treeLevel = selectedItem.level;


    var folderObj = {};
    folderObj['parentFolder'] = folderValue;
    folderObj['parentFolderId'] = parentFolderId;
    folderObj['treeLevel'] = parseInt(treeLevel);

    var jobId = genHexString(32);
    $("#currentJobId").val(jobId);
    $("#currentJobName").val("");
//    var flowChartId = 'flowchartworkSourcesspace';
    var flowChartId = 'workSpace_' + jobId;
    flowChartWorkSpaceId = flowChartId;
    $("#" + flowChartId).remove;
    var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
    var tabName = "New Tab";
    if (selectedItemIndex == null) {
        $("#feedHeader").append('<div id="flowChartTabs"  class="flowChartTabs flowChartHeaderTabs" style="width: 100%;height: 9%;"><ul class=flowChartTabList><li></li></ul><div></div></div>');
        $('#flowChartTabs').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
        $('#flowChartTabs').jqxTabs('showAllCloseButtons');
        $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
        $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
        $('#flowChartTabs').jqxTabs('removeAt', 0);
        $('#flowChartTabs').jqxTabs('addFirst', tabName, '<div  id="' + flowChartWorkSpaceId + '" jobid="' + jobId + '" class="flowchart-example-container"></div>');
    } else {

//        var length = $('#flowChartTabs').jqxTabs('length');
//        var openedTab = false;
//        for (var i = 0; i < length; i++) {
//            var title = $('#flowChartTabs').jqxTabs('getTitleAt', i);
//            if (title != null && title == tabName) {
//                $('#flowChartTabs').jqxTabs('select', i);
//                openedTab = true;
//                $("#" + flowChartId).remove();
//                var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
//                var htmlDiv = '<div  id="flowchartworkSourcesspace" class="flowchart-example-container"></div>';
//                $('#flowChartTabs').jqxTabs('setContentAt', selectedItemIndex, htmlDiv);
//                break;
//            }
//        }
//        if (!openedTab) {
        var divStr = ''
        divStr += '<div  style="display: flex;float:left;margin-top:5px;">'
        divStr += '</div>'
        divStr += '<div  id="' + flowChartWorkSpaceId + '" jobid="' + jobId + '"  class="flowchart-example-container"></div>'
        divStr += '';
        $('#flowChartTabs').jqxTabs('showAllCloseButtons');
        $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
        $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
        $('#flowChartTabs').jqxTabs('addLast', tabName, divStr);
//        }
    }

    $("#" + flowChartId).flowchart({
        linkWidth: 2,
        defaultSelectedLinkColor: '#000055',
        grid: 10,
        distanceFromArrow: 0,
        multipleLinksOnInput: true,
        multipleLinksOnOutput: true,
        defaultSelectedLinkColor: 'red',
        onOpeartorContextMenu: function (operatorId) {
            console.log("operatorId:::" + operatorId);
            openOpeartorContextMenu(operatorId);
            return true;
        },
    });
    $("#" + flowChartId).flowchart({
        //                                onOperatorSelect: function(operatorId) {
        //                                return true;
        //                                },
        onLinkCreate: function (linkId, linkData) {

            var fromOperatorId = linkData['fromOperator'];
            var toOperatorId = linkData['toOperator'];
            var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);


            var connectedTo = []
            var connectedToOp = getAllConnToOperatorsByOpId(fromOperatorId, []);
            $.each(connectedToOp, function (i) {
                if (this['component'] != 'Y') {
                    connectedTo.push(this['operatorId']);
                }
            })

            fromOperatorData['connectedTo'] = connectedTo;
            $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
            var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
            var connectedFrom = [];
            var connectedFromOp = getAllConnFromOperatorsByOpId(toOperatorId, []);
            $.each(connectedFromOp, function (i) {
                if (this['component'] != 'Y') {
                    connectedFrom.push(this['operatorId']);
                }
            })
            toOperatorData['connectedFrom'] = connectedFrom;
            if (toOperatorData['component'] == 'Y') {
                toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                if (toOperatorData['connObj'] == null) {
                    toOperatorData['connObj'] = savedDBData["Current_V10"];
                }
            }
            var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
            var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
            if (originalSources.indexOf(fromTable) == -1) {
                originalSources.push(fromTable);
            }
            toOperatorData['originalSources'] = originalSources;

            var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
            if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                originalSourceOp.push(fromOperatorId);
            }
            toOperatorData['originalSourceOp'] = originalSourceOp;
            $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
            //            setToOpDblCLickFuncName(fromOperator, toOperator);
            return true;
        },
        onAfterChange: function (changeType) {

            if (!operatorDoublClick) {
                trfmRulesChanged = true;
                console.error("trfmRulesChanged : " + trfmRulesChanged);
                return true;
            }
        },
        onOperatorSelect: function (changeType) {
            $(document).find("input").blur();
            return true;

        },
        onLinkSelect: function (changeType) {
            $(document).find("input").blur();
            return true;
        }
    });


    $("#dataMigrationTabs").remove();
    $("#normalizeOptionsTabs").remove();
    $("#deNormalizeOptionsTabs").remove();
    previousOperatorId = null;
    prevTargetOperatorId = null;
    trfmRulesChanged = false;

}

function copyJob(jobId) {

    $("#dialog").html(labelObject['Do you want Copy this Job?'] != null ? labelObject['Do you want Copy this Job?'] : 'Do you want Copy this Job?');
    $("#dialog").dialog({
        title: (labelObject['Confirm'] != null ? labelObject['Confirm'] : 'Confirm'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                    var response = "<div id='textReason'> <table> <td><input id='selectFolderName' style='width: 250px;' class='visionDSMappingInput' type='text' value='Saved Jobs' folderId='C8DE75F32D56288CE0554B610B40A4A3'  readonly='true'><img src='images/tree_icon.svg' class='visionETLColMapImage'  onclick='selectFolder(this)' style=''> </td></table>";
                    //UK folder
                    response += "<textarea id='reasonId' class='visionDeleteReason'></textarea><br>\n\
                        </div>";
                    response += "<div id='dailog_error_id' style='display:none;color:red'>" + (labelObject['Please give any Job Name'] != null ? labelObject['Please give new Job Name'] : 'Please give new Job Name') + "</div>";

                    $("#dialog").html(response);
                    $("#dialog").dialog({
                        title: (labelObject['Job Name'] != null ? labelObject['Job Name'] : 'Job Name'),
                        modal: true,
                        height: 'auto',
                        minWidth: 300,
                        maxWidth: 'auto',
                        fluid: true,
                        buttons: [{
                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                click: function () {
                                    var jobName = $("#reasonId").val();
                                    if (jobName != null && jobName != '') {
                                        $("#dailog_error_id").hide();
                                        $(this).html("");
                                        $(this).dialog("close");
                                        $(this).dialog("destroy");
                                        //saveJob(jobName, data, processJobData);
                                        copyProcessJob(jobId, jobName);

                                    } else {
                                        $("#dailog_error_id").show();
                                    }

                                }},
                            {
                                text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                                click: function () {
                                    $(this).html("");
                                    $(this).dialog("close");
                                    $(this).dialog("destroy");
                                    // $("#labeld").empty();

                                }

                            }],
                        open: function () {
                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                            $(".visionHeaderMain").css("z-index", "999");
                            $(".visionFooterMain").css("z-index", "999");
                        },
                        beforeClose: function (event, ui)
                        {
                            $(".visionHeaderMain").css("z-index", "99999");
                            $(".visionFooterMain").css("z-index", "99999");
                        }
                    });



                }},
            {
                text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");


                }}],

        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });


}

function copyProcessJob(jobId, jobName) {
    showLoader();
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'copyJob',
        async: true,
        data: {
            jobName: jobName,
            jobId: jobId
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                showSavedJobs();
                //var responseObj = JSON.parse(response);
                $("#dialog").html(response);
                $("#dialog").dialog({
                    title: (labelObject["Message"] != null ? labelObject["Message"] : "Message"),
                    modal: true,
                    height: 'auto',
                    minWidth: 300,
                    maxWidth: 1000,
                    fluid: true,
                    buttons: [{
                            text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                            click: function () {
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                            }
                        }],
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });


            }
        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
        }

    });
}
function mapAllColumns(event, $this, toIconType) {
    var data = [];
    var dataStr = $("#fromTableColsArray_hidden").val();
    if (dataStr != null && dataStr != '') {
        data = JSON.parse(dataStr);
    }
    var toTableColsArrayStr = $("#toTableColsArray_hidden").val();
    var currentTrnsOpId = $("#currentTrnsOpId").val();


//    var toConnObj = JSON.parse($("#toConnObjPK").val());//PKH PKIcon
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'allColMappingForm',
        cache: false,
        data: {
            toTableColsArrayStr: toTableColsArrayStr,
            fromTableColsArrayStr: dataStr,
            toIconType: toIconType
        },
        success: function (response, status, xhr) {
            stopLoader();
            $("#columnSQLMappingDialog").html(response['sqlPopupDiv']);
            $("#columnSQLMappingDialog").dialog({
                title: (labelObject['Column Mapping'] != null ? labelObject['Column Mapping'] : 'Column Mapping'),
                modal: true,
                width: parseInt(screen.width) - 100,
                maxWidth: parseInt(screen.width) - 100,
                height: 400,
                maxHeight: 1000,
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var length = $('#sqlToTableColumnsTable >tbody >tr').length;
                            if (length != null && parseInt(length) != 0) {
                                $('#sqlToTableColumnsTable >tbody >tr').each(function () {
                                    var tdArray = this.cells;
                                    if (tdArray != null && tdArray.length != 0) {
                                        var sourceColumn = $(tdArray[0]).find("input").val();
                                        var columnStr = "";
                                        var destinationColumn = $(tdArray[1]).find("input").val();
                                        if (sourceColumn != null && sourceColumn != ''
                                                && destinationColumn != null && destinationColumn != '') {
                                            columnStr = '<tr><td width="1%" class="visionColMappingImgTd1">'
                                                    + '<img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete"'
                                                    + 'style="width:15px;height: 15px;cursor:pointer;"></td>';
//                                                    + '<td width="1%" class="visionColMappingImgTd1"><input type="checkbox" class="visionPKSelectCbx" />'
//                                                    + '</td>'// ravi pk

                                            //PKH PKIcon
                                            var destTableColStr = destinationColumn.split(":");//PKH PKIcon
                                            var destTableName = [];
                                            if (destTableColStr != null) {
                                                destTableName.push(destTableColStr[0]);//PKH PKIcon
                                            }
                                            var sourceTableName = [];
                                            var sourceTableColStr = sourceColumn.split(":");//PKH PKIcon
                                            if (sourceTableColStr != null) {
                                                sourceTableName.push(sourceTableColStr[0]);//PKH PKIcon
                                            }

//                                                if (toIconType == "XLSX" || toIconType == "XLS" || toIconType == "XML" || toIconType == "CSV" ||
//                                                        toIconType == "JSON") {
//                                                    columnStr += '<td width="1%" class="visionColMappingImgTd1" style ="display:none"><input type="checkbox" class="visionPKSelectCbx" />'
//                                                            + '</td>';
//                                                } else
//                                                {
//                                            if (toConnObj.includes(columnNameStr[1])) {
//                                                columnStr += '<td width="1%" class="visionColMappingImgTd1"><input type="checkbox" checked class="visionPKSelectCbx" />'
//                                                        + '</td>';
//                                            } else {
                                            columnStr += '<td width="1%" class="visionColMappingImgTd1"><input type="checkbox" class="visionPKSelectCbx" />'
                                                    + '</td>';
//                                            }
//                                                }
                                            //PKH PKIcon

                                            columnStr += '<td width="19%" style=""><input class="visionColMappingInput" '
                                                    + 'type="text" tableName=\'' + JSON.stringify(destTableName) + '\' value="' + destinationColumn + '" title="' + destinationColumn + '" ' + ((toIconType != null && toIconType != "" && toIconType != 'SQL') ? '' : 'readonly="true"') + ' style="width:84% !important">'
                                                    + '<img title="Select Column" src="images/tree_icon.svg" '
                                                    + 'class="visionETLColMapImage " onclick="selectColumn(this,\'' + ((toTableColsArrayStr != null && toTableColsArrayStr != "" && toTableColsArrayStr != "[]") ? 'toColumn' : 'fromColumn') + '\')" style=""></td>'
                                                    + '<td width="20%"><input class="visionColMappingInput" '
                                                    + 'type="text" tableName=\'' + JSON.stringify(sourceTableName) + '\' value="' + sourceColumn + '" title="' + sourceColumn + '" readonly="true" style="width:84% !important">'
                                                    + '<img title="Select Column" '
                                                    + 'src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectColumn(this,\'fromColumn\')" style="">'
                                                    + '</td>'
                                                    + '<td width="20%"><input class="visionColMappingTextarea" type="text" value=""></td>'
                                                    + '<td width="20%" style="display:none;">'
                                                    + '<input class="visionColMappingTextarea" type="text" value=""></td>'
                                                    + '<td width="20%"><input class="visionColMappingInput" '
                                                    + 'type="text" value="" style="width:84% !important">'
                                                    + '<img title="Select Function" src="images/Fx icon-01.svg" '
                                                    + 'class="visionETLColMapImage " onclick="selectColumnFun(this,\'fromColumn\')" style=""></td>'
                                                    + '</tr>';
                                        }
//                                        if (toIconType != null
//                                                && toIconType != ''
//                                                && toIconType != 'null'
//                                                && toIconType != 'SQL') {
//                                            if (sourceColumn != null && sourceColumn != '') {
//                                                columnStr = '<tr><td width="1%" class="visionColMappingImgTd1">'
//                                                        + '<img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete"'
//                                                        + 'style="width:15px;height: 15px;cursor:pointer;"></td>'
//                                                        + '<td width="19%" style=""><input class="visionColMappingInput" '
//                                                        + 'type="text" value="' + sourceColumn + '" title="' + sourceColumn + '" style="width:84% !important">'
//                                                        + '<img title="Select Column" src="images/tree_icon.svg" '
//                                                        + 'class="visionETLColMapImage " onclick="selectColumn(this,\'fromColumn\')" style=""></td>'
//                                                        + '<td width="20%"><input class="visionColMappingInput" type="text" value="' + sourceColumn + '" title="' + sourceColumn + '" readonly="true" style="width:84% !important">'
//                                                        + '<img title="Select Column" '
//                                                        + 'src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectColumn(this,\'fromColumn\')" style="">'
//                                                        + '</td>'
//                                                        + '<td width="20%"><input class="visionColMappingTextarea" type="text" value=""></td>'
//                                                        + '<td width="20%" style="display:none;">'
//                                                        + '<input class="visionColMappingTextarea" type="text" value=""></td>'
//                                                        + '<td width="20%"><input class="visionColMappingInput" '
//                                                        + 'type="text" value="" style="width:84% !important">'
//                                                        + '<img title="Select Function" src="images/Fx icon-01.svg" '
//                                                        + 'class="visionETLColMapImage " onclick="selectColumnFun(this,\"fromColumn\")" style=""></td>'
//                                                        + '</tr>';
////                                                columnStr = '<tr><td width="1%" class="visionColMappingImgTd1">'
////                                                        + '<img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete"'
////                                                        + 'style="width:15px;height: 15px;cursor:pointer;"></td>'
////                                                        + '<td width="19%" style=""><input class="visionColMappingInput" '
////                                                        + 'type="text" value="" title="" readonly="true" style="width:84% !important">'
////                                                        + '<img title="Select Column" src="images/tree_icon.svg" '
////                                                        + 'class="visionETLColMapImage " onclick="selectColumn(this,\"toColumn\")" style=""></td>'
////                                                        + '<td width="20%"><input class="visionColMappingInput" type="text" value="' + sourceColumn + '" title="' + sourceColumn + '" readonly="true" style="width:84% !important">'
////                                                        + '<img title="Select Column" '
////                                                        + 'src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectColumn(this,\"fromColumn\")" style="">'
////                                                        + '</td>'
////                                                        + '<td width="20%"><input class="visionColMappingTextarea" type="text" value=""></td>'
////                                                        + '<td width="20%" style="display:none;">'
////                                                        + '<input class="visionColMappingTextarea" type="text" value=""></td>'
////                                                        + '<td width="20%"><input class="visionColMappingInput" '
////                                                        + 'type="text" value="" style="width:84% !important">'
////                                                        + '<img title="Select Function" src="images/Fx icon-01.svg" '
////                                                        + 'class="visionETLColMapImage " onclick="selectColumnFun(this,\"fromColumn\")" style=""></td>'
////                                                        + '</tr>';
//                                            }
//                                        } else {
//                                            var destinationColumn = $(tdArray[1]).find("input").val();
//                                            if (sourceColumn != null && sourceColumn != ''
//                                                    && destinationColumn != null && destinationColumn != '') {
//                                                columnStr = '<tr><td width="1%" class="visionColMappingImgTd1">'
//                                                        + '<img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete"'
//                                                        + 'style="width:15px;height: 15px;cursor:pointer;"></td>'
//                                                        + '<td width="19%" style=""><input class="visionColMappingInput" '
//                                                        + 'type="text" value="' + destinationColumn + '" title="' + destinationColumn + '" readonly="true" style="width:84% !important">'
//                                                        + '<img title="Select Column" src="images/tree_icon.svg" '
//                                                        + 'class="visionETLColMapImage " onclick="selectColumn(this,\'toColumn\')" style=""></td>'
//                                                        + '<td width="20%"><input class="visionColMappingInput" type="text" value="' + sourceColumn + '" title="' + sourceColumn + '" readonly="true" style="width:84% !important">'
//                                                        + '<img title="Select Column" '
//                                                        + 'src="images/tree_icon.svg" class="visionETLColMapImage " onclick="selectColumn(this,\'fromColumn\')" style="">'
//                                                        + '</td>'
//                                                        + '<td width="20%"><input class="visionColMappingTextarea" type="text" value=""></td>'
//                                                        + '<td width="20%" style="display:none;">'
//                                                        + '<input class="visionColMappingTextarea" type="text" value=""></td>'
//                                                        + '<td width="20%"><input class="visionColMappingInput" '
//                                                        + 'type="text" value="" style="width:84% !important">'
//                                                        + '<img title="Select Function" src="images/Fx icon-01.svg" '
//                                                        + 'class="visionETLColMapImage " onclick="selectColumnFun(this,\"fromColumn\")" style=""></td>'
//                                                        + '</tr>';
//                                            }
//
//                                        }
//                                        
                                        if (columnStr != null && columnStr != '') {
                                            $("#sourceDestColsTableId tbody").append(columnStr);
                                        }

                                        try {
                                            $("#sourceDestColsTableId").colResizable({
                                                disable: true
                                            });

                                            $("#sourceDestColsTableId").tableDnD({
                                                onDragStyle: null,
                                                onDropStyle: null,
                                                onDragClass: "tDnD_whileDrag",
                                            });
                                        } catch (e) {
                                        }
                                        $("#sourceDestColsTableId").colResizable();

                                        //sourceDestColsTableId
//                                     var tdOutPutArray =  $("#selectedColumnStr").html().find("tr").cells;


                                    }
                                });
                                $("#tabs-1").animate({
                                    scrollTop: $("#tabs-1").prop("scrollHeight")
                                }, 1000);
                            }
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
//                            $("#sourceDestColsTableId tbody").append(selectedColumnStr);
                        }


                    }],
                open: function () {
                    var source =
                            {
                                dataType: "json",
                                dataFields: [
                                    {name: 'id', type: 'string'},
                                    {name: 'text', type: 'string'},
                                    {name: 'value', type: 'string'},
                                    {name: 'icon', type: 'string'},
                                    {name: 'parentid', type: 'string'}
                                ],
                                hierarchy:
                                        {
                                            keyDataField: {name: 'id'},
                                            parentDataField: {name: 'parentid'}
                                        },
                                id: 'id',
                                localData: data
                            };
                    var dataAdapter = new $.jqx.dataAdapter(source);
                    $("#columnSQLMappingTree").jqxTreeGrid(
                            {
                                width: "100%",
                                source: dataAdapter,
                                height: 250,
                                sortable: true,
                                columnsResize: true,
                                columnsReorder: true,
                                enableHover: true,
                                enableBrowserSelection: true,
                                filterable: true,
                                icons: true,
                                hierarchicalCheckboxes: true,
                                pageable: true,
                                pagerMode: 'advanced',
                                pagerPosition: 'bottom',
                                pageSize: 100,
                                pageSizeOptions: ['100', '200', '300'],
                                theme: 'energyblue',
                                selectionMode: 'multipleRows',
                                autoShowLoadElement: false,
                                rendered: function (type) {
                                    var sourceColumn = "";
                                    var gridCells = $('#columnSQLMappingTree').find('.jqx-grid-cell');
                                    // initialize the jqxDragDrop plug-in. Set its drop target to the second Grid.
                                    gridCells.jqxDragDrop({
                                        appendTo: 'body',
                                        theme: 'energyblue',
                                        dragZIndex: 99999,
                                        dropAction: 'none',
                                        initFeedback: function (feedback) {
                                            feedback.height(25);
                                        },
                                        dropTarget: $('.visionColMappingInput'),
                                        revert: true
                                    });
                                    gridCells.off('dragStart');
                                    gridCells.off('dragEnd');
                                    gridCells.off('dropTargetEnter');
                                    gridCells.off('dropTargetLeave');
                                    // disable revert when the dragged cell is over the second Grid.
                                    gridCells.on('dropTargetEnter', function () {
                                        gridCells.jqxDragDrop({
                                            revert: false
                                        });
                                    });
                                    // enable revert when the dragged cell is outside the second Grid.
                                    gridCells.on('dropTargetLeave', function () {
                                        gridCells.jqxDragDrop({
                                            revert: true
                                        });
                                    });
                                    // initialize the dragged object.
                                    gridCells.on('dragStart', function (event) {

                                        $(this).jqxDragDrop('data', {
                                            value: sourceColumn
                                        });
                                    });
                                    // set the new cell value when the dragged cell is dropped over the second Grid.      
                                    gridCells.on('dragEnd', function (event) {
                                        var value = $(this).text();
                                    });

                                    gridCells.jqxDragDrop({
                                        onTargetDrop: function (data) {
                                            var dataa = data;
                                            var value = this['data']['value'];
                                            data.val(value);
                                            data.attr("title", value);
                                        }
                                    });

                                    $('#columnSQLMappingTree').on('rowClick', function (event) {
                                        var row = event.args.row;
                                        sourceColumn = row['value'];
//                                        var parent = event.args.row.parent;
//                                        var dataField = event.args.dataField;
//                                        console.log('rowClick: (dataField is: ' +  dataField + ') row: ' + ((row != null) ? 'not null' : 'null') + ' parent: '  + ((parent != null) ? 'not null' : 'null'));
                                    });

                                },
                                columns: [
                                    {text: 'Table/Column Name', dataField: 'text', width: '100%', filterable: true},
                                    {text: 'value', dataField: 'value', hidden: true, width: '30%', filterable: false},
                                    {text: 'id', dataField: 'id', hidden: true, width: 160, filterable: false},
                                    {text: 'parentid', dataField: 'parentid', hidden: true, width: 160, filterable: false}
                                ]
                            });





                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                    $(".ui-dialog").addClass('visionDMTreePopup');

                },
                resizeStop: function (event, ui) {
                    //   $("#columnSQLMappingTree").jqxTreeGrid( -- 250/350 
                    //.visionEtlCreateSQLTable tbody 156/350
                    var sizes = ui.size;
                    var height = ui.size.height;
                    var width = ui.size.width;
                    var treeHeight = parseInt(height) - 100;
                    var tableHeight = parseInt(height) - 194;
                    $("#columnSQLMappingTree").jqxTreeGrid({height: treeHeight + "px"});
                    $(".visionEtlCreateSQLTable tbody").height(tableHeight + "px");
                },
                beforeClose: function (event, ui)
                {

                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");

                }, close: function (event, ui)
                {

                    $(this).html("");
                    try {
                        $("#columnSQLMappingTree").jqxTreeGrid('destroy');
                        $("#columnSQLMappingTree").remove();
                        $("#treeSearchInputDiv").remove();

                    } catch (e) {
                    }
                }
            });

        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}
function mapTableColumns(treeId, selectionType) {
    var selection = [];
//    if (selectionType == 'selected') {
//        selection = $("#" + treeId).jqxTreeGrid('getSelection');
//    } else {
//        //selection = $("#" + treeId).jqxTreeGrid('getRows');
//    }
    var selectionArray = $("#" + treeId).jqxTreeGrid('getSelection');
    if (selectionArray != null && !jQuery.isEmptyObject(selectionArray)) {
        if ($.isArray(selectionArray)) {
            for (var i = 0; i < selectionArray.length; i++) {
                var selectionObj = selectionArray[i];

                if (selectionObj['level'] == 0) {//level
                    var allChildRecords = selectionObj['records'];
                    if (allChildRecords != null && allChildRecords.length != 0) {
                        allChildRecords = allChildRecords.map(function (item) {
                            delete item.parent;
                            return item;
                        });
                        Array.prototype.push.apply(selection, allChildRecords);
                    }
                } else {
                    delete selectionObj.parent;
                    selection.push(selectionObj);
                }

            }
//            console.log("selectionObj:::" + JSON.stringify(selection));
            selectionType = "selected";
        }
    }
    if (true) {
//    if (selection != null && selection.length != 0) {
        var toTableColsArrayStr = $("#toTableColsArray_hidden").val();
        var dataStr = $("#fromTableColsArray_hidden").val();
        $.ajax({
            datatype: "json",
            type: "post",
            traditional: true,
            url: 'mapTableColumns',
            cache: false,
            data: {
                selection: JSON.stringify(selection),
                toTableColsArrayStr: toTableColsArrayStr,
                fromTableColsArrayStr: dataStr,
                selectionType: selectionType
            },
            success: function (response, status, xhr) {
                stopLoader();
                if (response != null && !jQuery.isEmptyObject(response)) {
                    $('#sqlToTableColumnsTable >tbody >tr').remove();
//                $("#table_of_items tbody tr").remove(); 
                    $("#sqlToTableColumnsTable tbody").append(response['columnsStr']);
                }


            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    }

}
function connectEtlWSSOAP(type, typeName) {
//    var selectedDbType = $('#selectedTypeName').val();
//    var ConnectionEtlType = $('#selectedType').val();
    var wsdlURL = $('#wsdlURL').val();
    if (wsdlURL != null && wsdlURL != '') {
        wsdlURL = $.trim(wsdlURL);
    }
    var endPointURL = $('#endPointURL').val();
    if (endPointURL != null && endPointURL != '') {
        endPointURL = $.trim(endPointURL);
    }

    if (!wsdlURL) {
        $('#wsdlURLError').html("Please enter WSDL URL");
    }
    if (!endPointURL) {
        $('#endPointURLError').html("Please enter End Point URL");
    }
    if (wsdlURL && endPointURL) {
        $('.dataMigrationInputError').hide();
        $('.visionDataMigrationError').hide();
        importSAOPService();
    }


}
function importSAOPService() {
    showLoader();
    var wsdlURL = $('#wsdlURL').val();
    var endPointURL = $('#endPointURL').val();
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'importSAOPService',
        cache: false,
        data: {
            wsdlURL: wsdlURL,
            endPointURL: endPointURL
        },
        success: function (response, status, xhr) {
            stopLoader();
            if (response != null && !jQuery.isEmptyObject(response)) {
                if (response['messageFlag']) {
                    $("#dialog").html(response['message']);
                    $("#dialog").dialog({
                        title: (labelObject['SOAP Request'] != null ? labelObject['SOAP Request'] : 'SOAP Request'),
                        modal: true,
                        width: 800,
                        height: 500,
                        maxHeight: 1000,
                        maxWidth: 1000,
                        fluid: true,
                        buttons: [{
                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                click: function () {
                                    $(this).html("");
                                    $(this).dialog("close");
                                    $(this).dialog("destroy");
                                }
                            }],
                        open: function () {

                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                            $(".visionHeaderMain").css("z-index", "999");
                            $(".visionFooterMain").css("z-index", "999");
                        },
                        beforeClose: function (event, ui)
                        {
                            $(this).html("");
//                            $(this).dialog("close");
//                            $(this).dialog("destroy");
                            $(".visionHeaderMain").css("z-index", "99999");
                            $(".visionFooterMain").css("z-index", "99999");
                        }
                    });
                    $('#soapSplitterDiv').jqxSplitter({width: '100%', height: '100%',
                        orientation: 'vertical',
                        panels: [{size: "50%", min: 50}, {min: 50, size: "50%"}]}
                    );
                    $('#soapRequestSpliterDiv').jqxSplitter({width: '100%', height: '100%',
                        orientation: 'horizontal',
                        panels: [{size: "80%", min: 50}, {min: 50, size: "20%"}]});
//                    $('#soapRequestInput').jqxEditor({
//                        height: "100%",
//                                tools: '',
//                        width: '100%'
//                    });
//                    $("#soapRequestInput").val(response['request']);
//                    $('#soapResponseInput').jqxEditor({
//                        height: "100%",
//                                tools: '',
//                        width: '100%'
//                    });
                } else {
                    $('#visionShowConnectionMsg').show();
                    $('#visionShowConnectionMsg').html('<p style="color:red">' + response['message'] + '</p>');

                }
            }


        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}
function viewFileData(fileDataObjStr) {
    if (fileDataObjStr != null && fileDataObjStr != '') {
        var fileDataObj = JSON.parse(fileDataObjStr);
        if (fileDataObj != null) {
            var filePath = fileDataObj['filePath'];
            var fileName = fileDataObj['fileName'];
            var fileType = fileDataObj['fileType'];
            var sheetNo = fileDataObj['sheetNo'];// ravi multiple excelSheets code

            var gridId = ("divGrid-" + filePath.replace(fileType, "").replace(".csv", "")).replace(/\s/g, '');
            gridId = gridId.replace(/\//g, '');



            if (sheetNo == null) {


                var contentDivId = ("main_divGrid-" + filePath.replace(fileType, "")).replace(/\s/g, '');
                var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');

                if (selectedItemIndex != null) {
                    var html = $('#dataViewDiv').html();
                    if (html.indexOf('"' + contentDivId + '"') > -1
                            || html.indexOf('"' + contentDivId.replace(/\//g, '') + '"') > -1) {
                        var length = $('#dataViewDiv').jqxTabs('length');
                        for (var i = 0; i < length; i++) {
                            var content = $('#dataViewDiv').jqxTabs('getContentAt', i);
                            var id = $(content).attr("id");
                            if (id == null) {
                                id = $(content).children('div:nth-child(2)').attr("id");
                            }
                            if (id == contentDivId || id == contentDivId.replace(/\//g, '')) {
                                switchETLDesignTabs("li_contentView", "dataViewDiv");
                                $('#dataViewDiv').jqxTabs('select', i);
                                break;
                            }
                        }
                        if (sheetNo == null) { // ravi multiple excelSheets code
                            return false;
                        }
                        //  return false;
                    }

                }
            }
            var data = {
                filePath: filePath,
                fileName: fileName,
                fileType: fileType,
                targetFile: fileDataObj['targetFile'], // ravi etl issues new
                fileHeaders: JSON.stringify(fileDataObj['fileHeaders']), // ravi file headers
                sheetNo: sheetNo, // ravi multiple excelSheets code
                gridId: gridId // ravi multiple excelSheets code
            };
//            var gridId = ("divGrid-" + filePath.replace(fileType, "").replace(".csv", "")).replace(/\s/g, '');
//            gridId = gridId.replace(/\//g, '');
            //gridPersonalizeStr

            //data['gridId'] = gridId;
            $.ajax({
                type: "post",
                traditional: true,
                dataType: 'json',
                url: 'getFileObjectMetaData',
                cache: false,
                data: data,
                success: function (response) {
                    stopLoader();
                    if (response != null) {
                        try {
                            if (fileName.indexOf("Rejected_") == 0) {
                                $("#dialogLogFile").dialog('close');
                            }

                        } catch (e) {
                        }
                        // var responseObj = JSON.parse(response);
                        var dataFieldsArray = response['dataFieldsArray'];
                        var columnsArray = response['columnsArray'];
                        data['columnsArray'] = JSON.stringify(response['columnList']);
                        var personalizeDivStr = response['gridPersonalizeStr'];
                        var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');


                        if (sheetNo == null) {
                            var divStr = "<div>"
                                    + "<div id='personalize_" + gridId + "'>" + personalizeDivStr + "</div>"
                                    + "<div id='main_" + gridId + "'>"
                                    + "<div id='" + gridId + "'></div>"
                                    + "</div>"
                                    + "</div>";

                            if (selectedItemIndex == null) {
                                //$("#designViewTab").jqxTabs('select', 1);
                                switchETLDesignTabs("li_contentView", "dataViewDiv");
                                $("#dataViewDiv").prepend("<ul></ul>");
                                $("#dataViewDiv ul").prepend("<li title='" + fileName + "'>" + fileName + "</li>");
                                $("#dataViewDiv").append(divStr);
                                $('#dataViewDiv').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

                                $('#dataViewDiv').jqxTabs('showAllCloseButtons');
                                $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                                $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                            } else {
                                switchETLDesignTabs("li_contentView", "dataViewDiv");
                                $('#dataViewDiv').jqxTabs('addLast', fileName, divStr);

                            }
                        }
                        // ravi multiple excelSheets code
                        $('#personalize_' + gridId).html(personalizeDivStr);
                        $("#navBar_" + gridId).remove();
                        var navigationDiv = response['navigationDiv'];
                        if (navigationDiv != null && navigationDiv != "") {
                            $("#main_" + gridId).append(navigationDiv);
                            $("#navBar_" + gridId).jqxNavBar({height: 20, selectedItem: ((sheetNo != null) ? sheetNo : 0), theme: 'fresh'});
                        }

                        var source =
                                {
                                    type: 'POST',
//                                                async: false,
                                    datatype: "json",
                                    datafields: dataFieldsArray,
                                    data: data,
                                    url: 'getFileObjectData',
                                    cache: false,
                                    root: 'Rows',
                                    processdata: function (data) {


                                    },
                                    beforeSend: function () {
                                        showLoader();

                                    }, loadError: function (xhr, status, error) {
                                        $('#dataViewDiv').css("width", "100%");
                                        stopLoader();
                                    }, loadComplete: function (data)
                                    {
                                        $('#dataViewDiv').css("width", "100%");
                                        $("#navBar_" + gridId).show();
                                        //$("#div_" + tableName).jqxGrid('hiderowdetails', 0);
                                        //$("#row0div_" + tableName).hide();
                                        stopLoader();
                                    },
                                    beforeprocessing: function (data) {
                                        if (data != null && data[0] != null) {
                                            source.totalrecords = data[0].totalrecords;
                                        } else {
                                            source.totalrecords = 0;
                                        }

                                        stopLoader();
                                    },
                                    sort: function ()
                                    {
//                                                $("#" + gridResultObj['gridId'] + "_sort_columns").remove();
                                        $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'sort');
                                        try {
                                            $("[id='" + gridId + "']").jqxGrid('clearselection');
                                        } catch (e) {
                                        }
                                        stopLoader();
                                    },
                                    filter: function () {

                                        $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'filter');
                                        try {
                                            $("[id='" + gridId + "']").jqxGrid('clearselection');
                                        } catch (e) {
                                        }
                                        stopLoader();
                                    }


                                };
//                var source =
//                        {
//                            localdata: dataArray,
//                            datatype: "array",
//                            datafields: dataFieldsArray
//                        };
                        var dataAdapter = new $.jqx.dataAdapter(source);
                        var headerTooltipRenderer = function (element) {
                            $(element).parent().jqxTooltip({position: 'mouse', theme: 'energyblue',
                                position: 'bottom-right',
                                showArrow: false, content: $(element).text()});
                        }
                        window.allGridColumns[gridId] = columnsArray;
                        var tabHeight = $("#" + gridId).closest(".jqx-tabs-content-element").height();
                        $("#" + gridId).jqxGrid(
                                {
                                    width: "100%",
                                    height: parseInt(tabHeight) * 0.84,
                                    theme: 'energyblue',
                                    autoshowloadelement: false,
                                    source: dataAdapter,
                                    pageable: true,
                                    pagesize: 50,
                                    showfilterrow: true,
                                    filterable: true,
                                    sortable: true,
                                    virtualmode: true,
                                    pagesizeoptions: ['50', '100', '500', '1000', '5000', '10000', '50000'],
                                    enabletooltips: true,
                                    enablemousewheel: true,
                                    enablehover: true,
                                    enablebrowserselection: true,
                                    selectionmode: 'checkbox',
                                    rendergridrows: function (params) {
                                        return params.data;
                                    },
                                    columnsresize: true,
                                    columns: columnsArray
                                });


                        $('#' + gridId).on('celldoubleclick', function (event) {
                            var args = event.args;
                            var dataField = args.datafield;
                            var dataField1 = args.text;
                            var rowIndex = args.rowindex;
                            var cellValue = args.value;
                            var column = $('#' + gridId).jqxGrid('getcolumn', event.args.datafield).text;
                            popupedit(column, cellValue);
                        });


                        $('#dataViewDiv').unbind('selected').on('selected', function (event) {
                            var $thid = this;

                            $('#dataViewDiv').jqxTabs('getContentAt', i);

                            $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                            $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                        });

                        $('#dataViewDiv').unbind('add').on('add', function (event) {

                            $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
//                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                            setTimeout(function () {
                                $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                            }, 100);
                            var selectedTabTitle = $("#dataViewDiv").jqxTabs("getTitleAt", event.args.item);
                            $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle);
//                            $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle.split(".")[1]);
                            var selectedTabLi = $("#dataViewDiv").find("li.jqx-tabs-title-selected-top");
                            selectedTabLi.attr("title", selectedTabTitle);


                        });

                        $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                        $(document).mouseup(function (e)
                        {
                            var container = $("#" + gridId + "_settings_panel");
                            var container1 = $(".personaliseoption");
                            if ((!container.is(e.target)
                                    && container.has(e.target).length === 0)
                                    && (!container1.is(e.target)
                                            && container1.has(e.target).length === 0)
                                    )
                            {
                                $(container).hide();
                                $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                            }
                        });

                        // ravi excel sheet navigation

                        $("#navBar_" + gridId).on('change', function () {

                            var index = $("#navBar_" + gridId).jqxNavBar('getSelectedIndex');

                            if (fileDataObj['sheetNo'] != index) {
                                fileDataObj['sheetNo'] = index;
                                $('#' + gridId).remove();
                                $('#personalize_' + gridId).empty();
                                $('#main_' + gridId).append("<div id=" + gridId + "></div>");
                                var fileDataObjStr = JSON.stringify(fileDataObj);
                                viewFileData(fileDataObjStr)
                                $("#navBar_" + gridId).hide();
                            }

                        });

                    }
                },
                error: function (e)
                {
                    sessionTimeout(e);
                }

            });
        }
    }

}
function uploadColumnMap(event, $this, browseId) {


//     var csrfToken = $("input[name='_csrf']").val();
//        if (csrfToken != null && csrfToken != '') {
//            params['_csrf'] = $("input[name='_csrf']").val();
//        }
    $("#" + browseId).ajaxfileupload({
        'action': 'uploadColumnMap',
        valid_extensions: ['xls', 'xlsx', 'XLS', 'XLSX'],
//        headers: {"X-CSRF-TOKEN": $("input[name='_csrf']").val()},
//        'action': 'importFile?gridId=' + gridId + '&tableName=' + tableName,
//        params: params,
//        'action': 'importFile?gridId=' + gridId,
        async: true,
        onStart: function () {
            $("#Loader").css("opacity", "0.99");
            $("#Loader").css("display", "block");
            $("body").css("pointer-events", "none");
            showLoader();
        },
        'onComplete': function (result) {
            $("#importColMapFile").remove();
            $("#colMappinAddIconDiv").append('<input name="importColMapFile" id="importColMapFile" type="file" style="display:none" data-clicked="Y">');
//            ajaxStop();//30
            $("#Loader").css("display", "none");
            $("body").css("pointer-events", "auto");
            stopLoader();
            if (result != null) {
                var selectedColumnStr = result.message;
                getUploadedColMappings(result.message);
            }

        }
        , onCancel: function () {
            $("#importColMapFile").remove();
            $("#colMappinAddIconDiv").append('<input name="importColMapFile" id="importColMapFile" type="file" style="display:none" data-clicked="Y">');
            $("#Loader").css("display", "none");
            $("body").css("pointer-events", "auto");
            stopLoader();
//            ajaxStop();//29
        }
        //catch()}
    });

    $("#" + browseId).attr('data-clicked', 'Y');
    $("#" + browseId).click();

}
function getUploadedColMappings(filePath) {
    //getUploadedColMappings

    showLoader();
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'getUploadedColMappings',
        cache: false,
        data: {
            filePath: filePath,
            toIconType: ""
        },
        success: function (response, status, xhr) {
            stopLoader();
            if (response != null && !jQuery.isEmptyObject(response)) {
                var selectedColumnStr = response['message'];
                $("#sourceDestColsTableId tbody").append(selectedColumnStr);
                $("#tabs-1").animate({
                    scrollTop: $("#tabs-1").prop("scrollHeight")
                }, 1000);

            }


        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}

function selectSapTableColumns(dataObj) {

    showLoader();
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'selectSapTableColumns',
        cache: false,
        data: dataObj,

        success: function (response) {
            stopLoader();
            var columns = response.columnsArray;
            var tableStr = '<div class ="visionTablesComboBox">'
            tableStr += '<div class="visionTablesSearchDiv">';
            tableStr += '<input id="searchColumns" class="visionTablesSearchInput" type="text" placeholder="Search Columns.." onkeyup="searchColumns(\'' + dataObj.tableName + '\',\'' + dataObj.DBValue + '\')">'
            tableStr += '<img src="images/crossicon.png" title="Clear Data" onclick="clearColumnInput(\'' + dataObj.tableName + '\',\'' + dataObj.DBValue + '\')" class="visionClearFieldBtn">';
            tableStr += '</div>';


            tableStr += '<div class="visionTablesComboBoxInner" style="display: flex;">'; // ravi sap columns code start

            tableStr += '<div id="sourceFields" class="sourceFields" style="margin-top: 30px;height:272px; width:47.5%;">';
            tableStr += '<div  class="visionTableName" style="position: relative;"><input id="selectAllCheckBoxes"  type="checkbox" > Select All </div>'; // ---- ravi edit for checkboxes

            for (var i = 0; i < columns.length; i++) {
                tableStr += '<div id="' + columns[i] + '" class="visionTableName" title="' + columns[i] + '"  style="position: relative;"><input class="visionTableNameChbx" type="checkbox" > ' + columns[i] + '<img src="images/crossicon.png" title="Clear Data" onclick="moveColumnToSource(' + columns[i] + ')" class="visionCloseDestTableBtn"></div>';
            }

            tableStr += '</div>';

            tableStr += '<div class="visionNavigateButtonDiv" style="width:5%;margin-top: 162px;"><input onclick="moveSapTableColumns()" type="button" value=">" class="sqlMoveButtons"/></div>';


            tableStr += '<div id="destinationFields" class="destinationFields" style="width:47.5%; margin-left: 0px;"></div>';
            tableStr += '</div>';


            $("#logoutDailog").html(tableStr);
            $("#logoutDailog").dialog({
                title: (labelObject['Select Columns'] != null ? labelObject['Select Columns'] : 'Select Columns'),
                modal: true,
                height: 'auto',
                minWidth: '650',
                maxWidth: 'auto',
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {

                            var selectedColumnsArray = [];
                            var checkedColumns = $("#destinationFields div");
                            if (checkedColumns.length == 0) {
                                showMesg("Destination Columns Empty!");
                                return false;
                            }
                            $.each(checkedColumns, function (index) {
                                var value = this.textContent.trim();// ravi sap table issue
                                selectedColumnsArray.push(value);
                            });
//                            if (selectedColumnsArray.length > 50) {
//                                showMesg("Max Select Columns limit exceeds.Please select less than 50 Columns");
//                                return false;
//                            }

                            dataObj['selectSapTableColumns'] = JSON.stringify(selectedColumnsArray);
                            viewTableDataGrid(dataObj);

                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");

                        }}],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");



//                        $(".visionTableNameChbx").change(function(){
//                            if ($(this).prop("checked")){
//                               $(this).parent('div').addClass("multipleSelect");
//                            }
//                        });

                    $("#selectAllCheckBoxes").click(function () {
//                      $(".visionTableNameChbx").prop('checked', $(this).prop('checked'));



                        if ($(this).prop("checked")) {
                            $(".visionTableNameChbx").each(function (i) {
                                if (true) {
//                                if (i < 50) {
                                    $(this).prop('checked', true)
                                    $(this).parent('div').addClass("multipleSelect");
                                } else {
                                    $(this).prop('checked', false)
                                    $(this).parent('div').removeClass("multipleSelect");
                                }

                            });

                        }
                        if (!$(this).prop("checked")) {
                            $(".visionTableNameChbx").prop('checked', $(this).prop('checked'));
                            $(".visionTableNameChbx").parent('div').removeClass("multipleSelect");
                        }

                    });

                    $(".visionTableNameChbx").change(function () {

                        var selectedLength = $(".sourceFields").find(".multipleSelect").length;
                        if (selectedLength < 50) {
                            $("#selectAllCheckBoxes").prop("checked", false);
                            if (!$(this).prop("checked")) {
                                $(this).parent('div').removeClass("multipleSelect");
                            }
                            if ($(this).prop("checked")) {
                                $(this).parent('div').addClass("multipleSelect");
                            }
                        } else {

                            if (!$(this).prop("checked")) {

                                $(this).prop("checked", false);
                                $(this).parent('div').removeClass("multipleSelect");
                                $("#selectAllCheckBoxes").prop("checked", false);
                            }
                            if ($(this).prop("checked")) {
                                showMesg("Cannot select more than 50");
                                $(this).prop("checked", false);
                                $(this).parent('div').removeClass("multipleSelect");
                            }

                        }

                    });

                    dragColumns();



                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });

        },
        error: function (e)
        {
            sessionTimeout(e);
        }
    })
}
function refreshTableGrid(gridId) {

    try {
        showLoader();
        updateDataInfo = {};

        $('#' + gridId).jqxGrid('updatebounddata');
        $("#" + gridId).jqxGrid('clearselection');
        $("#" + gridId).jqxGrid('clearfilters');
        $("#" + gridId).jqxGrid({virtualmode: true});

//      ss$("#" + gridId).jqxGrid('updatebounddata', 'cells');


        stopLoader();
    } catch (e) {

        var error = e;
        stopLoader();
    }
}

function viewTableDataGrid(data) {
    showLoader();
    var DBValue = data.DBValue;
    var tableName = data.tableName;
    //    var gridId = ("divGrid" + DBValue + "-" + tableName).replace(/\s/g, '');
    var gridId = ("divGrid-" + DBValue + "-" + tableName).replace(/\s/g, ''); // ravi updated code changes
    gridId = gridId.replace(/\//g, '');
    data['gridId'] = gridId;
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'getSchemaObjectMetaData',
        cache: false,
        data: data,

        success: function (response) {

            if (response != null) {
                // var responseObj = JSON.parse(response);
                var dataArray = response['dataArray'];
                var columnNamesArray = response['columnNamesArray'];
                var dataFieldsArray = response['dataFieldsArray'];
                var columnsArray = response['columnsArray'];
                data['columnsArray'] = JSON.stringify(response['columnList']);
                var totalCount = response['totalCount'];
                var personalizeDivStr = response['gridPersonalizeStr'];

                var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');

                if (selectedItemIndex == null) {
                    //$("#designViewTab").jqxTabs('select', 1);
                    switchETLDesignTabs("li_contentView", "dataViewDiv");
                    $("#dataViewDiv").prepend("<ul></ul>");
                    $("#dataViewDiv ul").prepend("<li title='" + DBValue + "." + tableName + "'>" + DBValue + "." + tableName + "</li>");
                    var divStr = "<div>";
                    divStr += "<div style='display: flex;float:left;margin-top:5px;'>";
                    divStr += "<img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'>"
                    divStr += "<img id ='editTableIcon_" + gridId + "' src='images/edit_table.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=showEditTableOptions('" + gridId + "') title='Edit Table'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/add_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=addRecordToTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Insert Record'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "'  src='images/commit_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=commitChangesInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Commit'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "'  src='images/delete_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=deleteRecordsInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Delete'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/truncate_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=truncateTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Truncate'>"
                    divStr += "<div id='exportDropdown" + gridId.trim() + "' class='exportDropdown visionSearchExport visionSearchExportDiv' style='vertical-align: bottom; display: flex; padding-top: 8px;margin-top:-8px;'><table style='/*vertical-align: bottom;*/ display: inline-block;width: 40%;' class='visionSearchExportTable'><tbody><tr><td><select id='export" + gridId.trim() + "' onchange=getImportType('" + gridId.trim() + "')><option value=''>Select</option><option value='Xlsx'>Xlsx</option><option value='CSV'>CSV</option><option value='XML'>XML</option></select></td></tr></tbody></table> ";
                    divStr += "<input title='Export'  id='excelExport" + gridId.trim() + "' onclick=finalExport('" + gridId.trim() + "') class='exportClass visionSearchExportButton visionGridExportButton' type='button' disabled=''>";
                    divStr += "<input title='Import'  id='excelImport" + gridId.trim() + "' onclick=finalImport('" + gridId.trim() + "') class='importClass visionSearchImportButton visionGridImportButton' type='button' disabled='' style='margin-top: 5px;margin-left:5px;'>";
                    divStr += "</div>";
                    divStr += "</div>";
                    divStr += personalizeDivStr;
                    divStr += "<div id='" + gridId + "'></div>";

                    $("#dataViewDiv").append(divStr);
//                    $("#dataViewDiv").append("<div><div><img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'></div><div id='" + gridId + "'></div>"); // ravi edit for tabs navigation
                    $('#dataViewDiv').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

                    $('#dataViewDiv').jqxTabs('showAllCloseButtons');
                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                } else {
                    switchETLDesignTabs("li_contentView", "dataViewDiv");
                    var divStr = "<div>";
                    divStr += "<div style='display: flex;float:left;margin-top:5px;'>";
                    divStr += "<img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'>"
                    divStr += "<img id='editTableIcon_" + gridId + "' src='images/edit_table.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=showEditTableOptions('" + gridId + "') title='Edit Table'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/add_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=addRecordToTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Insert Record'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/commit_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=commitChangesInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Commit'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/delete_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=deleteRecordsInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Delete'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/truncate_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=truncateTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Truncate'>"

                    divStr += "<div id='exportDropdown" + gridId.trim() + "' class='exportDropdown visionSearchExport visionSearchExportDiv' style='vertical-align: bottom; display: flex; padding-top: 8px;margin-top:-8px;'><table style='/*vertical-align: bottom;*/ display: inline-block;width: 40%;' class='visionSearchExportTable'><tbody><tr><td><select id='export" + gridId.trim() + "' onchange=getImportType('" + gridId.trim() + "')><option value=''>Select</option><option value='Xlsx'>Xlsx</option><option value='CSV'>CSV</option><option value='XML'>XML</option></select></td></tr></tbody></table> ";
                    divStr += "<input title='Export'  id='excelExport" + gridId.trim() + "' onclick=finalExport('" + gridId.trim() + "') class='exportClass visionSearchExportButton visionGridExportButton' type='button' disabled=''>";
                    divStr += "<input title='Import'  id='excelImport" + gridId.trim() + "' onclick=finalImport('" + gridId.trim() + "') class='importClass visionSearchImportButton visionGridImportButton' type='button' disabled='' style='margin-top: 5px;margin-left:5px;'>";
                    divStr += "</div>";
                    divStr += "</div>";
                    divStr += personalizeDivStr;
                    divStr += "<div id='" + gridId + "'></div>";

                    $('#dataViewDiv').jqxTabs('addLast', DBValue + "." + tableName, divStr); // ravi edit for tabs navigation
//                    $('#dataViewDiv').jqxTabs('addLast', DBValue + "." + tableName, '<div><div><img src="images/refresh_icon.png" style="width:18px;height: 18px;cursor:pointer;padding-left:3px;" onclick=refreshTableGrid("' + gridId + '") title="Refresh"></div><div id="' + gridId + '"></div></div>'); // ravi edit for tabs navigation
                }

                new gridjs.Grid({
                    columns: columnNamesArray,
                    search: true,
                    data: dataArray,
                    sort: true,
                    pagination: {
                        enabled: true,
                        limit: 5,
                        summary: false
                    }
                }).render(document.getElementById(gridId));

//                 new gridjs.Grid({
//                    columns: ["Name", "Email", "Phone Number"],
//                    search: true,
//                    data: [
//                        ["John", "john@example.com", "(353) 01 222 3333"],
//                        ["Mark", "mark@gmail.com", "(01) 22 888 4444"],
//                        ["Eoin", "eoin@gmail.com", "0097 22 654 00033"],
//                        ["Sarah", "sarahcdd@gmail.com", "+322 876 1233"],
//                        ["Afshin", "afshin@mail.com", "(353) 22 87 8356"]
//                    ]
//                }).render(document.getElementById(gridId));



                $('#dataViewDiv').unbind('selected').on('selected', function (event) {
                    var $thid = this;

                    $('#dataViewDiv').jqxTabs('getContentAt', i);

                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                });

                $('#dataViewDiv').unbind('add').on('add', function (event) {

                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
//                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                    setTimeout(function () {
                        $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                    }, 100);
                    var selectedTabTitle = $("#dataViewDiv").jqxTabs("getTitleAt", event.args.item);
                    $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle);
//                    $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle.split(".")[1]);
                    var selectedTabLi = $("#dataViewDiv").find("li.jqx-tabs-title-selected-top");
                    selectedTabLi.attr("title", selectedTabTitle);

                    var selectedItem = $('#dataViewDiv').jqxTabs('selectedItem'); // ravi edit for tabs issue
                    $('#dataViewDiv').jqxTabs('ensureVisible', selectedItem); // ravi edit for tabs issue


                });


                $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                $(document).mouseup(function (e)
                {
                    var container = $("#" + gridId + "_settings_panel");
                    var container1 = $(".personaliseoption");
                    if ((!container.is(e.target)
                            && container.has(e.target).length === 0)
                            && (!container1.is(e.target)
                                    && container1.has(e.target).length === 0)
                            )
                    {
                        $(container).hide();
                        $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                    }
                });
            }
            stopLoader();
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}

function viewTableDataGrid1(data) {
    showLoader();
    var DBValue = data.DBValue;
    var tableName = data.tableName;
    //    var gridId = ("divGrid" + DBValue + "-" + tableName).replace(/\s/g, '');
    var gridId = ("divGrid-" + DBValue + "-" + tableName).replace(/\s/g, ''); // ravi updated code changes
    gridId = gridId.replace(/\//g, '');
    data['gridId'] = gridId;
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'getSchemaObjectMetaData',
        cache: false,
        data: data,

        success: function (response) {

            if (response != null) {
                // var responseObj = JSON.parse(response);
                var dataArray = response['dataArray'];
                var dataFieldsArray = response['dataFieldsArray'];
                var columnsArray = response['columnsArray'];
                data['columnsArray'] = JSON.stringify(response['columnList']);
                var totalCount = response['totalCount'];
                var personalizeDivStr = response['gridPersonalizeStr'];

                var selectedItemIndex = $('#dataViewDiv').jqxTabs('selectedItem');

                if (selectedItemIndex == null) {
                    //$("#designViewTab").jqxTabs('select', 1);
                    switchETLDesignTabs("li_contentView", "dataViewDiv");
                    $("#dataViewDiv").prepend("<ul></ul>");
                    $("#dataViewDiv ul").prepend("<li title='" + DBValue + "." + tableName + "'>" + DBValue + "." + tableName + "</li>");
                    var divStr = "<div>";
                    divStr += "<div style='display: flex;float:left;margin-top:5px;'>";
                    divStr += "<img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'>"
                    divStr += "<img id ='editTableIcon_" + gridId + "' src='images/edit_table.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=showEditTableOptions('" + gridId + "') title='Edit Table'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/add_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=addRecordToTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Insert Record'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "'  src='images/commit_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=commitChangesInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Commit'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "'  src='images/delete_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=deleteRecordsInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Delete'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/truncate_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=truncateTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Truncate'>"
                    divStr += "<div id='exportDropdown" + gridId.trim() + "' class='exportDropdown visionSearchExport visionSearchExportDiv' style='vertical-align: bottom; display: flex; padding-top: 8px;margin-top:-8px;'><table style='/*vertical-align: bottom;*/ display: inline-block;width: 40%;' class='visionSearchExportTable'><tbody><tr><td><select id='export" + gridId.trim() + "' onchange=getImportType('" + gridId.trim() + "')><option value=''>Select</option><option value='Xlsx'>Xlsx</option><option value='CSV'>CSV</option><option value='XML'>XML</option></select></td></tr></tbody></table> ";
                    divStr += "<input title='Export'  id='excelExport" + gridId.trim() + "' onclick=finalExport('" + gridId.trim() + "') class='exportClass visionSearchExportButton visionGridExportButton' type='button' disabled=''>";
                    divStr += "<input title='Import'  id='excelImport" + gridId.trim() + "' onclick=finalImport('" + gridId.trim() + "') class='importClass visionSearchImportButton visionGridImportButton' type='button' disabled='' style='margin-top: 5px;margin-left:5px;'>";
                    divStr += "</div>";
                    divStr += "</div>";
                    divStr += personalizeDivStr;
                    divStr += "<div id='" + gridId + "'></div>";

                    $("#dataViewDiv").append(divStr);
//                    $("#dataViewDiv").append("<div><div><img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'></div><div id='" + gridId + "'></div>"); // ravi edit for tabs navigation
                    $('#dataViewDiv').jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

                    $('#dataViewDiv').jqxTabs('showAllCloseButtons');
                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                } else {
                    switchETLDesignTabs("li_contentView", "dataViewDiv");
                    var divStr = "<div>";
                    divStr += "<div style='display: flex;float:left;margin-top:5px;'>";
                    divStr += "<img src='images/refresh_icon.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=refreshTableGrid('" + gridId + "') title='Refresh'>"
                    divStr += "<img id='editTableIcon_" + gridId + "' src='images/edit_table.png' style='width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=showEditTableOptions('" + gridId + "') title='Edit Table'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/add_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=addRecordToTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Insert Record'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/commit_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=commitChangesInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Commit'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/delete_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=deleteRecordsInTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Delete'>"
                    divStr += "<img class='visionEditOptions_" + gridId + "' src='images/truncate_icon.png' style='display:none; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=truncateTable('" + gridId + "','" + data.DBValue + "','" + data.tableName + "','" + data.connectionObj + "') title='Truncate'>"

                    divStr += "<div id='exportDropdown" + gridId.trim() + "' class='exportDropdown visionSearchExport visionSearchExportDiv' style='vertical-align: bottom; display: flex; padding-top: 8px;margin-top:-8px;'><table style='/*vertical-align: bottom;*/ display: inline-block;width: 40%;' class='visionSearchExportTable'><tbody><tr><td><select id='export" + gridId.trim() + "' onchange=getImportType('" + gridId.trim() + "')><option value=''>Select</option><option value='Xlsx'>Xlsx</option><option value='CSV'>CSV</option><option value='XML'>XML</option></select></td></tr></tbody></table> ";
                    divStr += "<input title='Export'  id='excelExport" + gridId.trim() + "' onclick=finalExport('" + gridId.trim() + "') class='exportClass visionSearchExportButton visionGridExportButton' type='button' disabled=''>";
                    divStr += "<input title='Import'  id='excelImport" + gridId.trim() + "' onclick=finalImport('" + gridId.trim() + "') class='importClass visionSearchImportButton visionGridImportButton' type='button' disabled='' style='margin-top: 5px;margin-left:5px;'>";
                    divStr += "</div>";
                    divStr += "</div>";
                    divStr += personalizeDivStr;
                    divStr += "<div id='" + gridId + "'></div>";

                    $('#dataViewDiv').jqxTabs('addLast', DBValue + "." + tableName, divStr); // ravi edit for tabs navigation
//                    $('#dataViewDiv').jqxTabs('addLast', DBValue + "." + tableName, '<div><div><img src="images/refresh_icon.png" style="width:18px;height: 18px;cursor:pointer;padding-left:3px;" onclick=refreshTableGrid("' + gridId + '") title="Refresh"></div><div id="' + gridId + '"></div></div>'); // ravi edit for tabs navigation
                }

//                new gridjs.Grid({
//                    columns: ["Name", "Email", "Phone Number"],
//                    search: true,
//                    data: [
//                        ["John", "john@example.com", "(353) 01 222 3333"],
//                        ["Mark", "mark@gmail.com", "(01) 22 888 4444"],
//                        ["Eoin", "eoin@gmail.com", "0097 22 654 00033"],
//                        ["Sarah", "sarahcdd@gmail.com", "+322 876 1233"],
//                        ["Afshin", "afshin@mail.com", "(353) 22 87 8356"]
//                    ]
//                }).render(document.getElementById(gridId));



                var headerTooltipRenderer = function (element) {
                    $(element).parent().jqxTooltip({position: 'mouse', theme: 'energyblue',
                        position: 'bottom-right',
                        showArrow: false, content: $(element).text()});
                }
                var source =
                        {
                            type: 'POST',
//                                                async: false,
                            datatype: "json",
                            datafields: dataFieldsArray,
                            data: data,
                            url: 'getSchemaObjectData',
                            cache: false,
                            root: 'Rows',
                            processdata: function (data) {
                                showLoader();
                                data['getOnlyDataArray'] = 'Y';

                            },
                            beforeSend: function () {
                                //showLoader();

                            }, loadError: function (xhr, status, error) {
                                $('#dataViewDiv').css("width", "100%");
                            }, loadComplete: function (data)
                            {
                                $('#dataViewDiv').css("width", "100%");
                                //$("#div_" + tableName).jqxGrid('hiderowdetails', 0);
                                //$("#row0div_" + tableName).hide();
                                stopLoader();
                            },
                            beforeprocessing: function (data) {

                                source.totalrecords = data[data.length - 1];

                            },
                            sort: function ()
                            {
//                                                $("#" + gridResultObj['gridId'] + "_sort_columns").remove();
                                $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'sort');
                                try {
                                    $("[id='" + gridId + "']").jqxGrid('clearselection');
                                } catch (e) {
                                }
                                stopLoader();
                            },
                            filter: function () {

                                $("[id='" + gridId + "']").jqxGrid('updatebounddata', 'filter');
                                try {
                                    $("[id='" + gridId + "']").jqxGrid('clearselection');
                                } catch (e) {
                                }
                                stopLoader();
                            }
                        };
//                var source =
//                        {
//                            localdata: dataArray,
//                            datatype: "array",
//                            datafields: dataFieldsArray
//                        };
                window.allGridColumns[gridId] = columnsArray;
                var dataAdapter = new $.jqx.dataAdapter(source);
                var tabHeight = $("#" + gridId).closest(".jqx-tabs-content-element").height();
                $("[id='" + gridId + "']").jqxGrid(
                        {
                            width: "100%",
                            height: parseInt(tabHeight) * 0.88,
                            theme: 'energyblue',
                            autoshowloadelement: false,
                            source: dataAdapter,
                            pageable: true,
                            pagesize: 50,
                            showfilterrow: true,
                            filterable: true,
                            sortable: true,
                            virtualmode: true,
                            pagesizeoptions: ['50', '100', '500', '1000', '5000', '10000', '50000'],
                            enabletooltips: true,
                            enablemousewheel: true,
                            enablehover: true,
                            selectionmode: 'checkbox',
                            enablebrowserselection: true,
                            rendergridrows: function (params) {
                                return params.data;
                            },
                            columnsresize: true,
                            columns: columnsArray
                        });



                $('#' + gridId).on('cellbeginedit', function (event)
                {
//                    var data = $('#' + gridId).jqxGrid('exportdata', 'json');
//                    data = JSON.parse(data);
                    // event arguments.
                    var args = event.args;
                    // column data field.
                    var dataField = event.args.datafield;
                    // row's bound index.
                    var rowBoundIndex = event.args.rowindex;
                    // cell value
                    var value = args.value;
                    // cell old value.
                    var oldvalue = args.oldvalue;
                    $('#' + gridId).jqxGrid('selectrow', rowBoundIndex);
                    $("#last-edit-datafield").val(dataField);
                    $("#last-edit-row").val(rowBoundIndex);


                });


                $('#' + gridId).on('cellendedit', function (event)
                {

                    // event arguments.
                    var args = event.args;
                    // column data field.
                    var dataField = event.args.datafield;
                    // row's bound index.
                    var rowBoundIndex = event.args.rowindex;
                    // cell value
                    var value = args.value;
                    // cell old value.
                    var oldvalue = args.oldvalue;
                    // row's data.
                    var rowData = args.row;


                    if (rowData[tableName + "_HIDDEN"] == 'UPDATE') {
                        if (oldvalue != value) {

                            var changeObj = updateDataInfo[rowBoundIndex];
                            if (changeObj == null) {
                                changeObj = {};
                            }
                            changeObj[dataField] = oldvalue;
                            updateDataInfo[rowBoundIndex] = changeObj;
                        }

                    }



                });


                $('#' + gridId).on('cellvaluechanged', function (event) {
                    var args = event.args;
                    var dataField = args.datafield;
                    var dataField1 = args.text;
                    var rowIndex = args.rowindex;
                    var cellValue = args.value;
                    var column = $('#' + gridId).jqxGrid('getcolumn', event.args.datafield).text;

                });

                $('#' + gridId).on('celldoubleclick', function (event) {
                    var args = event.args;
                    var dataField = args.datafield;
                    var dataField1 = args.text;
                    var rowIndex = args.rowindex;
                    var cellValue = args.value;
                    var column = $('#' + gridId).jqxGrid('getcolumn', event.args.datafield).text;
                    popupedit(column, cellValue);
                });



                $('#dataViewDiv').unbind('selected').on('selected', function (event) {
                    var $thid = this;

                    $('#dataViewDiv').jqxTabs('getContentAt', i);

                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                });

                $('#dataViewDiv').unbind('add').on('add', function (event) {

                    $("#dataViewDiv").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
//                    $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                    setTimeout(function () {
                        $("#dataViewDiv").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");

                    }, 100);
                    var selectedTabTitle = $("#dataViewDiv").jqxTabs("getTitleAt", event.args.item);
                    $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle);
//                    $("#dataViewDiv").jqxTabs('setTitleAt', event.args.item, selectedTabTitle.split(".")[1]);
                    var selectedTabLi = $("#dataViewDiv").find("li.jqx-tabs-title-selected-top");
                    selectedTabLi.attr("title", selectedTabTitle);

                    var selectedItem = $('#dataViewDiv').jqxTabs('selectedItem'); // ravi edit for tabs issue
                    $('#dataViewDiv').jqxTabs('ensureVisible', selectedItem); // ravi edit for tabs issue


                });


                $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                $(document).mouseup(function (e)
                {
                    var container = $("#" + gridId + "_settings_panel");
                    var container1 = $(".personaliseoption");
                    if ((!container.is(e.target)
                            && container.has(e.target).length === 0)
                            && (!container1.is(e.target)
                                    && container1.has(e.target).length === 0)
                            )
                    {
                        $(container).hide();
                        $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
                    }
                });
            }
            stopLoader();
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}
function searchColumns(tableName, DBValue) {
    showLoader();
    var connectionObj;
    if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
    {
        var conObj = savedDBData[DBValue];
        if (conObj != null && !jQuery.isEmptyObject(conObj)) {
            connectionObj = conObj;
        }
    }
    var filterColumn = $('#searchColumns').val().toLowerCase();
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'selectSapTableColumns',
        cache: false,
        data: {
            filterColumn: filterColumn,
            parentkey: tableName,
            connectionObj: JSON.stringify(connectionObj)

        },
        success: function (response) {
            stopLoader();
            var columns = response.columnsArray;
            var tableStr = "";
            tableStr += '<div  class="visionTableName" style="position: relative;"><input id="selectAllCheckBoxes"  type="checkbox" > Select All </div>'; // ---- ravi edit for checkboxes

            for (var i = 0; i < columns.length; i++) {
                var destination = $("#destinationFields").find("[id=" + columns[i] + "]");
                if (destination.length > 0) {

                } else {
                    //tableStr +=  '<div id="'+columns[i]+'" class="visionTableName" title="'+columns[i]+'"  style="position: relative;">'+columns[i]+'<img src="images/crossicon.png" title="Clear Data" onclick="moveToSource('+columns[i]+')" class="visionCloseDestTableBtn"></div>';
                    tableStr += '<div id="' + columns[i] + '" class="visionTableName" title="' + columns[i] + '"  style="position: relative;"><input class="visionTableNameChbx" type="checkbox" > ' + columns[i] + '<img src="images/crossicon.png" title="Clear Data" onclick="moveColumnToSource(' + columns[i] + ')" class="visionCloseDestTableBtn"></div>';

                }
            }
            $("#sourceFields").html(tableStr);


            $("#selectAllCheckBoxes").click(function () {
//                      $(".visionTableNameChbx").prop('checked', $(this).prop('checked'));



                if ($(this).prop("checked")) {
                    $(".visionTableNameChbx").each(function (i) {
                        if (i < 50) {
                            $(this).prop('checked', true)
                            $(this).parent('div').addClass("multipleSelect");
                        } else {
                            $(this).prop('checked', false)
                            $(this).parent('div').removeClass("multipleSelect");
                        }

                    });

                }
                if (!$(this).prop("checked")) {
                    $(".visionTableNameChbx").prop('checked', $(this).prop('checked'));
                    $(".visionTableNameChbx").parent('div').removeClass("multipleSelect");
                }

            });

            $(".visionTableNameChbx").change(function () {

                var selectedLength = $(".sourceFields").find(".multipleSelect").length;
                if (selectedLength < 50) {
                    $("#selectAllCheckBoxes").prop("checked", false);
                    if (!$(this).prop("checked")) {
                        $(this).parent('div').removeClass("multipleSelect");
                    }
                    if ($(this).prop("checked")) {
                        $(this).parent('div').addClass("multipleSelect");
                    }
                } else {

                    if (!$(this).prop("checked")) {

                        $(this).prop("checked", false);
                        $(this).parent('div').removeClass("multipleSelect");
                        $("#selectAllCheckBoxes").prop("checked", false);
                    }
                    if ($(this).prop("checked")) {
                        showMesg("Cannot select more than 50");
                        $(this).prop("checked", false);
                        $(this).parent('div').removeClass("multipleSelect");
                    }

                }

            });

            dragColumns()
        },
        error: function (e) {
            console.log(e);
            sessionTimeout(e);
            stopLoader();
        }
    });
}


function clearColumnInput(tableName, DBValue) {
    $("#searchColumns").val('');
    searchColumns(tableName, DBValue);
}
function dragColumns() {


    $("#sourceFields div").draggable({
        revert: "invalid",
        refreshPositions: true,
        cursor: 'move',
        zindex: false,
        opacity: false,
        appendto: "parent",
        helper: function (event) {
            var helperList = $('<ul class="draggable-helper" />');
            if ($(this).is('.multipleSelect')) {
                helperList.append($(this).siblings('.multipleSelect').andSelf().clone());
            } else {
                helperList.append($(this).clone());
            }
            return helperList;
        },
        drag: function (event, ui) {
            ui.helper.addClass("draggableTable");
            var height = ui.helper[0].offsetHeight;
            var dialogHeight = $("#logoutDailog").css("height");
            $("#logoutDailog").css("height", dialogHeight);
            $("#logoutDailog").css("overflow", "inherit");
            $("#destinationFields").css("min-height", "300px");
            $("#destinationFields").css("height", height);

        },
        stop: function (event, ui) {
            // ui.helper.removeClass("draggableTable");
            $("#destinationFields").css("height", "300px");
            $("#logoutDailog").css("height", "auto");
            $("#logoutDailog").css("overflow", "auto");

        }
    });
    $("#destinationFields").droppable({
        revert: "invalid",
        refreshPositions: true,
        cursor: 'move',
        drop: function (event, ui) {
            $("#destinationFields").css("height", "300px");
            $("#logoutDailog").css("height", "auto");
            $("#logoutDailog").css("overflow", "auto");

            if ($("#destinationFields div").length == 0) {
                $("#destinationFields").html("");
            }

            var destinationFieldsLength = $(".destinationFields").find(".visionTableName").length;
            if (destinationFieldsLength < 50) {
                $("#selectAllCheckBoxes").prop("checked", false);
                var items = ui.helper.children();
                $.each(items, function (index) {
                    var destinationFieldsLength = $(".destinationFields").find(".visionTableName").length;
                    if (destinationFieldsLength < 50) {
                        $(this).removeClass("multipleSelect");
                        $(this).addClass("droppedTable");
                        var droppableId = this.id;

                        $("#destinationFields").append($(this));


                        $("#sourceFields").find("#" + droppableId).remove();
                        $("#" + droppableId).children().show();

                        $("#destinationFields").find(".visionTableNameChbx").hide();
                    } else {
                        return false;
                    }
                })
            } else {
                showMesg("Cannot select more than 50 columns");
            }

        }
    });
}

function moveColumnToSource(column) {
    var columnName = column.id;
    $("#sourceFields").append($("#" + columnName));
    $("#" + columnName).find(".visionCloseDestTableBtn").hide();
    $("#" + columnName).find(".visionTableNameChbx").show();
    $("#" + columnName).find(".visionTableNameChbx").prop("checked", false);
    $("#" + columnName).find(".visionTableNameChbx").prop("checked", false);

    $(".visionTableNameChbx").change(function () {
        if (!$(this).prop("checked")) {
            $("#selectAllCheckBoxes").prop("checked", false);
            $(this).parent('div').removeClass("multipleSelect");
        }
        if ($(this).prop("checked")) {
            $(this).parent('div').addClass("multipleSelect");
        }
    });
    dragColumns();
}

function scheduleJob(jobId) {
    var jobName = $("#" + jobId).find("span").text();
    console.log("jobName::" + $.trim(jobName));
    if (jobId != null && jobId != ''
            && jobName != null && jobName != '') {
        jobName = $.trim(jobName);
        var scheduleForm = "<div class='cronStartDateDiv'>"
                + "<table><tr>"
                + "<td>Start Date</td>"
                + "<td><input type='text' id='cronStartDate' readonly='true'  /></td>"
                + "<td>End Date</td>"
                + "<td><input type='text' id='cronEndDate' /></td>"
                + "</tr></table>"
                + "</div>"
                + "<div id='cronExpressionDiv' class='cron-builder'></div>"
                + "<div class='cron-expression'>"
                + " <p>Cron Expression:<input type='text' id='cronExpression' readonly='true' /></p>"
                + "</div>";
        $("#logoutDailog").html(scheduleForm);
        $("#logoutDailog").dialog({
            title: (labelObject[jobName] != null ? labelObject[jobName] : jobName),
            modal: true,
            height: 250,
            minWidth: '650',
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Schedule'] != null ? labelObject['Schedule'] : 'Schedule'),
                    click: function () {
                        var cronExp = $('#cronExpression').val();
                        if (cronExp != null && cronExp != '') {
                            cronExp = cronExp.substring(0, cronExp.lastIndexOf(" "));
                            var cronStartDate = $("#cronStartDate").val();
                            var cronEndDate = $("#cronEndDate").val();
                            console.log("cronExp:::" + cronExp);
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
                            scheduleProcessJob(cronExp, jobId, jobName, cronStartDate, cronEndDate);
                        }


                    }},
                {
                    text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");

                    }}],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $('#cronExpressionDiv').cronBuilder({
                    selectorLabel: "Select time period:  ",
                    onChange: function (expression) {
                        $('#cronExpression').val(expression);
                    }
                });
                $("#cronStartDate").datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: "dd-mm-yy",
                    showOn: "button",
                    buttonImage: 'images/date_picker_icon.png',
                    buttonImageOnly: true,

//                    setDate:new Date()
                });
                $("#cronStartDate").datepicker("setDate", new Date());
                $("#cronStartDate").addClass("ui-datepickerJobSchedule");

                $("#cronEndDate").datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: "dd-mm-yy",
                    showOn: "button",
                    buttonImage: 'images/date_picker_icon.png',
                    buttonImageOnly: true
                });
                $("#ui-datepicker-div").addClass("ui-datepickerJobSchedule");
//                $('#cronExpression').html("");
                //cronExpressionDiv
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    }
    // need to open dailog box for Scheduling time
}
function scheduleProcessJob(cronExp, jobId, jobName, cronStartDate, cronEndDate) {
    if (cronExp != null && cronExp != ''
            && jobId != null && jobId != ''
            && jobName != null && jobName != '') {

        $.ajax({
            datatype: "json",
            type: "post",
            traditional: true,
            url: 'scheduleProcessJob',
            cache: false,
            data: {
                cronExp: cronExp,
                jobId: jobId,
                jobName: jobName,
                cronStartDate: cronStartDate,
                cronEndDate: cronEndDate


            },
            success: function (response) {
                stopLoader();
                var dialogSplitMessage = dialogSplitIconText(response['message'], "Y");
                $("#logoutDailog").html(dialogSplitMessage);
                $("#logoutDailog").dialog({
                    title: (labelObject[jobName] != null ? labelObject[jobName] : jobName),
                    modal: true,
                    height: 'auto',
                    minHeight: 'auto',
                    minWidth: 370,
                    maxWidth: 'auto',
                    fluid: true,
                    buttons: [{
                            text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                            click: function () {
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");


                            }}],
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");

                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });
            },
            error: function (e) {
                sessionTimeout(e);
                stopLoader();
            }
        });
    }
}

function loadScheduledJobs() {
    showLoader();
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'loadScheduledJobs',
        cache: false,
        data: {

        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                var dataArray = response['scheduledJobsArray'];
            }
            var source =
                    {
                        datatype: "json",
                        datafields: [
                            {name: 'id'},
                            {name: 'parentid'},
                            {name: 'text'},
                            {name: 'icon'},
                            {name: 'value'}
                        ],
                        id: 'id',
                        icon: 'icon',
                        localdata: dataArray
                    };

            // create data adapter.
            var dataAdapter = new $.jqx.dataAdapter(source);
            // perform Data Binding.
            dataAdapter.dataBind();
            // get the tree items. The first parameter is the item's id. The second parameter is the parent item's id. The 'items' parameter represents 
            // the sub items collection name. Each jqxTree item has a 'label' property, but in the JSON data, we have a 'text' field. The last parameter 
            // specifies the mapping between the 'text' and 'label' fields.  
            var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{name: 'text', map: 'label'}]);
            //scheduledJobs
            $('#scheduledJobs').jqxTree({source: records, width: 300,
                toggleMode: 'click', theme: 'energyblue',
                enableHover: true,
                incrementalSearch: true,
                keyboardNavigation: true
            });
            $("#scheduledJobs").on('mousedown', function (event) {


                var target = $(event.target).parents('li:first')[0];
                var treeItem = $(event.target).closest('.visionETLAvailableJobs');
                var rightClick = isRightClick(event);
                if (rightClick && target != null) {
                    $("#scheduledJobs").jqxTree('selectItem', target);
                    var selectedItem = $('#scheduledJobs').jqxTree('getSelectedItem');
                    var jobId = selectedItem['value'];
                    if (jobId != null
                            && jobId != ''
                            && jobId != 'RUNNING_JOBS'
                            && jobId != 'STOPED_JOBS'
                            ) {
                        var parentListItem = selectedItem.parentElement;
                        if (parentListItem != null) {
                            var selectedParentItem = $('#scheduledJobs').jqxTree('getItem', parentListItem);
                            if (selectedParentItem != null && selectedParentItem['value'] == 'RUNNING_JOBS') {
                                var menuItems = "<li onclick=\"processScheduledJobFlag('" + jobId + "','STOP')\">Stop</li>";
                                menuItems += "<li onclick=\"processScheduledJobFlag('" + jobId + "','DELETE')\">Remove</li>";
                                var menuHeight = 2;
                                $("#jqxMenu").remove();
                                $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
                                $("#jqxMenu ul").html(menuItems);
                                var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 27.5 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start
                                var scrollTop = $(window).scrollTop();
                                var scrollLeft = $(window).scrollLeft();
                                contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
                                return false;
                            } else if (selectedParentItem != null && selectedParentItem['value'] == 'STOPED_JOBS') {
                                var menuItems = "<li onclick=\"processScheduledJobFlag('" + jobId + "','RUN')\">Run</li>";
                                menuItems += "<li onclick=\"processScheduledJobFlag('" + jobId + "','DELETE')\">Remove</li>";
                                var menuHeight = 2;
                                $("#jqxMenu").remove();
                                $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
                                $("#jqxMenu ul").html(menuItems);
                                var contextMenu = $("#jqxMenu").jqxMenu({width: '120px', height: menuHeight * 27.5 + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start
                                var scrollTop = $(window).scrollTop();
                                var scrollLeft = $(window).scrollLeft();

                                contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
                                return false;
                            }
                        }


                    }

                }

            });
            $("#scheduledJobs li").on('dblclick', function (event) {
                var selectedItem = $("#scheduledJobs").jqxTree('getSelectedItem');
                var jobId = selectedItem['value'];
                if (jobId != null
                        && jobId != ''
                        && jobId != 'RUNNING_JOBS'
                        && jobId != 'STOPED_JOBS'
                        ) {
                    openSelectedJobLog(jobId);
                }

            });
        },
        error: function (e) {
            sessionTimeout(e);
            stopLoader();
        }
    });
}

function processScheduledJobFlag(jobId, jobFlag) {
    showLoader();
    var jobName = $("#" + jobId).find("span").text();
    if (jobName != null && jobName != '') {
        jobName = $.trim(jobName);
    }
    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'processScheduledJobFlag',
        cache: false,
        data: {
            jobId: jobId,
            jobFlag: jobFlag
        },
        success: function (response) {
            stopLoader();
            var dialogSplitMessage = dialogSplitIconText(response['message'], "Y");
            $("#logoutDailog").html(dialogSplitMessage);
            $("#logoutDailog").dialog({
                title: (labelObject[jobName] != null ? labelObject[jobName] : jobName),
                modal: true,
                height: 'auto',
                minHeight: 'auto',
                minWidth: 370,
                maxWidth: 'auto',
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
                            loadScheduledJobs();
                        }}],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");

                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });
        },
        error: function (e) {
            sessionTimeout(e);
            stopLoader();
        }
    });
}
function isRightClick(event) {
    var rightclick;
    if (!event)
        var event = window.event;
    if (event.which)
        rightclick = (event.which == 3);
    else if (event.button)
        rightclick = (event.button == 2);
    return rightclick;
}

function openSelectedJobLog(jobId) {
    var jobName = $("#" + jobId).find("span").text();
    if (jobName != null && jobName != '') {
        jobName = $.trim(jobName);
    }
    if (jobId != null && jobId != '') {
        var hidden = "<input type='hidden' id='currentProcessJoblogDate'/><input type='hidden' id='currentProcessJoblogIndex'/>";
        hidden += "<table id='processlogJobScheduleTable' class='logtable' style='width:100%'>"
                + "<thead>"
                + "<tr>"
                + "<th width='5%'></th>"
                + "<th width='25%' style='background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center;'>Time Stamp</th>"
                + "<th width='70%' style='background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center;'>Message</th>"
                + "</tr>"
                + "</thead>"
                + "<tbody>"
                + "</tbody>"
                + "</table>";
        $("#scheduledJobsDetails").html(hidden);
        processLogInterval = setInterval(function () {
            refreshScheduledJobLogFile(jobId) // this will run after every 1 seconds
        }, 2000);
    }

}

function  refreshScheduledJobLogFile(jobId) {
    stopLoader();
    var currentProcesslogDate = $("#currentProcessJoblogDate").val();
    var currentProcesslogIndex = $("#currentProcessJoblogIndex").val();
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'refreshProcessLog',
        async: true,
        data: {
            currentProcesslogDate: ((currentProcesslogDate != null && currentProcesslogDate != '') ? currentProcesslogDate : ""),
            currentProcesslogIndex: ((currentProcesslogIndex != null && currentProcesslogIndex != '') ? currentProcesslogIndex : ""),
            jobId: jobId
        },
        success: function (response) {
            if (response != null && response != '') {
                var resultObj = JSON.parse(response);
                if (resultObj != null && !jQuery.isEmptyObject(resultObj)) {
                    $("#currentProcessJoblogIndex").val(resultObj['currentProcesslogIndex']);
                    var logTxt = resultObj['logTxt'];
                    if (logTxt != null && logTxt != '') {
                        $("#processlogJobScheduleTable tbody").append(logTxt);
                        $("#currentProcessJoblogDate").val(resultObj['currentProcesslogDate']);
                        if (resultObj['processFlag'] == 'N') {
                            clearInterval(processScheduledJobLogInterval);
                        }
                    } else {

                    }
                } else {

                }
            } else {

            }
        },
        error: function (e)
        {
            sessionTimeout(e);
            stopLoader();
            if (processScheduledJobLogInterval != null) {
                clearInterval(processScheduledJobLogInterval);
            }
        }

    });
}

function normalizeData(mapOperatorId) {

    showLoader();
    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
//    previousOperatorId = selectedOperatorId;
    prevTargetOperatorId = selectedOperatorId;

    var mapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', mapOperatorId);

    // var jobId = selectedOperatorData['jobId'];

    var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', mapOperatorId);
    console.log("::::::::" + JSON.stringify(mapingObj));
    if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
        var toOpArray = mapingObj['toOpArray'];
        var fromOpArray = mapingObj['fromOpArray'];
    }

    var fromOperator = fromOpArray[0];
    var toOperator = toOpArray[0];


    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'getNormalizeTabs',
        cache: false,
        data: {

            fromOperator: JSON.stringify(fromOperator),
            toOperator: JSON.stringify(toOperator),
            operatorData: JSON.stringify(selectedOperatorData)
        },
        success: function (response, status, xhr) {
            stopLoader();

            if (response != null) {
                $("#feedContentArea").html(response);
                $("#normalizeOptionsTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

                $("#normalizeOptionsTabs").change(function (event) {
                    trfmRulesChanged = true;
                });
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}




function deNormalizeData(mapOperatorId) {


    showLoader();
    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
//    previousOperatorId = selectedOperatorId;
    prevTargetOperatorId = selectedOperatorId;


    var mapOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', mapOperatorId);

    // var jobId = selectedOperatorData['jobId'];

    var mapingObj = $('#' + flowChartWorkSpaceId).flowchart('getMapOperatorData', mapOperatorId);
    console.log("::::::::" + JSON.stringify(mapingObj));
    if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
        var toOpArray = mapingObj['toOpArray'];
        var fromOpArray = mapingObj['fromOpArray'];
    }

    var fromOperator = fromOpArray[0];
    var toOperator = toOpArray[0];


    $.ajax({
        datatype: "json",
        type: "post",
        traditional: true,
        url: 'getDeNormalizeTabs',
        cache: false,
        data: {
            fromOperator: JSON.stringify(fromOperator),
            toOperator: JSON.stringify(toOperator),
            operatorData: JSON.stringify(selectedOperatorData)
        },
        success: function (response, status, xhr) {
            stopLoader();

            if (response != null) {
                $("#feedContentArea").html(response);
                $("#deNormalizeOptionsTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});

                $("#deNormalizeOptionsTabs").change(function (event) {
                    trfmRulesChanged = true;
                });
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}

function changeSelectedTableDb(id, index) {
    var joinDBStr = $("#EtlMappingTable").attr("data-join-db");
    if (joinDBStr != null && joinDBStr != '') {
        var joinDB = JSON.parse(joinDBStr);
        if (joinDB != null && !jQuery.isEmptyObject(joinDB)) {
            var tableName = $("#" + id).val();
            var selectedTableDBObj = joinDB[tableName];
            //data-table-db
            $("#" + id).attr("data-table-db", JSON.stringify(selectedTableDBObj));


        }
    }
}
function finalImport(gridId) {
    var typeName = $("#export" + gridId).val();
    var divStr = '<div class="dataMigratorContent"> <div class="visionProgressSteps" style="display: none;"><ul class="visionStepsProgressbar"><li id="connectToDB" class="active"><p class="visionProcessStepsContent">Connect to Database</p></li><li id="fetchTables"><p class="visionProcessStepsContent">Fetch Tables</p> </li><li id="mapColumns"><p class="visionProcessStepsContent">Map Columns</p></li></ul></div><div class="visionProgressFilesSteps"><ul class="visionStepsProgressbar"><li id="uploadFile" class="active"><p class="visionProcessStepsContent">Upload File</p></li><li id="mapFileCols"><p class="visionProcessStepsContent">Map Columns</p> </li></ul></div><div class="visionUploadFileDiv" id="visionUploadDocs"><div id="showFileType" class="visionShowFileType"></div><input type="hidden" id="selectedType" value=""><input type="hidden" id="selectedTypeName" value=""><input type="hidden" id="savedConnectionList" value=""><input type="hidden" value="" id="dbDetails"><input type="hidden" value="" id="auditId"><div id="visionDMFileUploadDiv" class="visionDMFileUploadDiv"><input type="file" name="importDMFile" id="importDMFile" class="visionDMFilesInput"><div class="visionDMFileUploadclass" id="visionDmFileUpload"><p class="VisionDMUploadFileContent">Upload Files Here </p></div> <div id="visionDMFileList"></div><div class="allErrors visionDMFiles" splitcount="0" id="disvisionDMFiles" style="color: red;display:none"></div></div><div id="visionFileMapCols"></div></div><div class="visionDatabaseMain"><div id="showConnectionType" class="visionShowConnectionType"></div><div class="visionConnectToDbDiv" id="visionConnectToDb"><table class="visionDbTable"> <tbody><tr class="visionDbTr"><td class="visionDbTd"> <label class="visionDbLabels">Connection Name</label></td><td class="visionDbTd"> <input type="text" value="" name="ConnectionName" id="DbConnectionName" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbConnectionNameError"></div></td> </tr><tr class="visionDbTr"><td class="visionDbTd"> <label class="visionDbLabels">Host Name</label></td><td class="visionDbTd"> <input type="text" value="" name="HostName" id="DbHostName" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbHostNameError"></div></td></tr><tr class="visionDbTr"><td class="visionDbTd">  <label class="visionDbLabels">Port</label></td><td class="visionDbTd"><input type="text" value="" name="Port" id="DbPort" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbPortError"></div></td></tr><tr class="visionDbTr"><td class="visionDbTd">  <label class="visionDbLabels">Username</label></td><td class="visionDbTd"> <input type="text" value="" name="Username" id="DbUserName" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbUserNameError"></div></td></tr> <tr class="visionDbTr"><td class="visionDbTd">  <label class="visionDbLabels">Password</label></td><td class="visionDbTd">    <input type="password" value="" name="HostName" id="DbPassword" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbPasswordError"></div></td></tr><tr class="visionDbTr"><td class="visionDbTd">  <label class="visionDbLabels">Database/Service Name</label></td><td class="visionDbTd">    <input type="text" value="" name="ServiceName" id="DbServiceName" class="visionInputDbFields"><div class="dataMigrationInputError" id="DbServiceNameError"></div></td></tr><tr class="visionDbTr" style="display:none"><td class="visionDbTd">  <label class="visionDbLabels">Audit Id</label></td><td class="visionDbTd">    <input type="hidden" value="" name="auditId" id="auditId" class="visionInputDbFields"></td></tr><tr class="visionDbTr"><td><input type="checkbox" name="checkBoxDetails" id="checkBoxChecked" value="checked" checked="">Save Details<div class="visionDataMigrationError" style="display:none">Please check the box</div></td></tr><tr class="visionDbTr"><td class="visionDbTd visionDbConnectBtn" id="connectDbTd" colspan="2"><input type="button" value="Connect" name="Connect" onclick="connectDatabase()" class="visionInputDbButton"></td><td class="visionDbTd visionDbSaveBtn" id="saveDbTd" colspan="2" style="display:none"></td></tr></tbody></table></div><div id="fieldChooser" class="visionTablesComboBox" style="display:none"></div><div id="mappingColumns" class="visionColumnsMapping" style="display:none"><div id="showSourceTablesList" class="visionSourceTablesMain"></div><div class="visionMappedTable" id="MappedTable"></div><div class="visionProcessCols"><input type="button" value="Process" name="Process" id="processCols" onclick="fetchSelectedColumns()" class="visionProcessColsBtn"></div></div></div></div>';
    $('#dataMigratorPopup').html(divStr);


    $("#dataMigratorPopup").dialog({
        title: (labelObject['Data Piping'] != null ? labelObject['Data Piping'] : 'Data Piping'),
        modal: true,
        minHeight: 450,
        maxHeight: 600,
        minWidth: 970,
        maxWidth: 1200,
        fluid: true,

        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");

            //18-02

            $('.visionProgressSteps').hide();


            getDataBase("FILE", typeName.toUpperCase());

            $(".dataMigratorContent").css("width", "87%");
            $(".dataMigratorContent").css("margin-left", "8%");


        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        },
        close: function (event, ui)
        {
            try {
                $("#sub-tabs-2").jqxTabs("destroy");
            } catch (e) {
            }
            $(this).html("");
            $(this).dialog("close");
            $(this).dialog("destroy");
        }

    });

    var fileslist = [];
    $("html").on("dragover", function (e) {
        e.preventDefault();
        e.stopPropagation();

    });
    $("html").on("drop", function (e) {
        e.preventDefault();
        e.stopPropagation();
    });
    $('.visionDMFileUploadclass').on('drop', function (e) {
        $("#wait").css("display", "block");
        console.log("iam in drop functionality");
        var filetype = $('#selectedTypeName').val();
        etlFileImport("Y", filetype);

//        console.log("i am in drop functionality1" + filename);
    });


    $("#visionDmFileUpload").click(function (e) {
        $("#wait").css("display", "block");
        var filetype = $('#selectedTypeName').val();
        console.log("iam in clickable ");
        etlFileImport("N", filetype);


    });

    $("#visionDMFiles").on('change', function (event) {
        console.log("iam in files change ");
        var filetype = $('#selectedTypeName').val();
        etlFileImport("N", filetype);


    });

}


function getImportType(selectedGridId) {
    getExportType(selectedGridId);
    var importType = $('#export' + selectedGridId).val();
    if (importType.toUpperCase() == 'XLSX') {
        $("#excelImport" + selectedGridId).prop("disabled", false);
        // $("#excelImport"+selectedGridId).css('background','url("images/export_as_xlsx_icon_blue.png") 5px center no-repeat rgb(255, 255, 255)');

        $("input.importClass").css('background', '#fff url("images/export_as_xlsx_icon_blue.png")  no-repeat 5px center', 'important');
        $("input.importClass").hover(
                function () {
                    $("input.importClass").css('background', '#0071c5 url("images/export_as_xls_white.png")  no-repeat 5px center', 'important');
                }, function () {
            $("input.importClass").css('background', '#fff url("images/export_as_xlsx_icon_blue.png")  no-repeat 5px center', 'important');
        });


    } else if (importType.toUpperCase() == 'CSV') {
        $("#excelImport" + selectedGridId).prop("disabled", false);
        //$("#excelImport"+selectedGridId).css('background','url("images/export_as_csv_icon_blue.png") 5px center no-repeat rgb(255, 255, 255)');
        $("input.importClass").css('background', '#fff url("images/export_as_csv_icon_blue.png") no-repeat 5px center');
        $("input.importClass").hover(
                function () {
                    $("input.importClass").css('background', '#0071c5 url("images/export_as_csv_icon_white.png") no-repeat 5px center', 'important');
                }, function () {
            $("input.importClass").css('background', '#fff url("images/export_as_csv_icon_blue.png") no-repeat 5px center', 'important');
        });

    } else if (importType.toUpperCase() == "XML")
    {
        $("#excelImport" + selectedGridId).prop("disabled", false);
        $("input.importClass").css('background', '#fff url("images/import_icon_blue.png") no-repeat 5px center');
        $("input.importClass").hover(
                function () {
                    $("input.importClass").css('background', '#0071c5 url("images/import_icon_white.png") no-repeat 5px center', 'important');
                }, function () {
            $("input.importClass").css('background', '#fff url("images/import_icon_blue.png") no-repeat 5px center', 'important');
        });

    } else {
        $("#excelImport" + selectedGridId).prop("disabled", true);
    }

}


function etlFileImport(draganddropInd, filetype) {

    var validExtension = [];
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }

    var secretKey = $('meta[name=keygeneration]').attr("content");
    var params = {};
    var gridId = $('#gridIdStr').val();

    var browseId = "#importDMFile";
    var sourceex = $("#" + gridId).jqxGrid('source');
    var dataFeilds = [];
    dataFeilds = sourceex._source.datafields;

    params['gridId'] = $('#gridIdStr').val();
    params['selectedGridId'] = $('#gridIdStr').val();
    params['tableName'] = $('#tableName').val();
    params['selectedFiletype'] = filetype;
    var dataFeildsStr = JSON.stringify(dataFeilds);
    if (dataFeildsStr != null && dataFeildsStr != '' && dataFeildsStr != '{}') {
        dataFeildsStr = CryptoJS.AES.encrypt(dataFeildsStr, secretKey);
        params['dataFeilds'] = dataFeildsStr;
    }


    $(browseId).ajaxfileupload({
        'action': 'importDMFile',
        params: params,

        'onComplete': function (response) {
            $("#Loader").css("display", "none");
            $("body").css({"pointer-events": "auto"});
            var status = response.status;
            var message = response.message;
            if (message != null && message.indexOf("{") > -1 && message.indexOf("}") > -1) {
                message = message.substring(message.indexOf("{"), message.indexOf("}") + 1);
            }
            message = JSON.parse(message);
            // var tableStr = message.columnStr;
            var tableStr = jQuery('<div />').html(message.columnStr).text();
            var filePath = message.filePath;
            $('#filePathValue').val(filePath);
            var result = message.result;
            if (status == true && result != null && result == "File imported successfully") {
                $("#importDMFile").remove();

                var fileImprtDiv = "<input type='file' name='importDMFile' id='importDMFile' style='display:none'>";
                $("#visionDmFileUpload").parent().append(fileImprtDiv);
                var processBtn = "<input type='button' value= 'process' id= 'processMappedFileCols' onclick = 'processMappedFileCols()' class='visionProcessMappedFileBtn'>";
                $('#visionFileMapCols').html(tableStr + processBtn);

                $('#visionDMFileUploadDiv').hide();
                $('#visionFileMapCols').show();
                $('.visionProgressFilesSteps').show();
                $('#mapFileCols').addClass("active");

                if ($("#dataMigratorTreeDiv").length == 0) { // ravi import
                    $(".visionProcessMappedFileBtn").css("margin-right", "47%");
                }

            } else {
                $("#dialog").html(result);
                $("#dialog").dialog({
                    modal: true,
                    width: 270,
                    height: 135,
                    fluid: true,
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");


                        }
                    },
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                    },
                    beforeClose: function (event, ui)
                    {
                        $("#importDMFile").remove();
                        var fileImprtDiv = "<input type='file' name='importDMFile' id='importDMFile' style='display:none'>";
                        $("#visionDmFileUpload").parent().append(fileImprtDiv);
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });


            }
            console.log("On Complete::");

        },
        'onStart': function () {
            $('#Loader').show();
            $("body").css({"pointer-events": "none"});
            $("#Loader").css("display", "block");
            // $('#message').hide();
        }
    });

    if (draganddropInd == 'N') {
        $("#importDMFile").click();

        //var filename = 
    }
}


function openOpeartorContextMenu(selectedOperatorId) {

    var contentSplitterStyle = $("#contentSplitter").css("display");

    var contentSplitter1Style = $("#contentSplitter1").css("display");

    var $flowchart;

    if (contentSplitterStyle == "block") {
        $flowchart = $('#' + flowChartWorkSpaceId);

    } else if (contentSplitter1Style == "block") {
        $flowchart = $('#dataModellerFlowchartworkSourcesspace');

    }

    var toOpLinkArray = $flowchart.flowchart('getLinksFrom', selectedOperatorId);
    var fromOpLinkArray = $flowchart.flowchart('getLinksTo', selectedOperatorId);
    console.log("toOpLinkArray:::" + toOpLinkArray);
    console.log("fromOpLinkArray:::" + fromOpLinkArray);
    var selectedOperatorData = $flowchart.flowchart('getOperatorData', selectedOperatorId);
    var iconType = selectedOperatorData["iconType"];
    var dragType = selectedOperatorData["dragType"];

    var operatorType = selectedOperatorData["operatorType"];


    var menuItems = "";
    var menuHeight = 30;
//    if (operatorType == "predefinedSource") {// ravi predefined start
//        menuHeight = 30;
//        menuItems = "<li onclick=setConnectionToOperator(this)>Source Connection</li>";
//    } else if (operatorType == "predefinedTarget") {
//        menuHeight = 30;
//        menuItems = "<li onclick=setConnectionToOperator(this)>Target Connection</li>";
//
//    } // ravi predefined  end
//    else
    if (iconType == 'XLS'
            || iconType == 'XLSX'
            || iconType == 'CSV'
            || iconType == 'XML'
            || iconType == 'TXT'
            || iconType == 'JSON'
            ) {

        menuItems = "<li onclick=showFileNamePopup(this,'" + iconType + "')>Rename File</li>";

        menuItems += "<li onclick=addHeadersToFile()>Add Headers</li>";
        menuHeight = 56;
        var fileDataObj = {};
        fileDataObj['filePath'] = "V10ETLExport_" + selectedOperatorData['timeStamp'] + "." + iconType.toLowerCase();
        var fileName = ((selectedOperatorData['userFileName'] != null && selectedOperatorData['userFileName'] != 'undefined') ? selectedOperatorData['userFileName'] : fileDataObj['filePath']);
        for (var entitykey in HtmlEntities) {
            var entity = HtmlEntities[entitykey];
            var regex = new RegExp(entitykey, 'g');
            fileName = fileName.replace(regex, entity);
        }


        fileDataObj['fileName'] = fileName;
        fileDataObj['fileType'] = "." + iconType.toLowerCase();
        fileDataObj['targetFile'] = "Y";

        if (selectedOperatorData['trfmRules-data'] != null) {
            var t_rules = selectedOperatorData['trfmRules-data']
            var fileHeaders = t_rules['fileHeaders'];
            if (fileHeaders != null && !jQuery.isEmptyObject(fileHeaders)) {
                fileDataObj['fileHeaders'] = fileHeaders;
                menuItems += "<li onclick=viewFileData('" + JSON.stringify(fileDataObj) + "')>View File Data</li>";
                menuHeight = 84;
            }

        }
        menuItems += "<li onclick=dataProfiling()>Data Profiling</li>";
        menuHeight = 112;

    } else if (iconType == 'CUBE') {

        menuItems = "<li onclick=setCubeConnection(this,'FACT')>FACTS</li>";
        menuItems += "<li onclick=setCubeConnection(this,'DIMENSION')>DIMENSIONS</li>";
        menuItems += "<li onclick=setCubeConnection(this,'AGGREGATE')>AGGREGATES</li>";
        menuHeight = 84;
    } else if (iconType == 'SQL') {
        menuItems = "<li onclick=showSQLPopup(this)>Create Table</li>";
        if (dragType == "Table") {
            var connectionObj = selectedOperatorData['connObj'];
            menuItems += "<li onclick=viewTableData('" + connectionObj['CONNECTION_NAME'] + "','" + $.trim(selectedOperatorData.statusLebel) + "'," + JSON.stringify(connectionObj) + ")>View Data</li>";
            menuHeight = 56;
            menuItems += "<li onclick=alterTable('" + connectionObj['CONNECTION_NAME'] + "','" + $.trim(selectedOperatorData.statusLebel) + "'," + JSON.stringify(connectionObj) + ")>Alter Table</li>";
            menuHeight = 84;
            menuItems += "<li onclick=dataProfiling()>Data Profiling</li>";
            menuHeight = 112;

        }
    } else if (dragType == "Table") {
        var connectionObj = selectedOperatorData['connObj'];
        menuItems = "<li onclick=viewTableData('" + connectionObj['CONNECTION_NAME'] + "','" + $.trim(selectedOperatorData.statusLebel) + "'," + JSON.stringify(connectionObj) + ")>View Data</li>";
        menuItems += "<li onclick=alterTable('" + connectionObj['CONNECTION_NAME'] + "','" + $.trim(selectedOperatorData.statusLebel) + "'," + JSON.stringify(connectionObj) + ")>Alter Table</li>";
        menuHeight = 84;
        menuItems += "<li onclick=dataProfiling()>Data Profiling</li>";
        menuHeight = 56;


    } else if (dragType == "File") {

        var connectionObj = selectedOperatorData['connObj'];
        var fileObj = {};
        var filePath = connectionObj['filePath'];
        if (filePath != null && filePath.lastIndexOf("\\") > -1) {
            filePath = filePath.substring(filePath.lastIndexOf("\\") + 1);
        }
        fileObj['filePath'] = filePath;
        fileObj['fileType'] = connectionObj['fileType'];
        var filename = (connectionObj['fileName']);
        for (var entitykey in HtmlEntities) {
            var entity = HtmlEntities[entitykey];
            var regex = new RegExp(entitykey, 'g');
            filename = filename.replace(regex, entity);
        }
        fileObj['fileName'] = filename;


        menuItems = "<li onclick=viewFileData('" + JSON.stringify(fileObj) + "')>View File Data</li>";
        menuItems += "<li onclick=dataProfiling()>Data Profiling</li>";
        menuHeight = 56;

    }  // pre job post job 
    else if (iconType == "MAP") {
        menuItems += "<li id='PREJOB' onclick=jobExecuteType(this)>Pre Job</li>";
        menuItems += "<li id='POSTJOB' onclick=jobExecuteType(this)>Post Job</li>";
        menuItems += "<li id='REMOVEJOB' onclick=jobExecuteType(this)>Remove Job</span></li>";
        menuItems += "<li id='PARALLELJOB' onclick=jobExecuteType(this)>Parallel Job</span></li>";
        menuItems += "<li id='mapExecutionNo' onclick=setMapSeqNo(this)>Set Map No</span></li>";
        menuHeight = 130;
    } else if (iconType == "GROUP_JOB") {
        menuItems += "<li id='GROUP_JOB' onclick=popUpSavedJobs(this)>Select Job</li>";
        menuItems += "<li  onclick=showChildJob('" + selectedOperatorId + "')>Show Job</li>";
        menuItems += " <li>Process Type"
                + "  <ul>"
                + "          <li id='PREJOB' onclick=jobExecuteType(this)>Pre Job</li>"
                + "          <li id='POSTJOB' onclick=jobExecuteType(this)>Post Job</li>"
                + "          <li id='PARALLELJOB' onclick=jobExecuteType(this)>Parallel Job</li>"
                + "          <li id='REMOVEJOB' onclick=jobExecuteType(this)>Remove Job</li>"
                + " </ul>"
                + " </li>"
                + "<li id='mapExecutionNo' onclick=setMapSeqNo(this)>Set Map No</span></li>";
        menuHeight = 110;
    }
    if (menuItems != "") {
        $("#jqxMenu").remove();
        $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
        $("#jqxMenu ul").html(menuItems);
        var contextMenu = $("#jqxMenu").jqxMenu({width: '140px', height: menuHeight + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start
        var scrollTop = $(window).scrollTop();
        var scrollLeft = $(window).scrollLeft();
        //need add these line
        var operatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
        var idValue = operatorData['executeType'];
        if (idValue != null && idValue != '' && idValue != undefined) {
            $("#" + idValue).prepend("&#10004;" + " ");
        }
        //upto here
        contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
        return false;
    }

//    if (menuItems != "") {
//        $("#jqxMenu").remove();
//        $(".visionMainPage").append("<div id='jqxMenu'><ul></ul></div>");
//        $("#jqxMenu ul").html(menuItems);
//        var contextMenu = $("#jqxMenu").jqxMenu({width: '180px', height: menuHeight + 'px', autoOpenPopup: false, mode: 'popup', theme: 'energyblue'}); // ravi start
//
//        var scrollTop = $(window).scrollTop();
//        var scrollLeft = $(window).scrollLeft();
//
//        contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + scrollLeft, parseInt(event.clientY) + 5 + scrollTop);
//        return false;
//    }
}


function viewTrfmRules1() {

    var contentSplitterStyle = $("#contentSplitter").css("display");
    var contentSplitter1Style = $("#contentSplitter1").css("display");
    var $flowchart;
    var $container;
    if (contentSplitterStyle == "block") {
        $flowchart = $('#' + flowChartWorkSpaceId);
        $container = $('#feedContentArea');
    } else if (contentSplitter1Style == "block") {
        $flowchart = $('#dataModellerFlowchartworkSourcesspace');
        $container = $('#feedContentArea1');
    }
    var selectedOperatorId = $flowchart.flowchart('getSelectedOperatorId');
    try {
        selectedOperatorId = parseInt(selectedOperatorId);
    } catch (e) {
    }
    $("#currentTrnsOpId").val(selectedOperatorId);
    var selectedOperatorData = $flowchart.flowchart('getOperatorData', selectedOperatorId);
    if (selectedOperatorData != null && selectedOperatorData['iconType'] == 'SQL') {
        if (selectedOperatorData['dragType'] == null) {
            showMesg("Please select target table/Create target table by Right clicking on SQL icon.");
            return false;
        }
    }

//    var fromOpLinkArray = $('#'+flowChartWorkSpaceId).flowchart('getLinksTo', selectedOperatorId);
    try {
        if (prevTargetOperatorId != null) { // new issues changes
            prevTargetOperatorId = parseInt(prevTargetOperatorId);
        }

    } catch (e) {
    }
    if (prevTargetOperatorId != null && parseInt(selectedOperatorId) != prevTargetOperatorId) { // latest changes
        var t_rules = {};

        var previousTargetOperatorData = $flowchart.flowchart('getOperatorData', prevTargetOperatorId);

        var isEmpty = jQuery.isEmptyObject(previousTargetOperatorData);
        if (!jQuery.isEmptyObject(previousTargetOperatorData)) {

            if (previousTargetOperatorData['trfmRules-data'] != null) {
                t_rules = previousTargetOperatorData['trfmRules-data'];
            }

            var componentOperator = {};
            var fromOpLinkArray = $flowchart.flowchart('getAllFromOperatorsByToOpId', prevTargetOperatorId);
            if (fromOpLinkArray != null) {
                if (fromOpLinkArray != null && fromOpLinkArray.length != 0) {
                    for (var i = 0; i < fromOpLinkArray.length; i++) {
                        var operatorData = fromOpLinkArray[i];
                        if (operatorData != null
                                && operatorData['iconType'] != null
                                && operatorData['iconType'] != '') {
                            componentOperator = operatorData;
                            break;
                        }

                    }
                }

            }


            if (componentOperator['iconType'] == "MAP") {
                var destinationColumnEmpty = false;

                var colMappingsData = []

                var rowCount = $('#sourceDestColsTableId tbody tr').length;
                var columnCount = $('#sourceDestColsTableId th').length;
                t_rules['primaryKey'] = "";

                for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                    var rowData = {};
                    var tr = $('#sourceDestColsTableId tbody tr')[rowIndex];
                    var destinationColumnStyle = $(tr.children[2]).attr("style");

                    var destinationColumnVal = $(tr.children[2]).find('input').val();

                    if (destinationColumnStyle == "display:none;" || destinationColumnStyle == "display:none") {
                        destinationColumnVal = "N/A:N/A";
                    }
                    if (destinationColumnVal == null || destinationColumnVal == "") {
                        destinationColumnEmpty = true;
                    }


                    if (destinationColumnEmpty) {
                        showMesg("Destination Column Cannot be empty");
                        throw new Error();
                    }

                    //        if (destinationColumnVal != null &&
                    //                destinationColumnVal != "" &&
                    //                destinationColumnVal != "undefined"
                    //                && destinationColumnVal.indexOf(":")==-1){
                    //            destinationColumnVal = "N/A:"+destinationColumnVal; // ravi process job issues 
                    //        }

                    var dataFunobjStr = $(tr.children[5]).find('input').attr("data-funobjstr");
                    //funobjstr
                    var funObj = {};
                    if (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') {
                        funObj['funobjstr'] = dataFunobjStr;
                    }
                    rowData['primaryKey'] = $(tr.children[1]).find('input').prop('checked') ? "Y" : "N";
                    rowData['destinationColumn'] = destinationColumnVal;
                    rowData['sourceColumn'] = $(tr.children[3]).find('input').val();
                    rowData['defaultValue'] = $(tr.children[4]).find('input').val();
                    rowData['appendValue'] = $(tr.children[5]).find('input').val();
                    rowData['columnClause'] = (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') ? funObj : $(tr.children[6]).find('input').val();
                    rowData['data-funobjstr'] = $(tr.children[6]).find('input').attr("data-funobjstr"); // ravi change new
                    rowData['data-columnClause'] = $(tr.children[6]).find('input').val(); // ravi change new
                    colMappingsData[rowIndex] = rowData;


                    if (rowData['primaryKey'] == 'Y') {
                        t_rules['primaryKey'] = "Y";
                    }
                }

                t_rules['colMappingsData'] = colMappingsData;

                // ---------------------------------

                var masterTable = "";
                var childTables = [];
                var fromTables = [];

                var rowCount = $('#EtlMappingTable thead tr').length;
                for (var rowIndex = 1; rowIndex < rowCount; rowIndex++) {
                    var rowData = {};
                    var tr = $('#EtlMappingTable thead tr')[rowIndex];
                    fromTables.push($(tr.children[0]).find('select').val());
                    if (rowIndex == 1) {
                        masterTable = $(tr.children[0]).find('select').val();
                    } else {
                        childTables.push($(tr.children[0]).find('select').val());
                    }
                }

                if (masterTable == "") {

                    var mapingObj = $flowchart.flowchart('getMapOperatorData', prevTargetOperatorId);
                    if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
                        var fromOpArray = mapingObj['fromOpArray'];
                    }
                    if (fromOpArray != null && fromOpArray.length != 0) {
                        masterTable = fromOpArray[0]['tableName'];
                    }
                    //            try{
                    //               masterTable = $($(".visionOpIcons")[0]).parent().next().text().trim();
                    //            }catch(e){}
                }

                t_rules['masterTableName'] = masterTable;
                t_rules['masterTableName'] = masterTable;
                t_rules['childTables'] = childTables;
                t_rules['fromTables'] = fromTables;
                //------------------------------------

                var joinClauseData = []
                var mapIcons = $("#EtlMappingTable").find(".visionEtlJoinClauseMapIcon");

                $.each(mapIcons, function (index) {
                    var mappedColumnData = $(this).attr('data-mappedcolumns');
                    if (mappedColumnData != null
                            && mappedColumnData != ''
                            && mappedColumnData != 'null'
                            && mappedColumnData != '{}') {
//                        if (mappedColumnData == "") {
//                            mappedColumnData = "{}";
//                        }
                        joinClauseData[index] = mappedColumnData;
                    }
                });
                if (joinClauseData.length > 0) {
                    t_rules['joinClauseData'] = joinClauseData;
                    var fromTablesList = $(".sourceJoinColsTd").find("select");
                    if (fromTablesList.length > 0) {
                        var reOrderFromTables = [];
                        $.each(fromTablesList, function (i) {
                            reOrderFromTables.push(this.value);
                        })
                        t_rules['fromTables'] = reOrderFromTables;
                    }
                }

                //------------------------------------
                var whereClauseData = []
                var mapIcons = $("#selectedTables").find(".visionEtlWhereClauseMapIcon");
                $.each(mapIcons, function (index) {
                    var mappedColumnData = $(this).attr('data-whereclause');
                    if (mappedColumnData != null) {
                        if (mappedColumnData == "") {
                            mappedColumnData = "{}";
                        }
                        whereClauseData[index] = mappedColumnData;
                    }

                });
                if (whereClauseData.length > 0) {
                    t_rules['whereClauseData'] = whereClauseData;
                }
                //---------------------------------------------------- advanced settings  
                var selectTabObj = {};
                var uniqueRowsFlag = "N";
                if ($("#distinctRowsInput").is(":checked")) {
                    uniqueRowsFlag = "Y";
                }
                selectTabObj['uniqueRowsFlag'] = uniqueRowsFlag;

                var showRejectedRecords = "N";
                if ($("#showRejectedRecords").is(":checked")) {
                    showRejectedRecords = "Y";
                }
                selectTabObj['showRejectedRecords'] = showRejectedRecords;

                var minRows = $("#rowsCountFromInput").val();
                var maxRows = $("#rowsCountToInput").val();
                if (!(minRows != null && minRows != '') && (maxRows != null && maxRows != '')) {
                    minRows = 0;
                }
                selectTabObj['minRows'] = minRows;
                selectTabObj['maxRows'] = maxRows;

                var operatorType = $("#operatorType").val();
                selectTabObj['operatorType'] = operatorType;

                var scdType = $('input[name="scdType"]:checked').val();
                if (scdType != null) {
                    selectTabObj['scdType'] = scdType;
                }


                t_rules['selectTabObj'] = selectTabObj;

                //------------------------------------

                var orderByData = []

                var rowCount = $('#fromTablesOrderCauseTable tbody tr').length;
                for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                    var rowData = {};
                    var tr = $('#fromTablesOrderCauseTable tbody tr')[rowIndex];
                    rowData['columnName'] = $(tr.children[1]).find('input').val();
                    rowData['order'] = $(tr.children[2]).find('select').val();
                    orderByData[rowIndex] = rowData;
                }
                t_rules['orderByData'] = orderByData;
                //------------------------------------

                var groupByData = []

                var rowCount = $('#fromTablesGroupCauseTable tbody tr').length;
                for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                    var rowData = {};
                    var tr = $('#fromTablesGroupCauseTable tbody tr')[rowIndex];
                    rowData['columnName'] = $(tr.children[1]).find('input').val();
                    groupByData[rowIndex] = rowData;
                }
                t_rules['groupByData'] = groupByData;

            } else if (componentOperator['iconType'] == "UNGROUP") {

                var normalizeOptionsObj = {};
                normalizeOptionsObj['normalizeFlag'] = "normalize";
                normalizeOptionsObj['itemSeparator'] = $("#itemSeparator").val();
                normalizeOptionsObj['normalizeColumn'] = $("#selectNormalizeColHeader").val();
                t_rules['normalizeOptionsObj'] = normalizeOptionsObj;
                var colMappingsData = [];
                var fromColsArray = $("#selectNormalizeColHeader").find("option");
                if (fromColsArray != null && fromColsArray.length > 0) {
                    $.each(fromColsArray, function (rowIndex) {
                        if (rowIndex != 0) {
                            var rowData = {};
                            var destFileHeaders = t_rules['fileHeaders'];
                            if (destFileHeaders != null) {
                                var destinationColumn = destFileHeaders[rowIndex];
                            }
                            rowData['sourceColumn'] = this.value;
                            rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                            colMappingsData[rowIndex - 1] = rowData;
                        }

                    })

                    t_rules['colMappingsData'] = colMappingsData;
                }
            } else if (componentOperator['iconType'] == "GROUP") {

                var deNormalizeOptionsObj = {};
                deNormalizeOptionsObj['normalizeFlag'] = "deNormalize";
                deNormalizeOptionsObj['delimiter'] = $("#delimiter").val();
                deNormalizeOptionsObj['deNormalizeColumn'] = $("#selectDenormalizeColHeader").val();
                deNormalizeOptionsObj['keyColumn'] = $("#selectDenormalizeKeyColumn").val(); // ravi updated code

                t_rules['normalizeOptionsObj'] = deNormalizeOptionsObj;
                var colMappingsData = [];
                var fromColsArray = $("#selectDenormalizeColHeader").find("option");
                if (fromColsArray != null && fromColsArray.length > 0) {
                    $.each(fromColsArray, function (rowIndex) {
                        if (rowIndex != 0) {
                            var rowData = {};
                            var destFileHeaders = t_rules['fileHeaders'];
                            if (destFileHeaders != null) {
                                var destinationColumn = destFileHeaders[rowIndex];
                            }
                            rowData['sourceColumn'] = this.value;
                            rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                            colMappingsData[rowIndex - 1] = rowData;
                        }

                    })

                    t_rules['colMappingsData'] = colMappingsData;
                }
            }



            previousTargetOperatorData['trfmRules-data'] = t_rules;
            previousTargetOperatorData['targetOperator'] = "Y";
            $flowchart.flowchart('setOperatorData', prevTargetOperatorId, previousTargetOperatorData);
            var previousTargetOperatorData2 = $flowchart.flowchart('getOperatorData', prevTargetOperatorId);
            $(".flowchart-operator-connector-label").hide();
            $(".flowchart-operator-title").hide();
        }
    }
    var fromOpLinkArray = $flowchart.flowchart('getLinksTo', selectedOperatorId);
    if (fromOpLinkArray.length != 0) {
        var mapOperatorId = fromOpLinkArray[0]['operatorId'];// latest changes
        if (mapOperatorId == null) {
            mapOperatorId = fromOpLinkArray[0]['fromOperator'];// latest changes
        }

        var mapOperatorData = $flowchart.flowchart('getOperatorData', mapOperatorId);
        if (mapOperatorData['iconType'] == "GROUP") {
            deNormalizeData(mapOperatorId);
            return false;
        } else if (mapOperatorData['iconType'] == "UNGROUP") {
            normalizeData(mapOperatorId);
            return false;
        }

        prevTargetOperatorId = selectedOperatorId;

        var fromOpLinkArrayToMap = $flowchart.flowchart('getLinksTo', mapOperatorId);
        var fromTableName = "";
        var fromConnectionObj = {};
        var fromOpArray = [];
        var toOpArray = [];
        $.each(fromOpLinkArrayToMap, function (index) {
            var fromOperator = $flowchart.flowchart('getOperatorData', this.fromOperator);
            fromOpArray.push(fromOperator);
            fromTableName += fromOperator['tableName'];
            fromConnectionObj = fromOperator["connObj"];
            if (index != fromOpLinkArrayToMap.length - 1) {
                fromTableName += ",";
            }
        });


        var trfmRulesId = selectedOperatorData['trfmRulesId'];
        var trfmRulesData = selectedOperatorData['trfmRules-data'];

        var toTableName = selectedOperatorData['tableName'];
        var toIconType = selectedOperatorData['iconType'];
        var toConnectionObj = selectedOperatorData['connObj'];
        toOpArray.push(selectedOperatorData);

        // ravi end
        if ((fromConnectionObj != null && !jQuery.isEmptyObject(fromConnectionObj))) {
            showLoader();
            if (!(toConnectionObj != null && !jQuery.isEmptyObject(toConnectionObj))) {
                toConnectionObj = {};
            }
            $.ajax({
                type: 'post',
                traditional: true,
                dataType: 'html',
                cache: false,
                url: 'fetchTransformationRules',
                async: true,
                data: {
                    fromTable: fromTableName,
                    toTable: toTableName,
                    fromConnObj: JSON.stringify(fromConnectionObj),
                    toConnObj: JSON.stringify(toConnectionObj),
                    sourceTables: JSON.stringify(fromTableName.split(",")),
                    toIconType: toIconType,
                    createTableObj: null,
                    trfmRulesId: trfmRulesId,
                    trfmRulesData: JSON.stringify(trfmRulesData),
                    trfmRulesChanged: (trfmRulesChanged == true) ? "Y" : "N",
                    toOpArray: JSON.stringify(toOpArray),
                    fromOpArray: JSON.stringify(fromOpArray),
                },
                success: function (response) {
                    stopLoader();
                    if (response != null) {
                        $('.visionTablesComboBox').hide();
                        $('.visionUploadFileDiv').hide();
                        $('.visionConnectToDbDiv').hide();
                        $('#visionERPMain').hide();
                        var response = JSON.parse(response);
                        if (response != null && response.connectionFlag == 'Y') {
                            $container.html(response['tabsString']);
                            $("#dataMigrationTabs").jqxTabs({width: "100%", height: "130px", position: 'top', theme: 'ui-redmond', reorder: true});

                            $('#dataMigrationTabs').unbind('selected').on('selected', function (event) {
                                $('#iconsdiv').attr('style', 'margin-top:4px !important');
                                // scroll bar issue fixed by SHI
                                var feedContentAreaHeight = $container.height();
//                    $("#dataMigrationTabs").jqxTabs({height:feedContentAreaHeight})
                                var tbodyHeight = feedContentAreaHeight - 90;
                                $(".visionColMappScrollDiv1").css("max-height", tbodyHeight);
                                $(".visionEtlJoinClauseTablesDiv").css("max-height", tbodyHeight);
//                                $(".visionEtlMappingTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                                $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                                $(".visionSqlViewQuery1").css("max-height", parseInt(feedContentAreaHeight) - 67);
                                $(".visionEtlJoinrClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                                $(".visionEtlwhereClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 69);
                                var joinTablesHeight = $(".visionEtlJoinrClauseTablesDiv").height();
                                $(".viewJoinQueryOuterDivClass").css("max-height", parseInt(feedContentAreaHeight) - (parseInt(joinTablesHeight) + 82));
                                // scroll bar issue fixed by SHI
                                //end code
                            });
//                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                            var columnStr = response['columnMapping'];
                            $("#toConnObjPK").val(JSON.stringify(response['toTablePKColumnList']));  //PKH PKIcon
                            var selectedJoinTables = response['selectedJoinTables'];
                            $('#tabs-1').html(columnStr);
                            $('#tabs-1').append("<div id='selectedColumnStr' style='display:none'></div>");



                            $("#toTableColsArray_hidden").remove();
                            $("#fromTableColsArray_hidden").remove();
                            var hiddenData = "<input type='hidden' id='toTableColsArray_hidden'/><input type='hidden' id='fromTableColsArray_hidden'/>";
                            $('#tabs-1').append(hiddenData);
                            $("#toTableColsArray_hidden").val(JSON.stringify(response['toTableColsArray']));
                            $("#fromTableColsArray_hidden").val(JSON.stringify(response['fromTableColsArray']));

                            $("#sourceTablesArray").remove();
                            $("#destinationTablesArray").remove();
                            var hiddenData = "<input type='hidden' id='sourceTablesArray'/><input type='hidden' id='destinationTablesArray'/>";
                            $('#tabs-1').append(hiddenData);
                            $("#sourceTablesArray").val(JSON.stringify(response['sourceTablesArray']));
                            $("#destinationTablesArray").val(JSON.stringify(response['destinationTablesArray']));


                            $('#tabs-2').html(selectedJoinTables);
                            $('#mapColumns').addClass("active");
                            $('.visionProgressFilesSteps').hide();
                            $("#selectedColumnStr").html(response['colMapTrString']);//colMapTrString
                            var selectedTableWhereClause = response['selectedTableWhereClause'];
                            if (selectedTableWhereClause != null) {
                                var hiddenDataWhere = "<input type='hidden' id='whereClauseTableColsArray_hidden'/><input type='hidden' id='currentClauseMapId'/>"
                                        + "<div id='wherClauseTrString' style='display:none;'></div><div id='wherClauseColsString' style='display:none;'></div>";
                                $('#tabs-3').html(selectedTableWhereClause['whereClauseCondition'] + hiddenDataWhere);//whereClauseCondition
                                $("#whereClauseTableColsArray_hidden").val(JSON.stringify(selectedTableWhereClause['fromTableColsArray']));
                            }
                            var selectedTableOrderGroupClause = response['selectedTableOrderGroupClause'];
                            if (selectedTableOrderGroupClause != null) {
                                var hiddenDataOrderBy = ""
                                        + "<div id='orderClauseTrString' style='display:none;'></div>";
                                $('#tabs-4').html(selectedTableOrderGroupClause['orderByCondition'] + hiddenDataOrderBy);//
                                var hiddenDataGroupBy = ""
                                        + "<div id='groupClauseTrString' style='display:none;'></div>";
                                $('#tabs-5').html(selectedTableOrderGroupClause['groupByCondition'] + hiddenDataGroupBy);//
                                $("#groupClauseTrString").html(selectedTableOrderGroupClause['groupByTrString']);
                                $("#orderClauseTrString").html(selectedTableOrderGroupClause['orderByTrString']);
                            }
                            // sql Editor
//                        var sqlEditor = ace.edit("tabs-6");
//                        sqlEditor.setOptions({
//                            enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
//                            showPrintMargin: false, // hides the vertical limiting strip
//                            fontSize: "100%" // ensures that the editor fits in the environment
//                        });
//
//                        sqlEditor.getSession().setMode("ace/mode/sql");
// scroll bar issue fixed by SHI
                            var feedContentAreaHeight = $container.height();
                            if ($('#dataMigrationTabs').length) {
                                $("#dataMigrationTabs").jqxTabs({height: feedContentAreaHeight});
                            }
//                            $("#dataMigrationTabs").jqxTabs({height: feedContentAreaHeight})
                            var tbodyHeight = feedContentAreaHeight - 90;
                            $(".visionColMappScrollDiv1").css("max-height", tbodyHeight);
                            $(".visionEtlJoinClauseTablesDiv").css("max-height", tbodyHeight);
//                            $(".visionEtlMappingTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                            $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                            $(".visionSqlViewQuery1").css("max-height", parseInt(feedContentAreaHeight) - 67);
                            $(".visionEtlJoinrClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                            $(".visionEtlwhereClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 69);
                            var joinTablesHeight = $(".visionEtlJoinrClauseTablesDiv").height();
                            $(".viewJoinQueryOuterDivClass").css("max-height", parseInt(feedContentAreaHeight) - (parseInt(joinTablesHeight) + 82));
                            // scroll bar issue fixed by SHI
                            $("#dataMigrationTabs").change(function (event) {
                                trfmRulesChanged = true;
                            });
                            if (response['uniqueRowsFlag'] == "Y") {
                                $("#distinctRowsInput").prop("checked", true);
                            }

                            if (response['showRejectedRecords'] == "Y") {
                                $("#showRejectedRecords").prop("checked", true);
                            }

                            $("#rowsCountFromInput").val(response['minRows']);
                            $("#rowsCountToInput").val(response['maxRows']);

                            if (response['operatorType'] != null && response['operatorType'] != '') {
                                $("#operatorType").val(response['operatorType']);
                            }

//                        //importColMapFile
//                        var fileslist = [];
//                        $("#importColMapFile").on('change', function (event) {
//                            console.log("iam in files change ");
//                           fileslist  = event.target.files;
//                            srsFileNames(fileslist);
//
//                        });

                            $(".visionETLColMapImage").mousedown(function (event) {
                                treeIconClickEvent = event;
                            });
                            try {
                                $("#sourceDestColsTableId").colResizable({
                                    disable: true
                                });

                                $("#sourceDestColsTableId").tableDnD({
                                    onDragStyle: null,
                                    onDropStyle: null,
                                    onDragClass: "tDnD_whileDrag",
                                });
                            } catch (e) {
                            }
                            $("#sourceDestColsTableId").colResizable();

                            $('#dataMigrationTabs').on('selected', function (event) {
                                var selectedTab = event.args.item;
                                if (selectedTab == '0' || selectedTab == 0) {// mapping
                                    try {
                                        $("#sourceDestColsTableId").colResizable({
                                            disable: true
                                        });
                                        $("#sourceDestColsTableId").tableDnD({
                                            onDragStyle: null,
                                            onDropStyle: null,
                                            onDragClass: "tDnD_whileDrag",
                                        });

                                    } catch (e) {
                                    }
                                    $("#sourceDestColsTableId").colResizable();
                                } else if (selectedTab == '1' || selectedTab == 1) {// join
                                    try {
                                        $("#EtlMappingTable").colResizable({
                                            disable: true
                                        });
                                    } catch (e) {
                                    }
                                    $("#EtlMappingTable").colResizable();
                                } else if (selectedTab == '2' || selectedTab == 2) {//where clause
                                    try {
                                        $("#selectedTables").colResizable({
                                            disable: true
                                        });
                                    } catch (e) {
                                    }
                                    $("#selectedTables").colResizable();
                                } else if (selectedTab == '3' || selectedTab == 3) {//order clause
                                    try {
                                        $("#fromTablesOrderCauseTable").colResizable({
                                            disable: true
                                        });
                                    } catch (e) {
                                    }
                                    $("#fromTablesOrderCauseTable").colResizable();
                                } else if (selectedTab == '4' || selectedTab == 4) {//group clause
                                    try {
                                        $("#fromTablesGroupCauseTable").colResizable({
                                            disable: true
                                        });
                                    } catch (e) {
                                    }
                                    $("#fromTablesGroupCauseTable").colResizable();
                                }
                            });


                            // ravi scd code start

                            $('input[name="scdType"]').change(function (event) {
                                var selectedSCDType = $('input[name="scdType"]:checked').val();
                                if (selectedSCDType != null && selectedSCDType != 'typeNone') {
                                    $("#operatorType").attr('disabled', true);
                                } else {
                                    $("#operatorType").attr('disabled', false);
                                }
                            });

                            // ravi scd code end

                        } else {
                            stopLoader();
                            showMessagePopup(response.connectionMessage);
                        }


                    }
                },
                error: function (e)
                {
                    stopLoader();
                    sessionTimeout(e);
                }

            });
        } else {
            showMesg("Please map from table.");
            stopLoader();
        }
    }
}


function getAllMappedData1(processFlag) {
    var data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var operators = data['operators'];
    var groupJob = false;
    if (operators != null && !jQuery.isEmptyObject(operators)) {

        for (var key of Object.keys(operators)) {
            var operator = operators[key];
            if (operator['iconType'] == 'GROUP_JOB') {
                groupJob = true;
            }
            break;

        }
        if (groupJob) {
            var jobName = $("#currentGroupJobName").val();
            if (jobName == null || jobName == 'undefined' || jobName == '') {
                setGroupJobName();
            } else if (jobName != null && jobName != '' && processFlag == 'Y') {
                processJob();
            } else if (processFlag == undefined) {
                updateGroupJob();
            }
            return false;
        }

    }

    var contentSplitterStyle = $("#contentSplitter").css("display");
    var contentSplitter1Style = $("#contentSplitter1").css("display");
    var flowChartId;
    var containerId;
    if (contentSplitterStyle == "block") {
        flowChartId = 'flowchartworkSourcesspace';
        containerId = 'feedHeader';
    } else if (contentSplitter1Style == "block") {
        flowChartId = 'dataModellerFlowchartworkSourcesspace';
        containerId = 'feedHeader1';
    }

    var currentTrnsOpId = $("#currentTrnsOpId").val();
    var t_rules = {};
    try {
        currentTrnsOpId = parseInt(currentTrnsOpId);
    } catch (e) {
    }
    var previousTargetOperatorData = $('#' + flowChartId).flowchart('getOperatorData', currentTrnsOpId);

    if (!jQuery.isEmptyObject(previousTargetOperatorData)) {

        if (previousTargetOperatorData['trfmRules-data'] != null) {
            t_rules = previousTargetOperatorData['trfmRules-data'];
        }

        var componentOperator = {};
        var fromOpLinkArray = $('#' + flowChartId).flowchart('getAllFromOperatorsByToOpId', currentTrnsOpId);
        if (fromOpLinkArray != null) {
            if (fromOpLinkArray != null && fromOpLinkArray.length != 0) {
                for (var i = 0; i < fromOpLinkArray.length; i++) {
                    var operatorData = fromOpLinkArray[i];
                    if (operatorData != null
                            && operatorData['iconType'] != null
                            && operatorData['iconType'] != '') {
                        componentOperator = operatorData;
                        break;
                    }

                }
            }

        }


        if (componentOperator['iconType'] == "MAP") {
            var destinationColumnEmpty = false;

            var colMappingsData = []

            var rowCount = $('#sourceDestColsTableId tbody tr').length;
            var columnCount = $('#sourceDestColsTableId th').length;
            t_rules['primaryKey'] = "";
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#sourceDestColsTableId tbody tr')[rowIndex];
                var destinationColumnStyle = $(tr.children[2]).attr("style");

                var destinationColumnVal = $(tr.children[2]).find('input').val();

                if (destinationColumnStyle == "display:none;" || destinationColumnStyle == "display:none") {
                    destinationColumnVal = "N/A:N/A";
                }
                if (destinationColumnVal == null || destinationColumnVal == "") {
                    destinationColumnEmpty = true;
                }


                if (destinationColumnEmpty) {
                    showMesg("Destination Column Cannot be empty");
                    throw new Error();
                }

                //        if (destinationColumnVal != null &&
                //                destinationColumnVal != "" &&
                //                destinationColumnVal != "undefined"
                //                && destinationColumnVal.indexOf(":")==-1){
                //            destinationColumnVal = "N/A:"+destinationColumnVal; // ravi process job issues 
                //        }

                var dataFunobjStr = $(tr.children[5]).find('input').attr("data-funobjstr");
                //funobjstr
                var funObj = {};
                if (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') {
                    funObj['funobjstr'] = dataFunobjStr;
                }

                rowData['primaryKey'] = $(tr.children[1]).find('input').prop('checked') ? "Y" : "N";
                rowData['destinationColumn'] = destinationColumnVal;
                rowData['sourceColumn'] = $(tr.children[3]).find('input').val();
                rowData['defaultValue'] = $(tr.children[4]).find('input').val();
                rowData['appendValue'] = $(tr.children[5]).find('input').val();
                rowData['columnClause'] = (dataFunobjStr != null && dataFunobjStr != '' && dataFunobjStr != 'null') ? funObj : $(tr.children[6]).find('input').val();
                rowData['data-funobjstr'] = $(tr.children[6]).find('input').attr("data-funobjstr"); // ravi change new
                rowData['data-columnClause'] = $(tr.children[6]).find('input').val(); // ravi change new
                colMappingsData[rowIndex] = rowData;
                if (rowData['primaryKey'] == 'Y') {
                    t_rules['primaryKey'] = "Y";
                }
            }

            t_rules['colMappingsData'] = colMappingsData;

            // ---------------------------------

            var masterTable = "";
            var childTables = [];
            var fromTables = [];

            var rowCount = $('#EtlMappingTable thead tr').length;
            for (var rowIndex = 1; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#EtlMappingTable thead tr')[rowIndex];
                fromTables.push($(tr.children[0]).find('select').val());
                if (rowIndex == 1) {
                    masterTable = $(tr.children[0]).find('select').val();
                } else {
                    childTables.push($(tr.children[0]).find('select').val());
                }
            }

            if (masterTable == "") {

                var mapingObj = $('#' + flowChartId).flowchart('getMapOperatorData', currentTrnsOpId);
                if (mapingObj != null && !jQuery.isEmptyObject(mapingObj)) {
                    var fromOpArray = mapingObj['fromOpArray'];
                }
                if (fromOpArray != null && fromOpArray.length != 0) {
                    masterTable = fromOpArray[0]['tableName'];
                }
                //            try{
                //               masterTable = $($(".visionOpIcons")[0]).parent().next().text().trim();
                //            }catch(e){}
            }

            t_rules['masterTableName'] = masterTable;
            t_rules['masterTableName'] = masterTable;
            t_rules['childTables'] = childTables;
            t_rules['fromTables'] = fromTables;
            //------------------------------------

            var joinClauseData = []
            var mapIcons = $("#EtlMappingTable").find(".visionEtlJoinClauseMapIcon");

            $.each(mapIcons, function (index) {
                var mappedColumnData = $(this).attr('data-mappedcolumns');
                if (mappedColumnData != null
                        && mappedColumnData != ''
                        && mappedColumnData != 'null'
                        && mappedColumnData != '{}') {
//                    if (mappedColumnData == "") {
//                        mappedColumnData = "{}";
//                    }
                    joinClauseData[index] = mappedColumnData;
                }
            });
            if (joinClauseData.length > 0) {
                t_rules['joinClauseData'] = joinClauseData;
                var fromTablesList = $(".sourceJoinColsTd").find("select");
                if (fromTablesList.length > 0) {
                    var reOrderFromTables = [];
                    $.each(fromTablesList, function (i) {
                        reOrderFromTables.push(this.value);
                    })
                    t_rules['fromTables'] = reOrderFromTables;
                }
            }

            //------------------------------------
            var whereClauseData = []
            var mapIcons = $("#selectedTables").find(".visionEtlWhereClauseMapIcon");
            $.each(mapIcons, function (index) {
                var mappedColumnData = $(this).attr('data-whereclause');
                if (mappedColumnData != null) {
                    if (mappedColumnData == "") {
                        mappedColumnData = "{}";
                    }
                    whereClauseData[index] = mappedColumnData;
                }

            });
            if (whereClauseData.length > 0) {
                t_rules['whereClauseData'] = whereClauseData;
            }
            //---------------------------------------------------- advanced settings  
            var selectTabObj = {};
            var uniqueRowsFlag = "N";
            if ($("#distinctRowsInput").is(":checked")) {
                uniqueRowsFlag = "Y";
            }
            selectTabObj['uniqueRowsFlag'] = uniqueRowsFlag;


            var showRejectedRecords = "N";
            if ($("#showRejectedRecords").is(":checked")) {
                showRejectedRecords = "Y";
            }
            selectTabObj['showRejectedRecords'] = showRejectedRecords;

            var minRows = $("#rowsCountFromInput").val();
            var maxRows = $("#rowsCountToInput").val();
            if (!(minRows != null && minRows != '') && (maxRows != null && maxRows != '')) {
                minRows = 0;
            }
            selectTabObj['minRows'] = minRows;
            selectTabObj['maxRows'] = maxRows;

            var operatorType = $("#operatorType").val();
            selectTabObj['operatorType'] = operatorType;

            var scdType = $('input[name="scdType"]:checked').val();
            if (scdType != null) {
                selectTabObj['scdType'] = scdType;
            }

            t_rules['selectTabObj'] = selectTabObj;

            //------------------------------------

            var orderByData = []

            var rowCount = $('#fromTablesOrderCauseTable tbody tr').length;
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#fromTablesOrderCauseTable tbody tr')[rowIndex];
                rowData['columnName'] = $(tr.children[1]).find('input').val();
                rowData['order'] = $(tr.children[2]).find('select').val();
                orderByData[rowIndex] = rowData;
            }
            t_rules['orderByData'] = orderByData;
            //------------------------------------

            var groupByData = []

            var rowCount = $('#fromTablesGroupCauseTable tbody tr').length;
            for (var rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                var rowData = {};
                var tr = $('#fromTablesGroupCauseTable tbody tr')[rowIndex];
                rowData['columnName'] = $(tr.children[1]).find('input').val();
                groupByData[rowIndex] = rowData;
            }
            t_rules['groupByData'] = groupByData;

        } else if (componentOperator['iconType'] == "UNGROUP") {

            var normalizeOptionsObj = {};
            normalizeOptionsObj['normalizeFlag'] = "normalize";
            normalizeOptionsObj['itemSeparator'] = $("#itemSeparator").val();
            normalizeOptionsObj['normalizeColumn'] = $("#selectNormalizeColHeader").val();
            t_rules['normalizeOptionsObj'] = normalizeOptionsObj;
            var colMappingsData = [];
            var fromColsArray = $("#selectNormalizeColHeader").find("option");
            if (fromColsArray != null && fromColsArray.length > 0) {
                $.each(fromColsArray, function (rowIndex) {
                    if (rowIndex != 0) {
                        var rowData = {};
                        var destFileHeaders = t_rules['fileHeaders'];
                        if (destFileHeaders != null) {
                            var destinationColumn = destFileHeaders[rowIndex];
                        }
                        rowData['sourceColumn'] = this.value;
                        rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                        colMappingsData[rowIndex - 1] = rowData;
                    }

                })

                t_rules['colMappingsData'] = colMappingsData;
            }
        } else if (componentOperator['iconType'] == "GROUP") {

            var deNormalizeOptionsObj = {};
            deNormalizeOptionsObj['normalizeFlag'] = "deNormalize";
            deNormalizeOptionsObj['delimiter'] = $("#delimiter").val();
            deNormalizeOptionsObj['deNormalizeColumn'] = $("#selectDenormalizeColHeader").val();
            t_rules['normalizeOptionsObj'] = deNormalizeOptionsObj;
            var colMappingsData = [];
            var fromColsArray = $("#selectDenormalizeColHeader").find("option");
            if (fromColsArray != null && fromColsArray.length > 0) {
                $.each(fromColsArray, function (rowIndex) {
                    if (rowIndex != 0) {
                        var rowData = {};
                        var destFileHeaders = t_rules['fileHeaders'];
                        if (destFileHeaders != null) {
                            var destinationColumn = destFileHeaders[rowIndex];
                        }
                        rowData['sourceColumn'] = this.value;
                        rowData['destinationColumn'] = (destinationColumn != null) ? destinationColumn : this.value;
                        colMappingsData[rowIndex - 1] = rowData;
                    }

                })

                t_rules['colMappingsData'] = colMappingsData;
            }
        }



        previousTargetOperatorData['trfmRules-data'] = t_rules;
        previousTargetOperatorData['targetOperator'] = "Y";
        $('#' + flowChartId).flowchart('setOperatorData', currentTrnsOpId, previousTargetOperatorData);
        var previousTargetOperatorData2 = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', currentTrnsOpId);
        $(".flowchart-operator-connector-label").hide();
        $(".flowchart-operator-title").hide();
    }
    var processJobData = {}

    var data = {};
    try {
        data = $('#' + flowChartId).flowchart('getData');
    } catch (e) {
    }




    if (data != null && !jQuery.isEmptyObject(data)) {
        var operators = data['operators'];
        var links = data['links'];
        if (operators != null && !jQuery.isEmptyObject(operators)
                && links != null && !jQuery.isEmptyObject(links)) {

            var selectedMapOperatorData = $('#' + flowChartId).flowchart('getOperatorData', currentTrnsOpId);
            var jobId = selectedMapOperatorData['jobId'];
            var jobName = selectedMapOperatorData['jobName'];


            // ravi save job without trfm rules start
            var targetOperatorExist = false;
            $.each(data['operators'], function (index) {
                var body = this['properties']['body'];
                var ele = document.createElement('div');
                ele.innerHTML = body;
                $(ele).find(".visionCountLabelsDiv").remove();
                this['properties']['body'] = $(ele).html();
                $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);

                var iconType = this['iconType'];
                if (iconType == "MAP" || iconType == "GROUP" || iconType == "UNGROUP" || iconType == "SPLITROW") {
                    var mapOperatorId = this.operatorId;
                    $.each(data['links'], function () {
                        if (this.fromOperator == mapOperatorId) {
                            var toOperatorData = $('#' + flowChartId).flowchart('getOperatorData', this.toOperator);
                            toOperatorData['targetOperator'] = "Y";
                            $('#' + flowChartId).flowchart('setOperatorData', this.toOperator, toOperatorData);
                            if (jobId == null) {
                                jobId = toOperatorData['jobId'];
                                jobName = toOperatorData['jobName'];
                            }
                            targetOperatorExist = true;
                        }
                    })

                }
            })
            if (!targetOperatorExist) {
                showMesg("Cannot save without a target");
                return false;
            }



            if (jobId == null) { // ravi save new job
                var currentJobId = $("#currentJobId").val();

                var selectedJobId = $(".selectJqxTreeItem :first-child").attr("id");
                if (currentJobId != null && currentJobId != "" && currentJobId != 'undefined') {
//                if (currentJobId == selectedJobId) {
                    jobId = currentJobId;
                    jobName = $("#currentJobName").val();
                }

            }

            $("#currentJobId").val(jobId);
            if (jobId != null && jobId != "") {
                var folderName = $("#folderNameHidden").val();
                var folderId = $("#folderIdHidden").val();
                saveJob(jobName, jobId, data, folderName, folderId, processFlag);
                return false;
            }
            // ravi end


            var response = "<div id='textReason'> <table> <td><input id='selectFolderName' style='width: 250px;' class='visionDSMappingInput' type='text' value='Saved Jobs' folderId='C8DE75F32D56288CE0554B610B40A4A3'  readonly='true'><img src='images/tree_icon.svg' class='visionETLColMapImage'  onclick='selectFolder(this)' style=''> </td></table>";
            //UK folder
            response += "<textarea id='reasonId' class='visionDeleteReason'></textarea><br>\n\
                        </div>";
            response += "<div id='dailog_error_id' style='display:none;color:red'>" + (labelObject['Please give any Job Name'] != null ? labelObject['Please give new Job Name'] : 'Please give new Job Name') + "</div>";

            $("#dialog").html(response);
            $("#dialog").dialog({
                title: (labelObject['Job Name'] != null ? labelObject['Job Name'] : 'Job Name'),
                modal: true,
                height: 'auto',
                minWidth: 300,
                maxWidth: 'auto',
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var jobName = $("#reasonId").val();
                            var folderName = $("#selectFolderName").val();//UK folder
                            var folderId = $("#selectFolderName").attr("folderId");//UK folder

                            $("#folderNameHidden").val(folderName);
                            $("#folderIdHidden").val(folderId);
                            if (jobName != null && jobName != '') {
                                $("#dailog_error_id").hide();
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                                saveJob(jobName, jobId, data, folderName, folderId, processFlag);

                            } else {
                                $("#dailog_error_id").show();
                            }

                        }},
                    {
                        text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                        click: function () {
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
                            // $("#labeld").empty();

                        }

                    }],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });
        } else {
            $("#dialog").html(labelObject['No Mapped Objects to Save'] != null ? labelObject['No Mapped Objects to Save'] : 'No Mapped Objects to Save');
            $("#dialog").dialog({
                title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                modal: true,
                height: 'auto',
                minWidth: 300,
                maxWidth: 'auto',
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");

                        }}],
                open: function () {
                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                    $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                    $(".visionHeaderMain").css("z-index", "999");
                    $(".visionFooterMain").css("z-index", "999");
                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }
            });
        }

    } else {
        $("#dialog").html(labelObject['No Mapped Objects to Save'] != null ? labelObject['No Mapped Objects to Save'] : 'No Mapped Objects to Save');
        $("#dialog").dialog({
            title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");

                    }}],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    }

}
function cancellCurrentJob() {
    var jobId = $("#currentJobId").val();
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'cancellProcessJob',
        async: true,
        data: {
            jobId: jobId
        },
        success: function (response) {
            stopLoader();

        },
        error: function (e)
        {
            stopLoader();
            sessionTimeout(e);
        }

    });
}

function disableDdw($this, id) {
    var operator = $($this).val();
    var tr = $this.closest("tr");
    var tdArray = tr.cells;
    if (tdArray != null && tdArray.length != 0) {
        if (operator == 'IS' || operator == 'IS NOT') {
            $(tdArray[3]).find("input").val("NULL");
            $(tdArray[3]).find("input").attr('readonly', 'true');
        } else {
            $(tdArray[3]).find("input").val("");
//            $(tdArray[3]).find("input").attr('readonly', 'false');
            $(tdArray[3]).find("input").removeAttr('readonly');
        }
    }

}

function addHeadersToFile() {
    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
    var t_Rules = selectedOperatorData['trfmRules-data'];
    if (t_Rules != null) {
        var inputFields_Obj = t_Rules['fileHeaders'];
    }
    var headersTr = "";
    if (inputFields_Obj != null && !jQuery.isEmptyObject(inputFields_Obj)) {
        var inputFields_ObjLen = Object.keys(inputFields_Obj).length;
        for (var i = 1; i <= inputFields_ObjLen; i++) {
            headersTr += '<td width="6.5%"><img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete" style="width:15px;height: 15px;cursor:pointer;"></td>\n\
                            <td width="6.5%">' + i + '</td>\n\
                            <td width="87%" class="visionFileHeaderNameTd"><input class="visionFileHeaderNameInput" type="text" value="' + inputFields_Obj[i] + '" style="width:97%" ></td></tr>';
        }
    } else {
        headersTr += '<td width="6.5%"><img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete" style="width:15px;height: 15px;cursor:pointer;"></td>\n\
                     <td width="6.5%">1</td>\n\
                     <td width="87%" class="visionFileHeaderNameTd"><input class="visionFileHeaderNameInput" type="text" value="" style="width:97%" ></td></tr>';

    }


    var divStr = '<div class="visionETLaddheader">\n\
                  <div class="visionEtlAddIconDiv"><img data-trstring="" src="images/Add icon.svg" id="visionEtlAddRowIcon" class="visionHeaderEtlAddRowIcon" title="Add new Headers" onclick="addNewFileHeader(event,id,this)" style="width:15px;height: 15px;cursor:pointer;"></div><div class="visionEtlFileHeaderTablesDiv">\n\
                  <table id="fileColumnHeadersTable" class="visionEtlFileHeaderTable" style="width: 100%;" border="1"><thead><tr>\n\
                    <th width="6.5%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center"></th>\n\
                    <th width="6.5%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center"></th>\n\
                    <th width="87%" class="" style="background: #0071c5 none repeat scroll 0 0;color: #FFF;text-align: center">Header Name</th></tr></thead>\n\
                  <tbody><tr>';

    divStr += headersTr;
    divStr += '</tbody></table></div></div>';

    $("#dialog").html(divStr);
    $("#dialog").dialog({
        title: (labelObject['Add File Headers'] != null ? labelObject['Add File Headers'] : 'Add File Headers'),
        modal: true,
        width: 300,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    if (selectedOperatorData['trfmRules-data'] == null) {
                        selectedOperatorData['trfmRules-data'] = {};
                    }
                    var tRules = selectedOperatorData['trfmRules-data'];

                    var inputFieldsObj = {};
                    var inputFieldsObjLength = Object.keys(inputFieldsObj).length;
                    $(".visionFileHeaderNameInput").each(function (index) {
                        if (this.value != null && this.value != '' && this.value != 'undefined') {

                            inputFieldsObj[inputFieldsObjLength + index + 1] = this.value;
                        }
                    });

                    tRules['fileHeaders'] = inputFieldsObj;
                    selectedOperatorData['trfmRules-data'] = tRules;

                    var fileType = "." + selectedOperatorData['iconType'];
                    var imageIcon = "";
                    if (fileType == '.xls'
                            || fileType == '.xlsx'
                            || fileType == '.XLS'
                            || fileType == '.XLSX'
                            ) {
                        imageIcon = "images/xlsx Icon-01.svg"
                    } else if (fileType == '.xml'
                            || fileType == '.XML') {
                        imageIcon = "images/XML Icon-01.svg";

                    } else if (fileType == '.CSV'
                            || fileType == '.csv') {
                        imageIcon = "images/CSV ICON-01.svg";
                    } else if (fileType == '.JSON'
                            || fileType == '.json') {
                        imageIcon = "images/JSON_Isons-02.svg";
                    }

                    selectedOperatorData['imageIcon'] = imageIcon;
                    $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedOperatorData);
                    if ($("#dataMigrationTabs").length > 0) {
                        viewTrfmRules(); // ravi updated code changes
                    }

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");

                }
            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
            $(".ui-dialog").addClass('visionDMTreePopup');
            $("#dataMigrationTabs").jqxTabs({theme: 'ui-redmond'});

        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");

        }, close: function (event, ui)
        {

            $(this).html("");
            $(this).dialog("close");
            $(this).dialog("destroy");
        }
    });
}

function addNewFileHeader(event, id, $this) {
    var rowIndex = $("#fileColumnHeadersTable tr:last")[0].rowIndex;
    rowIndex = rowIndex + 1;
    var newRow = '<tr><td width="6.5%"><img src="images/Detele Red Icon.svg" onclick="deleteSelectedRow(this)" class="visionColMappingImg" title="Delete" style="width:15px;height: 15px;cursor:pointer;"></td>\n\
                <td width="6.5%">' + rowIndex + '</td>\n\
                <td width="87%" class="visionFileHeaderNameTd"><input class="visionFileHeaderNameInput" type="text" value="" style="width:97%";></td></tr>'
    $('#fileColumnHeadersTable tr:last').after(newRow);
}

function deleteAllTableTrs(tableId) {
    $("#" + tableId + " > tbody").empty();
    try {
        $("#mainSplitter").resize();
    } catch (e) {
    }
}
function moveSapTableColumns() {
    //  $("#sourceFields").find(".multipleSelect").appendTo(".destinationFields ");
    var destinationFieldsLength = $(".destinationFields").find(".visionTableName").length;
    if (destinationFieldsLength < 50) {
        $("#selectAllCheckBoxes").prop("checked", false);
        $("#sourceFields").find(".multipleSelect").each(function () {
            var destinationFieldsLength = $(".destinationFields").find(".visionTableName").length;
            $(this).appendTo(".destinationFields");
            $(this).children().show();
            $(this).find(".visionTableNameChbx").hide();
//            if (destinationFieldsLength < 50) {
//                $(this).appendTo(".destinationFields");
//                $(this).children().show();
//                $(this).find(".visionTableNameChbx").hide();
//            } else {
//                return false;
//            }

        });
    } else {
        showMesg("Cannot select more than 50 columns");
    }

}

function slideSettingsETL(gridId) {
//  $("#settings_panel").toggle(100)
    $('#' + gridId + '_settings_panel').toggle('slide', {direction: 'right'}, 500);
    $("#" + gridId + "_personalizeid").toggleClass("ui-icon-triangle-1-s");
    //  var slideSettingsInd = $("#accordion").attr("data-slidesettingsind");
//    if (slideSettingsInd == 'N') {
//         $("#accordion").attr("data-slidesettingsind","Y");
//        getPersonalizationData();
//    }

    //$('#showcriteria').toggle();
}
function updateETLPersonalize(id) {
    var columnName = $("#" + id).attr("data-colname");
    var type = $("#" + id).attr("data-type");
    var gridId = $("#" + id).attr("data-gridid");
    if (type == 'display') {
        try {

            if ($("#" + id).is(':checked')) {
                $('#' + gridId).jqxGrid('showcolumn', columnName);
            } else {
                $('#' + gridId).jqxGrid('hidecolumn', columnName);
            }

        } catch (e) {

        }
    } else if (type == 'pinned') {
        try {

            if ($("#" + id).is(':checked')) {
                $('#' + gridId).jqxGrid('pincolumn', columnName);
            } else {
                $('#' + gridId).jqxGrid('unpincolumn', columnName);
            }

        } catch (e) {

        }
    }
}

function setConnectionToOperator(_this) {
    $("#dialog").html(tabsDiv);
    $("#dialog").dialog({
        title: (labelObject['Transformation Rules'] != null ? labelObject['Transformation Rules'] : 'Transformation Rules'),
        modal: true,
        width: 1000,
        height: 'auto',
        fluid: true,
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
            $(".ui-dialog").addClass('visionDMTreePopup');
            $("#dataMigrationTabs").jqxTabs({theme: 'ui-redmond'});

        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");

        }, close: function (event, ui)
        {

            $(this).html("");
            $(this).dialog("close");
            $(this).dialog("destroy");
        }
    });
}

function viewPredefinedTrfmRules() {

    var data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var operators = data['operators'];
    var trfmRulesId = "";
    var jobId = "";
    var jobName = "";

    $.each(operators, function (indx) {
        if (this['targetOperator'] == 'Y') {
            trfmRulesId = this['trfmRulesId'];
            jobId = this['jobId'];
            jobName = this['jobName'];
        }
    })

    showLoader();

    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'html',
        cache: false,
        url: 'fetchTransformationRules',
        async: true,
        data: {
            trfmRulesId: trfmRulesId,
            jobId: jobId,
            jobName: jobName
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
                $('.visionTablesComboBox').hide();
                $('.visionUploadFileDiv').hide();
                $('.visionConnectToDbDiv').hide();
                $('#visionERPMain').hide();
                var response = JSON.parse(response);
                if (response != null && response.connectionFlag == 'Y') {
                    $("#feedContentArea").html(response['tabsString']);
                    $("#dataMigrationTabs").jqxTabs({width: "100%", height: "130px", position: 'top', theme: 'ui-redmond', reorder: true});

                    $('#dataMigrationTabs').unbind('selected').on('selected', function (event) {
                        $('#iconsdiv').attr('style', 'margin-top:4px !important');
                        // scroll bar issue fixed by SHI
                        var feedContentAreaHeight = $("#feedContentArea").height();
//                    $("#dataMigrationTabs").jqxTabs({height:feedContentAreaHeight})
                        var tbodyHeight = feedContentAreaHeight - 90;
                        $(".visionColMappScrollDiv1").css("max-height", tbodyHeight);
                        $(".visionEtlJoinClauseTablesDiv").css("max-height", tbodyHeight);
//                                $(".visionEtlMappingTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                        $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                        $(".visionSqlViewQuery1").css("max-height", parseInt(feedContentAreaHeight) - 67);
                        $(".visionEtlJoinrClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                        $(".visionEtlwhereClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 69);
                        var joinTablesHeight = $(".visionEtlJoinrClauseTablesDiv").height();
                        $(".viewJoinQueryOuterDivClass").css("max-height", parseInt(feedContentAreaHeight) - (parseInt(joinTablesHeight) + 82));
                        // scroll bar issue fixed by SHI
                        //end code
                    });
//                        $("#dataMigrationTabs").jqxTabs({width: "100%", height: "100%", position: 'top', theme: 'ui-redmond', reorder: true});
                    var columnStr = response['columnMapping'];
                    $("#toConnObjPK").val(JSON.stringify(response['toTablePKColumnList']));  //PKH PKIcon
                    var selectedJoinTables = response['selectedJoinTables'];
                    $('#tabs-1').html(columnStr);
                    $('#tabs-1').append("<div id='selectedColumnStr' style='display:none'></div>");
                    $("#toTableColsArray_hidden").remove();
                    $("#fromTableColsArray_hidden").remove();
                    var hiddenData = "<input type='hidden' id='toTableColsArray_hidden'/><input type='hidden' id='fromTableColsArray_hidden'/>";
                    $('#tabs-1').append(hiddenData);
                    $("#toTableColsArray_hidden").val(JSON.stringify(response['toTableColsArray']));
                    $("#fromTableColsArray_hidden").val(JSON.stringify(response['fromTableColsArray']));
                    $('#tabs-2').html(selectedJoinTables);
                    $('#mapColumns').addClass("active");
                    $('.visionProgressFilesSteps').hide();
                    $("#selectedColumnStr").html(response['colMapTrString']);//colMapTrString
                    var selectedTableWhereClause = response['selectedTableWhereClause'];
                    if (selectedTableWhereClause != null) {
                        var hiddenDataWhere = "<input type='hidden' id='whereClauseTableColsArray_hidden'/><input type='hidden' id='currentClauseMapId'/>"
                                + "<div id='wherClauseTrString' style='display:none;'></div><div id='wherClauseColsString' style='display:none;'></div>";
                        $('#tabs-3').html(selectedTableWhereClause['whereClauseCondition'] + hiddenDataWhere);//whereClauseCondition
                        $("#whereClauseTableColsArray_hidden").val(JSON.stringify(selectedTableWhereClause['fromTableColsArray']));
                    }
                    var selectedTableOrderGroupClause = response['selectedTableOrderGroupClause'];
                    if (selectedTableOrderGroupClause != null) {
                        var hiddenDataOrderBy = ""
                                + "<div id='orderClauseTrString' style='display:none;'></div>";
                        $('#tabs-4').html(selectedTableOrderGroupClause['orderByCondition'] + hiddenDataOrderBy);//
                        var hiddenDataGroupBy = ""
                                + "<div id='groupClauseTrString' style='display:none;'></div>";
                        $('#tabs-5').html(selectedTableOrderGroupClause['groupByCondition'] + hiddenDataGroupBy);//
                        $("#groupClauseTrString").html(selectedTableOrderGroupClause['groupByTrString']);
                        $("#orderClauseTrString").html(selectedTableOrderGroupClause['orderByTrString']);
                    }
                    // sql Editor
//                        var sqlEditor = ace.edit("tabs-6");
//                        sqlEditor.setOptions({
//                            enableBasicAutocompletion: true, // the editor completes the statement when you hit Ctrl + Space
//                            showPrintMargin: false, // hides the vertical limiting strip
//                            fontSize: "100%" // ensures that the editor fits in the environment
//                        });
//
//                        sqlEditor.getSession().setMode("ace/mode/sql");
// scroll bar issue fixed by SHI
                    var feedContentAreaHeight = $("#feedContentArea").height();
                    if ($('#dataMigrationTabs').length) {
                        $("#dataMigrationTabs").jqxTabs({height: feedContentAreaHeight});
                    }
//                            $("#dataMigrationTabs").jqxTabs({height: feedContentAreaHeight})
                    var tbodyHeight = feedContentAreaHeight - 90;
                    $(".visionColMappScrollDiv1").css("max-height", tbodyHeight);
                    $(".visionEtlJoinClauseTablesDiv").css("max-height", tbodyHeight);
//                            $(".visionEtlMappingTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                    $(".visionEtlJoinClauseTablesDivScroll").css("max-height", parseInt(feedContentAreaHeight) - 105);
                    $(".visionSqlViewQuery1").css("max-height", parseInt(feedContentAreaHeight) - 67);
                    $(".visionEtlJoinrClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 130);
                    $(".visionEtlwhereClauseTablesDiv").css("max-height", parseInt(feedContentAreaHeight) - 69);
                    var joinTablesHeight = $(".visionEtlJoinrClauseTablesDiv").height();
                    $(".viewJoinQueryOuterDivClass").css("max-height", parseInt(feedContentAreaHeight) - (parseInt(joinTablesHeight) + 82));
                    // scroll bar issue fixed by SHI
                    $("#dataMigrationTabs").change(function (event) {
                        trfmRulesChanged = true;
                    });
                    if (response['uniqueRowsFlag'] == "Y") {
                        $("#distinctRowsInput").prop("checked", true);
                    }

                    if (response['showRejectedRecords'] == "Y") {
                        $("#showRejectedRecords").prop("checked", true);
                    }


                    $("#rowsCountFromInput").val(response['minRows']);
                    $("#rowsCountToInput").val(response['maxRows']);

                    if (response['operatorType'] != null && response['operatorType'] != '') {
                        $("#operatorType").val(response['operatorType']);
                    }

//                        //importColMapFile
//                        var fileslist = [];
//                        $("#importColMapFile").on('change', function (event) {
//                            console.log("iam in files change ");
//                           fileslist  = event.target.files;
//                            srsFileNames(fileslist);
//
//                        });
                    $(".visionETLColMapImage").mousedown(function (event) {
                        treeIconClickEvent = event;
                    });
                    try {
                        $("#sourceDestColsTableId").colResizable({
                            disable: true
                        });
                    } catch (e) {
                    }
                    $("#sourceDestColsTableId").colResizable();

                    $('#dataMigrationTabs').on('selected', function (event) {
                        var selectedTab = event.args.item;
                        if (selectedTab == '0' || selectedTab == 0) {// mapping
                            try {
                                $("#sourceDestColsTableId").colResizable({
                                    disable: true
                                });
                            } catch (e) {
                            }
                            $("#sourceDestColsTableId").colResizable();
                        } else if (selectedTab == '1' || selectedTab == 1) {// join
                            try {
                                $("#EtlMappingTable").colResizable({
                                    disable: true
                                });
                            } catch (e) {
                            }
                            $("#EtlMappingTable").colResizable();
                        } else if (selectedTab == '2' || selectedTab == 2) {//where clause
                            try {
                                $("#selectedTables").colResizable({
                                    disable: true
                                });
                            } catch (e) {
                            }
                            $("#selectedTables").colResizable();
                        } else if (selectedTab == '3' || selectedTab == 3) {//order clause
                            try {
                                $("#fromTablesOrderCauseTable").colResizable({
                                    disable: true
                                });
                            } catch (e) {
                            }
                            $("#fromTablesOrderCauseTable").colResizable();
                        } else if (selectedTab == '4' || selectedTab == 4) {//group clause
                            try {
                                $("#fromTablesGroupCauseTable").colResizable({
                                    disable: true
                                });
                            } catch (e) {
                            }
                            $("#fromTablesGroupCauseTable").colResizable();
                        }
                    });








                } else {
                    stopLoader();
                    showMessagePopup(response.connectionMessage);
                }


            }
        },
        error: function (e)
        {
            stopLoader();
            sessionTimeout(e);
        }

    });

}

function processPredefinedJob(flowChartData) {
    showLoader();
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'json',
        cache: false,
        url: 'processPredefinedJob',
        async: true,
        data: {
            flowChartData: flowChartData,
        },
        success: function (response) {
            stopLoader();
            if (response != null) {

                $("#dialog").html(response['tableStr']);
                $("#dialog").dialog({
                    title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                    modal: true,
                    width: 600,
                    height: 'auto',
                    fluid: true,
                    open: function () {
                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                        $(".ui-dialog").addClass('visionDMTreePopup');
                        $("#dataMigrationTabs").jqxTabs({theme: 'ui-redmond'});

                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");

                    }, close: function (event, ui)
                    {

                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }
                });
            }
        },
        error: function (e)
        {
            stopLoader();
            sessionTimeout(e);
        }

    });
}

function jobExecuteType($this) {

    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
    if ($this.id == 'PREJOB' && $this.id != null && $this.id != undefined && $this.id != '') {

        var data = $('#' + flowChartWorkSpaceId).flowchart('getFlowchartDataConnectedtoOP', selectedOperatorId);
        var subJobId = genHexString(32);
        $.each(data['operators'], function (key, value) {
            if (this.iconType == 'MAP' || this.iconType == 'GROUP_JOB') {
                this['subJobId'] = subJobId;
                this['executeType'] = 'PREJOB';
                var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', (this['operatorId']));
                var ele = document.createElement('div');
                ele.innerHTML = body;
                $(ele).find('.visionJobExecuteType').remove();
                $(ele).children('div:nth-child(1)').append("<span class='visionJobExecuteType'>PREJOB</span>");
                this['properties']['body'] = $(ele).html();
                $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);
            }
        })
    }
    if ($this.id == 'POSTJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
        var data = $('#' + flowChartWorkSpaceId).flowchart('getFlowchartDataConnectedtoOP', selectedOperatorId);
        var subJobId = genHexString(32);
        $.each(data['operators'], function (key, value) {
            if (this.iconType == 'MAP' || this.iconType == 'GROUP_JOB') {
                this['subJobId'] = subJobId;
                this['executeType'] = 'POSTJOB';
                var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', (this['operatorId']));
                var ele = document.createElement('div');
                ele.innerHTML = body;
                $(ele).find('.visionJobExecuteType').remove();
                $(ele).children('div:nth-child(1)').append("<span class='visionJobExecuteType'>POSTJOB</span>");
                this['properties']['body'] = $(ele).html();
                $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);
            }
        })
    }
    if ($this.id == 'PARALLELJOB' && $this.id != null && $this.id != undefined && $this.id != '') {

        var data = $('#' + flowChartWorkSpaceId).flowchart('getFlowchartDataConnectedtoOP', selectedOperatorId);
        var subJobId = genHexString(32);
        $.each(data['operators'], function (key, value) {
            if (this.iconType == 'MAP' || this.iconType == 'GROUP_JOB') {
                this['subJobId'] = subJobId;
                this['executeType'] = 'PARALLELJOB';
                var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', (this['operatorId']));
                var ele = document.createElement('div');
                ele.innerHTML = body;
                $(ele).find('.visionJobExecuteType').remove();
                $(ele).children('div:nth-child(1)').append("<span class='visionJobExecuteType'>PARALLELJOB</span>");
                this['properties']['body'] = $(ele).html();
                $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);
            }
        })
        $("#parallelJobsDiv").append("<input type='hidden' id='parallelJob_" + selectedOperatorData['operatorId'] + "' value='" + JSON.stringify(data) + "' />");

    }
    if ($this.id == 'REMOVEJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
        var data = $('#' + flowChartWorkSpaceId).flowchart('getFlowchartDataConnectedtoOP', selectedOperatorId);
        $.each(data['operators'], function (key, value) {
            if (this.iconType == 'MAP' || this.iconType == 'GROUP_JOB') {

                this['executeType'] = '';
                var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', (this['operatorId']));
                var ele = document.createElement('div');
                ele.innerHTML = body;
                $(ele).find('.visionJobExecuteType').remove();

                this['properties']['body'] = $(ele).html();
                $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', parseInt(this['operatorId']), this);
            }
        })
    }
}


function setMapSeqNo($this) {

    var labelObject = {};
    $("#dialog").html("<Span>Set map execution seq no</span><br><input type='text' id='mapExecutionSeqId'/>");
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        width: 300,
        height: 135,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var mapSeqNo = $("#mapExecutionSeqId").val();
                    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
                    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);

                    selectedOperatorData['mapExecutionSeqNo'] = parseInt(mapSeqNo);

                    $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedOperatorData);

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }],
        open: function () {
            var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
            var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);

            if (selectedOperatorData != null) {
                var mapExecutionSeqNo = selectedOperatorData['mapExecutionSeqNo'];
                if (mapExecutionSeqNo != null) {
                    $("#mapExecutionSeqId").val(mapExecutionSeqNo);
                }
            }
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });

}

function stopAllJobs() {
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'json',
        cache: false,
        url: 'cancellAllProcessJobs',
        async: true,
        data: {

        },
        success: function (response) {
            stopLoader();

        },
        error: function (e)
        {
            stopLoader();
            sessionTimeout(e);
        }

    });

}


function selectColumnFunForm($this, tableColType) {
    showLoader();
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    //dddw
    // prepare the data
    var data = [];
    var dataStr = $("#functionNameObj").val();
    if (dataStr != null && dataStr != '') {
        data = JSON.parse(dataStr);
        var source =
                {
                    dataType: "json",
                    dataFields: [
                        {name: "FUN_ID", type: "string"},
                        {name: "FUN_DISP_NAME", type: "string"},
                        {name: "FUN_DESCR", type: "string"},
                        {name: "FUN_NAME", type: "string"},
                        {name: "HL_FUN_ID", type: "string"},
                        {name: "FUN_FORM_ID", type: "string"},
                        {name: "FUN_LVL_TYPE", type: "string"},
                        {name: "DM_FUN_CUST_COL1", type: "string"},
                        {name: "DM_FUN_CUST_COL2", type: "string"},
                        {name: "ICON_PATH", type: "string"}
                    ],
                    hierarchy:
                            {
                                keyDataField: {name: 'FUN_ID'},
                                parentDataField: {name: 'HL_FUN_ID'}
                            },
                    id: 'FUN_ID',
                    localData: data
                };

        var dataAdapter = new $.jqx.dataAdapter(source);
        // create jqxTreeGrid.

        $("#columnMappingFuncDialog").html("<div id='columnMappingTreeForm' class='columnMappingTree'></div>");
        $("#columnMappingFuncDialog").dialog({
            title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
            modal: true,
            width: 400,
            maxWidth: 1000,
            height: 400,
            fluid: true,
            buttons: [{
                    text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                    click: function () {
                        var selection = $("#columnMappingTreeForm").jqxTreeGrid('getSelection');
                        if (selection != null && selection.length != 0) {
                            var selectedRowData = selection[0];
                            if (selectedRowData != null
                                    && !jQuery.isEmptyObject(selectedRowData)
                                    && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                var source = $("#columnMappingTreeForm").jqxTreeGrid('source');
                                $(this).html("");
                                $(this).dialog("close");
                                $(this).dialog("destroy");
                                openColumnFunctionForm(selection[0], source, $this, tableColType);
                            }
                        }
                    }

                }],
            open: function () {
                $("#columnMappingTreeForm").jqxTreeGrid(
                        {
                            source: dataAdapter,
                            width: "100%",
                            height: 300,
                            sortable: true,
                            columnsResize: true,
                            columnsReorder: true,
                            enableHover: true,
                            enableBrowserSelection: true,
                            filterable: true,
//                            filterMode: 'simple',
//                        hierarchicalCheckboxes: true,
                            pageable: true,
                            pagerMode: 'advanced',
                            pagerPosition: 'bottom',
                            pageSize: 100,
                            pageSizeOptions: ['100', '200', '300'],
                            theme: 'energyblue',
                            selectionMode: 'singleRow',
                            autoShowLoadElement: false,
                            columns: [
                                {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
                                {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
                                {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
                                {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
                                {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
                                {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
                                {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
                                {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
                                {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
                                {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
                            ]
                        });
                $('#columnMappingTreeForm').on('rowDoubleClick', function (event) {
                    var args = event.args;
                    var selectedRowData = args.row;
                    if (selectedRowData != null
                            && !jQuery.isEmptyObject(selectedRowData)
                            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                        var source = $("#columnMappingTreeForm").jqxTreeGrid('source');
                        $("#columnMappingFuncDialog").html("");
                        $("#columnMappingFuncDialog").dialog("close");
                        $("#columnMappingFuncDialog").dialog("destroy");
                        openColumnFunctionForm(selectedRowData, source, $this, tableColType);
                    }


                });

                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
                $(".ui-dialog").addClass('visionDMTreePopup');

                stopLoader();
            },
            beforeClose: function (event, ui)
            {

                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");

            }, close: function (event, ui)
            {

                $(this).html("");
                try {
                    $("#columnMappingTreeForm").jqxTreeGrid('destroy');
                    $("#columnMappingTreeForm").remove();
                    $("#treeSearchInputDiv").remove();

                } catch (e) {
                }

            }

        });

    } else {
        $.ajax({
            type: "post",
            traditional: true,
            url: 'getETLDBFunction',
            cache: false,
            data: {
                selectedRowData: JSON.stringify(selectedRowData)
            },
            success: function (response, status, xhr) {
                //columnMappingFormDialog
                if (response != null && response != '') {
                    stopLoader();
                    $("#functionNameObj").val(response);
                    data = JSON.parse(response);
                    var source =
                            {
                                dataType: "json",
                                dataFields: [
                                    {name: "FUN_ID", type: "string"},
                                    {name: "FUN_DISP_NAME", type: "string"},
                                    {name: "FUN_DESCR", type: "string"},
                                    {name: "FUN_NAME", type: "string"},
                                    {name: "HL_FUN_ID", type: "string"},
                                    {name: "FUN_FORM_ID", type: "string"},
                                    {name: "FUN_LVL_TYPE", type: "string"},
                                    {name: "DM_FUN_CUST_COL1", type: "string"},
                                    {name: "DM_FUN_CUST_COL2", type: "string"},
                                    {name: "ICON_PATH", type: "string"}
                                ],
                                hierarchy:
                                        {
                                            keyDataField: {name: 'FUN_ID'},
                                            parentDataField: {name: 'HL_FUN_ID'}
                                        },
                                id: 'FUN_ID',
                                localData: data
                            };

                    var dataAdapter = new $.jqx.dataAdapter(source);
                    // create jqxTreeGrid.

                    $("#columnMappingFuncDialog").html("<div id='columnMappingTreeForm' class='columnMappingTree'></div>");
                    $("#columnMappingFuncDialog").dialog({
                        title: (labelObject['Functions'] != null ? labelObject['Functions'] : 'Functions'),
                        modal: true,
                        width: 400,
                        maxWidth: 1000,
                        height: 400,
                        fluid: true,
                        buttons: [{
                                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                click: function () {
                                    var selection = $("#columnMappingTreeForm").jqxTreeGrid('getSelection');
                                    if (selection != null && selection.length != 0) {
                                        var selectedRowData = selection[0];
                                        if (selectedRowData != null
                                                && !jQuery.isEmptyObject(selectedRowData)
                                                && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                            var source = $("#columnMappingTreeForm").jqxTreeGrid('source');
                                            $(this).html("");
                                            $(this).dialog("close");
                                            $(this).dialog("destroy");
                                            openColumnFunctionForm(selection[0], source, $this, tableColType);
                                        }
                                    }
                                }

                            }],
                        open: function () {
                            $("#columnMappingTreeForm").jqxTreeGrid(
                                    {
                                        source: dataAdapter,
                                        width: "100%",
                                        height: 300,
                                        sortable: true,
                                        columnsResize: true,
                                        columnsReorder: true,
                                        enableHover: true,
                                        enableBrowserSelection: true,
                                        filterable: true,
//                            filterMode: 'simple',
//                        hierarchicalCheckboxes: true,
                                        pageable: true,
                                        pagerMode: 'advanced',
                                        pagerPosition: 'bottom',
                                        pageSize: 100,
                                        pageSizeOptions: ['100', '200', '300'],
                                        theme: 'energyblue',
                                        selectionMode: 'singleRow',
                                        autoShowLoadElement: false,
                                        columns: [
                                            {text: 'FUN_ID', dataField: 'FUN_ID', hidden: true, filterable: false},
                                            {text: 'Function Name', dataField: 'FUN_DISP_NAME', width: '30%', filterable: true},
                                            {text: 'Description', dataField: 'FUN_DESCR', width: '70%', filterable: true},
                                            {text: 'value', dataField: 'FUN_NAME', hidden: true, filterable: false},
                                            {text: 'HL_FUN_ID', dataField: 'HL_FUN_ID', hidden: true, filterable: false},
                                            {text: 'FUN_FORM_ID', dataField: 'FUN_FORM_ID', hidden: true, filterable: false},
                                            {text: 'FUN_LVL_TYPE', dataField: 'FUN_LVL_TYPE', hidden: true, filterable: false},
                                            {text: 'DM_FUN_CUST_COL1', dataField: 'DM_FUN_CUST_COL1', hidden: true, filterable: false},
                                            {text: 'DM_FUN_CUST_COL2', dataField: 'DM_FUN_CUST_COL2', hidden: true, filterable: false},
                                            {text: 'ICON_PATH', dataField: 'ICON_PATH', hidden: true, filterable: false}
                                        ]
                                    });
                            $('#columnMappingTreeForm').on('rowDoubleClick', function (event) {
                                var args = event.args;
                                var selectedRowData = args.row;
                                var source = $("#columnMappingTreeForm").jqxTreeGrid('source');
                                if (selectedRowData != null
                                        && !jQuery.isEmptyObject(selectedRowData)
                                        && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
                                    $("#columnMappingFuncDialog").html("");
                                    $("#columnMappingFuncDialog").dialog("close");
                                    $("#columnMappingFuncDialog").dialog("destroy");
                                    openColumnFunctionForm(selectedRowData, source, $this, tableColType);
                                }



                            });

                            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                            $(".visionHeaderMain").css("z-index", "999");
                            $(".visionFooterMain").css("z-index", "999");
                            $(".ui-dialog").addClass('visionDMTreePopup');

                            stopLoader();
                        },
                        beforeClose: function (event, ui)
                        {

                            $(".visionHeaderMain").css("z-index", "99999");
                            $(".visionFooterMain").css("z-index", "99999");

                        }, close: function (event, ui)
                        {

                            $(this).html("");
                            try {
                                $("#columnMappingTreeForm").jqxTreeGrid('destroy');
                                $("#columnMappingTreeForm").remove();
                                $("#treeSearchInputDiv").remove();

                            } catch (e) {
                            }

                        }

                    });
                }


            },
            error: function (e) {
                console.log(e);
                sessionTimeout(e);
                stopLoader();
            }
        });
    }



}
function openColumnFunctionForm(selectedRowData, source, $this, columnType) {

    if (selectedRowData != null
            && !jQuery.isEmptyObject(selectedRowData)
            && selectedRowData['HL_FUN_ID'] != null && selectedRowData['HL_FUN_ID'] != '') {
        if (selectedRowData != null
                && !jQuery.isEmptyObject(selectedRowData)
                && selectedRowData['FUN_FORM_ID'] != null
                && selectedRowData['FUN_FORM_ID'] != ''
                ) {//FUN_FORM_ID
            var selectedRowDataMain = {};
            var columns = source._source.datafields;
            if (columns != null && columns.length != 0) {
                for (var i = 0; i < columns.length; i++) {
                    var columnObj = columns[i];
                    selectedRowDataMain[columnObj['name']] = selectedRowData[columnObj['name']];
                }
            }
            var dataFunobjstr = $($this).parents("td").find("input").attr("data-funobjstr");
            $.ajax({
                type: "post",
                traditional: true,
                url: 'getETLOpenFunctionForm',
                cache: false,
                data: {
                    selectedRowData: JSON.stringify(selectedRowDataMain),
                    dataFunobjstr: dataFunobjstr,
                    columnType: columnType
                },
                success: function (data, status, xhr) {
                    //columnMappingFormDialog
                    if (data != null && data != '') {
                        var response = JSON.parse(data);
                        if (response['messageFlag']) {
                            var sourceTablesArray = $("#sourceTablesArray").val();
                            sourceTablesArray = JSON.parse(sourceTablesArray);

                            var idValue = Math.floor(Math.random() * 10000);
                            var dialogId = 'dialog' + idValue;
                            $('<div>').attr('id', dialogId).appendTo('body');
                            $("#" + dialogId).html(response['funFormStr'] + "<div id='funOpenFormETLTableTr' style='display:none'></div>");

                            $("#" + dialogId).dialog({
                                title: (labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] != null ? labelObject[selectedRowDataMain['FUN_DISP_NAME'] + ' Form'] : selectedRowDataMain['FUN_DISP_NAME'] + ' Form'),
                                modal: true,
                                width: 650,
                                maxWidth: 1000,
                                height: 'auto',
                                maxHeight: 1000,
                                fluid: true,
                                buttons: [{
                                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                                        click: function () {


                                            var selectedFunctionName = selectedRowData['FUN_NAME'];
                                            if (selectedFunctionName != null && selectedFunctionName != '') {
                                                selectedFunctionName = $.trim(selectedFunctionName);
                                            }
                                            var FUN_LVL_TYPE = selectedRowData['FUN_LVL_TYPE'];
                                            var HL_FUN_ID = selectedRowData['HL_FUN_ID'];
                                            var functionFormObj = {};
                                            var funStr = "";
                                            functionFormObj['functionName'] = selectedFunctionName;
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                funStr += "" + selectedFunctionName + "(";
                                            } else {
                                                funStr += "" + selectedFunctionName + "";

                                            }
                                            var mainFunStr = "";
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                mainFunStr += "" + selectedFunctionName + "(";
                                            } else {
                                                mainFunStr += "" + selectedFunctionName + "";

                                            }
                                            var rowCount = $('#funOpenFormETLTable tr').length;
                                            var displayRowCount = $('#funOpenFormETLTable tr:visible').length;
//                                        $('#myTable tr').length
                                            var loopCount = 0;
                                            var multiColumnsObj = {};
                                            $("#funOpenFormETLTable tr").each(function () {
                                                var tdArray = this.cells;
                                                if (tdArray != null && tdArray.length != 0) {
                                                    if (FUN_LVL_TYPE == 'MULTI_COLUMNS') {
                                                        if (loopCount != 0) {
                                                            var multiColsObj = {};
                                                            for (var i = 1; i < tdArray.length; i++) {

                                                                var funValue = $(tdArray[i]).find("input").val();

                                                                if (!(funValue != null && funValue != '' && funValue != 'null')) {
                                                                    funValue = $(tdArray[i]).find("select").val();
                                                                }
                                                                if (funValue != null && funValue != '') {
                                                                    var trimVal = $.trim(funValue);
                                                                    if (trimVal.length > 0) {
                                                                        funValue = trimVal;
                                                                    }

                                                                }
                                                                var funValueId = $(tdArray[i]).find("input").attr("id");
                                                                if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
                                                                    funValueId = $(tdArray[i]).find("select").attr("id");
                                                                }
                                                                if (funValueId != null && funValueId != '') {
                                                                    var trimVal = $.trim(funValueId);
                                                                    if (trimVal.length > 0) {
                                                                        funValueId = trimVal;
                                                                    }
//                                                                    funValueId = $.trim(funValueId);
                                                                }
                                                                if (!(funValue != null
                                                                        && funValue != ''
                                                                        && funValue != undefined
                                                                        && funValue != 'undefined')) {
                                                                    funValue = "";
                                                                }
                                                                multiColsObj[funValueId] = funValue;

                                                                funStr += "'" + funValue + "'";

                                                                var isTableColumn = false;
                                                                $.each(sourceTablesArray, function (indx) {
                                                                    var currentVal = sourceTablesArray[indx];
                                                                    if (funValue != null && funValue.indexOf(currentVal) > -1) {
                                                                        isTableColumn = true;
                                                                    }
                                                                })

                                                                if ($(tdArray[i]).is(":visible")) {
                                                                    if (funValue != null
                                                                            && funValue != ''
                                                                            && isTableColumn ||
                                                                            funValueId == 'CASE_COND'
                                                                            || funValueId == 'OPERATOR') {
                                                                        mainFunStr += " " + funValue + " ";
                                                                    } else if (funValue != null
                                                                            && funValue != ''
                                                                            && funValue != undefined) {

                                                                        mainFunStr += " '" + funValue + "' ";
                                                                    }

                                                                }
                                                                if (loopCount != parseInt(rowCount) - 1) {
                                                                    funStr += ",";


                                                                }
                                                                if (loopCount == 1 && i == 1) {
                                                                    functionFormObj['FUN_LVL_TYPE'] = FUN_LVL_TYPE;
                                                                }
                                                            }
                                                            multiColumnsObj[loopCount] = multiColsObj;
                                                        }

                                                    } else {
                                                        var funFormLabel = $(tdArray[0]).text();
                                                        var funValue = $(tdArray[1]).find("input").val();

                                                        if (!(funValue != null && funValue != '' && funValue != 'null')) {
                                                            funValue = $(tdArray[1]).find("select").val();
                                                        }
                                                        var funValueId = $(tdArray[1]).find("input").attr("id");
                                                        if (!(funValueId != null && funValueId != '' && funValueId != 'null')) {
                                                            funValueId = $(tdArray[1]).find("select").attr("id");
                                                        }
                                                        if (funValue != null && funValue != '' && funValue != undefined) {
                                                            var trimVal = $.trim(funValue);
                                                            if (trimVal.length > 0) {
                                                                funValue = trimVal;
                                                            }

//                                                            funValue = $.trim(funValue);
//                                                            funValue = funValue.replace(":", ".");
                                                        }
                                                        if (funValueId != null && funValueId != '') {
                                                            var trimVal = $.trim(funValueId);
                                                            if (trimVal.length > 0) {
                                                                funValueId = trimVal;
                                                            }

//                                                            funValueId = $.trim(funValueId);
                                                        }

                                                        funStr += "'" + funValue + "'";

                                                        var isTableColumn = false;
                                                        $.each(sourceTablesArray, function (indx) {
                                                            var currentVal = sourceTablesArray[indx];
                                                            if (funValue != null && funValue.indexOf(currentVal) > -1) {
                                                                isTableColumn = true;
                                                            }
                                                        })

                                                        if ($(this).is(":visible")) {
                                                            if (funValue != null
                                                                    && funValue != ''
                                                                    && isTableColumn) {
                                                                mainFunStr += "" + funValue + "";
                                                            } else if (funValue != null
                                                                    && funValue != ''
                                                                    && funValue != undefined) {
                                                                mainFunStr += "'" + funValue + "'";
                                                            }
                                                        }

                                                        functionFormObj[funValueId] = funValue;
                                                        if (loopCount != parseInt(rowCount) - 1) {
                                                            funStr += ",";
                                                            if ($(this).is(":visible")) {
                                                                if (funValue != null
                                                                        && funValue != ''
                                                                        && funValue != undefined) {
                                                                    if (loopCount < parseInt(displayRowCount) - 1) {
                                                                        mainFunStr += ",";
                                                                    }
                                                                } else {
                                                                    mainFunStr = mainFunStr.replace(/,(\s+)?$/, '');
                                                                }
                                                            }

                                                        }


                                                    }

                                                    loopCount++;
                                                }
                                            });
                                            funStr += ")";
                                            if (FUN_LVL_TYPE != 'MULTI_COLUMNS') {
                                                mainFunStr += ")";
                                            }

                                            functionFormObj['funStr'] = funStr;
                                            functionFormObj['mainFunStr'] = mainFunStr;
                                            functionFormObj['HL_FUN_ID'] = HL_FUN_ID;
                                            functionFormObj['multiColumnsObj'] = multiColumnsObj;

                                            var input = $($this).parents("td").find("input");
                                            input.val(mainFunStr);

                                            $($this).parents("td").find("input").attr("title", mainFunStr);
                                            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
//                                            $(this).html("");
//                                            $(this).dialog("close");
//                                            $(this).dialog("destroy");
                                            $(this).html("");
                                            try {
                                                $(this).dialog("close");
                                            } catch (e) {
                                            }
                                            try {
                                                $(this).dialog("destroy");
                                            } catch (e) {
                                            }
                                        }

                                    }],
                                open: function () {
                                    $("#viewFunQuery").click(function () {
                                        console.log("iam in clickable ");
                                        viewFunQuery('funOpenFormETLTable', selectedRowData);
                                    });
//                                    $("#viewFunQuery")
                                    $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");

                                    $(".visionHeaderMain").css("z-index", "999");
                                    $(".visionFooterMain").css("z-index", "999");
                                    $(".ui-dialog").addClass('visionDMTreePopup');


                                },
                                beforeClose: function (event, ui)
                                {

                                    $(".visionHeaderMain").css("z-index", "99999");
                                    $(".visionFooterMain").css("z-index", "99999");


                                }, close: function (event, ui)
                                {
                                    $(this).html("");
                                    try {
                                        $(this).dialog("close");
                                    } catch (e) {
                                    }
                                    try {
                                        $(this).dialog("destroy");
                                    } catch (e) {
                                    }

                                }
                            });
                            $("#funOpenFormETLTableTr").html(response['addTrString']);
                        }

                    }


                },
                error: function (e) {
                    console.log(e);
                    sessionTimeout(e);
                    stopLoader();
                }
            });
        } else {
            var selectedFunctionName = selectedRowData['FUN_NAME'];
            var functionFormObj = {};
            functionFormObj['functionName'] = selectedFunctionName;
            functionFormObj['FUN_LVL_TYPE'] = selectedRowData['FUN_LVL_TYPE'];
            functionFormObj['DM_FUN_CUST_COL1'] = selectedRowData['DM_FUN_CUST_COL1'];
            functionFormObj['DM_FUN_CUST_COL2'] = selectedRowData['DM_FUN_CUST_COL2'];
            $($this).parents("td").find("input").val(selectedFunctionName);
            $($this).parents("td").find("input").attr("title", selectedFunctionName);
            $($this).parents("td").find("input").attr("data-funobjstr", JSON.stringify(functionFormObj));
        }
    } else {
        console.log("Please select function name");
    }


}


function genHexString(len) {
    const hex = '0123456789ABCDEF';
    let output = '';
    for (let i = 0; i < len; ++i) {
        output += hex.charAt(Math.floor(Math.random() * hex.length));
    }
    return output;
}

function showRecordCountOnOp(resultObj) {
    setTimeout(function () {
        if (resultObj['insertCountObjectsArray'] != null && resultObj['insertCountObjectsArray'].length > 0) {
            var insertCountObjectsArray = resultObj['insertCountObjectsArray'];

            var initialBody = "";
            $.each(insertCountObjectsArray, function (i) {
                var insertCountObj = JSON.parse(insertCountObjectsArray[i]);
                $.each(insertCountObj, function (key, value) {

                    var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', key);
                    if (initialBody == "") {
                        initialBody = body;
                    }
                    var elem = document.createElement('div');
                    elem.innerHTML = body;
                    $(elem).find(".visionCountLabelsDiv").remove();

                    body = elem.innerHTML;
                    body += "<div class='visionCountLabelsDiv'><div class='visionInsertCountLabelsDiv' style='left:0px;' title='" + value + " records Inserted'><span>&nbsp;" + value + "&nbsp;</span></div></div>";
                    $('#' + flowChartWorkSpaceId).flowchart('setOperatorBody', key, body);



                })

            })

        }

        if (resultObj['updateCountObjectsArray'] != null && resultObj['updateCountObjectsArray'].length > 0) {
            var updateCountObjectsArray = resultObj['updateCountObjectsArray'];
            $.each(updateCountObjectsArray, function (i) {
                var updateCountObj = JSON.parse(updateCountObjectsArray[i]);
                $.each(updateCountObj, function (key, value) {

                    var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', key);
                    var elem = document.createElement('div');
                    elem.innerHTML = body;
                    $(elem).find(".visionCountLabelsDiv").remove();
                    body = elem.innerHTML;
                    body += "<div class='visionCountLabelsDiv'><div class='visionUpdateCountLabelsDiv' style='left:0px;' title='" + value + " records Updated'><span>&nbsp;" + value + "&nbsp;</span></div></div>";
                    $('#' + flowChartWorkSpaceId).flowchart('setOperatorBody', key, body);

                })

            })

        }

        if (resultObj['fromTableCountObjectsArray'] != null && resultObj['fromTableCountObjectsArray'].length > 0) {
            var fromTableCountObjectsArray = resultObj['fromTableCountObjectsArray'];
            $.each(fromTableCountObjectsArray, function (i) {
                var fromTableCountObj = JSON.parse(fromTableCountObjectsArray[i]);
                $.each(fromTableCountObj, function (key, value) {

                    var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', key);

                    if (body.indexOf("visionSourceCountLabelsDiv") == -1) {
                        body += "<div class='visionCountLabelsDiv'><div class='visionSourceCountLabelsDiv' style='left:0px;' title='" + value + "'><span>&nbsp;" + value + "&nbsp;</span></div></div>";
                        $('#' + flowChartWorkSpaceId).flowchart('setOperatorBody', key, body);

                    }




                })

            })

        }


    }, 0);
}

function parseExcel(file, filetype)
{
    var sheets = [];
    var fileName = file['name'];
    var fileDataType = file['type'];
    var reader = new FileReader();
    if (filetype != null && filetype != '' && filetype != undefined)
    {
        filetype = filetype.toLowerCase();
    }
    reader.onload = function (e) {


        var data = e.target.result;
        var workbook;
        if (filetype == 'xls') {
            workbook = XLS.read(data, {
                type: 'binary',
                cellDates: true
            });
        } else if (filetype == 'xlsx')
        {
//            workbook = XLSX.read(data, {
//                type: 'binary',
//                cellDates: true
//            });
            workbook = XLSX.read(data, {type: 'binary', cellDates: true, cellNF: true, cellText: false});
        }
        var headersObj = {};
        workbook.SheetNames.forEach(function (sheetName) {

            sheets.push(sheetName);

//        const sheet = workbook.Sheets[sheetName]
//        const headers = extractHeader(sheet);
//        headersObj[sheetName]= headers;
        });
        var checkBoxDiv = "<div id='visionETLXlsxFileSelectId' class='visionETLXlsxFileSelectClass'>";
        checkBoxDiv += "<div id='VisionETLXlsxFileNameId' class='VisionETLXlsxFileNameClass'></div>";
        checkBoxDiv += "<label><input type='checkbox' id='visionETLXlsxFileIdAll' name='visionETLXlsxFileClass' value='All Sheets'/>All Sheets</label>";
        $.each(sheets, function (index, value) {
            checkBoxDiv += "<label><input type='checkbox' class='visionETLXlsxFileClass' name='visionETLXlsxFileClass' value='" + value + "'/>" + value + "</label>";
        });
        checkBoxDiv += "<label><input type='radio' id='visionETLXlsxSameFile' name='visionETLXlsxFileClass' value='Y' checked='checked'/>Save as same File</label>";
        checkBoxDiv += "<label><input type='radio' id='visionETLXlsxDiffFile' name='visionETLXlsxFileClass' value='N' />Save as Different Files</label>";

        checkBoxDiv += "</div>";
        getCheckBoxXlsxFileSheet(checkBoxDiv, workbook, file, filetype, fileName, fileDataType, sheets);

    }


    reader.onerror = function (ex) {
        console.log(ex);
    };

    reader.readAsBinaryString(file);
}


function getCheckBoxXlsxFileSheet(checkBoxDiv, workbook, file, filetype, fileName, fileDataType, sheets)
{
    labelObject = {};
    try {
        labelObject = JSON.parse($("#labelObjectHidden").val());
    } catch (e) {

    }
    $("#dialog1").html(checkBoxDiv);
    $("#dialog1").dialog({
        title: (labelObject['Xlsx Sheets'] != null ? labelObject['Xlsx Sheets'] : 'Xlsx Sheets'),
        modal: true,
        width: 300,
        minHeight: 180,
        height: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Upload'] != null ? labelObject['Upload'] : 'Upload'),
                click: function () {
                    $("#Loader").css("display", "block");
                    var checkBoxIds = $('.visionETLXlsxFileClass:checked').map(function () {
                        return this.value;
                    }).get();


                    function extractHeader(ws) {
                        const header = []
                        const columnCount = XLSX.utils.decode_range(ws['!ref']).e.c + 1
                        for (let i = 0; i < columnCount; ++i) {
                            header[i] = ws[`${XLSX.utils.encode_col(i)}1`].v
                        }
                        return header
                    }

                    if (checkBoxIds != null && checkBoxIds.length > 0) {
                        $.each(sheets, function (index, value) {
                            if (value != null && value != '' && value != undefined) {
                                if (!(checkBoxIds.indexOf(value) > -1)) {
                                    const sidx = workbook.SheetNames.indexOf(value);
                                    if (sidx == -1)
                                    {

                                    } else
                                    {
                                        workbook.SheetNames.splice(sidx, 1);
                                        delete workbook.Sheets[value];
                                        delete workbook.Workbook.Sheets.splice(sidx, 1)
                                        ;
                                    }

                                }
                            }
                        });



                        var JSONData = {}
                        var headersObj = {}
                        var sheetsArray = []
                        workbook.SheetNames.forEach(function (sheetName) {

                            var XL_row_object = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {raw: true})
                            JSONData[sheetName] = XL_row_object;
                            //            document.getElementById("jsonObject").innerHTML = json_object;
                            sheetsArray.push(sheetName);
                            const sheet = workbook.Sheets[sheetName]
                            const headers = extractHeader(sheet);
                            headersObj[sheetName] = headers;

                        });

                        uploadSelectedFileXlsx(JSONData, filetype, fileName, headersObj, sheetsArray);
                    } else
                    {
                        var JSONData = {}
                        var headersObj = {}
                        var sheetsArray = []
                        workbook.SheetNames.forEach(function (sheetName) {

                            var XL_row_object = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {raw: true})
                            JSONData[sheetName] = XL_row_object;
                            //            document.getElementById("jsonObject").innerHTML = json_object;
                            sheetsArray.push(sheetName);
                            const sheet = workbook.Sheets[sheetName]
                            const headers = extractHeader(sheet);
                            headersObj[sheetName] = headers;

                        });
                        uploadSelectedFileXlsx(JSONData, filetype, fileName, headersObj, sheetsArray);
                    }
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }
//            , {
//                text: (labelObject['Save as Different files'] != null ? labelObject['Save as Different files'] : 'Save as Different files'),
//                click: function () {
//                    $("#Loader").css("display", "block");
//                    var files = [];
//                    var checkBoxIds = $('.visionETLXlsxFileClass:checked').map(function () {
//                        return this.value;
//                    }).get();
//                    if (checkBoxIds != null && checkBoxIds.length > 0) {
//                        $.each(checkBoxIds, function (index, value) {
//                            var fileTypeName = fileName;
//                            var wb = XLSX.utils.book_new();
//                            wb.Props = {
//                                Title: "Xlsx File Data",
//                                Subject: "Data",
//                                Author: "Vision",
//                                CreatedDate: new Date()
//                            };
//                            wb.SheetNames.push(value);
//                            var sheet = workbook.Sheets[value];
//                            wb.Sheets[value] = sheet;
//                            if (value != null && value != '' && value != undefined) {
//                                var blob;
//                                if (filetype == 'xls') {
//                                    fileTypeName = fileTypeName.replace('.xls', '');
//                                    fileTypeName = fileTypeName + "_" + value + ".xls";
//                                    blob = new Blob([s2ab(XLS.write(wb, {sheet: value, bookType: 'xlsx', type: 'binary'}))], {
//                                        type: fileDataType
//                                    });
//                                } else if (filetype == 'xlsx')
//                                {
//                                    fileTypeName = fileTypeName.replace('.xlsx', '');
//                                    fileTypeName = fileTypeName + "_" + value + ".xlsx";
//                                    blob = new Blob([s2ab(XLSX.write(wb, {sheet: value, bookType: 'xlsx', type: 'binary'}))], {
//                                        type: fileDataType
//                                    });
//                                }
//                                function s2ab(s) {
//                                    var buf = new ArrayBuffer(s.length);
//                                    var view = new Uint8Array(buf);
//                                    for (var i = 0; i != s.length; ++i)
//                                        view[i] = s.charCodeAt(i) & 0xFF;
//                                    return buf;
//                                }
//                                var file = new File([blob], fileTypeName, {lastModified: new Date().getTime(), type: blob.type});
//                                files.push(file);
//                            }
//                        });
//
//                        etlXlsxSheetDifferentFiles(files, filetype);
//                    }
//                    $(this).html("");
//                    $(this).dialog("close");
//                    $(this).dialog("destroy");
//                }
//
//            }
        ],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }

    });
    $("#visionETLXlsxFileIdAll").click(function () {
        $(".visionETLXlsxFileClass").prop('checked', $(this).prop('checked'));
    });
    var spanText = "<span class='VisionETLXlsxFileSpan'>1." + fileName + "</span>";
    $("#VisionETLXlsxFileNameId").html(spanText);
}

//function etlXlsxSheetDifferentFiles(files, fileType)
//{
//    var xlsxETLFileData = new FormData();
//    for (var i = 0; i < files.length; i++) {
//        xlsxETLFileData.append("importTreeDMFile[]", files[i]);
//    }
//    xlsxETLFileData.append("selectedFiletype", fileType);
//    $.ajax({
//        url: 'importTreeDMDifferentFiles',
//        type: "POST",
//        data: xlsxETLFileData,
//        enctype: 'multipart/form-data',
//        processData: false,
//        contentType: false,
//        success: function (response) {
//            console.log("The result is:::" + response);
//            $("#Loader").css("display", "none");
//            $("body").css({"pointer-events": "auto"});
//            response = JSON.parse(response);
//            var result = response.result;
//            if (result != null && result.indexOf("successfully") > -1) {
//                $("#visionShowFileUploadMsg").html('<p style="color:green">' + result + '</p>');
//            } else {
//                $("#visionShowFileUploadMsg").html('<p style="color:red">' + result + '</p>');
//            }
//            $("#importTreeDMFile").remove();
//            var fileImprtDiv = "<input type='file' name='importTreeDMFile' id='importTreeDMFile' style='display:none'>";
//            $("#visionTreeDmFileUpload").parent().append(fileImprtDiv);
//            console.log("On Complete::");
//            // files expand ravi start
//            if (fileType != null) {
//                var treeItemElement = globalFileTreeItem[fileType];
//                if (treeItemElement != null) {
//                    var $element = $(treeItemElement);
//                    var children = $element.find('ul:first').children();
//                    if (children != null && children.length > 0) {
//                        $.each(children, function (index) {
//                            $('#savedConnections').jqxTree('removeItem', this)
//                        })
//                        $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
//                        $('#savedConnections').jqxTree('collapseItem', treeItemElement);
//                        $('#savedConnections').jqxTree('expandItem', treeItemElement);
//                    }
//                }
//            }
//
//
//        }, error: function (e) {
//            console.log("The Error Message is:::" + e.message);
//            sessionTimeout(e);
//        }
//    });
//}

function uploadSelectedFileXlsx(jsonData, fileType, fileName, headersObj, sheets) {
    showLoader();

    var url;
    if ($("#visionETLXlsxSameFile").prop("checked")) {
        url = 'importTreeDMFileXlsx';
    } else if ($("#visionETLXlsxDiffFile").prop("checked")) {
        url = 'importTreeDMDifferentFiles';
    }

    $.ajax({
        type: "post",
        traditional: true,
        url: url,
        cache: false,
        data: {
            jsonData: JSON.stringify(jsonData),
            selectedFiletype: fileType,
            fileName: fileName,
            headersObj: JSON.stringify(headersObj),
            sheets: JSON.stringify(sheets)
        },
        success: function (response) {
            stopLoader();
            console.log("The result is:::" + response);
            $("#Loader").css("display", "none");
            $("body").css({"pointer-events": "auto"});
            response = JSON.parse(response);
            var fileName = response.fileName;
            var result = response.result;
            if (result != null && result.indexOf("successfully") > -1) {
                $("#dialog").html("");
                $("#dialog").dialog("close");
                $("#dialog").dialog("destroy");
                showEtlList('savedConnectionsIconsDiv', 'availableConnections');
                var fileTypeValue = fileType.toLowerCase();
                getAvaliableFiles(fileType, 'FILES');
                $("#visionShowFileUploadMsg").html('<p style="color:green">' + result + '</p>');
            } else {
                $("#visionShowFileUploadMsg").html('<p style="color:red">' + result + '</p>');
            }
            $("#importTreeDMFile").remove();
            var fileImprtDiv = "<input type='file' name='importTreeDMFile' id='importTreeDMFile' style='display:none'>";
            $("#visionTreeDmFileUpload").parent().append(fileImprtDiv);
            console.log("On Complete::");
            // files expand ravi start
            var treeItemElement = globalFileTreeItem[fileType];
            if (treeItemElement != null) {
                var $element = $(treeItemElement);
                var children = $element.find('ul:first').children();
                if (children != null && children.length > 0) {
                    $.each(children, function (index) {
                        $('#savedConnections').jqxTree('removeItem', this)
                    })
                    $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
                    $('#savedConnections').jqxTree('collapseItem', treeItemElement);
                    $('#savedConnections').jqxTree('expandItem', treeItemElement);
                }
            }

        }, error: function (e) {
            console.log("The Error Message is:::" + e.message);
            sessionTimeout(e);
        }
    });

}

function uploadSelectedFile(files, fileType) {
    showLoader();
    var data;
    var url;

    var xlsxETLFileData = new FormData();
    xlsxETLFileData.append("importTreeDMFile", files);
    xlsxETLFileData.append("selectedFiletype", fileType);
    data = xlsxETLFileData;
    url = "importTreeDMFile";

    $.ajax({
        url: 'importTreeDMFile',
        type: "POST",
        data: xlsxETLFileData,
        enctype: 'multipart/form-data',
        processData: false,
        contentType: false,
        success: function (response) {
            stopLoader();
            console.log("The result is:::" + response);
            $("#Loader").css("display", "none");
            $("body").css({"pointer-events": "auto"});
            response = JSON.parse(response);
            var fileName = response.fileName;
            var result = response.result;
            if (result != null && result.indexOf("successfully") > -1) {
                $("#dialog").html("");
                $("#dialog").dialog("close");
                $("#dialog").dialog("destroy");
                showEtlList('savedConnectionsIconsDiv', 'availableConnections');
                getAvaliableFiles(fileType, 'FILES')

                $("#visionShowFileUploadMsg").html('<p style="color:green">' + result + '</p>');
            } else {
                $("#visionShowFileUploadMsg").html('<p style="color:red">' + result + '</p>');
            }
            $("#importTreeDMFile").remove();
            var fileImprtDiv = "<input type='file' name='importTreeDMFile' id='importTreeDMFile' style='display:none'>";
            $("#visionTreeDmFileUpload").parent().append(fileImprtDiv);
            console.log("On Complete::");
            // files expand ravi start
            var treeItemElement = globalFileTreeItem[fileType];
            if (treeItemElement != null) {
                var $element = $(treeItemElement);
                var children = $element.find('ul:first').children();
                if (children != null && children.length > 0) {
                    $.each(children, function (index) {
                        $('#savedConnections').jqxTree('removeItem', this)
                    })
                    $('#savedConnections').jqxTree('addTo', {label: 'dummy', value: "ajax"}, treeItemElement);
                    $('#savedConnections').jqxTree('collapseItem', treeItemElement);
                    $('#savedConnections').jqxTree('expandItem', treeItemElement);
                }
            }

        }, error: function (e) {
            console.log("The Error Message is:::" + e.message);
            sessionTimeout(e);
        }
    });

}

function popUpSavedJobs(newJobId) {
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'fetchJobs',
        cache: false,
        data: {

        },
        success: function (response) {
            ajaxStop();
            var availableJobshtmlStr = response['scheduledJobsArray'];
            var source =
                    {
                        datatype: "json",
                        datafields: [
                            {name: 'id'},
                            {name: 'parentid'},
                            {name: 'text'},
                            {name: 'icon'},
                            {name: 'value'},
                            {name: 'datatype'}
                        ],
                        id: 'id',
                        icon: 'icon',
                        localdata: availableJobshtmlStr
                    };
            var dataAdapter = new $.jqx.dataAdapter(source);
            dataAdapter.dataBind();
            var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{name: 'text', map: 'label'}]);

            $("#dialog").html("<div class='treeSearchInputDiv'>\n\
    <input id='treeSearchValue' type='text' class='treeSearchValueInput' placeholder='Search'/>\n\
    <img id='treeNodeSearchIconId' src='images/icon.png' style='height:12px;width:12px;cursor:pointer;'\n\
 onclick=searchTreeNode('groupJobTree')  /><div id='searchTreeErrorMesg' style='color:red;'>\n\
</div></div>\n\
<div id='groupJobTree' class='columnMappingTree'></div>");
            $('#groupJobTree').jqxTree({source: records, width: 300,
                toggleMode: 'click', theme: 'energyblue',
                enableHover: true,
                incrementalSearch: true,
                keyboardNavigation: true,
//                        checkboxes: true
            });

            $("#dialog").dialog({
                title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
                modal: true,
                width: 300,
                height: 300,
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var selectedItem = $('#groupJobTree').jqxTree('selectedItem');
                            var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');

                            var data = {};
                            data = $('#' + flowChartWorkSpaceId).flowchart('getData');
                            data['type'] = "GROUPJOB";
                            var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
                            selectedOperatorData['jobId'] = selectedItem.id;
                            selectedOperatorData['jobName'] = selectedItem.value;
                            selectedOperatorData['type'] = "GROUPJOB";
                            selectedOperatorData['executeType'] = "";
                            $('#' + flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedOperatorData);
                            // save all checked items in checkedItems array.

//                            var checkedItemsObj = {};
//                            var i = 1;
//                            $.each(items, function () {
//                                if (this.checked) {
//                                    var checkedItems = {};
//                                    checkedItems['jobName'] = this.label;
//                                    checkedItems['jobId'] = this.id;
////                                    checkedItemsArray.push(checkedItems);
//                                    checkedItemsObj[i] = checkedItems;
//                                    i++;
//                                }
//                            });

                            console.log("checkedItemsArray::" + selectedItem);
                            $(this).html("");
                            $(this).dialog("close");
//                            setGroupJobName(checkedItemsObj);
                        }

                    }],

                open: function () {
                    $('#groupJobTree').jqxTree({source: records, width: 300,
                        toggleMode: 'click', theme: 'energyblue',
                        enableHover: true,
                        incrementalSearch: true,
                        keyboardNavigation: true,
//                        checkboxes: true
                    });
//                     $('#groupJobTree').jqxTree({checkboxes: true, source: records, height: '300px', width: '300px' });
                    $("#treeSearchValue").keyup(function (event) {
                        if (event.keyCode === 13) {
                            $("#treeNodeSearchIconId").click();
                        }
                    });
                    $('#groupJobTree').jqxTree('expandItem', $("#groupJobTree").find('li:first')[0]);

                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");

                }, close: function (event, ui)
                {

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }




            });
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function processGroupJobs(jobId, jobName) {
    showLoader();
    $("#currentJobId").val(jobId);
//    $("#currentJobName").val("");
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'html',
        cache: false,
        url: "getJobTransformationRules",
        data: {
            jobId: jobId,
        },
        success: function (response) {
            showLoader();
            try {
                response = JSON.parse(response);
            } catch (e) {
            }

            var processJobData = JSON.parse(response['processJobDataObj']);
            processJobData['mappedData'] = response['mappedObjectData'];
            processJobData['jobId'] = jobId;
            processJobData['type'] = "GroupJob";
            processJobData['jobName'] = jobName;
            $.ajax({
                type: 'post',
                traditional: true,
                dataType: 'html',
                cache: false,
                url: 'processGroupETLData',
                async: true,
                data: processJobData,
                success: function (response) {
                    console.log("ended");
                    stopLoader();
                    try {
                        $("#currentJobId").val(response['jobId']);
                        $("#currentJobName").val(response['jobName']);

                    } catch (e) {
                    }
                    openLogFile();

                },
                error: function (e)
                {
                    sessionTimeout(e);
                    stopLoader();
                    if (processLogInterval != null) {
                        clearInterval(processLogInterval);
                    }
                }

            });

        }

    });
}

function setGroupJobName() {
    var response = "<div id='textReason'>";
    response += "<textarea id='reasonId' class='visionDeleteReason'></textarea></div>";
    response += "<div id='dailog_error_id' style='display:none;color:red'>" + (labelObject['Please give any Job Name'] != null ? labelObject['Please give new Job Name'] : 'Please give new Job Name') + "</div>";
    $("#dialog").html(response);
    $("#dialog").dialog({
        title: (labelObject['Job Name'] != null ? labelObject['Job Name'] : 'Job Name'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 'auto',
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var jobName = $("#reasonId").val();

                    if (jobName != null && jobName != '') {
                        $("#dailog_error_id").hide();
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                        saveGroupJob(jobName);
                    } else {
                        $("#dailog_error_id").show();
                    }

                }},
            {
                text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                    // $("#labeld").empty();

                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}
function saveGroupJob(jobName) {
    $("#currentGroupJobName").val(jobName);
    var data = {};
    data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var operators = data.operators;
    var operatorJobId;
    $.each(operators, function (indx) {
        operatorJobId = this['jobId'];
    })
    if (operatorJobId != null && operatorJobId != '' && operatorJobId != 'undefined') {
        var jobDetails = {};
        jobDetails['jobType'] = "ETL";
        jobDetails['jobDetail'] = "GROUP";
        var jobId = $("#currenId").val();
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: 'saveGroupjob',
            cache: false,
            data: {
                jobName: jobName,
                jobDetails: JSON.stringify(jobDetails),
                jobId: jobId,
                checkedItemsObj: JSON.stringify(data)

            },

            success: function (response) {
                $("#currentGroupJobName").val(jobName);
                ajaxStop();
                showSavedJobs();
                processJob();
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    } else {
        showMesg("Select Job to operator to execute.");
    }

}
function openGroupJobs(event, flowChartData) {
    if (flowChartData != null) {
        $("#" + flowChartWorkSpaceId).remove();
        $("#feedHeader").append('<div  id="flowchartworkSourcesspace" class="flowchart-example-container"></div>');

        $('#' + flowChartWorkSpaceId).flowchart({
            linkWidth: 2,
            defaultSelectedLinkColor: '#000055',
            grid: 10,
            distanceFromArrow: 0,
            multipleLinksOnInput: true,
            multipleLinksOnOutput: true,
            defaultSelectedLinkColor: 'red',
            onOperatorContextMenu: function (operatorId) {
                console.log("operatorId:::" + operatorId);
                openOpeartorContextMenu(operatorId);
                return true;
            },
        });
        $('#' + flowChartWorkSpaceId).flowchart({
//                                onOperatorSelect: function(operatorId) {
//                                return true;
//                                },
            onLinkCreate: function (linkId, linkData) {

                var fromOperatorId = linkData['fromOperator'];
                var toOperatorId = linkData['toOperator'];
                var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                var connectedTo = fromOperatorData['connectedTo'];
                connectedTo = (connectedTo != null) ? connectedTo : [];
                if (connectedTo.indexOf(toOperatorId) == -1) {
                    connectedTo.push(toOperatorId)
                }

                fromOperatorData['connectedTo'] = connectedTo;
                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                var connectedFrom = toOperatorData['connectedFrom'];
                connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                if (connectedFrom.indexOf(fromOperatorId) == -1) {
                    connectedFrom.push(fromOperatorId)
                }

                toOperatorData['connectedFrom'] = connectedFrom;
                if (toOperatorData['component'] == 'Y') {
                    toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                    if (toOperatorData['connObj'] == null) {
                        if (toOperatorData['connObj'] == null) {
                            toOperatorData['connObj'] = savedDBData["Current_V10"];
                        }
                    }

                }
                var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                if (originalSources.indexOf(fromTable) == -1) {
                    originalSources.push(fromTable);
                }
                toOperatorData['originalSources'] = originalSources;

                var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                    originalSourceOp.push(fromOperatorId);
                }
                toOperatorData['originalSourceOp'] = originalSourceOp;
                $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                //            setToOpDblCLickFuncName(fromOperator, toOperator);
                return true;
            },
            onAfterChange: function (changeType) {

                if (!operatorDoublClick) {
                    trfmRulesChanged = true;
                    console.error("trfmRulesChanged : " + trfmRulesChanged);
                    return true;
                }
            },
            onOperatorSelect: function (changeType) {
                $(document).find("input").blur();
                return true;

            },
            onLinkSelect: function (changeType) {
                $(document).find("input").blur();
                return true;
            }
        });

        var count = 0;
        var OperatorsData = {};
        var linksData = {};
        try {
            for (var key in flowChartData.operators) {

                OperatorsData[count] = flowChartData.operators[key];
//                        for (var i in flowChartData.links) {
//                            if (parseInt(key) == flowChartData.links[i].fromOperator) {
//                                flowChartData.links[i].fromOperator = count;
//                            }
//                            if (parseInt(key) == flowChartData.links[i].toOperator) {
//                                flowChartData.links[i].toOperator = count;
//                            }
//
//                        }

                count = count + 1;
            }
            for (var key in OperatorsData) {
                $('#' + flowChartWorkSpaceId).flowchart('addOperator', OperatorsData[key]);
            }
        } catch (e) {
        }

    }

}

//function setExecuteType($this) {
//    var selectedOperatorId = $('#'+flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
//    var selectedOperatorData = $('#'+flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
//    if ($this.id == 'PREJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        selectedOperatorData['executeType'] = 'PREJOB';
//    }
//    if ($this.id == 'POSTJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        selectedOperatorData['executeType'] = 'POSTJOB';
//    }
//    if ($this.id == 'PARALLELJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        selectedOperatorData['executeType'] = 'PARALLELJOB';
//    }
//    if ($this.id == 'PARALLELJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        selectedOperatorData['executeType'] = 'PARALLELJOB';
//    }
//    if ($this.id == 'REMOVEJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        selectedOperatorData['executeType'] = '';
//
//        var body = $('#'+flowChartWorkSpaceId).flowchart('getOperatorBody', selectedOperatorId);
//        var ele = document.createElement('div');
//        ele.innerHTML = body;
//        $(ele).find('.visionJobExecuteType').remove();
//
//        selectedOperatorData['properties']['body'] = $(ele).html();
//    }
//    if ($this.id == 'PREJOB' || $this.id == 'POSTJOB' || $this.id == 'PARALLELJOB' && $this.id != null && $this.id != undefined && $this.id != '') {
//        var body = $('#'+flowChartWorkSpaceId).flowchart('getOperatorBody', selectedOperatorId);
//        var ele = document.createElement('div');
//        ele.innerHTML = body;
//        $(ele).find('.visionOpLabelDiv').remove();
//        $(ele).children('div:nth-child(1)').append("<span class='visionJobExecuteType'>" + $this.id + "</span>");
//        selectedOperatorData['properties']['body'] = $(ele).html();
//
//    }
//    selectedOperatorData['properties']['body'] = body;
//    $('#'+flowChartWorkSpaceId).flowchart('setOperatorData', selectedOperatorId, selectedOperatorData);
//
//}


function executeProcessGroupJob() {
    showLoader();
    try {
        var data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    } catch (e) {
    }

//    $("#currentJobName").val("");
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'html',
        cache: false,
        url: "ProcessGroupJobData",
        data: {
            groupJobData: JSON.stringify(data),
            groupJobId: data['operators'][0]['jobId']
        },
        success: function (response) {
            showLoader();
            try {
                response = JSON.parse(response);
                var jobId = response["jobId"];
                $("#currentJobId").val(jobId);
            } catch (e) {
            }
            openLogFile();


        }

    });



}
function updateGroupJob() {
    ajaxStart();
    var data = {};
    data = $('#' + flowChartWorkSpaceId).flowchart('getData');
    var jobId = $("#currentJobId").val();
    if (jobId != null && jobId != '' && jobId != 'undefined') {
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: 'updateGroupjob',
            cache: false,
            data: {
                jobId: jobId,
                checkedItemsObj: JSON.stringify(data)
            },
            success: function (response) {
                var message = response.message;
                showMesg(message);
                ajaxStop();
                showSavedJobs();
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    } else {
        showMesg("No mapping to save");
    }

}



function deleteRecordsInTable(gridId, dbValue, tableName, connObj) {
    var selectedRowsData = [];
    var indexes = $("#" + gridId).jqxGrid('selectedrowindexes');
    for (var i = 0; i < indexes.length; i++) {
        var data = $("#" + gridId).jqxGrid('getrowdata', indexes[i]);
        selectedRowsData.push(data);
    }

    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'deleteRecordsInTable',
        cache: false,
        data: {
            connObj: connObj,
            tableName: tableName,
            selectedRowsData: JSON.stringify(selectedRowsData),
        },
        success: function (response) {
            if (response != null && response != "") {
                var message = response['message'];
                refreshTableGrid(gridId);

                showMesg(message);

            }


        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function truncateTable(gridId, dbValue, tableName, connObj) {
    var confirmMsg = "Are you sure you want to Truncate this table?";

    $("#dialog").html(labelObject[confirmMsg] != null ? labelObject[confirmMsg] : confirmMsg);
    $("#dialog").dialog({
        title: (labelObject['Confirm'] != null ? labelObject['Confirm'] : 'Confirm'),
        modal: true,
        height: 'auto',
        minWidth: 300,
        maxWidth: 300,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {

                    $.ajax({
                        type: "post",
                        traditional: true,
                        dataType: 'json',
                        url: 'truncateTableData',
                        cache: false,
                        data: {
                            connObj: connObj,
                            tableName: tableName,
                        },
                        success: function (response) {
                            if (response != null && response != "") {
                                var message = response['message'];
                                showMesg(message);
                                $('#' + gridId).jqxGrid({editable: false});
                                refreshTableGrid(gridId);
                            }


                        },
                        error: function (e)
                        {
                            sessionTimeout(e);
                        }

                    });

                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }},
            {
                text: (labelObject['Cancel'] != null ? labelObject['Cancel'] : 'Cancel'),
                click: function () {
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                    // $("#labeld").empty();

                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}


function checkGridLoadComplete(gridId, tableName, rowscount) {
    var isCompleted = $("#" + gridId).jqxGrid('isBindingCompleted');
    if (isCompleted == false) {
        setTimeout(function () {
            checkGridLoadComplete(gridId, tableName, rowscount)
        }, 100);
//        setTimeout(function () {
//            isCompleted = true;
//        }, 2000);
    } else {
        $("#" + gridId).jqxGrid('addrow', null, {}, 0);
        $("#" + gridId).jqxGrid('selectrow', 0);
        $("#" + gridId).jqxGrid('setcellvalue', 0, tableName + '_HIDDEN', 'INSERT');
        $("#" + gridId).jqxGrid({
            pageSizeOptions: [rowscount + 1],
        });
    }
}

function addRecordToTable(gridId, dbValue, tableName, connObj) {
    $('#' + gridId).jqxGrid({editable: true});
    var rowindexes = $("#" + gridId).jqxGrid('getselectedrowindexes');
    $("#" + gridId).jqxGrid('clearselection');
    $.each(rowindexes, function (i) {
        $("#" + gridId).jqxGrid('selectrow', (rowindexes[i] + 1));
    })

    var datainformation = $("#" + gridId).jqxGrid('getdatainformation');
    var rowscount = datainformation.rowscount;
    var paginginformation = datainformation.paginginformation;
    var pagesize = paginginformation.pagesize;

    if (rowscount <= pagesize) {

        if (rowscount < pagesize) {
            $("#" + gridId).jqxGrid({
                pageSizeOptions: [rowscount],
                virtualmode: false
            });

            try {
                checkGridLoadComplete(gridId, tableName, rowscount);

            } catch (e) {
                var error = e;

            }




        } else if (rowscount == pagesize) {

            $("#" + gridId).jqxGrid('addrow', null, {}, 0);
            $("#" + gridId).jqxGrid('selectrow', 0);

            $("#" + gridId).jqxGrid('setcellvalue', 0, tableName + '_HIDDEN', 'INSERT');

            $("#" + gridId).jqxGrid({
                pageSize: rowscount,
                pageSizeOptions: [rowscount + 1]
            });
            $("#" + gridId).jqxGrid({
                virtualmode: false
            });

//            $("#" + gridId).jqxGrid('refreshdata');
        }


    } else {
        $("#" + gridId).jqxGrid('addrow', null, {}, 0);
        $("#" + gridId).jqxGrid('selectrow', 0);

        $("#" + gridId).jqxGrid('setcellvalue', 0, tableName + '_HIDDEN', 'INSERT');
    }
//    $("#" + gridId).jqxGrid('refreshdata');

}

function commitChangesInTable(gridId, dbValue, tableName, connObj) {
    var updateRowsData = [];
    var insertRowsData = [];

    var lasteditdatafield = $("#last-edit-datafield").val();
    var lasteditrow = $("#last-edit-row").val();

    var editable = $("#" + gridId).jqxGrid('endcelledit', lasteditrow, lasteditdatafield, false);


    var rowindexes = $("#" + gridId).jqxGrid('getselectedrowindexes');
    for (var i = 0; i < rowindexes.length; i++) {
        var rowData = $("#" + gridId).jqxGrid('getRowData', rowindexes[i]);
        if (rowData[tableName + '_HIDDEN'] == 'UPDATE') {
            updateRowsData.push(rowData);
        } else if (rowData[tableName + '_HIDDEN'] == 'INSERT') {
            insertRowsData.push(rowData);
        }
    }

    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'insertRecordsToTable',
        cache: false,
        data: {
            connObj: connObj,
            tableName: tableName,
            updateRowsData: JSON.stringify(updateRowsData),
            insertRowsData: JSON.stringify(insertRowsData),
            updateDataInfo: JSON.stringify(updateDataInfo),
        },
        success: function (response) {
            if (response != null && response != "") {
                var insertMessage = response['insertMessage'];
                var updateMessage = response['updateMessage'];
                var msg = ((insertMessage != null) ? insertMessage : "") + "\n<br>" + ((updateMessage != null) ? updateMessage : "");
                showMesg(msg);
//                $('#' + gridId).jqxGrid({editable: false});
                refreshTableGrid(gridId);
            }

//            $(".visionEditOptions").css("display", "none");
            $("#last-edit-datafield").val("");
            $("#last-edit-row").val("");


        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });


//    $('#' + gridId).jqxGrid({editable: false});
}

function showEditTableOptions(gridId) {
    $(".visionEditOptions_" + gridId).toggle();
    if ($(".visionEditOptions_" + gridId).is(':visible')) {
        $("#editTableIcon_" + gridId).attr("title", "Stop Editing");
        $('#' + gridId).jqxGrid({editable: true});
    } else {
        $("#editTableIcon_" + gridId).attr("title", "Edit Table");
        $('#' + gridId).jqxGrid({editable: false});
        refreshTableGrid(gridId);

    }

}

function createNewSaveJobFolder() {
    ajaxStart();
    var selectedItem = $('#avaialableJobsTree').jqxTree('selectedItem');
    var selectedItemElement = selectedItem.element;
    var parentFolderId = $($(selectedItemElement).find('div.visionEtlTreeFolders')[0]).attr("id");
    var folderValue = selectedItem.label;
    var treeLevel = selectedItem.level;


    var folderObj = {};
    folderObj['parentFolder'] = folderValue;
    folderObj['parentFolderId'] = parentFolderId;
    folderObj['treeLevel'] = parseInt(treeLevel);
    var jobDetails = {};
    jobDetails['jobType'] = "ETL";
    jobDetails['treeValue'] = "PARENT_ID";
    jobDetails['jobDetail'] = "NewFolder_Name";
    var labelObject = {};
    $("#dialog").html("<Span>New Folder Name</span><br><input  type='text' id='folderName'/>");
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        width: 300,
        height: 135,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var folderName = $("#folderName").val();
                    $("#folderNameHidden").val(folderName);
                    if (folderName != null && folderName != '' && folderName != undefined) {
                        $.ajax({
                            type: "post",
                            traditional: true,
                            dataType: 'json',
                            url: "saveFolderName",
                            cache: false,
                            data: {
                                folderName: folderName,
                                jobDetails: JSON.stringify(jobDetails),
                                folderObj: JSON.stringify(folderObj)
                            },
                            success: function (response) {
                                ajaxStop();
//                                showSavedJobs();
                                $('#avaialableJobsTree').jqxTree('collapseItem', selectedItemElement);
                                $('#avaialableJobsTree').jqxTree('expandItem', selectedItemElement);

                                try {
                                    response = JSON.parse(response);
                                } catch (e) {
                                }
                            }
                        });
                    }
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }
            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });

}
function deleteFolder() {
    ajaxStart();
    var selectedItem = $('#avaialableJobsTree').jqxTree('selectedItem');
    var folderName = selectedItem.label;
    var folderId = $($(selectedItem.element).find('div.visionEtlTreeFolders')[0]).attr("id");
    var level = selectedItem.level;

    var parentFolderElement = selectedItem.element.parentElement.parentElement;
    var parentFolderItem = $('#avaialableJobsTree').jqxTree('getItem', parentFolderElement);

    if (folderName != null && folderName != 'Saved Jobs') {
        $("#dialog").html("Are you sure you want to delete the folder??");
        $("#dialog").dialog({
            title: (labelObject['Confirmation'] != null ? labelObject['Confirmation'] : 'Confirmation'),
            modal: true,
            height: 'auto',
            minWidth: 300,
            maxWidth: 'auto',
            fluid: true,
            buttons: [{
                    text: (labelObject['Yes'] != null ? labelObject['Yes'] : 'Yes'),
                    click: function () {
                        $.ajax({
                            type: "post",
                            traditional: true,
                            dataType: 'json',
                            cache: false,
                            url: "deleteETLFolder",
                            data: {
                                folderName: folderName,
                                folderId: folderId,
                                level: level,
                                jobType: 'ETL'
                            },
                            success: function (response) {
                                ajaxStop();
//                                showSavedJobs();

                                try {
                                    response = JSON.parse(response);

                                } catch (e) {
                                }


                                $('#avaialableJobsTree').jqxTree('collapseItem', parentFolderElement);
                                $('#avaialableJobsTree').jqxTree('expandItem', parentFolderElement);


                            }
                        });
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }},
                {
                    text: (labelObject['No'] != null ? labelObject['No'] : 'No'),
                    click: function () {
                        $(this).html("");
                        $(this).dialog("close");
                        $(this).dialog("destroy");
                    }
                }],
            open: function () {
                $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                $(this).closest(".ui-dialog").find(".ui-button").eq(2).addClass("dialogno");
                $(".visionHeaderMain").css("z-index", "999");
                $(".visionFooterMain").css("z-index", "999");
            },
            beforeClose: function (event, ui)
            {
                $(".visionHeaderMain").css("z-index", "99999");
                $(".visionFooterMain").css("z-index", "99999");
            }
        });
    } else if (folderName == 'Saved Jobs') {
        showMesg("You can't delete saved jobs folder");
    }
}

function selectFolder($this) {
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'fetchSavedFolders',
        cache: false,
        data: {
            parentFolder: 'Saved Jobs',
            parentId: 'C8DE75F32D56288CE0554B610B40A4A3'
        },
        success: function (response) {
            ajaxStop();
            var availableJobshtmlStr = response['scheduledJobsArray'];
            var source =
                    {
                        datatype: "json",
                        datafields: [
                            {name: 'id'},
                            {name: 'parentid'},
                            {name: 'text'},
                            {name: 'icon'},
                            {name: 'value'},
                            {name: 'datatype'}
                        ],
                        id: 'id',
                        icon: 'icon',
                        localdata: availableJobshtmlStr
                    };
            var dataAdapter = new $.jqx.dataAdapter(source);
            dataAdapter.dataBind();
            var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{name: 'text', map: 'label'}]);

            $("#dialog1").html("<div class='treeSearchInputDiv'>\n\
    <input id='treeSearchValue' type='text' class='treeSearchValueInput' placeholder='Search'/>\n\
    <img id='treeNodeSearchIconId' src='images/icon.png' style='height:12px;width:12px;cursor:pointer;'\n\
 onclick=searchTreeNode('folderTree')  /><div id='searchTreeErrorMesg' style='color:red;'>\n\
</div></div>\n\
<div id='folderTree' class='columnMappingTree'></div>");

            $("#dialog1").dialog({
                title: (labelObject['Select Folder'] != null ? labelObject['Select Folder'] : 'Select Folder'),
                modal: true,
                width: 300,
                height: 300,
                fluid: true,
                buttons: [{
                        text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                        click: function () {
                            var selectedItem = $('#folderTree').jqxTree('selectedItem');
                            if (selectedItem != null) {
                                $($this).parents("td").find("input").val(selectedItem['label']);
                                $($this).parents("td").find("input").attr("folderId", selectedItem['value']);
                                $($this).parents("td").find("input").attr("title", selectedItem['label']);
                            }
                            $(this).html("");
                            $(this).dialog("close");
                            $(this).dialog("destroy");
                        }
                    }],

                open: function () {
                    $('#folderTree').jqxTree({source: records, width: 300,
                        toggleMode: 'click', theme: 'energyblue',
                        enableHover: true,
                        incrementalSearch: true,
                        keyboardNavigation: true,
                    });
                    $("#treeSearchValue").keyup(function (event) {
                        if (event.keyCode === 13) {
                            $("#treeNodeSearchIconId").click();
                        }
                    });
                    $('#folderTree').jqxTree('expandItem', $("#folderTree").find('li:first')[0]);

                },
                beforeClose: function (event, ui)
                {
                    $(".visionHeaderMain").css("z-index", "99999");
                    $(".visionFooterMain").css("z-index", "99999");
                }, close: function (event, ui)
                {
                    $(this).html("");
                    $(this).dialog("close");
                }
            });
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function showSavedJobs(newJobId) {
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'fetchSavedJobs',
        cache: false,
        data: {
            parentFolder: "Saved Jobs",
            parentFolderId: "C8DE75F32D56288CE0554B610B40A4A3"
        },

        success: function (response) {
            ajaxStop();
            var availableJobshtmlStr = response['availableJobshtmlStr'];
            if (availableJobshtmlStr != null && availableJobshtmlStr != '') {
                $("#availableJobsId").html(availableJobshtmlStr);
                $('#avaialableJobsTree').jqxTree({height: 'auto', width: '98%'});
                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
                $('#avaialableJobsTree').jqxTree('expandItem', $("#avaialableJobsTree")[0]);
                $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
                $(currentJobItem).addClass("selectJqxTreeItem");
                $('#avaialableJobsTree').on('expand', function (event) {
                    var parentItem = $('#avaialableJobsTree').jqxTree('getItem', event.args.element);
                    var $element1 = $(event.args.element);
                    var loaderItem1 = null;
                    var children = $element1.find('ul:first').children();

                    $.each(children, function () {
                        var item = $('#avaialableJobsTree').jqxTree('getItem', this);
                        loaderItem1 = item;
                        $('#avaialableJobsTree').jqxTree('removeItem', loaderItem1.element);
                    });

                    var selectedItem = $('#avaialableJobsTree').jqxTree('getItem', event.args.element);
                    var selectedItemElement = selectedItem.element;
                    var parentFolder = selectedItem.label;
                    var parentFolderId = $($(selectedItem.element).find('div.visionEtlTreeFolders')[0]).attr("id");
                    var level = selectedItem.level;
//                    if (parentFolder != 'Saved Jobs') {
                    $.ajax({
                        type: "post",
                        traditional: true,
                        dataType: 'json',
                        url: "getFolderData",
                        cache: false,
                        data: {
                            parentFolder: parentFolder,
                            parentFolderId: parentFolderId
                        },
                        success: function (data) {
                            if (data != null && data != '' && data != undefined) {
                                var availableJobsArray = data['availableJobsArray'];
                                var availableFoldersArray = data['availableFoldersArray'];

                                if (availableFoldersArray != null && availableFoldersArray.length > 0) {
                                    for (var i = 0; i < availableFoldersArray.length; i++) {
                                        var folderString = availableFoldersArray[i];
                                        try {
                                            $('#avaialableJobsTree').jqxTree('addTo', {
                                                html: folderString
                                            }, selectedItemElement);
                                        } catch (e) {
                                            var erroe = e;
                                        }


                                    }
                                    var treeItems = $("#avaialableJobsTree").jqxTree('getItems');
                                    var childItems = [];
                                    $.each(treeItems, function (i) {
                                        if (this['level'] == selectedItem['level'] + 1) {
                                            var parentFolderItem = $("#avaialableJobsTree").jqxTree('getItem', this.parentElement);
                                            if (parentFolderItem['label'] == selectedItem['label']) {
                                                childItems.push(this);
                                            }
                                        }
                                    });
                                    $.each(childItems, function (i) {
                                        var childElement = this.element;
                                        $('#avaialableJobsTree').jqxTree('addTo', {html: "<div>loading...</div>"}, childElement);
                                    })

                                }
                                $('#avaialableJobsTree').jqxTree('refresh');
                                for (var i = 0; i < availableJobsArray.length; i++) {
                                    var jobItemString = availableJobsArray[i];
                                    try {
                                        $('#avaialableJobsTree').jqxTree('addTo', {
                                            html: jobItemString
                                        }, selectedItemElement);
                                    } catch (e) {
                                        var erroe = e;
                                    }

                                }
                            }
                        },
                        error: function (e) {
                            console.log(e);
                            sessionTimeout(e);
                            stopLoader();
                        }
                    });
//                    }
                });

            }


            var predefinedJobshtmlStr = response['predefinedJobshtmlStr'];
            if (predefinedJobshtmlStr != null && predefinedJobshtmlStr != '') {
                $("#preDefinedJobs").html(predefinedJobshtmlStr);
                $('#predefinedJobsTree').jqxTree({height: '98%', width: '98%'});
//                $('#predefinedJobsTree').jqxTree('expandAll');
                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
                $("#predefinedJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
                $(currentJobItem).addClass("selectJqxTreeItem");
//                $('#predefinedJobsTree').jqxTree('expandAll');
            }


            var dataModellerJobshtmlStr = response['dataModellerJobshtmlStr'];
            if (dataModellerJobshtmlStr != null && dataModellerJobshtmlStr != '') {
                $("#dataModellerJobsDiv").html(dataModellerJobshtmlStr);
                $('#dataModellerJobsTree').jqxTree({height: '98%', width: '98%'});
                $('#dataModellerJobsTree').jqxTree('expandAll');
                var currentJobItem = $("#" + newJobId).parents("li:first").find("div:first")[0];
                $("#dataModellerJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
                $(currentJobItem).addClass("selectJqxTreeItem");
//                $('#dataModellerJobsTree').jqxTree('expandAll');
            }
            // $(".jqx-tree-item").addClass("selectJqxTreeItem");


//                try{
//                    $('#avaialableJobsTree').jqxTree('destroy');
//                }catch(e){}


//            }


        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });

}


function onSubmitChildJob() {
    var jobId = $('#currentGroupJobId').val();
    var jobDescr = $('#currentSelectedGroupJobName').val();
    $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
    $("#" + jobId).parent().addClass("selectJqxTreeItem");
    if (jobId != null && jobId != 'undefined' && jobId != '' && jobDescr != null && jobDescr != 'undefined' && jobId != '') {
        $("#currentJobId").val(jobId);
        $("#currentJobName").val(jobDescr);
        showLoader();
        var data = {
            jobDescr: jobDescr,
            jobId: jobId

        };
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: 'getSavedJobData',
            cache: false,
            data: data,
            success: function (response) {
                stopLoader();
//                switchETLDesignTabs('li_ChildJob', 'childJobDiv');

                switchETLDesignTabs("li_designView", "contentSplitter"); // -----code start
                var flowChartData = JSON.parse(response['flowChartData']);
                $("#" + flowChartWorkSpaceId).remove();
                $("#feedHeader").append('<div  id="flowchartworkSourcesspace" class="flowchart-example-container"></div>');
                $('#' + flowChartWorkSpaceId).flowchart({
                    linkWidth: 2,
                    defaultSelectedLinkColor: '#000055',
                    grid: 10,
                    distanceFromArrow: 0,
                    multipleLinksOnInput: true,
                    multipleLinksOnOutput: true,
                    defaultSelectedLinkColor: 'red',
                    onOperatorContextMenu: function (operatorId) {
                        console.log("operatorId:::" + operatorId);
                        openOpeartorContextMenu(operatorId);
                        return true;
                    },
                });
                $('#' + flowChartWorkSpaceId).flowchart({

                    onLinkCreate: function (linkId, linkData) {

                        var fromOperatorId = linkData['fromOperator'];
                        var toOperatorId = linkData['toOperator'];
                        var fromOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', fromOperatorId);
                        var connectedTo = fromOperatorData['connectedTo'];
                        connectedTo = (connectedTo != null) ? connectedTo : [];
                        if (connectedTo.indexOf(toOperatorId) == -1) {
                            connectedTo.push(toOperatorId)
                        }

                        fromOperatorData['connectedTo'] = connectedTo;
                        $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', fromOperatorId, fromOperatorData);
                        var toOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', toOperatorId);
                        var connectedFrom = toOperatorData['connectedFrom'];
                        connectedFrom = (connectedFrom != null) ? connectedFrom : [];
                        if (connectedFrom.indexOf(fromOperatorId) == -1) {
                            connectedFrom.push(fromOperatorId)
                        }

                        toOperatorData['connectedFrom'] = connectedFrom;
                        if (toOperatorData['component'] == 'Y') {
                            toOperatorData['tableName'] = "ZZ_TEMP_" + new Date().getTime();
                            if (toOperatorData['connObj'] == null) {
                                if (toOperatorData['connObj'] == null) {
                                    toOperatorData['connObj'] = savedDBData["Current_V10"];
                                }
                            }
                        }
                        var originalSources = (toOperatorData['originalSources'] != null) ? toOperatorData['originalSources'] : [];
                        var fromTable = (fromOperatorData['tableName'] != null) ? fromOperatorData['tableName'] : fromOperatorData['statusLebel'];
                        if (originalSources.indexOf(fromTable) == -1) {
                            originalSources.push(fromTable);
                        }
                        toOperatorData['originalSources'] = originalSources;

                        var originalSourceOp = (toOperatorData['originalSourceOp'] != null) ? toOperatorData['originalSourceOp'] : [];
                        if (originalSourceOp.indexOf(fromOperatorId) == -1) {
                            originalSourceOp.push(fromOperatorId);
                        }
                        toOperatorData['originalSourceOp'] = originalSourceOp;
                        $("#" + flowChartWorkSpaceId).flowchart('setOperatorData', toOperatorId, toOperatorData);
                        //            setToOpDblCLickFuncName(fromOperator, toOperator);
                        return true;
                    },
                    onAfterChange: function (changeType) {

                        if (!operatorDoublClick) {
                            trfmRulesChanged = true;
                            console.error("trfmRulesChanged : " + trfmRulesChanged);
                            return true;
                        }
                    },
                    onOperatorSelect: function (changeType) {
                        $(document).find("input").blur();
                        return true;

                    },
                    onLinkSelect: function (changeType) {
                        $(document).find("input").blur();
                        return true;
                    }
                });
                var count = 0;
                var OperatorsData = {};
                var linksData = {};
                try {
                    for (var key in flowChartData.operators) {

                        OperatorsData[count] = flowChartData.operators[key];
                        for (var i in flowChartData.links) {
                            if (parseInt(key) == flowChartData.links[i].fromOperator) {
                                flowChartData.links[i].fromOperator = count;
                            }
                            if (parseInt(key) == flowChartData.links[i].toOperator) {
                                flowChartData.links[i].toOperator = count;
                            }

                        }

                        count = count + 1;
                    }
                    for (var key in OperatorsData) {
                        $('#' + flowChartWorkSpaceId).flowchart('addOperator', OperatorsData[key]);
                    }
                } catch (e) {
                }



                var count = 0;
                //   try {

                for (var key in flowChartData.links) {

                    linksData[count] = flowChartData.links[key];
                    count = count + 1;
                }
                for (var key in linksData) {
                    $('#' + flowChartWorkSpaceId).flowchart('addLink', linksData[key]);
                }

                $(".flowchart-operator-connector-label").hide();
                $(".flowchart-operator-title").hide();
                $(".visionMapOperator").removeClass("visionOpLabelDiv");
                // $('#'+flowChartWorkSpaceId).flowchart('setData', flowChartData);
                $("#dataMigrationTabs").remove();
                $("#normalizeOptionsTabs").remove();
                $("#deNormalizeOptionsTabs").remove();
                var mapIcons = $(".visionMapOperator");
                $.each(mapIcons, function (index) {
                    $(this).attr('job-id', jobId);
                    $(this).attr('job-name', jobDescr);
                });

                $('#dataMigrationTabs :input').keyup(function (event) {
                    if (event.target.nodeName == 'INPUT') {
                        var $this = $(event.target);
                        $this.attr("value", event.target.value);
                        $this.attr("title", event.target.value);
                        $this.val(event.target.value);
                    }

                });
                previousOperatorId = null;
                prevTargetOperatorId = null;
                $("#emptyJobName").val("");
                $("#emptyJobId").val("");
                $("#currentTrnsOpId").val("");
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    } else {
        showMesg("No job Mapped to these operator");
    }

}

function showChildJob(selectedOperatorId) {
    var jobId;
    var jobDescr;
    if (selectedOperatorId != null && selectedOperatorId != '' && selectedOperatorId != undefined) {
        var selectedOperatorData = $("#" + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
        jobId = selectedOperatorData.jobId;
        jobDescr = selectedOperatorData.jobName;
    }
    $('#currentGroupJobId').val(jobId);
    $('#currentSelectedGroupJobName').val(jobDescr);
    $('#formJobId').val(jobId);
    $('#formJobName').val(jobDescr);
//    $('#formJobHidden').val('Y');
//    $('#formJobFlag').val('Y');
    $('#formGlobalTreeObj').val(JSON.stringify(globalTreeObj));
//    $("#childJobForm").submit();

    $("#avaialableJobsTree").find(".selectJqxTreeItem").removeClass("selectJqxTreeItem");
    $("#" + jobId).parent().addClass("selectJqxTreeItem");
    var getOnclickAttr = $("#" + jobId).parent().children().attr('ondblclick');
    var strarray = getOnclickAttr.split(',');
    var folderName = strarray[3].replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '');
    var folderId = strarray[4].replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '');
//    var folderId = strarray[4].replace('"', '');

    if (jobId != null && jobId != 'undefined' && jobId != '' && jobDescr != null && jobDescr != 'undefined' && jobId != '') {
        $("#currentJobId").val(jobId);
        $("#currentJobName").val(jobDescr);
        showLoader();
        var data = {
            jobDescr: jobDescr,
            jobId: jobId

        };
        $.ajax({
            type: "post",
            traditional: true,
            dataType: 'json',
            url: 'getSavedJobData',
            cache: false,
            data: data,
            success: function (response) {
                stopLoader();
//                switchETLDesignTabs('li_ChildJob', 'childJobDiv');


                switchETLDesignTabs("li_designView", "contentSplitter"); // -----code start
                var flowChartData = JSON.parse(response['flowChartData']);
                var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');


                var flowChartIndex = 'workSpace_' + jobId;
                var length = $('#flowChartTabs').jqxTabs('length');
                var openedTab = false;
                for (var i = 0; i < length; i++) {
                    var title = $('#flowChartTabs').jqxTabs('getTitleAt', i);
                    if (title != null && title == jobDescr) {
                        $('#flowChartTabs').jqxTabs('select', i);
                        openedTab = true;
                        $("#" + flowChartIndex).remove();
                        var selectedItemIndex = $('#flowChartTabs').jqxTabs('selectedItem');
                        var htmlDiv = '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                        $('#flowChartTabs').jqxTabs('setContentAt', selectedItemIndex, htmlDiv);
                        break;
                    }
                }
                if (!openedTab) {
                    var divStr = ''
                    divStr += '<div  style="display: flex;float:left;margin-top:5px;">'
                    divStr += '</div>'
                    divStr += '<div  id="workSpace_' + jobId + '" class="flowchart-example-container" jobId="' + jobId + '" jobName="' + jobDescr + '" folderId "' + folderId + '" folderName="' + folderName + '" ></div>';
                    divStr += '';
                    $('#flowChartTabs').jqxTabs('showAllCloseButtons');
                    $("#flowChartTabs").find("li.jqx-tabs-title").find("div.jqx-tabs-close-button").css("background-image", "url(images/close.png)");
                    $("#flowChartTabs").find("li.jqx-tabs-title-selected-top").find("div.jqx-tabs-close-button").css("background-image", "url(images/close_white.png)");
                    $('#flowChartTabs').jqxTabs('addLast', jobDescr, divStr);
                }

                $("#workSpace_" + jobId).flowchart({
                    linkWidth: 2,
                    defaultSelectedLinkColor: '#000055',
                    grid: 10,
                    distanceFromArrow: 0,
                    multipleLinksOnInput: true,
                    multipleLinksOnOutput: true,
                    defaultSelectedLinkColor: 'red',
                    onOperatorContextMenu: function (operatorId) {
                        console.log("operatorId:::" + operatorId);
                        openOpeartorContextMenu(operatorId);
                        return true;
                    },
                });
                $("#workSpace_" + jobId).flowchart({

                    onAfterChange: function (changeType) {

                        if (!operatorDoublClick) {
                            trfmRulesChanged = true;
                            console.error("trfmRulesChanged : " + trfmRulesChanged);
                            return true;
                        }
                    }, onOperatorSelect: function (changeType) {
                        $(document).find("input").blur();
                        return true;
                    },
                    onLinkSelect: function (changeType) {
                        $(document).find("input").blur();
                        return true;
                    }
                });
                var count = 0;
                var OperatorsData = {};
                var linksData = {};
                try {
                    for (var key in flowChartData.operators) {

                        OperatorsData[count] = flowChartData.operators[key];
                        for (var i in flowChartData.links) {
                            if (parseInt(key) == flowChartData.links[i].fromOperator) {
                                flowChartData.links[i].fromOperator = count;
                            }
                            if (parseInt(key) == flowChartData.links[i].toOperator) {
                                flowChartData.links[i].toOperator = count;
                            }

                        }

                        count = count + 1;
                    }
                    for (var key in OperatorsData) {
                        $("#workSpace_" + jobId).flowchart('addOperator', OperatorsData[key]);
                    }
                } catch (e) {
                }



                var count = 0;
                //   try {

                for (var key in flowChartData.links) {

                    linksData[count] = flowChartData.links[key];
                    count = count + 1;
                }
                for (var key in linksData) {
                    $("#workSpace_" + jobId).flowchart('addLink', linksData[key]);
                }

                $(".flowchart-operator-connector-label").hide();
                $(".flowchart-operator-title").hide();
                $(".visionMapOperator").removeClass("visionOpLabelDiv");
                // $('#flowchartworkSourcesspace').flowchart('setData', flowChartData);
                $("#dataMigrationTabs").remove();
                $("#normalizeOptionsTabs").remove();
                $("#deNormalizeOptionsTabs").remove();
                var mapIcons = $(".visionMapOperator");
                $.each(mapIcons, function (index) {
                    $(this).attr('job-id', jobId);
                    $(this).attr('job-name', jobDescr);
                });

                $('#dataMigrationTabs :input').keyup(function (event) {
                    if (event.target.nodeName == 'INPUT') {
                        var $this = $(event.target);
                        $this.attr("value", event.target.value);
                        $this.attr("title", event.target.value);
                        $this.val(event.target.value);
                    }

                });
                previousOperatorId = null;
                prevTargetOperatorId = null;
                $("#emptyJobName").val("");
                $("#emptyJobId").val("");
                $("#currentTrnsOpId").val("");
            },
            error: function (e)
            {
                sessionTimeout(e);
            }

        });
    } else {
        showMesg("No job Mapped to these operator");
    }




}


//function showChildJob(event, selectedOperatorId) {
//    var selectedOperatorData = $('#' + flowChartWorkSpaceId).flowchart('getOperatorData', selectedOperatorId);
//    var jobId = selectedOperatorData.jobId;
//    var jobDescr = selectedOperatorData.jobName;
//    $('#currentGroupJobId').val(jobId);
//    $('#currentSelectedGroupJobName').val(jobDescr);
//    $('#formJobId').val(jobId);
//    $('#formJobName').val(jobDescr);
//    $('#formJobHidden').val('Y');
//    $('#formJobFlag').val('Y');
//    $("#childJobForm").submit();
//
//}


function alterTable(DBValue, parentkey, connectionObj) {

//    var DBValue;
    var tableName;
    var connName;
//    var parentkey;
    var extTreeParams = $("#extTreeParams").val();
    var columnsObj = globalTreeObj['treeColumnObj'];
    var target = $("#jqxtabs").find(".visionSelectedObject")[0];
    if (!(parentkey != null && parentkey != '' && DBValue != null && DBValue != '')) {
        if (target != null) {
            tableName = target.textContent.trim();
            var div = $(target).parents('div.visionObjectsListDiv')[0];
            var divId = div.id;

            parentkey = target.textContent.trim().toUpperCase();

            DBValue = divId.split("-")[1];
            var liItems = $("#savedConnections").find("li :contains('" + DBValue + "')");
            $.each(liItems, function (index) {
                var liItem = $('#savedConnections').jqxTree('getItem', this);
                if (liItem != null && liItem.level == 3 && liItem.value == DBValue) {

                    var connItem = this.parentElement.parentElement;
                    var selectedConnItem = $('#savedConnections').jqxTree('getItem', connItem);
                    if (selectedConnItem != null && selectedConnItem.level == 2) {
                        connName = selectedConnItem.value;
                    }
                    stopLoader();
                    return false;
                }

            })

        } else {
            var parentItem = $('#savedConnections').jqxTree('getSelectedItem');
            tableName = parentItem.label;
            parentkey = parentItem.value
            var $element = $(parentItem.element);

            var dbItem = parentItem.element.parentElement.parentElement.parentElement.parentElement;

            //var dbItemvalue = parentItem.element.parentElement.parentElement.parentElement.parentElement.children[2].title;

            var selectedDBItem = $('#savedConnections').jqxTree('getItem', dbItem);
            DBValue = selectedDBItem['value'];

            var connItem = dbItem.parentElement.parentElement;
            var selectedConnItem = $('#savedConnections').jqxTree('getItem', connItem);
            if (selectedConnItem.level == 2) {
                connName = selectedConnItem.value;
            }

        }
    }

    if (!(tableName != null && tableName != '')) {
        tableName = parentkey;
    }

    if (connectionObj == null || connectionObj == 'undefined') {
        if (savedDBData != null && !jQuery.isEmptyObject(savedDBData))
        {
            var conObj = savedDBData[DBValue];
            if (conObj != null && !jQuery.isEmptyObject(conObj)) {
                connectionObj = conObj;
            }

        }
    }
    showLoader();
    $.ajax({
        type: "post",
        traditional: true,
        dataType: 'json',
        url: 'alterTable',
        cache: false,
        data: {
            tableName: tableName,
            connectionName: DBValue,
            connObj: JSON.stringify(connectionObj)
        },
        success: function (response) {
            stopLoader();
            if (response != null) {

                var dataArray = response['data'];
                var dataTypesList = response['dataTypesList'];
                var pkColsList = response['pkColsList'];
                $("#alterTablePKList").val(pkColsList);
                var divStr = "<div id = 'tableAlterDiv'>"
                        + "<div id='alterTableOptions' class='visionAlterTableOptions' style='display:flex;'>"
                        + "<img class='visionEditOptions' src='images/add_icon.png' style='display:block; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=addRecordToAlterTableGrid() title='Add Column'>"
                        + "<img class='visionEditOptions'  src='images/commit_icon.png' style='display:block; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=commitAlterTable('" + tableName + "','" + JSON.stringify(connectionObj) + "') title='Commit'>"
                        + "<img class='visionEditOptions'  src='images/delete_icon.png' style='display:block; width:18px;height: 18px;cursor:pointer;padding-left:3px;margin-right:5px;' onclick=deleteColAlterTable('" + tableName + "','" + JSON.stringify(connectionObj) + "') title='Delete COlumn'>"
                        + "</div>"

// edit connection start
//                divStr += "<div id='sqlToTableNameDiv'>"
//                        + "<table class=\"visionEtlCreateSQLDS\" id='sqlToTableColumnsTableName' style='width: 100%;' border='1'>"
//                        + "<tr>"
//                        + "<td>Data Source:</td>"
//                        + "<td>"
//                        + "<input id=\"sqlToDataSourceName\" class=\"visionDSMappingInput\" type=\"text\""
//                        + " value=\"" + connectionName + "\""
////                    + " data-conobjstr='" + ((createTableObj != null && !createTableObj.isEmpty()) ? createTableObj.get("dataSourceObj") : "") + "'"
//                        + " data-conobjstr='" + JSON.stringify(connectionObj) + "'"
//                        + " data-tosystype='" + connectionObj["CONN_CUST_COL1"] + "' "
//                        + " readonly=\"true\">"//dataSourceObj
//                        + "<img src=\"images/tree_icon.svg\" class=\"visionETLColMapImage \""
//                        + " onclick=\"selectFunColumnValue(this,'ALL_SCHEMA','Data Source')\" style=\"\">"
//                        + "</td>"
//                        + "<td>Table Name:</td>"
//                        + "<td>"
//                        + "<input class='' type='text' id='sqlToTableName' value='" + tableName + "'/>"
//                        + "</td>"
//                        + "</table>"
//                        + "</div>"
// edit connection end

                        + "<div id='tableAlterGrid'></div>"
                        + "</div>";

                $("#dialog1").html(divStr);

                $("#dialog1").dialog({
                    title: (labelObject['Alter Table'] != null ? labelObject['Alter Table'] : 'Alter Table'),
                    modal: true,
                    width: 1013,
                    minHeight: 300,
                    maxHeight: 600,
                    autoheight: true,
                    fluid: true,
//                    buttons: [{
//                            text: (labelObject['Alter'] != null ? labelObject['Alter'] : 'Alter'),
//                            click: function () {
//                                $(this).html("");
//                                $(this).dialog("close");
//                                $(this).dialog("destroy");
//                            }
//
//                        }],
                    open: function () {
                        var source =
                                {
                                    localdata: dataArray,
                                    datatype: "array",
                                    loadComplete: function (data)
                                    {
//                                        


                                    },
                                    rendered: function ()
                                    {

                                    }
//                                    , addrow: function (rowid, rowdata, position, commit) {

//                                        $("#alterTablecolumnName_"+rowid).attr("initval","newRow_" + rowid)
//                                        var aaa = $("#alterTablecolumnName_"+rowid).attr("initval")
//                                        $("#tableAlterGrid").jqxGrid('setcellvalue', rowid, 'columnName', 'newRow_' + rowid);
//                                        commit(true);
//                                    }

                                };

                        var dataAdapter = new $.jqx.dataAdapter(source);


                        var inputRenderer = function (row, columnfield, value, defaulthtml, columnproperties) {//overflow-y:scroll;height:100%;
                            if (columnfield == 'columnName') {
                                var html = defaulthtml;
                                if (value == null || value == "") {
                                    html = '<input type="text" id="alterTablecolumnName_' + row + '" dataField="' + columnfield + '" initVal="newRow_' + row + '" value="" style="width:100%;height:100%;" >'
                                } else {
                                    html = '<input type="text" id="alterTablecolumnName_' + row + '" dataField="' + columnfield + '" initVal="' + value + '" value="' + value + '" style="width:100%;height:100%;" >'

                                }
                                return html;
                            }
                            if (columnfield == 'primaryKey') {
                                if (value == "Y") {
                                    return '<input id="alterTablePrimaryKey_' + row + '" dataField="' + columnfield + '" type="checkbox" initVal="' + value + '" value="' + value + '" checked>';
                                } else {
                                    return '<input id="alterTablePrimaryKey_' + row + '" dataField="' + columnfield + '" type="checkbox" initVal="' + value + '" value="' + value + '">';
                                }
                            }
                            if (columnfield == 'columnsize') {
                                return '<input id="alterTableColumnSize_' + row + '" dataField="' + columnfield + '" style="width:100%;height:100%;" type="number" initVal="' + value + '" value="' + value + '" min="0" max="4000">';
                            }
//                            if (columnfield == 'byteOrChar') {
//                                
//                                html = '<select name="byteOrChar" id="alterTablebyteOrChar_'+row+'" dataField="' + columnfield + '" initVal="' + value + '" style="width:100%;height:100%;" >';
//                                var byteOrCharList = ["Byte","Char"];
//                                $.each(byteOrCharList, function(i){
//                                    if (byteOrCharList[i]==value){
//                                         html+='<option value="'+byteOrCharList[i]+'" selected >'+byteOrCharList[i]+'</option>';
//                                    } else {
//                                         html+='<option value="'+byteOrCharList[i]+'">'+byteOrCharList[i]+'</option>';
//                                    }
//                                 
//                                });
//                                html+='</select>';
//                                return html;
//                            }
                            if (columnfield == 'precision') {
                                return '<input id="alterTablePrecision_' + row + '" dataField="' + columnfield + '" style="width:100%;height:100%;" type="number" initVal="' + value + '" value="' + value + '" min="0" max="38">';
                            }
                            if (columnfield == 'scale') {
                                return '<input id="alterTableScale_' + row + '" dataField="' + columnfield + '" style="width:100%;height:100%;" type="number" initVal="' + value + '" value="' + value + '" min="-84" max="127">';
                            }
                            if (columnfield == 'notNull') {
                                if (value == "NULL") {
                                    return '<input id="alterTableNotnull_' + row + '" dataField="' + columnfield + '" type="checkbox" initVal="' + value + '" value="' + value + '" >';
                                } else {
                                    return '<input id="alterTableNotnull_' + row + '" dataField="' + columnfield + '" type="checkbox" initVal="' + value + '" value="' + value + '" checked>';
                                }
                            }
                            if (columnfield == 'defaultValue') {
                                var html = defaulthtml;
                                html = '<input type="text" id="alterTabledefaultVal_' + row + '" dataField="' + columnfield + '" initVal="' + value + '" value="' + value + '" style="width:100%;height:100%;" >'
                                return html;
                            }

                            if (columnfield == 'datatypeName') {
                                var html = defaulthtml;
                                html = '<select name="dataTypeNames" id="alterTableDataType_' + row + '" dataField="' + columnfield + '" initVal="' + value + '" style="width:100%;height:100%;" >';

                                $.each(dataTypesList, function (i) {
                                    if (dataTypesList[i] == value) {
                                        html += '<option value="' + dataTypesList[i] + '" selected >' + dataTypesList[i] + '</option>';
                                    } else {
                                        html += '<option value="' + dataTypesList[i] + '">' + dataTypesList[i] + '</option>';
                                    }

                                });
                                html += '</select>';
                                return html;
                            }


                        }



                        var i = 0;
                        $("#tableAlterGrid").jqxGrid(
                                {
                                    width: "100%",
                                    source: source,
                                    autoheight: true,
                                    editable: true,
                                    sortable: true,
                                    columnsResize: true,
                                    columnsReorder: true,
                                    enableHover: true,
                                    enableBrowserSelection: true,
                                    filterable: true,
//                                    selectionmode: 'singleRow',
                                    selectionmode: 'checkbox',
                                    handlekeyboardnavigation: function (event)
                                    {

                                        var keyis = event.key;
                                        if (keyis.length == 1) {
//                                            var value = $(event.target).val();
//                                            $(event.target).val(value + keyis);
//                                            
                                            var cursorPos = $(event.target).prop('selectionStart');
                                            var v = $(event.target).val();
                                            var textBefore = v.substring(0, cursorPos);
                                            var textAfter = v.substring(cursorPos, v.length);
                                            $(event.target).val(textBefore + $(this).val() + textAfter);

                                            return true;
                                        }
//                                       

                                    },
                                    columns: [
                                        {text: 'Column Name', datafield: 'columnName', width: 200, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'PK', datafield: 'primaryKey', width: 100, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'Datatype', datafield: 'datatypeName', width: 100, editable: false, cellsrenderer: inputRenderer
//                                            createeditor: function (row, value, editor) {
//                                                editor.jqxDropDownList({source: dataTypesList});
//                                            }
                                        },
                                        {text: 'Size', datafield: 'columnsize', width: 100, editable: false, cellsrenderer: inputRenderer},
//                                        {text: 'Byte/Char', datafield: 'byteOrChar', width: 100, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'Precision', datafield: 'precision', width: 100, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'Scale', datafield: 'scale', width: 100, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'Not Null', datafield: 'notNull', width: 100, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'Default value', datafield: 'defaultValue', width: 200, editable: false, cellsrenderer: inputRenderer},
                                        {text: 'alterTableHidden', datafield: 'alterTableHidden', hidden: true},
                                    ]
                                });



                        $("[id^=tableAlter]").change(function (event) {

                            var target = event.target;
                            var oldvalue = $(target).attr("initval");
                            var value;
                            var dataField = $(target).attr("dataField");
                            // validations
                            var rowIndex = $(target).attr("id").split("_")[1];
                            var columnName = $("#alterTablecolumnName_" + rowIndex).attr("initval");
                            if (dataField == "datatypeName") {
                                value = $(target).val();
                                if (value == "NUMBER" || value == "NUMERIC" || value == "DECIMAL") {
                                    $("#alterTableColumnSize_" + rowIndex).val("");
                                    $("#alterTableColumnSize_" + rowIndex).attr('readonly', true);

                                    $("#alterTablePrecision_" + rowIndex).val("");
                                    $("#alterTablePrecision_" + rowIndex).attr('readonly', false);


                                    $("#alterTableScale_" + rowIndex).attr('readonly', false);
                                }
                                if (value == "FLOAT") {
                                    $("#alterTableColumnSize_" + rowIndex).val("");
                                    $("#alterTableColumnSize_" + rowIndex).attr('readonly', true);

                                    $("#alterTablePrecision_" + rowIndex).attr('readonly', false);

                                    $("#alterTablePrecision_" + rowIndex).val("");
                                    $("#alterTableScale_" + rowIndex).attr('readonly', true);
                                }
                                if (value == "INTERGER" || value == "DATE" || value == "LONG" || value == "LONG RAW"
                                        || value == "ROWID" || value == "MLSLABEL" || value == "CLOB" || value == "NCLOB"
                                        || value == "BLOB" || value == "BFILE" || value == "BINARY_DOUBLE" || value == "BINARY_FLOAT"
                                        || value == "URITYPE" || value == "DOUBLE PRECISION" || value == "SMALLINT" || value == "REAL"
                                        || value == "URITYPE" || value == "TIMESTAMP") {
                                    $("#alterTableColumnSize_" + rowIndex).val("");
                                    $("#alterTableColumnSize_" + rowIndex).attr('readonly', true);

                                    $("#alterTablePrecision_" + rowIndex).val("");
                                    $("#alterTablePrecision_" + rowIndex).attr('readonly', true);

                                    $("#alterTableScale_" + rowIndex).val("");
                                    $("#alterTableScale_" + rowIndex).attr('readonly', true);
                                }
                                if (value == "VARCHAR" || value == "VARCHAR2" || value == "CHAR" || value == "NVARCHAR2"
                                        || value == "RAW" || value == "CHAR VARYING" || value == "CHARACTER" || value == "CHARACTER VARYING"
                                        || value == "NATIONAL CHAR" || value == "NATIONAL CHARACTER" || value == "NATIONAL CHARACTER VARYING"
                                        || value == "NCHAR VARYING") {

                                    $("#alterTableColumnSize_" + rowIndex).attr('readonly', false);

                                    $("#alterTablePrecision_" + rowIndex).val("");
                                    $("#alterTablePrecision_" + rowIndex).attr('readonly', true);

                                    $("#alterTableScale_" + rowIndex).val("");
                                    $("#alterTableScale_" + rowIndex).attr('readonly', true);

                                }
                            }

                            $("#tableAlterGrid").jqxGrid('endrowedit', rowIndex, false);
                            // validations end
                            var rowData = $("#tableAlterGrid").jqxGrid('getrowdata', rowIndex);
                            var dataFieldsObj = alterTableData[columnName];
                            if (dataFieldsObj == null) {
                                dataFieldsObj = {};
                            }

                            if (dataField != null) {
                                if (dataField == "columnName") {
                                    value = $(target).val();
                                    if (value != null && oldvalue != value) {
                                        dataFieldsObj[dataField] = value;
                                        alterTableData[columnName] = dataFieldsObj;
                                    }
                                } else if (dataField == "primaryKey") {
                                    var checked = $(target).prop("checked");
                                    if (checked) {
                                        $(target).val("Y")
                                        value = $(target).val();
                                    } else {
                                        $(target).val("N")
                                        value = $(target).val();
                                    }
                                    if (value != null && oldvalue != value) {
                                        dataFieldsObj[dataField] = value;
                                        alterTableData[columnName] = dataFieldsObj;
                                    }

                                } else if (dataField == "datatypeName" || dataField == "columnsize"
                                        || dataField == "byteOrChar" || dataField == "precision" || dataField == "scale") {
                                    value = $(target).val();
                                    if (value != null && oldvalue != value) {
                                        dataFieldsObj['datatypeName'] = $("#alterTableDataType_" + rowIndex).val();
                                        dataFieldsObj['columnsize'] = $("#alterTableColumnSize_" + rowIndex).val();
//                                      dataFieldsObj['byteOrChar'] = $("#alterTablebyteOrChar_" + rowIndex).val();
                                        dataFieldsObj['precision'] = $("#alterTableprecision_" + rowIndex).val();
                                        dataFieldsObj['scale'] = $("#alterTableScale_" + rowIndex).val();
                                        alterTableData[columnName] = dataFieldsObj;
                                    }
                                } else if (dataField == "notNull") {
                                    var checked = $(target).prop("checked");
                                    if (checked) {
                                        $(target).val("NOT NUL")
                                        value = "NOT NULL";
                                    } else {
                                        $(target).val("NULL")
                                        value = "NULL"
                                    }
                                    if (value != null && oldvalue != value) {
                                        dataFieldsObj[dataField] = value;
                                        alterTableData[columnName] = dataFieldsObj;
                                    }
                                } else if (dataField == "defaultValue") {
                                    value = $(target).val();
                                    if (value != null && oldvalue != value) {
                                        dataFieldsObj[dataField] = value;
                                        alterTableData[columnName] = dataFieldsObj;
                                    }
                                }





                            }

                        });


                        $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
                        $(".visionHeaderMain").css("z-index", "999");
                        $(".visionFooterMain").css("z-index", "999");
                    },
                    beforeClose: function (event, ui)
                    {
                        $(".visionHeaderMain").css("z-index", "99999");
                        $(".visionFooterMain").css("z-index", "99999");
                    }
                });
            }




        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function addRecordToAlterTableGrid() {
    var rowData = {};
    rowData['alterTableHidden'] = 'INSERT';
    $("#tableAlterGrid").jqxGrid('addrow', null, rowData, 'last');
}

function commitAlterTable(tableName, connectionObj) {

    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'json',
        cache: false,
        url: 'executeAlterTable',
        async: true,
        data: {
            tableName: tableName,
            connObj: connectionObj,
            alterTableData: JSON.stringify(alterTableData),
            existingPKcols: $("#alterTablePKList").val()
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
//                var responseObj = JSON.parse(response);
                showMesg(response['message']);

                alterTableData = {};
                $("#dialog1").dialog("close");
            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}

function deleteColAlterTable(tableName, connectionObj) {
    var selectedrowindexes = $('#tableAlterGrid').jqxGrid('selectedrowindexes');
    var selectedColumnsList = [];
    $.each(selectedrowindexes, function (i) {
        var caolumnName = $("#alterTablecolumnName_" + selectedrowindexes[i]).attr("initval");
        selectedColumnsList.push(caolumnName);
    })
    $.ajax({
        type: 'post',
        traditional: true,
        dataType: 'json',
        cache: false,
        url: 'dropColumnAlterTable',
        async: true,
        data: {
            tableName: tableName,
            connObj: connectionObj,
            selectedColumnsList: JSON.stringify(selectedColumnsList)
        },
        success: function (response) {
            stopLoader();
            if (response != null) {
//                var responseObj = JSON.parse(response);
                showMesg(response['message']);

                alterTableData = {};
                $("#dialog1").dialog("close");

            }
        },
        error: function (e)
        {
            sessionTimeout(e);
        }

    });
}


function renameOperatorDisplayLabel(title, $this) {
    $("#dialog").html("Rename Display label<br><input id='renameDisplayLabelId' value='' />");
    $("#dialog").dialog({
        title: (labelObject['Message'] != null ? labelObject['Message'] : 'Message'),
        modal: true,
        width: 300,
        height: 135,
        fluid: true,
        buttons: [{
                text: (labelObject['Ok'] != null ? labelObject['Ok'] : 'Ok'),
                click: function () {
                    var changedVal = $("#renameDisplayLabelId").val();
                    var selectedOperatorId = $('#' + flowChartWorkSpaceId).flowchart('getSelectedOperatorId');
                    var body = $('#' + flowChartWorkSpaceId).flowchart('getOperatorBody', selectedOperatorId);

                    body = body.replaceAll(title);
                    $($this).text(changedVal);
                    $(this).html("");
                    $(this).dialog("close");
                    $(this).dialog("destroy");
                }

            }],
        open: function () {
            $(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("dialogyes");
            $(".visionHeaderMain").css("z-index", "999");
            $(".visionFooterMain").css("z-index", "999");
        },
        beforeClose: function (event, ui)
        {
            $(".visionHeaderMain").css("z-index", "99999");
            $(".visionFooterMain").css("z-index", "99999");
        }
    });
}

function showEtlComponents() {
//    $("#etlIconGroup").toggle("slide");
    $('#etlIconGroup').toggle('slide', {direction: 'right'}, 500);
}


function setToOpDblCLickFuncName(fromOperatorId, toOperatorId) {
    var fromOpData = $("#" + flowChartWorkSpaceId).flowchart("getOperatorData", fromOperatorId);
    var toOpData = $("#" + flowChartWorkSpaceId).flowchart("getOperatorData", toOperatorId);
    var fromOpIcon = fromOpData['iconType'];
    if (fromOpIcon == "UNIQUE") {
        setDblCLickFuncNameToOpBody(toOperatorId, toOpData, 'uniqueComponent()')
    } else if (fromOpIcon == "MAP") {
        setDblCLickFuncNameToOpBody(toOperatorId, toOpData, 'viewTrfmRules()')
    }
}

function setDblCLickFuncNameToOpBody(toOperatorId, toOpData, functionName) {
    var body = $("#" + flowChartWorkSpaceId).flowchart("getOperatorBody", toOperatorId);
    $("#tempBodyDiv").remove();
    $('body').append("<div style='display:none;' id='tempBodyDiv'></div>")
    $("#tempBodyDiv").html(body);
    $("#tempBodyDiv").children(0).attr("ondblclick", functionName);
    var newBody = $("#tempBodyDiv").html();
    $('#' + flowChartWorkSpaceId).flowchart('setOperatorBody', toOperatorId, newBody);
    $("#tempBodyDiv").remove();
}




